2020/09/07 00:01:39.924 [E]  QQLuaVmRun CallGlobal err <string>:981: attempt to index a non-table object(nil) with key 'songname'
stack traceback:
	<string>:981: in function 'music'
	<string>:204: in main chunk
	[G]: ? detail File mimoio.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{581168848 Diamondäº‹åŠ¡æ‰€Â·ä¼Â·æ¥¼ 1615583730 âŠ™Ï‰âŠ™ ç‚¹æ­Œfuck you TextMsg 1599408099 536923 430743515 <nil>} 
2020/09/07 00:01:56.932 [E]  QQLuaVmRun CallGlobal err <string>:981: attempt to index a non-table object(nil) with key 'songname'
stack traceback:
	<string>:981: in function 'music'
	<string>:204: in main chunk
	[G]: ? detail File mimoio.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{581168848 Diamondäº‹åŠ¡æ‰€Â·ä¼Â·æ¥¼ 1615583730 âŠ™Ï‰âŠ™ ç‚¹æ­Œfuckyou TextMsg 1599408116 536924 1010941048 <nil>} 
2020/09/07 07:39:23.222 [E]  QQLuaVmRun CallGlobal err <string>:1060: attempt to index a non-table object(nil) with key 'GroupID'
stack traceback:
	<string>:1060: in function 'CheHui'
	<string>:417: in main chunk
	[G]: ? detail File mimoio.lua when  call ReceiveEvents params [0] 1689236904  [1] &{383770908 0 ON_EVENT_GROUP_REVOKE 136531 ç¾¤æˆå‘˜æ’¤å›æ¶ˆæ¯äº‹ä»¶ <nil>}  [2] map[AdminUserID:1689236904 GroupID:383770908 MsgRandom:192078835 MsgSeq:136531 UserID:1689236904]
2020/09/07 08:37:50.229 [E]  QQLuaVmRun CallGlobal err Unknow Lua Function:ReceiveEvents detail File weatherfy4a.lua when  call ReceiveEvents params [0] 1689236904  [1] &{661780072 0 ON_EVENT_GROUP_REVOKE 124771 ç¾¤æˆå‘˜æ’¤å›æ¶ˆæ¯äº‹ä»¶ <nil>}  [2] map[AdminUserID:2369500214 GroupID:661780072 MsgRandom:649559175 MsgSeq:124771 UserID:2369500214]
2020/09/07 08:44:58.756 [E]  QQLuaVmRun CallGlobal err <string>:1060: attempt to index a non-table object(nil) with key 'GroupID'
stack traceback:
	<string>:1060: in function 'CheHui'
	<string>:417: in main chunk
	[G]: ? detail File mimoio.lua when  call ReceiveEvents params [0] 1689236904  [1] &{383770908 0 ON_EVENT_GROUP_REVOKE 136535 ç¾¤æˆå‘˜æ’¤å›æ¶ˆæ¯äº‹ä»¶ <nil>}  [2] map[AdminUserID:1689236904 GroupID:383770908 MsgRandom:1317682263 MsgSeq:136535 UserID:1689236904]
2020/09/07 11:13:28.509 [E]  mimoio.lua
2020/09/07 11:13:28.510 [E]  local log = require("log")
local Api = require("coreApi")
local json = require("json")
local http = require("http")
local mysql = require("mysql")

--ç‰ˆæœ¬å·(ä¸è¦æ”¹åŠ¨)
Vabr = "1.0.2"
--æ•°æ®åº“é…ç½®
mysqlhost = "localhost"--é»˜è®¤ä¸åŠ¨
mysqldb = "ffaxx001"--æ•°æ®åº“å
mysqluser = "ffaxx001"--æ•°æ®åº“ç”¨æˆ·å
mysqlpass = "123456"--æ•°æ®åº“å¯†ç 
--ä¸ä½¿ç”¨è¯·ä¸è¦æ”¹åŠ¨

function ReceiveFriendMsg(CurrentQQ, data)
    if (data.Content == "ä½¿ç”¨æ–¹æ³•") then
	    sendfrimsg(CurrentQQ,data,"æ·»åŠ æˆæƒè€…çš„æ–¹æ³•\nå¯¹å•ä¸ªæœºå™¨äººç§èŠå‘é€[æ·»åŠ æˆæƒè€…+æˆæƒè€…QQ]\n\næˆæƒç¾¤çš„æ–¹æ³•\nåˆ°éœ€è¦æˆæƒçš„ç¾¤é‡Œå‘é€[æˆæƒ+ä¸»äººQQ]ã€‚æ³¨æ„:æˆæƒå¿…é¡»æ˜¯æˆæƒè€…è¿›è¡Œæ“ä½œ,ç®¡ç†å‘˜æˆæƒä¸äº†")
	end
    --æ•°æ®åˆå§‹åŒ–
    if (data.Content == "åˆå§‹åŒ–") then
	    root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root ~= nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´è¯·ä¸è¦é‡å¤åˆå§‹åŒ–")
			return 1
		end
    --os.execute('mkdir mimoio/æœºå™¨æˆæƒ')
	    os.execute('mkdir mimoio')
		os.execute('mkdir mimoio/å¤è¯»æœº')
		os.execute('mkdir mimoio/å¤è¯»æœº/æ¬¡æ•°')
		os.execute('mkdir mimoio/å¤è¯»æœº/å†…å®¹')
		os.execute('mkdir mimoio/æœºå™¨æˆæƒ')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨ä¸»äºº')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨èŠå¤©')
		os.execute('mkdir mimoio/æœºå™¨è°ƒæ•™')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æŠ¢çº¢åŒ…')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æœºå™¨èŠå¤©')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æœºå™¨å¼€å…³')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æ’¤å›æ£€æµ‹')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/å›¾ç‰‡è§£æ')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/è§†é¢‘è§£æ')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/é—ªç…§æ£€æµ‹')
		Wirte("mimoio\/"..data.FromUin..".txt","999")
		sendfrimsg(CurrentQQ,data,"åˆå§‹åŒ–å®Œæ¯•ï¼\nå‘é€[ä½¿ç”¨æ–¹æ³•]äº†è§£ä½¿ç”¨å§")
	end
	--æ·»åŠ æˆæƒè€…æ“ä½œ(ç§èŠæœºå™¨äººå‘é€)
	if (string.find(data.Content, "^æ·»åŠ æˆæƒè€…")) then
	    msg = data.Content:gsub("æ·»åŠ æˆæƒè€…", "")
		--Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromUin..".txt","å…³é—­")
		root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root == nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„ç®¡ç†è€…")
			return 1
		end
		Wirte("mimoio\/æœºå™¨æˆæƒ\/"..msg..CurrentQQ..".txt","999")
		sendfrimsg(CurrentQQ,data,"âˆ´æ·»åŠ æˆæƒè€…æˆåŠŸ")
	end
	--åˆ é™¤æˆæƒè€…æ“ä½œ(ç§èŠæœºå™¨äººå‘é€)
	if (string.find(data.Content, "^åˆ é™¤æˆæƒè€…")) then
	    msg = data.Content:gsub("åˆ é™¤æˆæƒè€…", "")
		--Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromUin..".txt","å…³é—­")
		root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root == nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„ç®¡ç†è€…")
			return 1
		end
		os.remove("mimoio\/æœºå™¨æˆæƒ\/"..msg..CurrentQQ..".txt")
		sendfrimsg(CurrentQQ,data,"âˆ´åˆ é™¤æˆæƒè€…æˆåŠŸ")
	end
    return 1
end
function ReceiveGroupMsg(CurrentQQ, data)
    if (tostring(data.FromUserId) == CurrentQQ) then
	    return 1
	end
	--ç¾¤èŠæˆæƒ(åˆ°éœ€è¦æˆæƒçš„ç¾¤é‡Œæ“ä½œ)
	if (string.find(data.Content, "^æˆæƒ")) then
	    root = Read("mimoio\/æœºå™¨æˆæƒ\/"..data.FromUserId..CurrentQQ..".txt","999")
		if (root == nil) then
		    sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„æˆæƒè€…")
			return 1
		end
		msg = data.Content:gsub("æˆæƒ", "")
		os.execute('mkdir mimoio/æœºå™¨è°ƒæ•™/'..data.FromGroupId)
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨ä¸»äºº/'..data.FromGroupId)
		Wirte("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..msg..".txt","999")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt","å›å¤èŠå¤©")
		sedmsg(CurrentQQ,data,"âˆ´æˆæƒæˆåŠŸï¼\nå‘é€[å¼€å¯æœºå™¨äºº]ä½¿ç”¨å§")
	end
	--åˆ é™¤æˆæƒæ“ä½œ(åˆ°éœ€è¦åˆ é™¤æˆæƒçš„ç¾¤é‡Œæ“ä½œ)
	if (string.find(data.Content, "^åˆ é™¤æˆæƒ")) then
	    root = Read("mimoio\/æœºå™¨æˆæƒ\/"..data.FromUserId..CurrentQQ..".txt","999")
		if (root == nil) then
		    sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„æˆæƒè€…")
			return 1
		end
		msg = data.Content:gsub("åˆ é™¤æˆæƒ", "")
		os.remove("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..msg..".txt")
		os.remove("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
		sedmsg(CurrentQQ,data,"âˆ´åˆ é™¤æˆæƒæˆåŠŸï¼")
	end
	--æœºå™¨å¼€å…³æŒ‡ä»¤
	if (data.Content == "å¼€å¯æœºå™¨äºº" or data.Content == "å…³é—­æœºå™¨äºº") then
        mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim ~= nil) then
            msg = data.Content:gsub("æœºå™¨äºº", "")
            str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
			if (str == nil) then
			    Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt",msg)
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äºº"..msg.."æˆåŠŸï¼")
				log.info("Str ====> %s", str)
                return 1
			end
			
            if (string.find(str, msg)) then
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äººä¸€ç›´æ˜¯"..msg.."çš„å‘")
                return 1
            end
            Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt",msg)
            sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äºº"..msg.."æˆåŠŸï¼")
            return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
	end
    --æœºå™¨äººå¼€å¯æ£€æµ‹
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
	if (str == nil) then
	    log.info("Str ====> %s", str)
        return 1
	end
	if (string.find(str, "å…³é—­")) then
	    return 1
	end
	--atæ¶ˆæ¯å¤„ç†
	msgs = ""
	atqq = 0
	if (string.find(data.Content, "ATæ¶ˆæ¯")) then
	    msgs = json.decode(data.Content).Content
		atqq = json.decode(data.Content).UserID
	end
	--å°¾å·´è‡ªå®šä¹‰(å¾…å®Œå–„)
	tips = "â€”â€”å‡¤é£ç¿±ç¿”å…®ä¸·"
    --åŠŸèƒ½æ¨¡å—
    if (data.Content == "åŠŸèƒ½" or data.Content == "ä¸»ç•Œé¢") then
        face = faceArray()
        sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."å½±è§†æœç´¢\n"..face.."èŠå¤©å¨±ä¹\n"..face.."ä¾¿åˆ©åŠŸèƒ½\n"..face.."æœºå™¨è°ƒæ•™\n"..face.."ç®¡ç†ç³»ç»Ÿ\n"..face.."bugåé¦ˆ\n"..face.."æœ¬ç¾¤çŠ¶æ€\n"..face.."æ›´æ–°æ£€æµ‹\n\n"..tips)
    end
    --å½±è§†æœç´¢æ¨¡å—
    if (data.Content == "å½±è§†æœç´¢") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."æœç´¢+å½±è§†å\n"..face.."æˆ‘æƒ³çœ‹+å½±è§†å\n"..face.."æˆ‘è¦çœ‹+å½±è§†å\n\n"..tips)
    elseif (string.find(data.Content, "^æœç´¢")) then
	    msg = data.Content:gsub("æœç´¢", "")
		Sousuo(CurrentQQ,data,msg)
	elseif (string.find(data.Content, "^æˆ‘æƒ³çœ‹")) then
	    msg = data.Content:gsub("æˆ‘æƒ³çœ‹", "")
		Sousuo(CurrentQQ,data,msg)
    elseif (string.find(data.Content, "^æˆ‘è¦çœ‹")) then
	    msg = data.Content:gsub("æˆ‘è¦çœ‹", "")
		Sousuo(CurrentQQ,data,msg)
	end
	--èŠå¤©å¨±ä¹æ¨¡å—
	if (data.Content == "èŠå¤©å¨±ä¹") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."åˆ‡æ¢æ–‡å­—èŠå¤©\n"..face.."åˆ‡æ¢å›å¤èŠå¤©\n"..face.."åˆ‡æ¢è¯­éŸ³èŠå¤©\n\n"..tips)
    elseif (data.Content == "åˆ‡æ¢æ–‡å­—èŠå¤©") then
		liaotian(CurrentQQ,data,1)
	elseif (data.Content == "åˆ‡æ¢è¯­éŸ³èŠå¤©") then
	    liaotian(CurrentQQ,data,2)
    elseif (data.Content == "åˆ‡æ¢å›å¤èŠå¤©") then
	    liaotian(CurrentQQ,data,3)
	else
	    ownthink(CurrentQQ,data,msgs,atqq)
	end
	--ä¾¿åˆ©åŠŸèƒ½æ¨¡å—
	if (data.Content == "ä¾¿åˆ©åŠŸèƒ½") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."ç™¾ç§‘å¤§å…¨\n"..face.."éŸ³ä¹ç‚¹æ­Œ\n"..face.."é—ªä»–@xx\n"..face.."å¤©æ°”æŸ¥è¯¢\n\n"..tips)
	elseif (data.Content == "ç™¾ç§‘å¤§å…¨") then
		sedmsg(CurrentQQ,data,"å‘é€:[ç™¾ç§‘+å…³é”®è¯]\nä¾‹å¦‚:ç™¾ç§‘æ´›å¤©ä¾")
    elseif (data.Content == "éŸ³ä¹ç‚¹æ­Œ") then
		sedmsg(CurrentQQ,data,"å‘é€:[ç‚¹æ­Œ+æ­Œå]\nä¾‹å¦‚:ç‚¹æ­Œé’æŸ ")
	elseif (data.Content == "å¤©æ°”æŸ¥è¯¢") then
		sedmsg(CurrentQQ,data,"å‘é€:[å¤©æ°”+åœ°æ–¹å]\nä¾‹å¦‚:å¤©æ°”åŒ—äº¬(é™äºå›½å†…)")
    elseif (string.find(data.Content, "^å¤©æ°”")) then
        tianqi(CurrentQQ,data)
	    --msg = data.Content:gsub("æœç´¢", "")
		--Sousuo(CurrentQQ,data,msg)
	elseif (string.find(data.Content, "^ç™¾ç§‘")) then
	    baike(CurrentQQ,data)
	    --msg = data.Content:gsub("æˆ‘æƒ³çœ‹", "")
		--Sousuo(CurrentQQ,data,msg)music(CurrentQQ,data)
    elseif (string.find(data.Content, "^ç‚¹æ­Œ")) then
	    music(CurrentQQ,data)
	end
	--æœºå™¨è°ƒæ•™æ¨¡å—
	if (data.Content == "æœºå™¨è°ƒæ•™") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."æ–‡å­—è°ƒæ•™\n"..face.."è¯­éŸ³è°ƒæ•™\n"..face.."å”±æ­Œè°ƒæ•™\n"..face.."éŸ³ä¹è°ƒæ•™\n"..face.."å›¾ç‰‡è°ƒæ•™\n"..face.."åˆ é™¤è°ƒæ•™\n\n"..tips)
    elseif (data.Content == "æ–‡å­—è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#(å†…å®¹)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#ä½ å¥½å•Š")
	elseif (data.Content == "è¯­éŸ³è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#è¯­éŸ³(å†…å®¹)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#è¯­éŸ³ä½ å¥½å•Š")
	elseif (data.Content == "å›¾ç‰‡è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#å›¾ç‰‡(é“¾æ¥)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#å›¾ç‰‡http://../1.jpg")
	elseif (data.Content == "éŸ³ä¹è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#ç‚¹æ­Œ(æ­Œå)]\nä¾‹å¦‚:è°ƒæ•™å–µ#ç‚¹æ­Œå­¦çŒ«å«")
	elseif (data.Content == "å”±æ­Œè°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#å”±æ­Œ(æ­Œå)]\nä¾‹å¦‚:è°ƒæ•™å–µ#å”±æ­Œå­¦çŒ«å«")
	elseif (data.Content == "åˆ é™¤è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[åˆ é™¤è°ƒæ•™(æŒ‡ä»¤)]\nä¾‹å¦‚:åˆ é™¤è°ƒæ•™ä½ å¥½")
	elseif (string.find(data.Content, "^è°ƒæ•™")) then
        tiaojiao(CurrentQQ,data)
	elseif (string.find(data.Content, "^åˆ é™¤è°ƒæ•™")) then
        tiaojiao(CurrentQQ,data)
	end
	--ç®¡ç†ç³»ç»Ÿæ¨¡å—
	if (data.Content == "ç®¡ç†ç³»ç»Ÿ") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."å¼€å¯/å…³é—­æœºå™¨äºº\n"..face.."å¼€å¯/å…³é—­æŠ¢çº¢åŒ…\n"..face.."å¼€å¯/å…³é—­æœºå™¨èŠå¤©\n"..face.."å¼€å¯/å…³é—­é—ªç…§æ£€æµ‹\n"..face.."å¼€å¯/å…³é—­å›¾ç‰‡è§£æ\n"..face.."å¼€å¯/å…³é—­è§†é¢‘è§£æ\n"..face.."å¼€å¯/å…³é—­æ’¤å›æ£€æµ‹\n\n"..tips)
    elseif (data.Content == "å¼€å¯æœºå™¨èŠå¤©" or data.Content == "å…³é—­æœºå™¨èŠå¤©") then
        adminio(CurrentQQ,data,"æœºå™¨èŠå¤©")
    elseif (data.Content == "å¼€å¯æ’¤å›æ£€æµ‹" or data.Content == "å…³é—­æ’¤å›æ£€æµ‹") then
        adminio(CurrentQQ,data,"æ’¤å›æ£€æµ‹")
	elseif (data.Content == "å¼€å¯é—ªç…§æ£€æµ‹" or data.Content == "å…³é—­é—ªç…§æ£€æµ‹") then
        adminio(CurrentQQ,data,"é—ªç…§æ£€æµ‹")
	elseif (data.Content == "å¼€å¯æŠ¢çº¢åŒ…" or data.Content == "å…³é—­æŠ¢çº¢åŒ…") then
        adminio(CurrentQQ,data,"æŠ¢çº¢åŒ…")
	elseif (data.Content == "å¼€å¯è§†é¢‘è§£æ" or data.Content == "å…³é—­è§†é¢‘è§£æ") then
        adminio(CurrentQQ,data,"è§†é¢‘è§£æ")
	elseif (data.Content == "å¼€å¯å›¾ç‰‡è§£æ" or data.Content == "å…³é—­å›¾ç‰‡è§£æ") then
        adminio(CurrentQQ,data,"å›¾ç‰‡è§£æ")
	end
	--bugåé¦ˆæ¨¡å—
	if (data.Content == "BUGåé¦ˆ" or data.Content == "bugåé¦ˆ") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."é‚®ä»¶åé¦ˆ\n"..face.."QQåé¦ˆ\n\n"..tips)
    elseif (data.Content == "QQåé¦ˆ") then
        sedmsg(CurrentQQ,data,"???Î£(ï¾Ÿâˆ€ï¾Ÿï¾‰)ï¾‰\næ’ä»¶æœ‰é—®é¢˜å¯ä»¥åé¦ˆåˆ°:\nQQ:2353065854")
    elseif (data.Content == "é‚®ä»¶åé¦ˆ") then
        sedmsg(CurrentQQ,data,"å®è´å’‹å•¦=ÍÍŸÍŸÍ(ê’ªá—œê’ª â€§Ì£Ì¥Ì‡)\næ’ä»¶æœ‰é—®é¢˜å¯ä»¥åé¦ˆåˆ°:\né‚®ç®±ğŸ“¬:ym-o@qq.com")
	end
	--æœ¬ç¾¤çŠ¶æ€æ¨¡æ¿
	if (data.Content == "æœ¬ç¾¤çŠ¶æ€") then
        face = faceArray()
        hb = Read("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt")
        sz = Read("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt")
		tp = Read("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt")
        sp = Read("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt")
        jqr = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
        lt = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
        ch = Read("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..data.FromGroupId..".txt")
		sedmsg(CurrentQQ,data,"çŠ¶æ€æ•°æ®åˆ—è¡¨â†“â†“â†“\n"..face.."æœºå™¨äºº:"..jqr.."\n"..face.."æŠ¢çº¢åŒ…:"..hb.."\n"..face.."å›¾ç‰‡è§£æ:"..tp.."\n"..face.."æ’¤å›æ£€æµ‹:"..ch.."\n"..face.."è§†é¢‘è§£æ:"..sp.."\n"..face.."æœºå™¨èŠå¤©:"..lt.."\n"..face.."é—ªç…§æ£€æµ‹:"..sz.."\n\n"..tips)
	end
	--æ›´æ–°æ¨¡å—
	if (data.Content == "æ›´æ–°æ£€æµ‹") then
        str = geturl("GET","http://118.25.41.32/Lsb/lua/Vabr.txt","")
		log.info("Str ====> %s", str)
        if (string.find(str, Vabr)) then
            sedmsg(CurrentQQ,data,"å½“å‰ç‰ˆæœ¬ä¸ºæœ€æ–°ç‰ˆ")
        else
            sedmsg(CurrentQQ,data,"å‘ç°æ–°ç‰ˆæœ¬!\nå½“å‰ç‰ˆæœ¬:"..Vabr.."\næ–°ç‰ˆæœ¬å·:"..str.."\nèµ¶å¿«å‘é€[æ›´æ–°æ’ä»¶]å§")
        end
	elseif (data.Content == "æ›´æ–°æ’ä»¶") then
	    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim == nil) then
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
        str = geturl("GET","http://118.25.41.32/Lsb/lua/Vabr.txt","")
		log.info("Str ====> %s", str)
        if (string.find(str, Vabr)) then
            sedmsg(CurrentQQ,data,"å½“å‰ç‰ˆæœ¬ä¸ºæœ€æ–°ç‰ˆ")
        else
            str = geturl("GET","http://118.25.41.32/Lsb/lua/mimoio.txt","")
            Wirte("Plugins\/mimoio.lua",str)
            sedmsg(CurrentQQ,data,"æ›´æ–°å®Œæ¯•ï¼")
        end
	end
	--å›¾ç‰‡ç±»å‹æ¶ˆæ¯å¤„ç†
    if (data.MsgType == "PicMsg") then
	    msg = Read("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt")
		jData = json.decode(data.Content)
	    if (msg ~= nil and jData.tips ~= "[ç¾¤æ¶ˆæ¯-QQé—ªç…§]") then
            if (string.find(str, "å¼€å¯")) then
	            sedmsg(CurrentQQ,data,"å›¾ç‰‡é“¾æ¥è§£æå¦‚ä¸‹â†“â†“\n"..jData.url)
				return 1
	        end
	    end
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt")
	    if (str == nil) then
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    --é—ªç…§ã€å›¾ç‰‡å¤„ç†æ¨¡å—
		PicFlag(CurrentQQ, data)
    end
	--æŠ¢çº¢åŒ…å¤„ç†
	if (string.find(data.MsgType, "RedBagMsg") == 1) then
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt")
		if (str == nil) then
	        log.info("Str ====> %s", str)
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    RedBag(CurrentQQ, data)
	end
	--è§†é¢‘è§£æå¤„ç†
	if (string.find(data.MsgType, "VideoMsg") == 1) then
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt")
		if (str == nil) then
	        log.info("Str ====> %s", str)
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    Video(CurrentQQ, data)
	end
	--até—ªå›¾
	if (data.MsgType == "AtMsg") and (string.find(data.Content, "é—ªä»–")) then
	    shantu(CurrentQQ, data)
    end
	--è°ƒæ•™æœç´¢å¼•æ“
	mim = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..data.Content..".txt")
	if (mim == nil) then
	    --äººç±»çš„æœ¬è´¨æ˜¯å¤è¯»æœº
	    msg = Read("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt")
		if (msg ~= nil) then
		    cs = Read("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt")
			ii = tonumber(cs)
			if (string.find(msg, "^"..data.Content.."$")) then
			    if (ii > 2) then
			         math.randomseed(os.time())
                     sj = math.random(1, 5)
		             if (sj == 1 or sj == 2) then
			             sedmsg(CurrentQQ,data,msg)
					     rr = ii + 1
		                 Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
				     elseif (sj == 3) then
				         os.remove("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt")
					     os.remove("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt")
					     fdArray = {"çªç„¶æˆªæ–­å¤è¯»(ï¾ŸâŠ¿ï¾Ÿ)ï¾‚","å¤è¯»å¯è€»(â€¢Ì€ã¸ â€¢Ì â•® )","ä¸è¦å¤è¯»äº†å•¦","è¿™å°±æ˜¯æ‰€è°“çš„äººç±»çš„æœ¬è´¨","ä½ ä»¬å’‹ä¸ä¸Šå¤©å‘","åˆå¤è¯»ä¸Šç˜¾äº†å•Š"}
                         math.randomseed(os.time())
                         fdsj = math.random(1, 6)
				         sedmsg(CurrentQQ,data,fdArray[fdsj])
				     else
			             rr = ii + 1
		                 Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
		             end
			    else
			        rr = ii + 1
		            Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
			    end
			else
			    if (ii > 2) then
			        math.randomseed(os.time())
                    sj2 = math.random(1, 3)
					if (sj2 == 2) then
					    fdArray2 = {"ä¸­æ–­å¤è¯»å¯è€»","æ‰“æ–­å¤è¯»å¯è€»(â€¢Ì€ã¸ â€¢Ì â•® )","ä½ ä¸ºä»€ä¹ˆè¦æ‰“æ–­å¤è¯»å•Š","å¤è¯»ä¸é¦™å˜›","ç ´åæ°›å›´(à¸‡áµ’ÌŒçš¿áµ’ÌŒ)à¸‡â¼Â³â‚Œâ‚ƒ"}
                        math.randomseed(os.time())
                        fdsj2 = math.random(1, 5)
				        sedmsg(CurrentQQ,data,fdArray2[fdsj2])
					end
				end
				Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt","1")
			    Wirte("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt",data.Content)
			end
		else
		    Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt","1")
			Wirte("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt",data.Content)
		end
	    --å¦‚æœè°ƒæ•™æŒ‡ä»¤ä¸å­˜åœ¨ï¼Œåˆ™è¿›è¡Œå…¶ä»–æ“ä½œ
	    msgsql(CurrentQQ,data)--æ•°æ®å‚¨è“„
		--éšæœºå›å¤æ¶ˆæ¯æ¦‚ç‡0.04
	    math.randomseed(os.time())
        num = math.random(1, 40)
		if (num == 12) then
		    j = xiaosiapi(CurrentQQ,data,data.Content)
			sedmsg(CurrentQQ,data,j.data.info.text)
		end
	else
	    --è§¦å‘è°ƒæ•™æŒ‡ä»¤
		funic(CurrentQQ,data,mim)
	end
    return 1
end

function ReceiveEvents(CurrentQQ, data, extData)
  if data.MsgType == "ON_EVENT_GROUP_REVOKE" then --ç›‘å¬ ç¾¤æ’¤å›äº‹ä»¶
    --æ’¤å›äº‹ä»¶å¤„ç†
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..extData.GroupID..".txt")
    if (str == nil) then
	    log.info("Str ====> %s", str)
        return 1
	end
	if (string.find(str, "å…³é—­")) then
		return 1
	end
	CheHui(CurrentQQ, data, extData)
	--xxxxxxxxxxxxxxx
    return 1
  end
  --è¿›ç¾¤ç§€å›¾æ¬¢è¿

end

  if (string.find(data.MsgType, "ON_EVENT_GROUP_JOIN") == 1) then
      --æœºå™¨äººå¼€å¯æ£€æµ‹
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromUin..CurrentQQ..".txt")
	if (str == nil) then
	    log.info("Str ====> %s", str)
        return 1
	end
	if (string.find(str, "å…³é—­")) then
	    return 1
	end
      xiutu(CurrentQQ, data, extData)
  end
end

--ç§€å›¾å‡½æ•°
function xiutu(CurrentQQ, data, extData)
    math.randomseed(os.time())
    num = math.random(40001, 40002)
    Api.Api_SendMsg( --é€šè¿‡å›¾ç‰‡md5å‘é€å›¾ç‰‡ ç§’å‘ä¸ç”¨ä¸Šä¼  ç›¸å½“äºè½¬å‘
           CurrentQQ,
           {
               toUser = data.FromUin,
               sendToType = 2,
               sendMsgType = "PicMsg",
               --å‘é€å›¾æ–‡æ¶ˆæ¯
               content = string.format("[ç§€å›¾%d]æ¬¢è¿ã€%sã€‘åŠ å…¥[PICFLAG]",40002,extData.UserName),
               --é€šè¿‡å®[PICFLAG]æ”¹å˜å›¾æ–‡é¡ºåº  æ”¹ä¸ºç°æ–‡å­—åå›¾ç‰‡
               --é€šè¿‡å®[ç§€å›¾40001] èŒƒå›´ 40000-40006 å®ç°ç§€å›¾å‘é€ ç¾¤æœ‰æ•ˆå¥½å‹æ— æ•ˆ
               atUser = 0,
               picUrl = "http://q1.qlogo.cn/g?b=qq&nk=".. extData.UserID .. "&s=640",
               picBase64Buf = "",
               fileMd5 = ""
           }
       )
end

--é—ªå›¾æ£€æµ‹å¤„ç†
function shantu(CurrentQQ, data)
        math.randomseed(os.time())
        ShowType = math.random(40001, 40002)
        jData = json.decode(data.Content)
        Api.Api_SendMsg( --é€šè¿‡Urlå‘é€å›¾ç‰‡
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "PicMsg",
                --å‘é€å›¾æ–‡æ¶ˆæ¯
                content = string.format("[ç§€å›¾%d]", ShowType),
                --é€šè¿‡å®[PICFLAG]æ”¹å˜å›¾æ–‡é¡ºåº  æ”¹ä¸ºç°æ–‡å­—åå›¾ç‰‡
                --é€šè¿‡å®[ç§€å›¾40001] èŒƒå›´ 40000-40005 å®ç°ç§€å›¾å‘é€ ç¾¤æœ‰æ•ˆå¥½å‹æ— æ•ˆ
                atUser = 0,
                voiceUrl = "",
                voiceBase64Buf = "",
                picUrl = "http://q1.qlogo.cn/g?b=qq&nk=" .. jData.UserID .. "&s=640",
                picBase64Buf = "",
                fileMd5 = ""
            }
        )
		return 1
end

--é—ªç…§æ£€æµ‹å¤„ç†


--åŠŸèƒ½ç»„
function funic(CurrentQQ,data,msg)
    if string.find(msg, "^ç‚¹æ­Œ") then
	    data.Content = msg
        music(CurrentQQ,data,msg)
		return 1
	elseif string.find(msg, "^è¯­éŸ³") then
	    keyWord = msg:gsub("è¯­éŸ³", "")
        sedvoicemsg(CurrentQQ,data,keyWord)
		return 1
	elseif string.find(msg, "^å›¾ç‰‡") then
	    keyWord = msg:gsub("å›¾ç‰‡", "")
        sedimgmsg(CurrentQQ,data,keyWord,"")
		return 1
    elseif string.find(msg, "^å”±æ­Œ") then
        keyWord = msg:gsub("å”±æ­Œ", "")
		if (keyWord == "") then
		    sedmsg(CurrentQQ,data,"æ­Œåä¸èƒ½ç©ºç€å“¦")
		    return 1
		end
		sedmsg(CurrentQQ,data,"å¤©ä¾æ­£åœ¨åŠªåŠ›åŠ è½½Ù©(ËƒÌ¶Ì€Íˆà¯°Ë‚Ì¶ÌÍˆ)Ùˆ")
        response, error_message =
            http.request(
            "POST",
            "http://127.0.0.1:8888/SilkApi/UrlToBuf",--ä¿®æ”¹æ­¤å¤„ipåŠç«¯å£å³å¯
            {
                body = keyWord --ä¼ å…¥æ­Œæ›²å
            }
        )
        log.notice("err   %v", error_message)
        html = response.body --è¿”å›silk base64 buf
		if (string.find(html, "Î´")) then
				    sedmsg(CurrentQQ,data,"å¤©ä¾æ²¡æœ‰æ‰¾åˆ°ç›¸å…³çš„æ­Œå‘€(Ã’Ï‰Ã“×±)ï¼")
					c.close(c)
				    return 2
				end
        luaRes =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "VoiceMsg",
                groupid = 0,
                content = "",
                atUser = 0,
                voiceUrl = "",
                voiceBase64Buf = html 
            }
        )
		return 1
	end
    sedmsg(CurrentQQ,data,msg)
end

--å½±è§†æœç´¢ç”¨
function Sousuo(CurrentQQ,data,msg)
    response, error_message =
        http.request(
            "GET",
            "http://localhost/index.php/ajax/suggest",
            {
                query = "mid=1&f=admin&wd="..msg.."&limit=10&timestamp=1567914326746"
            }
        )
    html = response.body
	json = json.decode(html)
	if (json.total == 0) then
	    sedmsg(CurrentQQ,data,"å½±è§†æŸ¥è¯¢é”™è¯¯\nè¯·æ£€æŸ¥å½±è§†åæ˜¯å¦æ­£ç¡®\nâ•â•â•â•â•â•â•â•â•â•â•\næ³¨æ„âš ï¸å½±è§†åä¸è¦å¸¦æ— å…³æˆ–å¤šä½™çš„å­—ç¬¦")
	else
        sedmsg(CurrentQQ,data,"èµ„æºåœ°å€å¦‚ä¸‹â†“â†“â†“\nâ•â•â•â•â•â•â•â•â•â•\nhttp://118.25.41.32/index.php/vod/search/wd/"..escape(msg)..".html\nâ•â•â•â•â•â•â•â•â•â•â•\næ³¨æ„:å¦‚æœQQå‡ºç°åœæ­¢è®¿é—®ç°è±¡ï¼Œè¯·å¤åˆ¶é“¾æ¥ç”¨æµè§ˆå™¨æ‰“å¼€")
	end
end

--å•çº¯å‘æ¶ˆæ¯å›¾æ–‡é€šç”¨
function sedimgmsg(CurrentQQ,data,url,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "PicMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = url,
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘æ¶ˆæ¯ç”¨
function sedmsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "TextMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘ç§èŠæ¶ˆæ¯ç”¨
function sendfrimsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromUin,
        sendToType = 1,
        sendMsgType = "TextMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘jsonæ¶ˆæ¯ç”¨
function sedjsonmsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "JsonMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--èŠå¤©æ¨¡å—åˆ‡æ¢å‡½æ•°
function liaotian(CurrentQQ,data,msg)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
    if (mim == nil) then
        sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
        return 1
    end
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
	if (str == nil) then
        return 1
    end
	if (string.find(str, "å…³é—­")) then
	    sedmsg(CurrentQQ,data,"æœºå™¨èŠå¤©å¤„äºå…³é—­çŠ¶æ€\nâˆ´è¯·å…ˆå¼€å¯æœºå™¨èŠå¤©")
	    return 1
	end
	--åˆ‡æ¢å¤„ç†
	file = io.open("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt", "w")
	if (msg == 1) then
	    file:write("æ–‡å­—èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°æ–‡å­—èŠå¤©")
	elseif (msg == 2) then
	    file:write("è¯­éŸ³èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°è¯­éŸ³èŠå¤©")
	elseif (msg == 3) then
	    file:write("å›å¤èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°å›å¤èŠå¤©")
	end
	file:close()
end

--éšæœºè¡¨æƒ…å‡½æ•°
function faceArray()
    faceArray = {"[è¡¨æƒ…147]","ğŸ€","ğŸ”¥","ğŸ»","ğŸ’","[è¡¨æƒ…185]","[è¡¨æƒ…219]","[è¡¨æƒ…176]"}
    math.randomseed(os.time())
    num = math.random(1, 9)
    return faceArray[num]
end

--urlç¼–ç è½¬æ¢
function escape(w)
	pattern="[^%w%d%._%-%* ]"
	s=string.gsub(w,pattern,function(c)
		local c=string.format("%%%02X",string.byte(c))
		return c
	end)
	s=string.gsub(s," ","+")
	return s
end

--è¯»å–æ•°æ®å‡½æ•°
function Read(url)
    file = io.open(url, "r")
	if (file == nil) then
	    return nil
	else
        file:seek("set")
	    str = file:read("*a")
	    file:close()
        return str
	end
end

--å†™å…¥æ•°æ®å‡½æ•°
function Wirte(url,msg)
    file = io.open(url, "w+")
    file:write(msg)
	file:close()
    return "ok"
end

--å°æ€èŠå¤©å‡½æ•°
function xiaosiapi(CurrentQQ,data,str)
    response, error_message =
            http.request(
            "GET",
            "https://api.ownthink.com/bot",
            {
                query = "appid="..tostring(data.FromUserId).."&spoken=" .. url_encode(str),
                headers = {
                    Accept = "*/*"
                }
            }
        )
        html = response.body
		jData = json.decode(html)
		return jData
end

--æœºå™¨èŠå¤©å‡½æ•°
function ownthink(CurrentQQ,data,msgs,atqq)
    if (tostring(atqq) == CurrentQQ) then
        m = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
        if (m == nil) then
	        log.info("Str ====> %s", m)
            return 1
	    end
	    if (string.find(m, "å…³é—­")) then
	        sedmsg(CurrentQQ,data,"æœºå™¨èŠå¤©å¤„äºå…³é—­çŠ¶æ€\nâˆ´è¯·å…ˆå¼€å¯æœºå™¨èŠå¤©")
	        return 1
	    end
		res2 = string.find(msgs, " ")
		str = string.sub(msgs,res2)
		jData = xiaosiapi(CurrentQQ,data,str)
		Data = json.decode(data.Content)
		m = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
		if (m == nil) then
	        log.info("Str ====> %s", m)
            return 1
	    end
		if (string.find(m, "å›å¤èŠå¤©")) then
		    Api.Api_SendMsg(
                CurrentQQ,
                {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "ReplayMsg",
                groupid = 0,
                content = jData.data.info.text,
                atUser = 0,
				replayInfo = {
                    MsgSeq = data.MsgSeq,
                    --å›å¤æ¶ˆæ¯çš„Seq
                    MsgTime = data.MsgTime,
                    --å›å¤æ¶ˆæ¯çš„äº‹ä»¶
                    UserID = data.FromUserId,
                    --å›å¤æ¶ˆæ¯å¯¹è±¡
                    RawContent = Data.Content --å›å¤æ¶ˆæ¯çš„åŸå†…å®¹
                }
				}
            )
			return 1
		elseif (string.find(m, "æ–‡å­—èŠå¤©")) then
		    sedmsg(CurrentQQ,data,jData.data.info.text)
		else
		    sedvoicemsg(CurrentQQ,data,url_encode(jData.data.info.text))
		end
    end
end

--å‘é€è¯­éŸ³æ¶ˆæ¯
function sedvoicemsg(CurrentQQ,data,str)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "VoiceMsg",
        groupid = 0,
		voiceUrl = "https://dds.dui.ai/runtime/v1/synthesize?voiceId=qianranfa&speed=0.7&volume=100&audioType=wav&text="..str, --å‘é€è¯­éŸ³çš„ç½‘ç»œåœ°å€ æ–‡æœ¬å‹
        voiceBase64Buf = "",
        content = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å¤©æ°”æŸ¥è¯¢å‡½æ•°
function tianqi(CurrentQQ,data)
    keyWord = data.Content:gsub("å¤©æ°”", "")
        if keyWord == "" then
            return 1
        end

        cookies = Api.Api_GetUserCook(CurrentQQ)

        response, error_message =
            http.request(
            "GET",
            "https://weather.mp.qq.com/cgi-bin/rich",
            {
                query = "g_tk=" .. cookies.Gtk .. "&city=" .. url_encode(keyWord),
                headers = {
                    Referer = "http://weather.mp.qq.com/ark"
                },
                cookies = {
                    uin = CurrentQQ,
                    skey = cookies.Skey
                }
            }
        )
        local html = response.body
        log.notice("From Lua html -->%s", html)

        local j = json.decode(html)
        if j.code ~= 0 then
            return 1
        end

        ApiRet =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "JsonMsg",
                groupid = 0,
                content = string.format(
                    --{"config":{"forward":1,"autosize":1},"prompt":"[åº”ç”¨]å¤©æ°”","app":"com.tencent.weather","ver":"0.0.0.1","view":"RichInfoView","meta":{"richinfo":{"adcode":"101210701","city":"æˆéƒ½","air":"58","min":"20","ts":"1500550866","wind":"1","date":"6æœˆ27æ—¥ å‘¨å››","max":"28","type":"201"}},"desc":"å¤©æ°”"}
                    --[[{"app":"com.tencent.weather","desc":"","meta":{"weather":{"ad":[{"icon":"http://imgcache.qq.com/ac/tq/xz2/tp.jpg","p":"ptype=star","t":"2","title":"æ˜Ÿåº§ | ä»Šå¤©ä¼šå› ä¸ºæ„Ÿæƒ…å’Œå®¶åº­çš„é—®é¢˜ï¼Œå½±å“å·¥ä½œï¼Œè¿˜æœ‰ï¼Œä¹Ÿè¦æ³¨æ„äºº...","url":""},{"icon":"http://imgcache.qq.com/ac/qqweather/image/2019/6/27.png","p":"ptype=lunar","t":"4","title":"é»„å† | å†œå†äº”æœˆå»¿äº”ã€‚å®œè®¢ç›Ÿ.çº³é‡‡.å‡ºè¡Œ.ç¥ˆç¦.æ–‹é†®.å®‰åºŠ.ä¼š...","url":""}],"info":{"it1":{"adcode":"101050101","city":"æ­¦æ±‰","hour":"18","max":"29","min":"17","temp":"24","type":"202","ut":"1561630401","wea":"å¤šäº‘"},"it2":{"hour":"19","temp":"22","type":"202"},"it3":{"hour":"20","temp":"21","type":"202"},"ts":"1561631244"},"url":""}},"prompt":"ã€å“ˆå°”æ»¨ã€‘å¤šäº‘ 17Â°/29Â°, 18:13æ›´æ–°~","ver":"1.0.0.106","view":"WeatherThreeView"}]]
                    [[{"app":"com.tencent.weather","desc":"å¤©æ°”","view":"RichInfoView","ver":"1.0.0.217","prompt":"[åº”ç”¨]å¤©æ°”","meta":{"richinfo":{"adcode":"%s","air":"%s","city":"%s","date":"%s","max":"%s","min":"%s","ts":"1554951408","type":"%s","wind":"%s"}},"config":{"forward":1,"autosize":1,"type":"card"}}]],
                    j.data.adcode,
                    j.data.air,
                    j.data.city,
                    j.data.date,
                    j.data.max,
                    j.data.min,
                    j.data.type,
                    j.data.wind
                ),
                atUser = 0
            }
        )
end

--è°ƒæ•™å¤„ç†å‡½æ•°(å¾…å¤„ç†)
function tiaojiao(CurrentQQ,data)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
	if (mim == nil) then
		sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå“‡")
		return 1
	end
	if (string.find(data.Content, "^åˆ é™¤è°ƒæ•™")) then
	    msg = data.Content:gsub("åˆ é™¤è°ƒæ•™", "")
	    if (msg == "") then
		    sedmsg(CurrentQQ,data,"è¦åˆ é™¤çš„è°ƒæ•™æŒ‡ä»¤ä¸èƒ½ä¸ºç©ºå“¦")
		    return 1
		end
		rese = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..tostring(data.FromGroupId).."\/"..msg..".txt")
	    if (rese == nil) then
			sedmsg(CurrentQQ,data,"è¿™ä¸ªæŒ‡ä»¤ä¸å­˜åœ¨äº†å“¦")
		    return 1
		end
		rm_file = os.remove("mimoio\/æœºå™¨è°ƒæ•™\/"..tostring(data.FromGroupId).."\/"..msg..".txt")
		log.info("åˆ é™¤è°ƒæ•™ ====> %s", rm_file)
		sedmsg(CurrentQQ,data,"åˆ é™¤æˆåŠŸ\nä½ ä¸å–œæ¬¢è¢«è¿™æ ·è°ƒæ•™çš„æˆ‘å—[è¡¨æƒ…9]")
		return 1
	end
    msgs = data.Content:gsub("è°ƒæ•™", "")
		res2 = string.find(msgs, "#")
		str = string.sub(msgs,res2+1)
		str2 = string.sub(msgs,1,res2-1)
		        
		        if (str == "") then
		            sedmsg(CurrentQQ,data,"è°ƒæ•™çš„å›ç­”å†…å®¹ä¸èƒ½ä¸ºç©ºå“¦")
			        return 1
		        end
				if (str2 == "") then
		            sedmsg(CurrentQQ,data,"è°ƒæ•™çš„æŒ‡ä»¤å†…å®¹ä¸èƒ½ä¸ºç©ºå“¦")
			        return 1
		        end
		        rese = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..str2..".txt")
					if (rese ~= nil) then
				        sedmsg(CurrentQQ,data,"æŒ‡ä»¤å·²ç»å­˜åœ¨äº†å“¦")
				        return 1
				    end
				Wirte("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..str2..".txt",str)
				sedmsg(CurrentQQ,data,"è°ƒæ•™æˆåŠŸ\nä½ è¿˜æƒ³å†è°ƒæ•™æˆ‘ä¸€æ¬¡å—[è¡¨æƒ…6]")
		        return 1
end

function url_encode(str)
    if (str) then
        str = string.gsub(str, "\n", "\r\n")
        str =
            string.gsub(
            str,
            "([^%w ])",
            function(c)
                return string.format("%%%02X", string.byte(c))
            end
        )
        str = string.gsub(str, " ", "+")
    end
    return str
end

--æŠ¢çº¢åŒ…å¤„ç†
function RedBag(CurrentQQ, data)
    Api.Api_OpenRedBag(CurrentQQ, data.RedBaginfo)
    if (data.RedBaginfo.RedType == 12) then
         luaRes =
                Api.Api_SendMsg(
                CurrentQQ,
                {
                    toUser = data.FromGroupId,
                    sendToType = 2,
                    sendMsgType = "TextMsg",
                    groupid = 0,
                    content = data.RedBaginfo.Tittle,
                    atUser = 0
                }
            )
        log.notice("From Lua SendMsg Ret\n%d", luaRes.Ret)
    end
end

--è§†é¢‘è§£æå¤„ç†
function Video(CurrentQQ, data)
    vdata = json.decode(data.Content)
        videodata = {
            GroupID = data.FromGroupId,
            VideoUrl = vdata.VideoUrl,
            VideoMd5 = vdata.VideoMd5
        }
        --æ„é€ table å‚æ•°è¡¨
        luaResp = Api.Api_CallFunc(CurrentQQ, "PttCenterSvr.ShortVideoDownReq", videodata) --é€šè¿‡cmdè°ƒç”¨åŠŸèƒ½åŒ…
        luaRes =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "TextMsg",
                groupid = 0,
                content = "è§£æè§†é¢‘URL-->" .. luaResp.VideoUrl,
                atUser = 0
            }
        )
end

--ç®¡ç†å¼€å…³é€šç”¨
function adminio(CurrentQQ,data,oio)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim ~= nil) then
            msg = data.Content:gsub(oio, "")
            str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
            if (string.find(str, "å…³é—­")) then
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äººå·²è¢«å…³é—­...\nè¯·å…ˆå¼€å¯æœºå™¨äºº")
                return 1
            end
			str2 = Read("mimoio\/çŠ¶æ€æ•°æ®\/"..oio.."\/"..data.FromGroupId..".txt")
			if (string.find(str2, msg)) then
			    sedmsg(CurrentQQ,data,"âˆ´"..oio.."æœ¬å°±æ˜¯"..str2.."çŠ¶æ€")
                return 1
			end
            Wirte("mimoio\/çŠ¶æ€æ•°æ®\/"..oio.."\/"..data.FromGroupId..".txt",msg)
            sedmsg(CurrentQQ,data,"âˆ´"..oio..msg.."æˆåŠŸ")
            return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
end

--ç™¾ç§‘å¤§å…¨
function baike(CurrentQQ,data)
    keyWord = data.Content:gsub("ç™¾ç§‘", "")
        if keyWord == "" then
            return 1
        end
        response, error_message =
            http.request(
            "GET",
            "http://baike.baidu.com/api/openapi/BaikeLemmaCardApi",
            {
                query = "scope=103&format=json&appid=379020&bk_key=" .. url_encode(keyWord) .. "&bk_length=600"
            }
        )
        html = response.body
        while(string.find(html, '"errno":2')) do
            response, error_message =
            http.request(
            "GET",
            "http://baike.baidu.com/api/openapi/BaikeLemmaCardApi",
            {
                query = "scope=103&format=json&appid=379020&bk_key=" .. url_encode(keyWord) .. "&bk_length=600"
            })
			html = response.body
        end
        local j = json.decode(html)
        sedmsg(CurrentQQ,data,j.abstract.."\n"..j.url)
end

--éŸ³ä¹ç‚¹æ­Œ
function music(CurrentQQ,data)
    keyWord = data.Content:gsub("ç‚¹æ­Œ", "")
        if keyWord == "" then
            return 1
        end
        response, error_message =
            http.request(
            "GET",
            "https://c.y.qq.com/soso/fcgi-bin/client_search_cp",
            {
                query = "aggr=1&cr=1&flag_qc=0&p=1&n=6&w=" .. url_encode(keyWord)
            }
        )
        html = response.body
		str = string.sub(html,10,-2)
        j = json.decode(str)
        if (j.code == 0) then
            msg = ""
            num = j.data.song.list
            list = num[1]
            songname = list.songname
            singername = list.singer[1].name
            payplay = list.pay.payplay
			albummid = list.albummid
			songmid = list.songmid
	        sedjsonmsg(CurrentQQ,data,'{"app":"com.tencent.structmsg","desc":"éŸ³ä¹","view":"music","ver":"0.0.0.1","prompt":"[åˆ†äº«]' ..songname.. '","meta":{"music":{"sourceMsgId":"0","title":"' ..songname.. '","desc":"' ..singername.. '","preview":"y.gtimg.cn/music/photo_new/T002R150x150M000'..albummid..'.jpg","tag":"QQéŸ³ä¹","musicUrl":"https://v1.itooi.cn/tencent/url?id='..songmid..'","jumpUrl":"y.qq.com/n/yqq/song/'..songmid..'.html","appid":100497308,"app_type":1,"action":"","source_url":"url.cn/5aSZ8Gc","source_icon":"url.cn/5tLgzTm","android_pkg_name":"com.tencent.qqmusic"}},"config":{"forward":true,"type":"normal","autosize":true}}')
			return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´Error:"..j.code)
			return 1
        end
end

--è®¿é—®url
function geturl(url_class,url,caulrt)
        response, error_message =
            http.request(
            url_class,
            url,
            {
                query = caulrt
            }
        )
        html = response.body
		return html
end

--æ¶ˆæ¯å‚¨è“„
function msgsql(CurrentQQ,data)
    if (mysqlpass == "") then
	    return 1
	end
    c = mysql.new()
    -- åˆå§‹åŒ–mysqlå¯¹è±¡
    ok, err = c:connect({host = mysqlhost, port = 3306, database = mysqldb, user = mysqluser, password = mysqlpass})
    --å»ºç«‹è¿æ¥
    if ok then
        sqlstr =
            string.format(
            [[INSERT INTO msgcache (GroupID, MsgSeq, MsgRandom,MsgType,Data,MsgTime)VALUES (%d,%d,%d,'%s','%s',%d)]],
            data.FromGroupId,
            data.MsgSeq,
            data.MsgRandom,
            data.MsgType,
            data.Content,
            data.MsgTime
        )
        res, err = c:query(sqlstr) --å…¥åº“ç¼“å­˜æ¶ˆæ¯
        log.info("%s", err)
        c.close(c)
    --é‡Šæ”¾è¿æ¥
    end
    return 1
end

--æ’¤å›æ£€æµ‹
function CheHui(CurrentQQ, data, extData)
    c = mysql.new()
    -- åˆå§‹åŒ–mysqlå¯¹è±¡
	if (mysqlpass == "") then
	    return 1
	end
	
    if data.MsgType == "ON_EVENT_GROUP_REVOKE" then --ç›‘å¬ ç¾¤æ’¤å›äº‹ä»¶
        str = string.format("ç¾¤æˆ %d  æˆå‘˜ UserID %s æ’¤å›äº†æ¶ˆæ¯Seq %s \n", extData.GroupID, extData.UserID, extData.MsgSeq)
        log.info("%s", str)
        ok, err = c:connect({host = mysqlhost, port = 3306, database = mysqldb, user = mysqluser, password = mysqlpass})
        --å»ºç«‹è¿æ¥
        log.info("sql %v", err)
        if ok then
            sqlstr =
                string.format(
                "select * from msgcache where `GroupID`= %d and `MsgSeq` = %d",
                extData.GroupID,
                extData.MsgSeq
            )
            res, err = c:query(sqlstr) --è·Ÿç¾¤ç¾¤idå’Œæ¶ˆæ¯SEQæŸ¥è¯¢å‡ºæ’¤å›çš„æ¶ˆæ¯å†…å®¹
            if err == nil then
                c.close(c)
                GroupID = tonumber(res[1]["GroupID"])
                MsgType = res[1]["MsgType"]
                Data = res[1]["Data"]

                if MsgType == "TextMsg" then
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            --å‘é€æ–‡æœ¬æ¶ˆæ¯
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡æ–‡æœ¬æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                Data
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "SmallFaceMsg" then
                    --Data {"Content":"[è¡¨æƒ…101]","Hex":"FKY=","Index":101,"tips":"[å°è¡¨æƒ…]"}
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡è¡¨æƒ…æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).Content
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "PicMsg" then
                    --Data {"Content":"","FileId":2820717626,"FileMd5":"q0oEC5aloJJMFr10mplaXw==","FileSize":7026,"tips":"[ç¾¤å›¾ç‰‡]","url":"http://gchat.qpic.cn/gchatpic_new/1700487478/960839480-2534335053-AB4A040B96A5A0924C16BD749A995A5F/0?vuin=u0026term=255u0026pictype=0"}
                    jData = json.decode(Data)
					if (jData.tips == "[ç¾¤æ¶ˆæ¯-QQé—ªç…§]") then
					    
					Api.Api_SendMsg( 
                    CurrentQQ,
                    {
                        toUser = GroupID,
                        sendToType = 2,
                        sendMsgType = "ForwordMsg",
                        content = "",
                        atUser = 0,
                        groupid = 0,
                        voiceUrl = "",
                        voiceBase64Buf = "",
                        picUrl = "",
                        picBase64Buf = "",
                        forwordBuf = json.decode(Data).ForwordBuf, --æ¬²è½¬å‘çš„base64buf å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                        forwordField = json.decode(Data).ForwordField --æ¬²å†™å…¥åè®®çš„å­—æ®µID å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                    }
                )
				    return 1
					end
                    Api.Api_SendMsg( --é€šè¿‡å›¾ç‰‡md5å‘é€å›¾ç‰‡ ç§’å‘ä¸ç”¨ä¸Šä¼  ç›¸å½“äºè½¬å‘
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "PicMsg",
                            --å‘é€å›¾æ–‡æ¶ˆæ¯
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡å›¾ç‰‡æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š[PICFLAG]%s",
                                extData.UserID,
                                jData.Content
                            ),
                            --é€šè¿‡å®[PICFLAG]æ”¹å˜å›¾æ–‡é¡ºåº  æ”¹ä¸ºç°æ–‡å­—åå›¾ç‰‡
                            atUser = 0,
                            voiceUrl = "",
                            voiceBase64Buf = "",
                            picUrl = "",
                            picBase64Buf = "",
                            fileMd5 = jData.FileMd5
                        }
                    )
                end
                if MsgType == "AtMsg" then
                    --Data {"Content":"@Kar98k skjjkssjkjs","UserID":123456789,"tips":"[ATæ¶ˆæ¯]"}
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡atæ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).Content
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "VoiceMsg" then
                    --Data {"tips":"[è¯­éŸ³]","url":"http://grouptalk.c2c.qq.com/?ver=0u0026rkey=3062020101045b305902010102010102041fdef8ae042439416931554e5142586c536d78706a314c686843664959725f327a5f573064697653755902045dac2a21041f0000000866696c6574797065000000013100000005636f64656300000001310400u0026filetype=1u0026voice_codec=1"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "VoiceMsg",
                            --å‘é€ç¾¤è¯­éŸ³æ¶ˆæ¯
                            groupid = 0,
                            content = "",
                            atUser = 0,
                            voiceUrl = json.decode(Data).url,
                            --é€šè¿‡ç½‘ç»œurlè¿›è¡Œå‘é€è¯­éŸ³
                            voiceBase64Buf = "",
                            picUrl = "",
                            picBase64Buf = ""
                        }
                    )
                end

                if MsgType == "ReplayMsg" then
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡å›å¤æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).ReplayContent
                            ),
                            atUser = 0
                        }
                    )
                end
				if MsgType == "VideoMsg" then
	             Api.Api_SendMsg( 
                    CurrentQQ,
                    {
                        toUser = GroupID,
                        sendToType = 2,
                        sendMsgType = "ForwordMsg",
                        content = "",
                        atUser = 0,
                        groupid = 0,
                        voiceUrl = "",
                        voiceBase64Buf = "",
                        picUrl = "",
                        picBase64Buf = "",
                        forwordBuf = json.decode(Data).ForwordBuf, --æ¬²è½¬å‘çš„base64buf å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                        forwordField = json.decode(Data).ForwordField --æ¬²å†™å…¥åè®®çš„å­—æ®µID å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                    }
                )
				end
                if MsgType == "XmlMsg" then
				    
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "XmlMsg",
                            groupid = 0,
                            content = string.format("%s", Data),
                            atUser = 0
                        }
                    )
                end
				if MsgType == "JsonMsg" then
				    
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "JsonMsg",
                            groupid = 0,
                            content = string.format("%s", Data),
                            atUser = 0
                        }
                    )
                end
            end
        end
    end
    return 1
end
2020/09/07 11:13:58.583 [E]  mimoio.lua
2020/09/07 11:13:58.583 [E]  local log = require("log")
local Api = require("coreApi")
local json = require("json")
local http = require("http")
local mysql = require("mysql")

--ç‰ˆæœ¬å·(ä¸è¦æ”¹åŠ¨)
Vabr = "1.0.2"
--æ•°æ®åº“é…ç½®
mysqlhost = "localhost"--é»˜è®¤ä¸åŠ¨
mysqldb = "ffaxx001"--æ•°æ®åº“å
mysqluser = "ffaxx001"--æ•°æ®åº“ç”¨æˆ·å
mysqlpass = "123456"--æ•°æ®åº“å¯†ç 
--ä¸ä½¿ç”¨è¯·ä¸è¦æ”¹åŠ¨

function ReceiveFriendMsg(CurrentQQ, data)
    if (data.Content == "ä½¿ç”¨æ–¹æ³•") then
	    sendfrimsg(CurrentQQ,data,"æ·»åŠ æˆæƒè€…çš„æ–¹æ³•\nå¯¹å•ä¸ªæœºå™¨äººç§èŠå‘é€[æ·»åŠ æˆæƒè€…+æˆæƒè€…QQ]\n\næˆæƒç¾¤çš„æ–¹æ³•\nåˆ°éœ€è¦æˆæƒçš„ç¾¤é‡Œå‘é€[æˆæƒ+ä¸»äººQQ]ã€‚æ³¨æ„:æˆæƒå¿…é¡»æ˜¯æˆæƒè€…è¿›è¡Œæ“ä½œ,ç®¡ç†å‘˜æˆæƒä¸äº†")
	end
    --æ•°æ®åˆå§‹åŒ–
    if (data.Content == "åˆå§‹åŒ–") then
	    root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root ~= nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´è¯·ä¸è¦é‡å¤åˆå§‹åŒ–")
			return 1
		end
    --os.execute('mkdir mimoio/æœºå™¨æˆæƒ')
	    os.execute('mkdir mimoio')
		os.execute('mkdir mimoio/å¤è¯»æœº')
		os.execute('mkdir mimoio/å¤è¯»æœº/æ¬¡æ•°')
		os.execute('mkdir mimoio/å¤è¯»æœº/å†…å®¹')
		os.execute('mkdir mimoio/æœºå™¨æˆæƒ')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨ä¸»äºº')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨èŠå¤©')
		os.execute('mkdir mimoio/æœºå™¨è°ƒæ•™')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æŠ¢çº¢åŒ…')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æœºå™¨èŠå¤©')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æœºå™¨å¼€å…³')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æ’¤å›æ£€æµ‹')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/å›¾ç‰‡è§£æ')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/è§†é¢‘è§£æ')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/é—ªç…§æ£€æµ‹')
		Wirte("mimoio\/"..data.FromUin..".txt","999")
		sendfrimsg(CurrentQQ,data,"åˆå§‹åŒ–å®Œæ¯•ï¼\nå‘é€[ä½¿ç”¨æ–¹æ³•]äº†è§£ä½¿ç”¨å§")
	end
	--æ·»åŠ æˆæƒè€…æ“ä½œ(ç§èŠæœºå™¨äººå‘é€)
	if (string.find(data.Content, "^æ·»åŠ æˆæƒè€…")) then
	    msg = data.Content:gsub("æ·»åŠ æˆæƒè€…", "")
		--Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromUin..".txt","å…³é—­")
		root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root == nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„ç®¡ç†è€…")
			return 1
		end
		Wirte("mimoio\/æœºå™¨æˆæƒ\/"..msg..CurrentQQ..".txt","999")
		sendfrimsg(CurrentQQ,data,"âˆ´æ·»åŠ æˆæƒè€…æˆåŠŸ")
	end
	--åˆ é™¤æˆæƒè€…æ“ä½œ(ç§èŠæœºå™¨äººå‘é€)
	if (string.find(data.Content, "^åˆ é™¤æˆæƒè€…")) then
	    msg = data.Content:gsub("åˆ é™¤æˆæƒè€…", "")
		--Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromUin..".txt","å…³é—­")
		root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root == nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„ç®¡ç†è€…")
			return 1
		end
		os.remove("mimoio\/æœºå™¨æˆæƒ\/"..msg..CurrentQQ..".txt")
		sendfrimsg(CurrentQQ,data,"âˆ´åˆ é™¤æˆæƒè€…æˆåŠŸ")
	end
    return 1
end
function ReceiveGroupMsg(CurrentQQ, data)
    if (tostring(data.FromUserId) == CurrentQQ) then
	    return 1
	end
	--ç¾¤èŠæˆæƒ(åˆ°éœ€è¦æˆæƒçš„ç¾¤é‡Œæ“ä½œ)
	if (string.find(data.Content, "^æˆæƒ")) then
	    root = Read("mimoio\/æœºå™¨æˆæƒ\/"..data.FromUserId..CurrentQQ..".txt","999")
		if (root == nil) then
		    sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„æˆæƒè€…")
			return 1
		end
		msg = data.Content:gsub("æˆæƒ", "")
		os.execute('mkdir mimoio/æœºå™¨è°ƒæ•™/'..data.FromGroupId)
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨ä¸»äºº/'..data.FromGroupId)
		Wirte("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..msg..".txt","999")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt","å›å¤èŠå¤©")
		sedmsg(CurrentQQ,data,"âˆ´æˆæƒæˆåŠŸï¼\nå‘é€[å¼€å¯æœºå™¨äºº]ä½¿ç”¨å§")
	end
	--åˆ é™¤æˆæƒæ“ä½œ(åˆ°éœ€è¦åˆ é™¤æˆæƒçš„ç¾¤é‡Œæ“ä½œ)
	if (string.find(data.Content, "^åˆ é™¤æˆæƒ")) then
	    root = Read("mimoio\/æœºå™¨æˆæƒ\/"..data.FromUserId..CurrentQQ..".txt","999")
		if (root == nil) then
		    sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„æˆæƒè€…")
			return 1
		end
		msg = data.Content:gsub("åˆ é™¤æˆæƒ", "")
		os.remove("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..msg..".txt")
		os.remove("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
		sedmsg(CurrentQQ,data,"âˆ´åˆ é™¤æˆæƒæˆåŠŸï¼")
	end
	--æœºå™¨å¼€å…³æŒ‡ä»¤
	if (data.Content == "å¼€å¯æœºå™¨äºº" or data.Content == "å…³é—­æœºå™¨äºº") then
        mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim ~= nil) then
            msg = data.Content:gsub("æœºå™¨äºº", "")
            str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
			if (str == nil) then
			    Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt",msg)
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äºº"..msg.."æˆåŠŸï¼")
				log.info("Str ====> %s", str)
                return 1
			end
			
            if (string.find(str, msg)) then
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äººä¸€ç›´æ˜¯"..msg.."çš„å‘")
                return 1
            end
            Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt",msg)
            sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äºº"..msg.."æˆåŠŸï¼")
            return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
	end
    --æœºå™¨äººå¼€å¯æ£€æµ‹
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
	if (str == nil) then
	    log.info("Str ====> %s", str)
        return 1
	end
	if (string.find(str, "å…³é—­")) then
	    return 1
	end
	--atæ¶ˆæ¯å¤„ç†
	msgs = ""
	atqq = 0
	if (string.find(data.Content, "ATæ¶ˆæ¯")) then
	    msgs = json.decode(data.Content).Content
		atqq = json.decode(data.Content).UserID
	end
	--å°¾å·´è‡ªå®šä¹‰(å¾…å®Œå–„)
	tips = "â€”â€”å‡¤é£ç¿±ç¿”å…®ä¸·"
    --åŠŸèƒ½æ¨¡å—
    if (data.Content == "åŠŸèƒ½" or data.Content == "ä¸»ç•Œé¢") then
        face = faceArray()
        sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."å½±è§†æœç´¢\n"..face.."èŠå¤©å¨±ä¹\n"..face.."ä¾¿åˆ©åŠŸèƒ½\n"..face.."æœºå™¨è°ƒæ•™\n"..face.."ç®¡ç†ç³»ç»Ÿ\n"..face.."bugåé¦ˆ\n"..face.."æœ¬ç¾¤çŠ¶æ€\n"..face.."æ›´æ–°æ£€æµ‹\n\n"..tips)
    end
    --å½±è§†æœç´¢æ¨¡å—
    if (data.Content == "å½±è§†æœç´¢") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."æœç´¢+å½±è§†å\n"..face.."æˆ‘æƒ³çœ‹+å½±è§†å\n"..face.."æˆ‘è¦çœ‹+å½±è§†å\n\n"..tips)
    elseif (string.find(data.Content, "^æœç´¢")) then
	    msg = data.Content:gsub("æœç´¢", "")
		Sousuo(CurrentQQ,data,msg)
	elseif (string.find(data.Content, "^æˆ‘æƒ³çœ‹")) then
	    msg = data.Content:gsub("æˆ‘æƒ³çœ‹", "")
		Sousuo(CurrentQQ,data,msg)
    elseif (string.find(data.Content, "^æˆ‘è¦çœ‹")) then
	    msg = data.Content:gsub("æˆ‘è¦çœ‹", "")
		Sousuo(CurrentQQ,data,msg)
	end
	--èŠå¤©å¨±ä¹æ¨¡å—
	if (data.Content == "èŠå¤©å¨±ä¹") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."åˆ‡æ¢æ–‡å­—èŠå¤©\n"..face.."åˆ‡æ¢å›å¤èŠå¤©\n"..face.."åˆ‡æ¢è¯­éŸ³èŠå¤©\n\n"..tips)
    elseif (data.Content == "åˆ‡æ¢æ–‡å­—èŠå¤©") then
		liaotian(CurrentQQ,data,1)
	elseif (data.Content == "åˆ‡æ¢è¯­éŸ³èŠå¤©") then
	    liaotian(CurrentQQ,data,2)
    elseif (data.Content == "åˆ‡æ¢å›å¤èŠå¤©") then
	    liaotian(CurrentQQ,data,3)
	else
	    ownthink(CurrentQQ,data,msgs,atqq)
	end
	--ä¾¿åˆ©åŠŸèƒ½æ¨¡å—
	if (data.Content == "ä¾¿åˆ©åŠŸèƒ½") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."ç™¾ç§‘å¤§å…¨\n"..face.."éŸ³ä¹ç‚¹æ­Œ\n"..face.."é—ªä»–@xx\n"..face.."å¤©æ°”æŸ¥è¯¢\n\n"..tips)
	elseif (data.Content == "ç™¾ç§‘å¤§å…¨") then
		sedmsg(CurrentQQ,data,"å‘é€:[ç™¾ç§‘+å…³é”®è¯]\nä¾‹å¦‚:ç™¾ç§‘æ´›å¤©ä¾")
    elseif (data.Content == "éŸ³ä¹ç‚¹æ­Œ") then
		sedmsg(CurrentQQ,data,"å‘é€:[ç‚¹æ­Œ+æ­Œå]\nä¾‹å¦‚:ç‚¹æ­Œé’æŸ ")
	elseif (data.Content == "å¤©æ°”æŸ¥è¯¢") then
		sedmsg(CurrentQQ,data,"å‘é€:[å¤©æ°”+åœ°æ–¹å]\nä¾‹å¦‚:å¤©æ°”åŒ—äº¬(é™äºå›½å†…)")
    elseif (string.find(data.Content, "^å¤©æ°”")) then
        tianqi(CurrentQQ,data)
	    --msg = data.Content:gsub("æœç´¢", "")
		--Sousuo(CurrentQQ,data,msg)
	elseif (string.find(data.Content, "^ç™¾ç§‘")) then
	    baike(CurrentQQ,data)
	    --msg = data.Content:gsub("æˆ‘æƒ³çœ‹", "")
		--Sousuo(CurrentQQ,data,msg)music(CurrentQQ,data)
    elseif (string.find(data.Content, "^ç‚¹æ­Œ")) then
	    music(CurrentQQ,data)
	end
	--æœºå™¨è°ƒæ•™æ¨¡å—
	if (data.Content == "æœºå™¨è°ƒæ•™") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."æ–‡å­—è°ƒæ•™\n"..face.."è¯­éŸ³è°ƒæ•™\n"..face.."å”±æ­Œè°ƒæ•™\n"..face.."éŸ³ä¹è°ƒæ•™\n"..face.."å›¾ç‰‡è°ƒæ•™\n"..face.."åˆ é™¤è°ƒæ•™\n\n"..tips)
    elseif (data.Content == "æ–‡å­—è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#(å†…å®¹)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#ä½ å¥½å•Š")
	elseif (data.Content == "è¯­éŸ³è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#è¯­éŸ³(å†…å®¹)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#è¯­éŸ³ä½ å¥½å•Š")
	elseif (data.Content == "å›¾ç‰‡è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#å›¾ç‰‡(é“¾æ¥)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#å›¾ç‰‡http://../1.jpg")
	elseif (data.Content == "éŸ³ä¹è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#ç‚¹æ­Œ(æ­Œå)]\nä¾‹å¦‚:è°ƒæ•™å–µ#ç‚¹æ­Œå­¦çŒ«å«")
	elseif (data.Content == "å”±æ­Œè°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#å”±æ­Œ(æ­Œå)]\nä¾‹å¦‚:è°ƒæ•™å–µ#å”±æ­Œå­¦çŒ«å«")
	elseif (data.Content == "åˆ é™¤è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[åˆ é™¤è°ƒæ•™(æŒ‡ä»¤)]\nä¾‹å¦‚:åˆ é™¤è°ƒæ•™ä½ å¥½")
	elseif (string.find(data.Content, "^è°ƒæ•™")) then
        tiaojiao(CurrentQQ,data)
	elseif (string.find(data.Content, "^åˆ é™¤è°ƒæ•™")) then
        tiaojiao(CurrentQQ,data)
	end
	--ç®¡ç†ç³»ç»Ÿæ¨¡å—
	if (data.Content == "ç®¡ç†ç³»ç»Ÿ") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."å¼€å¯/å…³é—­æœºå™¨äºº\n"..face.."å¼€å¯/å…³é—­æŠ¢çº¢åŒ…\n"..face.."å¼€å¯/å…³é—­æœºå™¨èŠå¤©\n"..face.."å¼€å¯/å…³é—­é—ªç…§æ£€æµ‹\n"..face.."å¼€å¯/å…³é—­å›¾ç‰‡è§£æ\n"..face.."å¼€å¯/å…³é—­è§†é¢‘è§£æ\n"..face.."å¼€å¯/å…³é—­æ’¤å›æ£€æµ‹\n\n"..tips)
    elseif (data.Content == "å¼€å¯æœºå™¨èŠå¤©" or data.Content == "å…³é—­æœºå™¨èŠå¤©") then
        adminio(CurrentQQ,data,"æœºå™¨èŠå¤©")
    elseif (data.Content == "å¼€å¯æ’¤å›æ£€æµ‹" or data.Content == "å…³é—­æ’¤å›æ£€æµ‹") then
        adminio(CurrentQQ,data,"æ’¤å›æ£€æµ‹")
	elseif (data.Content == "å¼€å¯é—ªç…§æ£€æµ‹" or data.Content == "å…³é—­é—ªç…§æ£€æµ‹") then
        adminio(CurrentQQ,data,"é—ªç…§æ£€æµ‹")
	elseif (data.Content == "å¼€å¯æŠ¢çº¢åŒ…" or data.Content == "å…³é—­æŠ¢çº¢åŒ…") then
        adminio(CurrentQQ,data,"æŠ¢çº¢åŒ…")
	elseif (data.Content == "å¼€å¯è§†é¢‘è§£æ" or data.Content == "å…³é—­è§†é¢‘è§£æ") then
        adminio(CurrentQQ,data,"è§†é¢‘è§£æ")
	elseif (data.Content == "å¼€å¯å›¾ç‰‡è§£æ" or data.Content == "å…³é—­å›¾ç‰‡è§£æ") then
        adminio(CurrentQQ,data,"å›¾ç‰‡è§£æ")
	end
	--bugåé¦ˆæ¨¡å—
	if (data.Content == "BUGåé¦ˆ" or data.Content == "bugåé¦ˆ") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."é‚®ä»¶åé¦ˆ\n"..face.."QQåé¦ˆ\n\n"..tips)
    elseif (data.Content == "QQåé¦ˆ") then
        sedmsg(CurrentQQ,data,"???Î£(ï¾Ÿâˆ€ï¾Ÿï¾‰)ï¾‰\næ’ä»¶æœ‰é—®é¢˜å¯ä»¥åé¦ˆåˆ°:\nQQ:2353065854")
    elseif (data.Content == "é‚®ä»¶åé¦ˆ") then
        sedmsg(CurrentQQ,data,"å®è´å’‹å•¦=ÍÍŸÍŸÍ(ê’ªá—œê’ª â€§Ì£Ì¥Ì‡)\næ’ä»¶æœ‰é—®é¢˜å¯ä»¥åé¦ˆåˆ°:\né‚®ç®±ğŸ“¬:ym-o@qq.com")
	end
	--æœ¬ç¾¤çŠ¶æ€æ¨¡æ¿
	if (data.Content == "æœ¬ç¾¤çŠ¶æ€") then
        face = faceArray()
        hb = Read("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt")
        sz = Read("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt")
		tp = Read("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt")
        sp = Read("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt")
        jqr = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
        lt = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
        ch = Read("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..data.FromGroupId..".txt")
		sedmsg(CurrentQQ,data,"çŠ¶æ€æ•°æ®åˆ—è¡¨â†“â†“â†“\n"..face.."æœºå™¨äºº:"..jqr.."\n"..face.."æŠ¢çº¢åŒ…:"..hb.."\n"..face.."å›¾ç‰‡è§£æ:"..tp.."\n"..face.."æ’¤å›æ£€æµ‹:"..ch.."\n"..face.."è§†é¢‘è§£æ:"..sp.."\n"..face.."æœºå™¨èŠå¤©:"..lt.."\n"..face.."é—ªç…§æ£€æµ‹:"..sz.."\n\n"..tips)
	end
	--æ›´æ–°æ¨¡å—
	if (data.Content == "æ›´æ–°æ£€æµ‹") then
        str = geturl("GET","http://118.25.41.32/Lsb/lua/Vabr.txt","")
		log.info("Str ====> %s", str)
        if (string.find(str, Vabr)) then
            sedmsg(CurrentQQ,data,"å½“å‰ç‰ˆæœ¬ä¸ºæœ€æ–°ç‰ˆ")
        else
            sedmsg(CurrentQQ,data,"å‘ç°æ–°ç‰ˆæœ¬!\nå½“å‰ç‰ˆæœ¬:"..Vabr.."\næ–°ç‰ˆæœ¬å·:"..str.."\nèµ¶å¿«å‘é€[æ›´æ–°æ’ä»¶]å§")
        end
	elseif (data.Content == "æ›´æ–°æ’ä»¶") then
	    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim == nil) then
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
        str = geturl("GET","http://118.25.41.32/Lsb/lua/Vabr.txt","")
		log.info("Str ====> %s", str)
        if (string.find(str, Vabr)) then
            sedmsg(CurrentQQ,data,"å½“å‰ç‰ˆæœ¬ä¸ºæœ€æ–°ç‰ˆ")
        else
            str = geturl("GET","http://118.25.41.32/Lsb/lua/mimoio.txt","")
            Wirte("Plugins\/mimoio.lua",str)
            sedmsg(CurrentQQ,data,"æ›´æ–°å®Œæ¯•ï¼")
        end
	end
	--å›¾ç‰‡ç±»å‹æ¶ˆæ¯å¤„ç†
    if (data.MsgType == "PicMsg") then
	    msg = Read("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt")
		jData = json.decode(data.Content)
	    if (msg ~= nil and jData.tips ~= "[ç¾¤æ¶ˆæ¯-QQé—ªç…§]") then
            if (string.find(str, "å¼€å¯")) then
	            sedmsg(CurrentQQ,data,"å›¾ç‰‡é“¾æ¥è§£æå¦‚ä¸‹â†“â†“\n"..jData.url)
				return 1
	        end
	    end
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt")
	    if (str == nil) then
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    --é—ªç…§ã€å›¾ç‰‡å¤„ç†æ¨¡å—
		PicFlag(CurrentQQ, data)
    end
	--æŠ¢çº¢åŒ…å¤„ç†
	if (string.find(data.MsgType, "RedBagMsg") == 1) then
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt")
		if (str == nil) then
	        log.info("Str ====> %s", str)
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    RedBag(CurrentQQ, data)
	end
	--è§†é¢‘è§£æå¤„ç†
	if (string.find(data.MsgType, "VideoMsg") == 1) then
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt")
		if (str == nil) then
	        log.info("Str ====> %s", str)
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    Video(CurrentQQ, data)
	end
	--até—ªå›¾
	if (data.MsgType == "AtMsg") and (string.find(data.Content, "é—ªä»–")) then
	    shantu(CurrentQQ, data)
    end
	--è°ƒæ•™æœç´¢å¼•æ“
	mim = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..data.Content..".txt")
	if (mim == nil) then
	    --äººç±»çš„æœ¬è´¨æ˜¯å¤è¯»æœº
	    msg = Read("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt")
		if (msg ~= nil) then
		    cs = Read("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt")
			ii = tonumber(cs)
			if (string.find(msg, "^"..data.Content.."$")) then
			    if (ii > 2) then
			         math.randomseed(os.time())
                     sj = math.random(1, 5)
		             if (sj == 1 or sj == 2) then
			             sedmsg(CurrentQQ,data,msg)
					     rr = ii + 1
		                 Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
				     elseif (sj == 3) then
				         os.remove("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt")
					     os.remove("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt")
					     fdArray = {"çªç„¶æˆªæ–­å¤è¯»(ï¾ŸâŠ¿ï¾Ÿ)ï¾‚","å¤è¯»å¯è€»(â€¢Ì€ã¸ â€¢Ì â•® )","ä¸è¦å¤è¯»äº†å•¦","è¿™å°±æ˜¯æ‰€è°“çš„äººç±»çš„æœ¬è´¨","ä½ ä»¬å’‹ä¸ä¸Šå¤©å‘","åˆå¤è¯»ä¸Šç˜¾äº†å•Š"}
                         math.randomseed(os.time())
                         fdsj = math.random(1, 6)
				         sedmsg(CurrentQQ,data,fdArray[fdsj])
				     else
			             rr = ii + 1
		                 Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
		             end
			    else
			        rr = ii + 1
		            Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
			    end
			else
			    if (ii > 2) then
			        math.randomseed(os.time())
                    sj2 = math.random(1, 3)
					if (sj2 == 2) then
					    fdArray2 = {"ä¸­æ–­å¤è¯»å¯è€»","æ‰“æ–­å¤è¯»å¯è€»(â€¢Ì€ã¸ â€¢Ì â•® )","ä½ ä¸ºä»€ä¹ˆè¦æ‰“æ–­å¤è¯»å•Š","å¤è¯»ä¸é¦™å˜›","ç ´åæ°›å›´(à¸‡áµ’ÌŒçš¿áµ’ÌŒ)à¸‡â¼Â³â‚Œâ‚ƒ"}
                        math.randomseed(os.time())
                        fdsj2 = math.random(1, 5)
				        sedmsg(CurrentQQ,data,fdArray2[fdsj2])
					end
				end
				Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt","1")
			    Wirte("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt",data.Content)
			end
		else
		    Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt","1")
			Wirte("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt",data.Content)
		end
	    --å¦‚æœè°ƒæ•™æŒ‡ä»¤ä¸å­˜åœ¨ï¼Œåˆ™è¿›è¡Œå…¶ä»–æ“ä½œ
	    msgsql(CurrentQQ,data)--æ•°æ®å‚¨è“„
		--éšæœºå›å¤æ¶ˆæ¯æ¦‚ç‡0.04
	    math.randomseed(os.time())
        num = math.random(1, 40)
		if (num == 12) then
		    j = xiaosiapi(CurrentQQ,data,data.Content)
			sedmsg(CurrentQQ,data,j.data.info.text)
		end
	else
	    --è§¦å‘è°ƒæ•™æŒ‡ä»¤
		funic(CurrentQQ,data,mim)
	end
    return 1
end

function ReceiveEvents(CurrentQQ, data, extData)
  if data.MsgType == "ON_EVENT_GROUP_REVOKE" then --ç›‘å¬ ç¾¤æ’¤å›äº‹ä»¶
    --æ’¤å›äº‹ä»¶å¤„ç†
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..extData.GroupID..".txt")
    if (str == nil) then
	    log.info("Str ====> %s", str)
        return 1
	end
	if (string.find(str, "å…³é—­")) then
		return 1
	end
	CheHui(CurrentQQ, data, extData)
	--xxxxxxxxxxxxxxx
    return 1
  end
  --è¿›ç¾¤ç§€å›¾æ¬¢è¿

end

  if (string.find(data.MsgType, "ON_EVENT_GROUP_JOIN") == 1) then
      --æœºå™¨äººå¼€å¯æ£€æµ‹
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromUin..CurrentQQ..".txt")
	if (str == nil) then
	    log.info("Str ====> %s", str)
        return 1
	end
	if (string.find(str, "å…³é—­")) then
	    return 1
	end
      xiutu(CurrentQQ, data, extData)
  end
end

--ç§€å›¾å‡½æ•°
function xiutu(CurrentQQ, data, extData)
    math.randomseed(os.time())
    num = math.random(40001, 40002)
    Api.Api_SendMsg( --é€šè¿‡å›¾ç‰‡md5å‘é€å›¾ç‰‡ ç§’å‘ä¸ç”¨ä¸Šä¼  ç›¸å½“äºè½¬å‘
           CurrentQQ,
           {
               toUser = data.FromUin,
               sendToType = 2,
               sendMsgType = "PicMsg",
               --å‘é€å›¾æ–‡æ¶ˆæ¯
               content = string.format("[ç§€å›¾%d]æ¬¢è¿ã€%sã€‘åŠ å…¥[PICFLAG]",40002,extData.UserName),
               --é€šè¿‡å®[PICFLAG]æ”¹å˜å›¾æ–‡é¡ºåº  æ”¹ä¸ºç°æ–‡å­—åå›¾ç‰‡
               --é€šè¿‡å®[ç§€å›¾40001] èŒƒå›´ 40000-40006 å®ç°ç§€å›¾å‘é€ ç¾¤æœ‰æ•ˆå¥½å‹æ— æ•ˆ
               atUser = 0,
               picUrl = "http://q1.qlogo.cn/g?b=qq&nk=".. extData.UserID .. "&s=640",
               picBase64Buf = "",
               fileMd5 = ""
           }
       )
end

--é—ªå›¾æ£€æµ‹å¤„ç†
function shantu(CurrentQQ, data)
        math.randomseed(os.time())
        ShowType = math.random(40001, 40002)
        jData = json.decode(data.Content)
        Api.Api_SendMsg( --é€šè¿‡Urlå‘é€å›¾ç‰‡
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "PicMsg",
                --å‘é€å›¾æ–‡æ¶ˆæ¯
                content = string.format("[ç§€å›¾%d]", ShowType),
                --é€šè¿‡å®[PICFLAG]æ”¹å˜å›¾æ–‡é¡ºåº  æ”¹ä¸ºç°æ–‡å­—åå›¾ç‰‡
                --é€šè¿‡å®[ç§€å›¾40001] èŒƒå›´ 40000-40005 å®ç°ç§€å›¾å‘é€ ç¾¤æœ‰æ•ˆå¥½å‹æ— æ•ˆ
                atUser = 0,
                voiceUrl = "",
                voiceBase64Buf = "",
                picUrl = "http://q1.qlogo.cn/g?b=qq&nk=" .. jData.UserID .. "&s=640",
                picBase64Buf = "",
                fileMd5 = ""
            }
        )
		return 1
end

--é—ªç…§æ£€æµ‹å¤„ç†


--åŠŸèƒ½ç»„
function funic(CurrentQQ,data,msg)
    if string.find(msg, "^ç‚¹æ­Œ") then
	    data.Content = msg
        music(CurrentQQ,data,msg)
		return 1
	elseif string.find(msg, "^è¯­éŸ³") then
	    keyWord = msg:gsub("è¯­éŸ³", "")
        sedvoicemsg(CurrentQQ,data,keyWord)
		return 1
	elseif string.find(msg, "^å›¾ç‰‡") then
	    keyWord = msg:gsub("å›¾ç‰‡", "")
        sedimgmsg(CurrentQQ,data,keyWord,"")
		return 1
    elseif string.find(msg, "^å”±æ­Œ") then
        keyWord = msg:gsub("å”±æ­Œ", "")
		if (keyWord == "") then
		    sedmsg(CurrentQQ,data,"æ­Œåä¸èƒ½ç©ºç€å“¦")
		    return 1
		end
		sedmsg(CurrentQQ,data,"å¤©ä¾æ­£åœ¨åŠªåŠ›åŠ è½½Ù©(ËƒÌ¶Ì€Íˆà¯°Ë‚Ì¶ÌÍˆ)Ùˆ")
        response, error_message =
            http.request(
            "POST",
            "http://127.0.0.1:8888/SilkApi/UrlToBuf",--ä¿®æ”¹æ­¤å¤„ipåŠç«¯å£å³å¯
            {
                body = keyWord --ä¼ å…¥æ­Œæ›²å
            }
        )
        log.notice("err   %v", error_message)
        html = response.body --è¿”å›silk base64 buf
		if (string.find(html, "Î´")) then
				    sedmsg(CurrentQQ,data,"å¤©ä¾æ²¡æœ‰æ‰¾åˆ°ç›¸å…³çš„æ­Œå‘€(Ã’Ï‰Ã“×±)ï¼")
					c.close(c)
				    return 2
				end
        luaRes =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "VoiceMsg",
                groupid = 0,
                content = "",
                atUser = 0,
                voiceUrl = "",
                voiceBase64Buf = html 
            }
        )
		return 1
	end
    sedmsg(CurrentQQ,data,msg)
end

--å½±è§†æœç´¢ç”¨
function Sousuo(CurrentQQ,data,msg)
    response, error_message =
        http.request(
            "GET",
            "http://localhost/index.php/ajax/suggest",
            {
                query = "mid=1&f=admin&wd="..msg.."&limit=10&timestamp=1567914326746"
            }
        )
    html = response.body
	json = json.decode(html)
	if (json.total == 0) then
	    sedmsg(CurrentQQ,data,"å½±è§†æŸ¥è¯¢é”™è¯¯\nè¯·æ£€æŸ¥å½±è§†åæ˜¯å¦æ­£ç¡®\nâ•â•â•â•â•â•â•â•â•â•â•\næ³¨æ„âš ï¸å½±è§†åä¸è¦å¸¦æ— å…³æˆ–å¤šä½™çš„å­—ç¬¦")
	else
        sedmsg(CurrentQQ,data,"èµ„æºåœ°å€å¦‚ä¸‹â†“â†“â†“\nâ•â•â•â•â•â•â•â•â•â•\nhttp://118.25.41.32/index.php/vod/search/wd/"..escape(msg)..".html\nâ•â•â•â•â•â•â•â•â•â•â•\næ³¨æ„:å¦‚æœQQå‡ºç°åœæ­¢è®¿é—®ç°è±¡ï¼Œè¯·å¤åˆ¶é“¾æ¥ç”¨æµè§ˆå™¨æ‰“å¼€")
	end
end

--å•çº¯å‘æ¶ˆæ¯å›¾æ–‡é€šç”¨
function sedimgmsg(CurrentQQ,data,url,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "PicMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = url,
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘æ¶ˆæ¯ç”¨
function sedmsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "TextMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘ç§èŠæ¶ˆæ¯ç”¨
function sendfrimsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromUin,
        sendToType = 1,
        sendMsgType = "TextMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘jsonæ¶ˆæ¯ç”¨
function sedjsonmsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "JsonMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--èŠå¤©æ¨¡å—åˆ‡æ¢å‡½æ•°
function liaotian(CurrentQQ,data,msg)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
    if (mim == nil) then
        sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
        return 1
    end
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
	if (str == nil) then
        return 1
    end
	if (string.find(str, "å…³é—­")) then
	    sedmsg(CurrentQQ,data,"æœºå™¨èŠå¤©å¤„äºå…³é—­çŠ¶æ€\nâˆ´è¯·å…ˆå¼€å¯æœºå™¨èŠå¤©")
	    return 1
	end
	--åˆ‡æ¢å¤„ç†
	file = io.open("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt", "w")
	if (msg == 1) then
	    file:write("æ–‡å­—èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°æ–‡å­—èŠå¤©")
	elseif (msg == 2) then
	    file:write("è¯­éŸ³èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°è¯­éŸ³èŠå¤©")
	elseif (msg == 3) then
	    file:write("å›å¤èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°å›å¤èŠå¤©")
	end
	file:close()
end

--éšæœºè¡¨æƒ…å‡½æ•°
function faceArray()
    faceArray = {"[è¡¨æƒ…147]","ğŸ€","ğŸ”¥","ğŸ»","ğŸ’","[è¡¨æƒ…185]","[è¡¨æƒ…219]","[è¡¨æƒ…176]"}
    math.randomseed(os.time())
    num = math.random(1, 9)
    return faceArray[num]
end

--urlç¼–ç è½¬æ¢
function escape(w)
	pattern="[^%w%d%._%-%* ]"
	s=string.gsub(w,pattern,function(c)
		local c=string.format("%%%02X",string.byte(c))
		return c
	end)
	s=string.gsub(s," ","+")
	return s
end

--è¯»å–æ•°æ®å‡½æ•°
function Read(url)
    file = io.open(url, "r")
	if (file == nil) then
	    return nil
	else
        file:seek("set")
	    str = file:read("*a")
	    file:close()
        return str
	end
end

--å†™å…¥æ•°æ®å‡½æ•°
function Wirte(url,msg)
    file = io.open(url, "w+")
    file:write(msg)
	file:close()
    return "ok"
end

--å°æ€èŠå¤©å‡½æ•°
function xiaosiapi(CurrentQQ,data,str)
    response, error_message =
            http.request(
            "GET",
            "https://api.ownthink.com/bot",
            {
                query = "appid="..tostring(data.FromUserId).."&spoken=" .. url_encode(str),
                headers = {
                    Accept = "*/*"
                }
            }
        )
        html = response.body
		jData = json.decode(html)
		return jData
end

--æœºå™¨èŠå¤©å‡½æ•°
function ownthink(CurrentQQ,data,msgs,atqq)
    if (tostring(atqq) == CurrentQQ) then
        m = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
        if (m == nil) then
	        log.info("Str ====> %s", m)
            return 1
	    end
	    if (string.find(m, "å…³é—­")) then
	        sedmsg(CurrentQQ,data,"æœºå™¨èŠå¤©å¤„äºå…³é—­çŠ¶æ€\nâˆ´è¯·å…ˆå¼€å¯æœºå™¨èŠå¤©")
	        return 1
	    end
		res2 = string.find(msgs, " ")
		str = string.sub(msgs,res2)
		jData = xiaosiapi(CurrentQQ,data,str)
		Data = json.decode(data.Content)
		m = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
		if (m == nil) then
	        log.info("Str ====> %s", m)
            return 1
	    end
		if (string.find(m, "å›å¤èŠå¤©")) then
		    Api.Api_SendMsg(
                CurrentQQ,
                {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "ReplayMsg",
                groupid = 0,
                content = jData.data.info.text,
                atUser = 0,
				replayInfo = {
                    MsgSeq = data.MsgSeq,
                    --å›å¤æ¶ˆæ¯çš„Seq
                    MsgTime = data.MsgTime,
                    --å›å¤æ¶ˆæ¯çš„äº‹ä»¶
                    UserID = data.FromUserId,
                    --å›å¤æ¶ˆæ¯å¯¹è±¡
                    RawContent = Data.Content --å›å¤æ¶ˆæ¯çš„åŸå†…å®¹
                }
				}
            )
			return 1
		elseif (string.find(m, "æ–‡å­—èŠå¤©")) then
		    sedmsg(CurrentQQ,data,jData.data.info.text)
		else
		    sedvoicemsg(CurrentQQ,data,url_encode(jData.data.info.text))
		end
    end
end

--å‘é€è¯­éŸ³æ¶ˆæ¯
function sedvoicemsg(CurrentQQ,data,str)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "VoiceMsg",
        groupid = 0,
		voiceUrl = "https://dds.dui.ai/runtime/v1/synthesize?voiceId=qianranfa&speed=0.7&volume=100&audioType=wav&text="..str, --å‘é€è¯­éŸ³çš„ç½‘ç»œåœ°å€ æ–‡æœ¬å‹
        voiceBase64Buf = "",
        content = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å¤©æ°”æŸ¥è¯¢å‡½æ•°
function tianqi(CurrentQQ,data)
    keyWord = data.Content:gsub("å¤©æ°”", "")
        if keyWord == "" then
            return 1
        end

        cookies = Api.Api_GetUserCook(CurrentQQ)

        response, error_message =
            http.request(
            "GET",
            "https://weather.mp.qq.com/cgi-bin/rich",
            {
                query = "g_tk=" .. cookies.Gtk .. "&city=" .. url_encode(keyWord),
                headers = {
                    Referer = "http://weather.mp.qq.com/ark"
                },
                cookies = {
                    uin = CurrentQQ,
                    skey = cookies.Skey
                }
            }
        )
        local html = response.body
        log.notice("From Lua html -->%s", html)

        local j = json.decode(html)
        if j.code ~= 0 then
            return 1
        end

        ApiRet =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "JsonMsg",
                groupid = 0,
                content = string.format(
                    --{"config":{"forward":1,"autosize":1},"prompt":"[åº”ç”¨]å¤©æ°”","app":"com.tencent.weather","ver":"0.0.0.1","view":"RichInfoView","meta":{"richinfo":{"adcode":"101210701","city":"æˆéƒ½","air":"58","min":"20","ts":"1500550866","wind":"1","date":"6æœˆ27æ—¥ å‘¨å››","max":"28","type":"201"}},"desc":"å¤©æ°”"}
                    --[[{"app":"com.tencent.weather","desc":"","meta":{"weather":{"ad":[{"icon":"http://imgcache.qq.com/ac/tq/xz2/tp.jpg","p":"ptype=star","t":"2","title":"æ˜Ÿåº§ | ä»Šå¤©ä¼šå› ä¸ºæ„Ÿæƒ…å’Œå®¶åº­çš„é—®é¢˜ï¼Œå½±å“å·¥ä½œï¼Œè¿˜æœ‰ï¼Œä¹Ÿè¦æ³¨æ„äºº...","url":""},{"icon":"http://imgcache.qq.com/ac/qqweather/image/2019/6/27.png","p":"ptype=lunar","t":"4","title":"é»„å† | å†œå†äº”æœˆå»¿äº”ã€‚å®œè®¢ç›Ÿ.çº³é‡‡.å‡ºè¡Œ.ç¥ˆç¦.æ–‹é†®.å®‰åºŠ.ä¼š...","url":""}],"info":{"it1":{"adcode":"101050101","city":"æ­¦æ±‰","hour":"18","max":"29","min":"17","temp":"24","type":"202","ut":"1561630401","wea":"å¤šäº‘"},"it2":{"hour":"19","temp":"22","type":"202"},"it3":{"hour":"20","temp":"21","type":"202"},"ts":"1561631244"},"url":""}},"prompt":"ã€å“ˆå°”æ»¨ã€‘å¤šäº‘ 17Â°/29Â°, 18:13æ›´æ–°~","ver":"1.0.0.106","view":"WeatherThreeView"}]]
                    [[{"app":"com.tencent.weather","desc":"å¤©æ°”","view":"RichInfoView","ver":"1.0.0.217","prompt":"[åº”ç”¨]å¤©æ°”","meta":{"richinfo":{"adcode":"%s","air":"%s","city":"%s","date":"%s","max":"%s","min":"%s","ts":"1554951408","type":"%s","wind":"%s"}},"config":{"forward":1,"autosize":1,"type":"card"}}]],
                    j.data.adcode,
                    j.data.air,
                    j.data.city,
                    j.data.date,
                    j.data.max,
                    j.data.min,
                    j.data.type,
                    j.data.wind
                ),
                atUser = 0
            }
        )
end

--è°ƒæ•™å¤„ç†å‡½æ•°(å¾…å¤„ç†)
function tiaojiao(CurrentQQ,data)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
	if (mim == nil) then
		sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå“‡")
		return 1
	end
	if (string.find(data.Content, "^åˆ é™¤è°ƒæ•™")) then
	    msg = data.Content:gsub("åˆ é™¤è°ƒæ•™", "")
	    if (msg == "") then
		    sedmsg(CurrentQQ,data,"è¦åˆ é™¤çš„è°ƒæ•™æŒ‡ä»¤ä¸èƒ½ä¸ºç©ºå“¦")
		    return 1
		end
		rese = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..tostring(data.FromGroupId).."\/"..msg..".txt")
	    if (rese == nil) then
			sedmsg(CurrentQQ,data,"è¿™ä¸ªæŒ‡ä»¤ä¸å­˜åœ¨äº†å“¦")
		    return 1
		end
		rm_file = os.remove("mimoio\/æœºå™¨è°ƒæ•™\/"..tostring(data.FromGroupId).."\/"..msg..".txt")
		log.info("åˆ é™¤è°ƒæ•™ ====> %s", rm_file)
		sedmsg(CurrentQQ,data,"åˆ é™¤æˆåŠŸ\nä½ ä¸å–œæ¬¢è¢«è¿™æ ·è°ƒæ•™çš„æˆ‘å—[è¡¨æƒ…9]")
		return 1
	end
    msgs = data.Content:gsub("è°ƒæ•™", "")
		res2 = string.find(msgs, "#")
		str = string.sub(msgs,res2+1)
		str2 = string.sub(msgs,1,res2-1)
		        
		        if (str == "") then
		            sedmsg(CurrentQQ,data,"è°ƒæ•™çš„å›ç­”å†…å®¹ä¸èƒ½ä¸ºç©ºå“¦")
			        return 1
		        end
				if (str2 == "") then
		            sedmsg(CurrentQQ,data,"è°ƒæ•™çš„æŒ‡ä»¤å†…å®¹ä¸èƒ½ä¸ºç©ºå“¦")
			        return 1
		        end
		        rese = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..str2..".txt")
					if (rese ~= nil) then
				        sedmsg(CurrentQQ,data,"æŒ‡ä»¤å·²ç»å­˜åœ¨äº†å“¦")
				        return 1
				    end
				Wirte("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..str2..".txt",str)
				sedmsg(CurrentQQ,data,"è°ƒæ•™æˆåŠŸ\nä½ è¿˜æƒ³å†è°ƒæ•™æˆ‘ä¸€æ¬¡å—[è¡¨æƒ…6]")
		        return 1
end

function url_encode(str)
    if (str) then
        str = string.gsub(str, "\n", "\r\n")
        str =
            string.gsub(
            str,
            "([^%w ])",
            function(c)
                return string.format("%%%02X", string.byte(c))
            end
        )
        str = string.gsub(str, " ", "+")
    end
    return str
end

--æŠ¢çº¢åŒ…å¤„ç†
function RedBag(CurrentQQ, data)
    Api.Api_OpenRedBag(CurrentQQ, data.RedBaginfo)
    if (data.RedBaginfo.RedType == 12) then
         luaRes =
                Api.Api_SendMsg(
                CurrentQQ,
                {
                    toUser = data.FromGroupId,
                    sendToType = 2,
                    sendMsgType = "TextMsg",
                    groupid = 0,
                    content = data.RedBaginfo.Tittle,
                    atUser = 0
                }
            )
        log.notice("From Lua SendMsg Ret\n%d", luaRes.Ret)
    end
end

--è§†é¢‘è§£æå¤„ç†
function Video(CurrentQQ, data)
    vdata = json.decode(data.Content)
        videodata = {
            GroupID = data.FromGroupId,
            VideoUrl = vdata.VideoUrl,
            VideoMd5 = vdata.VideoMd5
        }
        --æ„é€ table å‚æ•°è¡¨
        luaResp = Api.Api_CallFunc(CurrentQQ, "PttCenterSvr.ShortVideoDownReq", videodata) --é€šè¿‡cmdè°ƒç”¨åŠŸèƒ½åŒ…
        luaRes =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "TextMsg",
                groupid = 0,
                content = "è§£æè§†é¢‘URL-->" .. luaResp.VideoUrl,
                atUser = 0
            }
        )
end

--ç®¡ç†å¼€å…³é€šç”¨
function adminio(CurrentQQ,data,oio)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim ~= nil) then
            msg = data.Content:gsub(oio, "")
            str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
            if (string.find(str, "å…³é—­")) then
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äººå·²è¢«å…³é—­...\nè¯·å…ˆå¼€å¯æœºå™¨äºº")
                return 1
            end
			str2 = Read("mimoio\/çŠ¶æ€æ•°æ®\/"..oio.."\/"..data.FromGroupId..".txt")
			if (string.find(str2, msg)) then
			    sedmsg(CurrentQQ,data,"âˆ´"..oio.."æœ¬å°±æ˜¯"..str2.."çŠ¶æ€")
                return 1
			end
            Wirte("mimoio\/çŠ¶æ€æ•°æ®\/"..oio.."\/"..data.FromGroupId..".txt",msg)
            sedmsg(CurrentQQ,data,"âˆ´"..oio..msg.."æˆåŠŸ")
            return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
end

--ç™¾ç§‘å¤§å…¨
function baike(CurrentQQ,data)
    keyWord = data.Content:gsub("ç™¾ç§‘", "")
        if keyWord == "" then
            return 1
        end
        response, error_message =
            http.request(
            "GET",
            "http://baike.baidu.com/api/openapi/BaikeLemmaCardApi",
            {
                query = "scope=103&format=json&appid=379020&bk_key=" .. url_encode(keyWord) .. "&bk_length=600"
            }
        )
        html = response.body
        while(string.find(html, '"errno":2')) do
            response, error_message =
            http.request(
            "GET",
            "http://baike.baidu.com/api/openapi/BaikeLemmaCardApi",
            {
                query = "scope=103&format=json&appid=379020&bk_key=" .. url_encode(keyWord) .. "&bk_length=600"
            })
			html = response.body
        end
        local j = json.decode(html)
        sedmsg(CurrentQQ,data,j.abstract.."\n"..j.url)
end

--éŸ³ä¹ç‚¹æ­Œ
function music(CurrentQQ,data)
    keyWord = data.Content:gsub("ç‚¹æ­Œ", "")
        if keyWord == "" then
            return 1
        end
        response, error_message =
            http.request(
            "GET",
            "https://c.y.qq.com/soso/fcgi-bin/client_search_cp",
            {
                query = "aggr=1&cr=1&flag_qc=0&p=1&n=6&w=" .. url_encode(keyWord)
            }
        )
        html = response.body
		str = string.sub(html,10,-2)
        j = json.decode(str)
        if (j.code == 0) then
            msg = ""
            num = j.data.song.list
            list = num[1]
            songname = list.songname
            singername = list.singer[1].name
            payplay = list.pay.payplay
			albummid = list.albummid
			songmid = list.songmid
	        sedjsonmsg(CurrentQQ,data,'{"app":"com.tencent.structmsg","desc":"éŸ³ä¹","view":"music","ver":"0.0.0.1","prompt":"[åˆ†äº«]' ..songname.. '","meta":{"music":{"sourceMsgId":"0","title":"' ..songname.. '","desc":"' ..singername.. '","preview":"y.gtimg.cn/music/photo_new/T002R150x150M000'..albummid..'.jpg","tag":"QQéŸ³ä¹","musicUrl":"https://v1.itooi.cn/tencent/url?id='..songmid..'","jumpUrl":"y.qq.com/n/yqq/song/'..songmid..'.html","appid":100497308,"app_type":1,"action":"","source_url":"url.cn/5aSZ8Gc","source_icon":"url.cn/5tLgzTm","android_pkg_name":"com.tencent.qqmusic"}},"config":{"forward":true,"type":"normal","autosize":true}}')
			return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´Error:"..j.code)
			return 1
        end
end

--è®¿é—®url
function geturl(url_class,url,caulrt)
        response, error_message =
            http.request(
            url_class,
            url,
            {
                query = caulrt
            }
        )
        html = response.body
		return html
end

--æ¶ˆæ¯å‚¨è“„
function msgsql(CurrentQQ,data)
    if (mysqlpass == "") then
	    return 1
	end
    c = mysql.new()
    -- åˆå§‹åŒ–mysqlå¯¹è±¡
    ok, err = c:connect({host = mysqlhost, port = 3306, database = mysqldb, user = mysqluser, password = mysqlpass})
    --å»ºç«‹è¿æ¥
    if ok then
        sqlstr =
            string.format(
            [[INSERT INTO msgcache (GroupID, MsgSeq, MsgRandom,MsgType,Data,MsgTime)VALUES (%d,%d,%d,'%s','%s',%d)]],
            data.FromGroupId,
            data.MsgSeq,
            data.MsgRandom,
            data.MsgType,
            data.Content,
            data.MsgTime
        )
        res, err = c:query(sqlstr) --å…¥åº“ç¼“å­˜æ¶ˆæ¯
        log.info("%s", err)
        c.close(c)
    --é‡Šæ”¾è¿æ¥
    end
    return 1
end

--æ’¤å›æ£€æµ‹
function CheHui(CurrentQQ, data, extData)
    c = mysql.new()
    -- åˆå§‹åŒ–mysqlå¯¹è±¡
	if (mysqlpass == "") then
	    return 1
	end
	
    if data.MsgType == "ON_EVENT_GROUP_REVOKE" then --ç›‘å¬ ç¾¤æ’¤å›äº‹ä»¶
        str = string.format("ç¾¤æˆ %d  æˆå‘˜ UserID %s æ’¤å›äº†æ¶ˆæ¯Seq %s \n", extData.GroupID, extData.UserID, extData.MsgSeq)
        log.info("%s", str)
        ok, err = c:connect({host = mysqlhost, port = 3306, database = mysqldb, user = mysqluser, password = mysqlpass})
        --å»ºç«‹è¿æ¥
        log.info("sql %v", err)
        if ok then
            sqlstr =
                string.format(
                "select * from msgcache where `GroupID`= %d and `MsgSeq` = %d",
                extData.GroupID,
                extData.MsgSeq
            )
            res, err = c:query(sqlstr) --è·Ÿç¾¤ç¾¤idå’Œæ¶ˆæ¯SEQæŸ¥è¯¢å‡ºæ’¤å›çš„æ¶ˆæ¯å†…å®¹
            if err == nil then
                c.close(c)
                GroupID = tonumber(res[1]["GroupID"])
                MsgType = res[1]["MsgType"]
                Data = res[1]["Data"]

                if MsgType == "TextMsg" then
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            --å‘é€æ–‡æœ¬æ¶ˆæ¯
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡æ–‡æœ¬æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                Data
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "SmallFaceMsg" then
                    --Data {"Content":"[è¡¨æƒ…101]","Hex":"FKY=","Index":101,"tips":"[å°è¡¨æƒ…]"}
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡è¡¨æƒ…æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).Content
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "PicMsg" then
                    --Data {"Content":"","FileId":2820717626,"FileMd5":"q0oEC5aloJJMFr10mplaXw==","FileSize":7026,"tips":"[ç¾¤å›¾ç‰‡]","url":"http://gchat.qpic.cn/gchatpic_new/1700487478/960839480-2534335053-AB4A040B96A5A0924C16BD749A995A5F/0?vuin=u0026term=255u0026pictype=0"}
                    jData = json.decode(Data)
					if (jData.tips == "[ç¾¤æ¶ˆæ¯-QQé—ªç…§]") then
					    
					Api.Api_SendMsg( 
                    CurrentQQ,
                    {
                        toUser = GroupID,
                        sendToType = 2,
                        sendMsgType = "ForwordMsg",
                        content = "",
                        atUser = 0,
                        groupid = 0,
                        voiceUrl = "",
                        voiceBase64Buf = "",
                        picUrl = "",
                        picBase64Buf = "",
                        forwordBuf = json.decode(Data).ForwordBuf, --æ¬²è½¬å‘çš„base64buf å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                        forwordField = json.decode(Data).ForwordField --æ¬²å†™å…¥åè®®çš„å­—æ®µID å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                    }
                )
				    return 1
					end
                    Api.Api_SendMsg( --é€šè¿‡å›¾ç‰‡md5å‘é€å›¾ç‰‡ ç§’å‘ä¸ç”¨ä¸Šä¼  ç›¸å½“äºè½¬å‘
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "PicMsg",
                            --å‘é€å›¾æ–‡æ¶ˆæ¯
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡å›¾ç‰‡æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š[PICFLAG]%s",
                                extData.UserID,
                                jData.Content
                            ),
                            --é€šè¿‡å®[PICFLAG]æ”¹å˜å›¾æ–‡é¡ºåº  æ”¹ä¸ºç°æ–‡å­—åå›¾ç‰‡
                            atUser = 0,
                            voiceUrl = "",
                            voiceBase64Buf = "",
                            picUrl = "",
                            picBase64Buf = "",
                            fileMd5 = jData.FileMd5
                        }
                    )
                end
                if MsgType == "AtMsg" then
                    --Data {"Content":"@Kar98k skjjkssjkjs","UserID":123456789,"tips":"[ATæ¶ˆæ¯]"}
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡atæ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).Content
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "VoiceMsg" then
                    --Data {"tips":"[è¯­éŸ³]","url":"http://grouptalk.c2c.qq.com/?ver=0u0026rkey=3062020101045b305902010102010102041fdef8ae042439416931554e5142586c536d78706a314c686843664959725f327a5f573064697653755902045dac2a21041f0000000866696c6574797065000000013100000005636f64656300000001310400u0026filetype=1u0026voice_codec=1"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "VoiceMsg",
                            --å‘é€ç¾¤è¯­éŸ³æ¶ˆæ¯
                            groupid = 0,
                            content = "",
                            atUser = 0,
                            voiceUrl = json.decode(Data).url,
                            --é€šè¿‡ç½‘ç»œurlè¿›è¡Œå‘é€è¯­éŸ³
                            voiceBase64Buf = "",
                            picUrl = "",
                            picBase64Buf = ""
                        }
                    )
                end

                if MsgType == "ReplayMsg" then
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡å›å¤æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).ReplayContent
                            ),
                            atUser = 0
                        }
                    )
                end
				if MsgType == "VideoMsg" then
	             Api.Api_SendMsg( 
                    CurrentQQ,
                    {
                        toUser = GroupID,
                        sendToType = 2,
                        sendMsgType = "ForwordMsg",
                        content = "",
                        atUser = 0,
                        groupid = 0,
                        voiceUrl = "",
                        voiceBase64Buf = "",
                        picUrl = "",
                        picBase64Buf = "",
                        forwordBuf = json.decode(Data).ForwordBuf, --æ¬²è½¬å‘çš„base64buf å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                        forwordField = json.decode(Data).ForwordField --æ¬²å†™å…¥åè®®çš„å­—æ®µID å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                    }
                )
				end
                if MsgType == "XmlMsg" then
				    
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "XmlMsg",
                            groupid = 0,
                            content = string.format("%s", Data),
                            atUser = 0
                        }
                    )
                end
				if MsgType == "JsonMsg" then
				    
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "JsonMsg",
                            groupid = 0,
                            content = string.format("%s", Data),
                            atUser = 0
                        }
                    )
                end
            end
        end
    end
    return 1
end
2020/09/07 11:54:44.168 [E]  mimoio.lua
2020/09/07 11:54:44.169 [E]  local log = require("log")
local Api = require("coreApi")
local json = require("json")
local http = require("http")
local mysql = require("mysql")

--ç‰ˆæœ¬å·(ä¸è¦æ”¹åŠ¨)
Vabr = "1.0.2"
--æ•°æ®åº“é…ç½®
mysqlhost = "localhost"--é»˜è®¤ä¸åŠ¨
mysqldb = "ffaxx001"--æ•°æ®åº“å
mysqluser = "ffaxx001"--æ•°æ®åº“ç”¨æˆ·å
mysqlpass = "123456"--æ•°æ®åº“å¯†ç 
--ä¸ä½¿ç”¨è¯·ä¸è¦æ”¹åŠ¨

function ReceiveFriendMsg(CurrentQQ, data)
    if (data.Content == "ä½¿ç”¨æ–¹æ³•") then
	    sendfrimsg(CurrentQQ,data,"æ·»åŠ æˆæƒè€…çš„æ–¹æ³•\nå¯¹å•ä¸ªæœºå™¨äººç§èŠå‘é€[æ·»åŠ æˆæƒè€…+æˆæƒè€…QQ]\n\næˆæƒç¾¤çš„æ–¹æ³•\nåˆ°éœ€è¦æˆæƒçš„ç¾¤é‡Œå‘é€[æˆæƒ+ä¸»äººQQ]ã€‚æ³¨æ„:æˆæƒå¿…é¡»æ˜¯æˆæƒè€…è¿›è¡Œæ“ä½œ,ç®¡ç†å‘˜æˆæƒä¸äº†")
	end
    --æ•°æ®åˆå§‹åŒ–
    if (data.Content == "åˆå§‹åŒ–") then
	    root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root ~= nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´è¯·ä¸è¦é‡å¤åˆå§‹åŒ–")
			return 1
		end
    --os.execute('mkdir mimoio/æœºå™¨æˆæƒ')
	    os.execute('mkdir mimoio')
		os.execute('mkdir mimoio/å¤è¯»æœº')
		os.execute('mkdir mimoio/å¤è¯»æœº/æ¬¡æ•°')
		os.execute('mkdir mimoio/å¤è¯»æœº/å†…å®¹')
		os.execute('mkdir mimoio/æœºå™¨æˆæƒ')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨ä¸»äºº')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨èŠå¤©')
		os.execute('mkdir mimoio/æœºå™¨è°ƒæ•™')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æŠ¢çº¢åŒ…')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æœºå™¨èŠå¤©')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æœºå™¨å¼€å…³')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æ’¤å›æ£€æµ‹')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/å›¾ç‰‡è§£æ')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/è§†é¢‘è§£æ')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/é—ªç…§æ£€æµ‹')
		Wirte("mimoio\/"..data.FromUin..".txt","999")
		sendfrimsg(CurrentQQ,data,"åˆå§‹åŒ–å®Œæ¯•ï¼\nå‘é€[ä½¿ç”¨æ–¹æ³•]äº†è§£ä½¿ç”¨å§")
	end
	--æ·»åŠ æˆæƒè€…æ“ä½œ(ç§èŠæœºå™¨äººå‘é€)
	if (string.find(data.Content, "^æ·»åŠ æˆæƒè€…")) then
	    msg = data.Content:gsub("æ·»åŠ æˆæƒè€…", "")
		--Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromUin..".txt","å…³é—­")
		root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root == nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„ç®¡ç†è€…")
			return 1
		end
		Wirte("mimoio\/æœºå™¨æˆæƒ\/"..msg..CurrentQQ..".txt","999")
		sendfrimsg(CurrentQQ,data,"âˆ´æ·»åŠ æˆæƒè€…æˆåŠŸ")
	end
	--åˆ é™¤æˆæƒè€…æ“ä½œ(ç§èŠæœºå™¨äººå‘é€)
	if (string.find(data.Content, "^åˆ é™¤æˆæƒè€…")) then
	    msg = data.Content:gsub("åˆ é™¤æˆæƒè€…", "")
		--Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromUin..".txt","å…³é—­")
		root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root == nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„ç®¡ç†è€…")
			return 1
		end
		os.remove("mimoio\/æœºå™¨æˆæƒ\/"..msg..CurrentQQ..".txt")
		sendfrimsg(CurrentQQ,data,"âˆ´åˆ é™¤æˆæƒè€…æˆåŠŸ")
	end
    return 1
end
function ReceiveGroupMsg(CurrentQQ, data)
    if (tostring(data.FromUserId) == CurrentQQ) then
	    return 1
	end
	--ç¾¤èŠæˆæƒ(åˆ°éœ€è¦æˆæƒçš„ç¾¤é‡Œæ“ä½œ)
	if (string.find(data.Content, "^æˆæƒ")) then
	    root = Read("mimoio\/æœºå™¨æˆæƒ\/"..data.FromUserId..CurrentQQ..".txt","999")
		if (root == nil) then
		    sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„æˆæƒè€…")
			return 1
		end
		msg = data.Content:gsub("æˆæƒ", "")
		os.execute('mkdir mimoio/æœºå™¨è°ƒæ•™/'..data.FromGroupId)
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨ä¸»äºº/'..data.FromGroupId)
		Wirte("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..msg..".txt","999")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt","å›å¤èŠå¤©")
		sedmsg(CurrentQQ,data,"âˆ´æˆæƒæˆåŠŸï¼\nå‘é€[å¼€å¯æœºå™¨äºº]ä½¿ç”¨å§")
	end
	--åˆ é™¤æˆæƒæ“ä½œ(åˆ°éœ€è¦åˆ é™¤æˆæƒçš„ç¾¤é‡Œæ“ä½œ)
	if (string.find(data.Content, "^åˆ é™¤æˆæƒ")) then
	    root = Read("mimoio\/æœºå™¨æˆæƒ\/"..data.FromUserId..CurrentQQ..".txt","999")
		if (root == nil) then
		    sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„æˆæƒè€…")
			return 1
		end
		msg = data.Content:gsub("åˆ é™¤æˆæƒ", "")
		os.remove("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..msg..".txt")
		os.remove("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
		sedmsg(CurrentQQ,data,"âˆ´åˆ é™¤æˆæƒæˆåŠŸï¼")
	end
	--æœºå™¨å¼€å…³æŒ‡ä»¤
	if (data.Content == "å¼€å¯æœºå™¨äºº" or data.Content == "å…³é—­æœºå™¨äºº") then
        mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim ~= nil) then
            msg = data.Content:gsub("æœºå™¨äºº", "")
            str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
			if (str == nil) then
			    Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt",msg)
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äºº"..msg.."æˆåŠŸï¼")
				log.info("Str ====> %s", str)
                return 1
			end
			
            if (string.find(str, msg)) then
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äººä¸€ç›´æ˜¯"..msg.."çš„å‘")
                return 1
            end
            Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt",msg)
            sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äºº"..msg.."æˆåŠŸï¼")
            return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
	end
    --æœºå™¨äººå¼€å¯æ£€æµ‹
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
	if (str == nil) then
	    log.info("Str ====> %s", str)
        return 1
	end
	if (string.find(str, "å…³é—­")) then
	    return 1
	end
	--atæ¶ˆæ¯å¤„ç†
	msgs = ""
	atqq = 0
	if (string.find(data.Content, "ATæ¶ˆæ¯")) then
	    msgs = json.decode(data.Content).Content
		atqq = json.decode(data.Content).UserID
	end
	--å°¾å·´è‡ªå®šä¹‰(å¾…å®Œå–„)
	tips = "â€”â€”å‡¤é£ç¿±ç¿”å…®ä¸·"
    --åŠŸèƒ½æ¨¡å—
    if (data.Content == "åŠŸèƒ½" or data.Content == "ä¸»ç•Œé¢") then
        face = faceArray()
        sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."å½±è§†æœç´¢\n"..face.."èŠå¤©å¨±ä¹\n"..face.."ä¾¿åˆ©åŠŸèƒ½\n"..face.."æœºå™¨è°ƒæ•™\n"..face.."ç®¡ç†ç³»ç»Ÿ\n"..face.."bugåé¦ˆ\n"..face.."æœ¬ç¾¤çŠ¶æ€\n"..face.."æ›´æ–°æ£€æµ‹\n\n"..tips)
    end
    --å½±è§†æœç´¢æ¨¡å—
    if (data.Content == "å½±è§†æœç´¢") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."æœç´¢+å½±è§†å\n"..face.."æˆ‘æƒ³çœ‹+å½±è§†å\n"..face.."æˆ‘è¦çœ‹+å½±è§†å\n\n"..tips)
    elseif (string.find(data.Content, "^æœç´¢")) then
	    msg = data.Content:gsub("æœç´¢", "")
		Sousuo(CurrentQQ,data,msg)
	elseif (string.find(data.Content, "^æˆ‘æƒ³çœ‹")) then
	    msg = data.Content:gsub("æˆ‘æƒ³çœ‹", "")
		Sousuo(CurrentQQ,data,msg)
    elseif (string.find(data.Content, "^æˆ‘è¦çœ‹")) then
	    msg = data.Content:gsub("æˆ‘è¦çœ‹", "")
		Sousuo(CurrentQQ,data,msg)
	end
	--èŠå¤©å¨±ä¹æ¨¡å—
	if (data.Content == "èŠå¤©å¨±ä¹") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."åˆ‡æ¢æ–‡å­—èŠå¤©\n"..face.."åˆ‡æ¢å›å¤èŠå¤©\n"..face.."åˆ‡æ¢è¯­éŸ³èŠå¤©\n\n"..tips)
    elseif (data.Content == "åˆ‡æ¢æ–‡å­—èŠå¤©") then
		liaotian(CurrentQQ,data,1)
	elseif (data.Content == "åˆ‡æ¢è¯­éŸ³èŠå¤©") then
	    liaotian(CurrentQQ,data,2)
    elseif (data.Content == "åˆ‡æ¢å›å¤èŠå¤©") then
	    liaotian(CurrentQQ,data,3)
	else
	    ownthink(CurrentQQ,data,msgs,atqq)
	end
	--ä¾¿åˆ©åŠŸèƒ½æ¨¡å—
	if (data.Content == "ä¾¿åˆ©åŠŸèƒ½") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."ç™¾ç§‘å¤§å…¨\n"..face.."éŸ³ä¹ç‚¹æ­Œ\n"..face.."é—ªä»–@xx\n"..face.."å¤©æ°”æŸ¥è¯¢\n\n"..tips)
	elseif (data.Content == "ç™¾ç§‘å¤§å…¨") then
		sedmsg(CurrentQQ,data,"å‘é€:[ç™¾ç§‘+å…³é”®è¯]\nä¾‹å¦‚:ç™¾ç§‘æ´›å¤©ä¾")
    elseif (data.Content == "éŸ³ä¹ç‚¹æ­Œ") then
		sedmsg(CurrentQQ,data,"å‘é€:[ç‚¹æ­Œ+æ­Œå]\nä¾‹å¦‚:ç‚¹æ­Œé’æŸ ")
	elseif (data.Content == "å¤©æ°”æŸ¥è¯¢") then
		sedmsg(CurrentQQ,data,"å‘é€:[å¤©æ°”+åœ°æ–¹å]\nä¾‹å¦‚:å¤©æ°”åŒ—äº¬(é™äºå›½å†…)")
    elseif (string.find(data.Content, "^å¤©æ°”")) then
        tianqi(CurrentQQ,data)
	    --msg = data.Content:gsub("æœç´¢", "")
		--Sousuo(CurrentQQ,data,msg)
	elseif (string.find(data.Content, "^ç™¾ç§‘")) then
	    baike(CurrentQQ,data)
	    --msg = data.Content:gsub("æˆ‘æƒ³çœ‹", "")
		--Sousuo(CurrentQQ,data,msg)music(CurrentQQ,data)
    elseif (string.find(data.Content, "^ç‚¹æ­Œ")) then
	    music(CurrentQQ,data)
	end
	--æœºå™¨è°ƒæ•™æ¨¡å—
	if (data.Content == "æœºå™¨è°ƒæ•™") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."æ–‡å­—è°ƒæ•™\n"..face.."è¯­éŸ³è°ƒæ•™\n"..face.."å”±æ­Œè°ƒæ•™\n"..face.."éŸ³ä¹è°ƒæ•™\n"..face.."å›¾ç‰‡è°ƒæ•™\n"..face.."åˆ é™¤è°ƒæ•™\n\n"..tips)
    elseif (data.Content == "æ–‡å­—è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#(å†…å®¹)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#ä½ å¥½å•Š")
	elseif (data.Content == "è¯­éŸ³è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#è¯­éŸ³(å†…å®¹)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#è¯­éŸ³ä½ å¥½å•Š")
	elseif (data.Content == "å›¾ç‰‡è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#å›¾ç‰‡(é“¾æ¥)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#å›¾ç‰‡http://../1.jpg")
	elseif (data.Content == "éŸ³ä¹è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#ç‚¹æ­Œ(æ­Œå)]\nä¾‹å¦‚:è°ƒæ•™å–µ#ç‚¹æ­Œå­¦çŒ«å«")
	elseif (data.Content == "å”±æ­Œè°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#å”±æ­Œ(æ­Œå)]\nä¾‹å¦‚:è°ƒæ•™å–µ#å”±æ­Œå­¦çŒ«å«")
	elseif (data.Content == "åˆ é™¤è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[åˆ é™¤è°ƒæ•™(æŒ‡ä»¤)]\nä¾‹å¦‚:åˆ é™¤è°ƒæ•™ä½ å¥½")
	elseif (string.find(data.Content, "^è°ƒæ•™")) then
        tiaojiao(CurrentQQ,data)
	elseif (string.find(data.Content, "^åˆ é™¤è°ƒæ•™")) then
        tiaojiao(CurrentQQ,data)
	end
	--ç®¡ç†ç³»ç»Ÿæ¨¡å—
	if (data.Content == "ç®¡ç†ç³»ç»Ÿ") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."å¼€å¯/å…³é—­æœºå™¨äºº\n"..face.."å¼€å¯/å…³é—­æŠ¢çº¢åŒ…\n"..face.."å¼€å¯/å…³é—­æœºå™¨èŠå¤©\n"..face.."å¼€å¯/å…³é—­é—ªç…§æ£€æµ‹\n"..face.."å¼€å¯/å…³é—­å›¾ç‰‡è§£æ\n"..face.."å¼€å¯/å…³é—­è§†é¢‘è§£æ\n"..face.."å¼€å¯/å…³é—­æ’¤å›æ£€æµ‹\n\n"..tips)
    elseif (data.Content == "å¼€å¯æœºå™¨èŠå¤©" or data.Content == "å…³é—­æœºå™¨èŠå¤©") then
        adminio(CurrentQQ,data,"æœºå™¨èŠå¤©")
    elseif (data.Content == "å¼€å¯æ’¤å›æ£€æµ‹" or data.Content == "å…³é—­æ’¤å›æ£€æµ‹") then
        adminio(CurrentQQ,data,"æ’¤å›æ£€æµ‹")
	elseif (data.Content == "å¼€å¯é—ªç…§æ£€æµ‹" or data.Content == "å…³é—­é—ªç…§æ£€æµ‹") then
        adminio(CurrentQQ,data,"é—ªç…§æ£€æµ‹")
	elseif (data.Content == "å¼€å¯æŠ¢çº¢åŒ…" or data.Content == "å…³é—­æŠ¢çº¢åŒ…") then
        adminio(CurrentQQ,data,"æŠ¢çº¢åŒ…")
	elseif (data.Content == "å¼€å¯è§†é¢‘è§£æ" or data.Content == "å…³é—­è§†é¢‘è§£æ") then
        adminio(CurrentQQ,data,"è§†é¢‘è§£æ")
	elseif (data.Content == "å¼€å¯å›¾ç‰‡è§£æ" or data.Content == "å…³é—­å›¾ç‰‡è§£æ") then
        adminio(CurrentQQ,data,"å›¾ç‰‡è§£æ")
	end
	--bugåé¦ˆæ¨¡å—
	if (data.Content == "BUGåé¦ˆ" or data.Content == "bugåé¦ˆ") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."é‚®ä»¶åé¦ˆ\n"..face.."QQåé¦ˆ\n\n"..tips)
    elseif (data.Content == "QQåé¦ˆ") then
        sedmsg(CurrentQQ,data,"???Î£(ï¾Ÿâˆ€ï¾Ÿï¾‰)ï¾‰\næ’ä»¶æœ‰é—®é¢˜å¯ä»¥åé¦ˆåˆ°:\nQQ:2353065854")
    elseif (data.Content == "é‚®ä»¶åé¦ˆ") then
        sedmsg(CurrentQQ,data,"å®è´å’‹å•¦=ÍÍŸÍŸÍ(ê’ªá—œê’ª â€§Ì£Ì¥Ì‡)\næ’ä»¶æœ‰é—®é¢˜å¯ä»¥åé¦ˆåˆ°:\né‚®ç®±ğŸ“¬:ym-o@qq.com")
	end
	--æœ¬ç¾¤çŠ¶æ€æ¨¡æ¿
	if (data.Content == "æœ¬ç¾¤çŠ¶æ€") then
        face = faceArray()
        hb = Read("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt")
        sz = Read("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt")
		tp = Read("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt")
        sp = Read("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt")
        jqr = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
        lt = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
        ch = Read("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..data.FromGroupId..".txt")
		sedmsg(CurrentQQ,data,"çŠ¶æ€æ•°æ®åˆ—è¡¨â†“â†“â†“\n"..face.."æœºå™¨äºº:"..jqr.."\n"..face.."æŠ¢çº¢åŒ…:"..hb.."\n"..face.."å›¾ç‰‡è§£æ:"..tp.."\n"..face.."æ’¤å›æ£€æµ‹:"..ch.."\n"..face.."è§†é¢‘è§£æ:"..sp.."\n"..face.."æœºå™¨èŠå¤©:"..lt.."\n"..face.."é—ªç…§æ£€æµ‹:"..sz.."\n\n"..tips)
	end
	--æ›´æ–°æ¨¡å—
	if (data.Content == "æ›´æ–°æ£€æµ‹") then
        str = geturl("GET","http://118.25.41.32/Lsb/lua/Vabr.txt","")
		log.info("Str ====> %s", str)
        if (string.find(str, Vabr)) then
            sedmsg(CurrentQQ,data,"å½“å‰ç‰ˆæœ¬ä¸ºæœ€æ–°ç‰ˆ")
        else
            sedmsg(CurrentQQ,data,"å‘ç°æ–°ç‰ˆæœ¬!\nå½“å‰ç‰ˆæœ¬:"..Vabr.."\næ–°ç‰ˆæœ¬å·:"..str.."\nèµ¶å¿«å‘é€[æ›´æ–°æ’ä»¶]å§")
        end
	elseif (data.Content == "æ›´æ–°æ’ä»¶") then
	    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim == nil) then
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
        str = geturl("GET","http://118.25.41.32/Lsb/lua/Vabr.txt","")
		log.info("Str ====> %s", str)
        if (string.find(str, Vabr)) then
            sedmsg(CurrentQQ,data,"å½“å‰ç‰ˆæœ¬ä¸ºæœ€æ–°ç‰ˆ")
        else
            str = geturl("GET","http://118.25.41.32/Lsb/lua/mimoio.txt","")
            Wirte("Plugins\/mimoio.lua",str)
            sedmsg(CurrentQQ,data,"æ›´æ–°å®Œæ¯•ï¼")
        end
	end
	--å›¾ç‰‡ç±»å‹æ¶ˆæ¯å¤„ç†
    if (data.MsgType == "PicMsg") then
	    msg = Read("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt")
		jData = json.decode(data.Content)
	    if (msg ~= nil and jData.tips ~= "[ç¾¤æ¶ˆæ¯-QQé—ªç…§]") then
            if (string.find(str, "å¼€å¯")) then
	            sedmsg(CurrentQQ,data,"å›¾ç‰‡é“¾æ¥è§£æå¦‚ä¸‹â†“â†“\n"..jData.url)
				return 1
	        end
	    end
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt")
	    if (str == nil) then
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    --é—ªç…§ã€å›¾ç‰‡å¤„ç†æ¨¡å—
		PicFlag(CurrentQQ, data)
    end
	--æŠ¢çº¢åŒ…å¤„ç†
	if (string.find(data.MsgType, "RedBagMsg") == 1) then
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt")
		if (str == nil) then
	        log.info("Str ====> %s", str)
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    RedBag(CurrentQQ, data)
	end
	--è§†é¢‘è§£æå¤„ç†
	if (string.find(data.MsgType, "VideoMsg") == 1) then
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt")
		if (str == nil) then
	        log.info("Str ====> %s", str)
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    Video(CurrentQQ, data)
	end
	--até—ªå›¾
	if (data.MsgType == "AtMsg") and (string.find(data.Content, "é—ªä»–")) then
	    shantu(CurrentQQ, data)
    end
	--è°ƒæ•™æœç´¢å¼•æ“
	mim = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..data.Content..".txt")
	if (mim == nil) then
	    --äººç±»çš„æœ¬è´¨æ˜¯å¤è¯»æœº
	    msg = Read("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt")
		if (msg ~= nil) then
		    cs = Read("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt")
			ii = tonumber(cs)
			if (string.find(msg, "^"..data.Content.."$")) then
			    if (ii > 2) then
			         math.randomseed(os.time())
                     sj = math.random(1, 5)
		             if (sj == 1 or sj == 2) then
			             sedmsg(CurrentQQ,data,msg)
					     rr = ii + 1
		                 Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
				     elseif (sj == 3) then
				         os.remove("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt")
					     os.remove("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt")
					     fdArray = {"çªç„¶æˆªæ–­å¤è¯»(ï¾ŸâŠ¿ï¾Ÿ)ï¾‚","å¤è¯»å¯è€»(â€¢Ì€ã¸ â€¢Ì â•® )","ä¸è¦å¤è¯»äº†å•¦","è¿™å°±æ˜¯æ‰€è°“çš„äººç±»çš„æœ¬è´¨","ä½ ä»¬å’‹ä¸ä¸Šå¤©å‘","åˆå¤è¯»ä¸Šç˜¾äº†å•Š"}
                         math.randomseed(os.time())
                         fdsj = math.random(1, 6)
				         sedmsg(CurrentQQ,data,fdArray[fdsj])
				     else
			             rr = ii + 1
		                 Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
		             end
			    else
			        rr = ii + 1
		            Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
			    end
			else
			    if (ii > 2) then
			        math.randomseed(os.time())
                    sj2 = math.random(1, 3)
					if (sj2 == 2) then
					    fdArray2 = {"ä¸­æ–­å¤è¯»å¯è€»","æ‰“æ–­å¤è¯»å¯è€»(â€¢Ì€ã¸ â€¢Ì â•® )","ä½ ä¸ºä»€ä¹ˆè¦æ‰“æ–­å¤è¯»å•Š","å¤è¯»ä¸é¦™å˜›","ç ´åæ°›å›´(à¸‡áµ’ÌŒçš¿áµ’ÌŒ)à¸‡â¼Â³â‚Œâ‚ƒ"}
                        math.randomseed(os.time())
                        fdsj2 = math.random(1, 5)
				        sedmsg(CurrentQQ,data,fdArray2[fdsj2])
					end
				end
				Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt","1")
			    Wirte("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt",data.Content)
			end
		else
		    Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt","1")
			Wirte("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt",data.Content)
		end
	    --å¦‚æœè°ƒæ•™æŒ‡ä»¤ä¸å­˜åœ¨ï¼Œåˆ™è¿›è¡Œå…¶ä»–æ“ä½œ
	    msgsql(CurrentQQ,data)--æ•°æ®å‚¨è“„
		--éšæœºå›å¤æ¶ˆæ¯æ¦‚ç‡0.04
	    math.randomseed(os.time())
        num = math.random(1, 40)
		if (num == 12) then
		    j = xiaosiapi(CurrentQQ,data,data.Content)
			sedmsg(CurrentQQ,data,j.data.info.text)
		end
	else
	    --è§¦å‘è°ƒæ•™æŒ‡ä»¤
		funic(CurrentQQ,data,mim)
	end
    return 1
end

function ReceiveEvents(CurrentQQ, data, extData)
  if data.MsgType == "ON_EVENT_GROUP_REVOKE" then --ç›‘å¬ ç¾¤æ’¤å›äº‹ä»¶
    --æ’¤å›äº‹ä»¶å¤„ç†
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..extData.GroupID..".txt")
    if (str == nil) then
	    log.info("Str ====> %s", str)
        return 1
	end
	if (string.find(str, "å…³é—­")) then
		return 1
	end
	CheHui(CurrentQQ, data, extData)
	--xxxxxxxxxxxxxxx
    return 1
  end
  --è¿›ç¾¤ç§€å›¾æ¬¢è¿


--é—ªç…§æ£€æµ‹å¤„ç†


--åŠŸèƒ½ç»„
function funic(CurrentQQ,data,msg)
    if string.find(msg, "^ç‚¹æ­Œ") then
	    data.Content = msg
        music(CurrentQQ,data,msg)
		return 1
	elseif string.find(msg, "^è¯­éŸ³") then
	    keyWord = msg:gsub("è¯­éŸ³", "")
        sedvoicemsg(CurrentQQ,data,keyWord)
		return 1
	elseif string.find(msg, "^å›¾ç‰‡") then
	    keyWord = msg:gsub("å›¾ç‰‡", "")
        sedimgmsg(CurrentQQ,data,keyWord,"")
		return 1
    elseif string.find(msg, "^å”±æ­Œ") then
        keyWord = msg:gsub("å”±æ­Œ", "")
		if (keyWord == "") then
		    sedmsg(CurrentQQ,data,"æ­Œåä¸èƒ½ç©ºç€å“¦")
		    return 1
		end
		sedmsg(CurrentQQ,data,"å¤©ä¾æ­£åœ¨åŠªåŠ›åŠ è½½Ù©(ËƒÌ¶Ì€Íˆà¯°Ë‚Ì¶ÌÍˆ)Ùˆ")
        response, error_message =
            http.request(
            "POST",
            "http://127.0.0.1:8888/SilkApi/UrlToBuf",--ä¿®æ”¹æ­¤å¤„ipåŠç«¯å£å³å¯
            {
                body = keyWord --ä¼ å…¥æ­Œæ›²å
            }
        )
        log.notice("err   %v", error_message)
        html = response.body --è¿”å›silk base64 buf
		if (string.find(html, "Î´")) then
				    sedmsg(CurrentQQ,data,"å¤©ä¾æ²¡æœ‰æ‰¾åˆ°ç›¸å…³çš„æ­Œå‘€(Ã’Ï‰Ã“×±)ï¼")
					c.close(c)
				    return 2
				end
        luaRes =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "VoiceMsg",
                groupid = 0,
                content = "",
                atUser = 0,
                voiceUrl = "",
                voiceBase64Buf = html 
            }
        )
		return 1
	end
    sedmsg(CurrentQQ,data,msg)
end

--å½±è§†æœç´¢ç”¨
function Sousuo(CurrentQQ,data,msg)
    response, error_message =
        http.request(
            "GET",
            "http://localhost/index.php/ajax/suggest",
            {
                query = "mid=1&f=admin&wd="..msg.."&limit=10&timestamp=1567914326746"
            }
        )
    html = response.body
	json = json.decode(html)
	if (json.total == 0) then
	    sedmsg(CurrentQQ,data,"å½±è§†æŸ¥è¯¢é”™è¯¯\nè¯·æ£€æŸ¥å½±è§†åæ˜¯å¦æ­£ç¡®\nâ•â•â•â•â•â•â•â•â•â•â•\næ³¨æ„âš ï¸å½±è§†åä¸è¦å¸¦æ— å…³æˆ–å¤šä½™çš„å­—ç¬¦")
	else
        sedmsg(CurrentQQ,data,"èµ„æºåœ°å€å¦‚ä¸‹â†“â†“â†“\nâ•â•â•â•â•â•â•â•â•â•\nhttp://118.25.41.32/index.php/vod/search/wd/"..escape(msg)..".html\nâ•â•â•â•â•â•â•â•â•â•â•\næ³¨æ„:å¦‚æœQQå‡ºç°åœæ­¢è®¿é—®ç°è±¡ï¼Œè¯·å¤åˆ¶é“¾æ¥ç”¨æµè§ˆå™¨æ‰“å¼€")
	end
end

--å•çº¯å‘æ¶ˆæ¯å›¾æ–‡é€šç”¨
function sedimgmsg(CurrentQQ,data,url,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "PicMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = url,
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘æ¶ˆæ¯ç”¨
function sedmsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "TextMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘ç§èŠæ¶ˆæ¯ç”¨
function sendfrimsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromUin,
        sendToType = 1,
        sendMsgType = "TextMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘jsonæ¶ˆæ¯ç”¨
function sedjsonmsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "JsonMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--èŠå¤©æ¨¡å—åˆ‡æ¢å‡½æ•°
function liaotian(CurrentQQ,data,msg)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
    if (mim == nil) then
        sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
        return 1
    end
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
	if (str == nil) then
        return 1
    end
	if (string.find(str, "å…³é—­")) then
	    sedmsg(CurrentQQ,data,"æœºå™¨èŠå¤©å¤„äºå…³é—­çŠ¶æ€\nâˆ´è¯·å…ˆå¼€å¯æœºå™¨èŠå¤©")
	    return 1
	end
	--åˆ‡æ¢å¤„ç†
	file = io.open("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt", "w")
	if (msg == 1) then
	    file:write("æ–‡å­—èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°æ–‡å­—èŠå¤©")
	elseif (msg == 2) then
	    file:write("è¯­éŸ³èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°è¯­éŸ³èŠå¤©")
	elseif (msg == 3) then
	    file:write("å›å¤èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°å›å¤èŠå¤©")
	end
	file:close()
end

--éšæœºè¡¨æƒ…å‡½æ•°
function faceArray()
    faceArray = {"[è¡¨æƒ…147]","ğŸ€","ğŸ”¥","ğŸ»","ğŸ’","[è¡¨æƒ…185]","[è¡¨æƒ…219]","[è¡¨æƒ…176]"}
    math.randomseed(os.time())
    num = math.random(1, 9)
    return faceArray[num]
end

--urlç¼–ç è½¬æ¢
function escape(w)
	pattern="[^%w%d%._%-%* ]"
	s=string.gsub(w,pattern,function(c)
		local c=string.format("%%%02X",string.byte(c))
		return c
	end)
	s=string.gsub(s," ","+")
	return s
end

--è¯»å–æ•°æ®å‡½æ•°
function Read(url)
    file = io.open(url, "r")
	if (file == nil) then
	    return nil
	else
        file:seek("set")
	    str = file:read("*a")
	    file:close()
        return str
	end
end

--å†™å…¥æ•°æ®å‡½æ•°
function Wirte(url,msg)
    file = io.open(url, "w+")
    file:write(msg)
	file:close()
    return "ok"
end

--å°æ€èŠå¤©å‡½æ•°
function xiaosiapi(CurrentQQ,data,str)
    response, error_message =
            http.request(
            "GET",
            "https://api.ownthink.com/bot",
            {
                query = "appid="..tostring(data.FromUserId).."&spoken=" .. url_encode(str),
                headers = {
                    Accept = "*/*"
                }
            }
        )
        html = response.body
		jData = json.decode(html)
		return jData
end

--æœºå™¨èŠå¤©å‡½æ•°
function ownthink(CurrentQQ,data,msgs,atqq)
    if (tostring(atqq) == CurrentQQ) then
        m = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
        if (m == nil) then
	        log.info("Str ====> %s", m)
            return 1
	    end
	    if (string.find(m, "å…³é—­")) then
	        sedmsg(CurrentQQ,data,"æœºå™¨èŠå¤©å¤„äºå…³é—­çŠ¶æ€\nâˆ´è¯·å…ˆå¼€å¯æœºå™¨èŠå¤©")
	        return 1
	    end
		res2 = string.find(msgs, " ")
		str = string.sub(msgs,res2)
		jData = xiaosiapi(CurrentQQ,data,str)
		Data = json.decode(data.Content)
		m = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
		if (m == nil) then
	        log.info("Str ====> %s", m)
            return 1
	    end
		if (string.find(m, "å›å¤èŠå¤©")) then
		    Api.Api_SendMsg(
                CurrentQQ,
                {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "ReplayMsg",
                groupid = 0,
                content = jData.data.info.text,
                atUser = 0,
				replayInfo = {
                    MsgSeq = data.MsgSeq,
                    --å›å¤æ¶ˆæ¯çš„Seq
                    MsgTime = data.MsgTime,
                    --å›å¤æ¶ˆæ¯çš„äº‹ä»¶
                    UserID = data.FromUserId,
                    --å›å¤æ¶ˆæ¯å¯¹è±¡
                    RawContent = Data.Content --å›å¤æ¶ˆæ¯çš„åŸå†…å®¹
                }
				}
            )
			return 1
		elseif (string.find(m, "æ–‡å­—èŠå¤©")) then
		    sedmsg(CurrentQQ,data,jData.data.info.text)
		else
		    sedvoicemsg(CurrentQQ,data,url_encode(jData.data.info.text))
		end
    end
end

--å‘é€è¯­éŸ³æ¶ˆæ¯
function sedvoicemsg(CurrentQQ,data,str)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "VoiceMsg",
        groupid = 0,
		voiceUrl = "https://dds.dui.ai/runtime/v1/synthesize?voiceId=qianranfa&speed=0.7&volume=100&audioType=wav&text="..str, --å‘é€è¯­éŸ³çš„ç½‘ç»œåœ°å€ æ–‡æœ¬å‹
        voiceBase64Buf = "",
        content = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å¤©æ°”æŸ¥è¯¢å‡½æ•°
function tianqi(CurrentQQ,data)
    keyWord = data.Content:gsub("å¤©æ°”", "")
        if keyWord == "" then
            return 1
        end

        cookies = Api.Api_GetUserCook(CurrentQQ)

        response, error_message =
            http.request(
            "GET",
            "https://weather.mp.qq.com/cgi-bin/rich",
            {
                query = "g_tk=" .. cookies.Gtk .. "&city=" .. url_encode(keyWord),
                headers = {
                    Referer = "http://weather.mp.qq.com/ark"
                },
                cookies = {
                    uin = CurrentQQ,
                    skey = cookies.Skey
                }
            }
        )
        local html = response.body
        log.notice("From Lua html -->%s", html)

        local j = json.decode(html)
        if j.code ~= 0 then
            return 1
        end

        ApiRet =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "JsonMsg",
                groupid = 0,
                content = string.format(
                    --{"config":{"forward":1,"autosize":1},"prompt":"[åº”ç”¨]å¤©æ°”","app":"com.tencent.weather","ver":"0.0.0.1","view":"RichInfoView","meta":{"richinfo":{"adcode":"101210701","city":"æˆéƒ½","air":"58","min":"20","ts":"1500550866","wind":"1","date":"6æœˆ27æ—¥ å‘¨å››","max":"28","type":"201"}},"desc":"å¤©æ°”"}
                    --[[{"app":"com.tencent.weather","desc":"","meta":{"weather":{"ad":[{"icon":"http://imgcache.qq.com/ac/tq/xz2/tp.jpg","p":"ptype=star","t":"2","title":"æ˜Ÿåº§ | ä»Šå¤©ä¼šå› ä¸ºæ„Ÿæƒ…å’Œå®¶åº­çš„é—®é¢˜ï¼Œå½±å“å·¥ä½œï¼Œè¿˜æœ‰ï¼Œä¹Ÿè¦æ³¨æ„äºº...","url":""},{"icon":"http://imgcache.qq.com/ac/qqweather/image/2019/6/27.png","p":"ptype=lunar","t":"4","title":"é»„å† | å†œå†äº”æœˆå»¿äº”ã€‚å®œè®¢ç›Ÿ.çº³é‡‡.å‡ºè¡Œ.ç¥ˆç¦.æ–‹é†®.å®‰åºŠ.ä¼š...","url":""}],"info":{"it1":{"adcode":"101050101","city":"æ­¦æ±‰","hour":"18","max":"29","min":"17","temp":"24","type":"202","ut":"1561630401","wea":"å¤šäº‘"},"it2":{"hour":"19","temp":"22","type":"202"},"it3":{"hour":"20","temp":"21","type":"202"},"ts":"1561631244"},"url":""}},"prompt":"ã€å“ˆå°”æ»¨ã€‘å¤šäº‘ 17Â°/29Â°, 18:13æ›´æ–°~","ver":"1.0.0.106","view":"WeatherThreeView"}]]
                    [[{"app":"com.tencent.weather","desc":"å¤©æ°”","view":"RichInfoView","ver":"1.0.0.217","prompt":"[åº”ç”¨]å¤©æ°”","meta":{"richinfo":{"adcode":"%s","air":"%s","city":"%s","date":"%s","max":"%s","min":"%s","ts":"1554951408","type":"%s","wind":"%s"}},"config":{"forward":1,"autosize":1,"type":"card"}}]],
                    j.data.adcode,
                    j.data.air,
                    j.data.city,
                    j.data.date,
                    j.data.max,
                    j.data.min,
                    j.data.type,
                    j.data.wind
                ),
                atUser = 0
            }
        )
end

--è°ƒæ•™å¤„ç†å‡½æ•°(å¾…å¤„ç†)
function tiaojiao(CurrentQQ,data)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
	if (mim == nil) then
		sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå“‡")
		return 1
	end
	if (string.find(data.Content, "^åˆ é™¤è°ƒæ•™")) then
	    msg = data.Content:gsub("åˆ é™¤è°ƒæ•™", "")
	    if (msg == "") then
		    sedmsg(CurrentQQ,data,"è¦åˆ é™¤çš„è°ƒæ•™æŒ‡ä»¤ä¸èƒ½ä¸ºç©ºå“¦")
		    return 1
		end
		rese = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..tostring(data.FromGroupId).."\/"..msg..".txt")
	    if (rese == nil) then
			sedmsg(CurrentQQ,data,"è¿™ä¸ªæŒ‡ä»¤ä¸å­˜åœ¨äº†å“¦")
		    return 1
		end
		rm_file = os.remove("mimoio\/æœºå™¨è°ƒæ•™\/"..tostring(data.FromGroupId).."\/"..msg..".txt")
		log.info("åˆ é™¤è°ƒæ•™ ====> %s", rm_file)
		sedmsg(CurrentQQ,data,"åˆ é™¤æˆåŠŸ\nä½ ä¸å–œæ¬¢è¢«è¿™æ ·è°ƒæ•™çš„æˆ‘å—[è¡¨æƒ…9]")
		return 1
	end
    msgs = data.Content:gsub("è°ƒæ•™", "")
		res2 = string.find(msgs, "#")
		str = string.sub(msgs,res2+1)
		str2 = string.sub(msgs,1,res2-1)
		        
		        if (str == "") then
		            sedmsg(CurrentQQ,data,"è°ƒæ•™çš„å›ç­”å†…å®¹ä¸èƒ½ä¸ºç©ºå“¦")
			        return 1
		        end
				if (str2 == "") then
		            sedmsg(CurrentQQ,data,"è°ƒæ•™çš„æŒ‡ä»¤å†…å®¹ä¸èƒ½ä¸ºç©ºå“¦")
			        return 1
		        end
		        rese = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..str2..".txt")
					if (rese ~= nil) then
				        sedmsg(CurrentQQ,data,"æŒ‡ä»¤å·²ç»å­˜åœ¨äº†å“¦")
				        return 1
				    end
				Wirte("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..str2..".txt",str)
				sedmsg(CurrentQQ,data,"è°ƒæ•™æˆåŠŸ\nä½ è¿˜æƒ³å†è°ƒæ•™æˆ‘ä¸€æ¬¡å—[è¡¨æƒ…6]")
		        return 1
end

function url_encode(str)
    if (str) then
        str = string.gsub(str, "\n", "\r\n")
        str =
            string.gsub(
            str,
            "([^%w ])",
            function(c)
                return string.format("%%%02X", string.byte(c))
            end
        )
        str = string.gsub(str, " ", "+")
    end
    return str
end

--æŠ¢çº¢åŒ…å¤„ç†
function RedBag(CurrentQQ, data)
    Api.Api_OpenRedBag(CurrentQQ, data.RedBaginfo)
    if (data.RedBaginfo.RedType == 12) then
         luaRes =
                Api.Api_SendMsg(
                CurrentQQ,
                {
                    toUser = data.FromGroupId,
                    sendToType = 2,
                    sendMsgType = "TextMsg",
                    groupid = 0,
                    content = data.RedBaginfo.Tittle,
                    atUser = 0
                }
            )
        log.notice("From Lua SendMsg Ret\n%d", luaRes.Ret)
    end
end

--è§†é¢‘è§£æå¤„ç†
function Video(CurrentQQ, data)
    vdata = json.decode(data.Content)
        videodata = {
            GroupID = data.FromGroupId,
            VideoUrl = vdata.VideoUrl,
            VideoMd5 = vdata.VideoMd5
        }
        --æ„é€ table å‚æ•°è¡¨
        luaResp = Api.Api_CallFunc(CurrentQQ, "PttCenterSvr.ShortVideoDownReq", videodata) --é€šè¿‡cmdè°ƒç”¨åŠŸèƒ½åŒ…
        luaRes =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "TextMsg",
                groupid = 0,
                content = "è§£æè§†é¢‘URL-->" .. luaResp.VideoUrl,
                atUser = 0
            }
        )
end

--ç®¡ç†å¼€å…³é€šç”¨
function adminio(CurrentQQ,data,oio)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim ~= nil) then
            msg = data.Content:gsub(oio, "")
            str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
            if (string.find(str, "å…³é—­")) then
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äººå·²è¢«å…³é—­...\nè¯·å…ˆå¼€å¯æœºå™¨äºº")
                return 1
            end
			str2 = Read("mimoio\/çŠ¶æ€æ•°æ®\/"..oio.."\/"..data.FromGroupId..".txt")
			if (string.find(str2, msg)) then
			    sedmsg(CurrentQQ,data,"âˆ´"..oio.."æœ¬å°±æ˜¯"..str2.."çŠ¶æ€")
                return 1
			end
            Wirte("mimoio\/çŠ¶æ€æ•°æ®\/"..oio.."\/"..data.FromGroupId..".txt",msg)
            sedmsg(CurrentQQ,data,"âˆ´"..oio..msg.."æˆåŠŸ")
            return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
end

--ç™¾ç§‘å¤§å…¨
function baike(CurrentQQ,data)
    keyWord = data.Content:gsub("ç™¾ç§‘", "")
        if keyWord == "" then
            return 1
        end
        response, error_message =
            http.request(
            "GET",
            "http://baike.baidu.com/api/openapi/BaikeLemmaCardApi",
            {
                query = "scope=103&format=json&appid=379020&bk_key=" .. url_encode(keyWord) .. "&bk_length=600"
            }
        )
        html = response.body
        while(string.find(html, '"errno":2')) do
            response, error_message =
            http.request(
            "GET",
            "http://baike.baidu.com/api/openapi/BaikeLemmaCardApi",
            {
                query = "scope=103&format=json&appid=379020&bk_key=" .. url_encode(keyWord) .. "&bk_length=600"
            })
			html = response.body
        end
        local j = json.decode(html)
        sedmsg(CurrentQQ,data,j.abstract.."\n"..j.url)
end

--éŸ³ä¹ç‚¹æ­Œ
function music(CurrentQQ,data)
    keyWord = data.Content:gsub("ç‚¹æ­Œ", "")
        if keyWord == "" then
            return 1
        end
        response, error_message =
            http.request(
            "GET",
            "https://c.y.qq.com/soso/fcgi-bin/client_search_cp",
            {
                query = "aggr=1&cr=1&flag_qc=0&p=1&n=6&w=" .. url_encode(keyWord)
            }
        )
        html = response.body
		str = string.sub(html,10,-2)
        j = json.decode(str)
        if (j.code == 0) then
            msg = ""
            num = j.data.song.list
            list = num[1]
            songname = list.songname
            singername = list.singer[1].name
            payplay = list.pay.payplay
			albummid = list.albummid
			songmid = list.songmid
	        sedjsonmsg(CurrentQQ,data,'{"app":"com.tencent.structmsg","desc":"éŸ³ä¹","view":"music","ver":"0.0.0.1","prompt":"[åˆ†äº«]' ..songname.. '","meta":{"music":{"sourceMsgId":"0","title":"' ..songname.. '","desc":"' ..singername.. '","preview":"y.gtimg.cn/music/photo_new/T002R150x150M000'..albummid..'.jpg","tag":"QQéŸ³ä¹","musicUrl":"https://v1.itooi.cn/tencent/url?id='..songmid..'","jumpUrl":"y.qq.com/n/yqq/song/'..songmid..'.html","appid":100497308,"app_type":1,"action":"","source_url":"url.cn/5aSZ8Gc","source_icon":"url.cn/5tLgzTm","android_pkg_name":"com.tencent.qqmusic"}},"config":{"forward":true,"type":"normal","autosize":true}}')
			return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´Error:"..j.code)
			return 1
        end
end

--è®¿é—®url
function geturl(url_class,url,caulrt)
        response, error_message =
            http.request(
            url_class,
            url,
            {
                query = caulrt
            }
        )
        html = response.body
		return html
end

--æ¶ˆæ¯å‚¨è“„
function msgsql(CurrentQQ,data)
    if (mysqlpass == "") then
	    return 1
	end
    c = mysql.new()
    -- åˆå§‹åŒ–mysqlå¯¹è±¡
    ok, err = c:connect({host = mysqlhost, port = 3306, database = mysqldb, user = mysqluser, password = mysqlpass})
    --å»ºç«‹è¿æ¥
    if ok then
        sqlstr =
            string.format(
            [[INSERT INTO msgcache (GroupID, MsgSeq, MsgRandom,MsgType,Data,MsgTime)VALUES (%d,%d,%d,'%s','%s',%d)]],
            data.FromGroupId,
            data.MsgSeq,
            data.MsgRandom,
            data.MsgType,
            data.Content,
            data.MsgTime
        )
        res, err = c:query(sqlstr) --å…¥åº“ç¼“å­˜æ¶ˆæ¯
        log.info("%s", err)
        c.close(c)
    --é‡Šæ”¾è¿æ¥
    end
    return 1
end

--æ’¤å›æ£€æµ‹
function CheHui(CurrentQQ, data, extData)
    c = mysql.new()
    -- åˆå§‹åŒ–mysqlå¯¹è±¡
	if (mysqlpass == "") then
	    return 1
	end
	
    if data.MsgType == "ON_EVENT_GROUP_REVOKE" then --ç›‘å¬ ç¾¤æ’¤å›äº‹ä»¶
        str = string.format("ç¾¤æˆ %d  æˆå‘˜ UserID %s æ’¤å›äº†æ¶ˆæ¯Seq %s \n", extData.GroupID, extData.UserID, extData.MsgSeq)
        log.info("%s", str)
        ok, err = c:connect({host = mysqlhost, port = 3306, database = mysqldb, user = mysqluser, password = mysqlpass})
        --å»ºç«‹è¿æ¥
        log.info("sql %v", err)
        if ok then
            sqlstr =
                string.format(
                "select * from msgcache where `GroupID`= %d and `MsgSeq` = %d",
                extData.GroupID,
                extData.MsgSeq
            )
            res, err = c:query(sqlstr) --è·Ÿç¾¤ç¾¤idå’Œæ¶ˆæ¯SEQæŸ¥è¯¢å‡ºæ’¤å›çš„æ¶ˆæ¯å†…å®¹
            if err == nil then
                c.close(c)
                GroupID = tonumber(res[1]["GroupID"])
                MsgType = res[1]["MsgType"]
                Data = res[1]["Data"]

                if MsgType == "TextMsg" then
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            --å‘é€æ–‡æœ¬æ¶ˆæ¯
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡æ–‡æœ¬æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                Data
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "SmallFaceMsg" then
                    --Data {"Content":"[è¡¨æƒ…101]","Hex":"FKY=","Index":101,"tips":"[å°è¡¨æƒ…]"}
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡è¡¨æƒ…æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).Content
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "PicMsg" then
                    --Data {"Content":"","FileId":2820717626,"FileMd5":"q0oEC5aloJJMFr10mplaXw==","FileSize":7026,"tips":"[ç¾¤å›¾ç‰‡]","url":"http://gchat.qpic.cn/gchatpic_new/1700487478/960839480-2534335053-AB4A040B96A5A0924C16BD749A995A5F/0?vuin=u0026term=255u0026pictype=0"}
                    jData = json.decode(Data)
					if (jData.tips == "[ç¾¤æ¶ˆæ¯-QQé—ªç…§]") then
					    
					Api.Api_SendMsg( 
                    CurrentQQ,
                    {
                        toUser = GroupID,
                        sendToType = 2,
                        sendMsgType = "ForwordMsg",
                        content = "",
                        atUser = 0,
                        groupid = 0,
                        voiceUrl = "",
                        voiceBase64Buf = "",
                        picUrl = "",
                        picBase64Buf = "",
                        forwordBuf = json.decode(Data).ForwordBuf, --æ¬²è½¬å‘çš„base64buf å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                        forwordField = json.decode(Data).ForwordField --æ¬²å†™å…¥åè®®çš„å­—æ®µID å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                    }
                )
				    return 1
					end
                    Api.Api_SendMsg( --é€šè¿‡å›¾ç‰‡md5å‘é€å›¾ç‰‡ ç§’å‘ä¸ç”¨ä¸Šä¼  ç›¸å½“äºè½¬å‘
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "PicMsg",
                            --å‘é€å›¾æ–‡æ¶ˆæ¯
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡å›¾ç‰‡æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š[PICFLAG]%s",
                                extData.UserID,
                                jData.Content
                            ),
                            --é€šè¿‡å®[PICFLAG]æ”¹å˜å›¾æ–‡é¡ºåº  æ”¹ä¸ºç°æ–‡å­—åå›¾ç‰‡
                            atUser = 0,
                            voiceUrl = "",
                            voiceBase64Buf = "",
                            picUrl = "",
                            picBase64Buf = "",
                            fileMd5 = jData.FileMd5
                        }
                    )
                end
                if MsgType == "AtMsg" then
                    --Data {"Content":"@Kar98k skjjkssjkjs","UserID":123456789,"tips":"[ATæ¶ˆæ¯]"}
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡atæ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).Content
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "VoiceMsg" then
                    --Data {"tips":"[è¯­éŸ³]","url":"http://grouptalk.c2c.qq.com/?ver=0u0026rkey=3062020101045b305902010102010102041fdef8ae042439416931554e5142586c536d78706a314c686843664959725f327a5f573064697653755902045dac2a21041f0000000866696c6574797065000000013100000005636f64656300000001310400u0026filetype=1u0026voice_codec=1"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "VoiceMsg",
                            --å‘é€ç¾¤è¯­éŸ³æ¶ˆæ¯
                            groupid = 0,
                            content = "",
                            atUser = 0,
                            voiceUrl = json.decode(Data).url,
                            --é€šè¿‡ç½‘ç»œurlè¿›è¡Œå‘é€è¯­éŸ³
                            voiceBase64Buf = "",
                            picUrl = "",
                            picBase64Buf = ""
                        }
                    )
                end

                if MsgType == "ReplayMsg" then
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡å›å¤æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).ReplayContent
                            ),
                            atUser = 0
                        }
                    )
                end
				if MsgType == "VideoMsg" then
	             Api.Api_SendMsg( 
                    CurrentQQ,
                    {
                        toUser = GroupID,
                        sendToType = 2,
                        sendMsgType = "ForwordMsg",
                        content = "",
                        atUser = 0,
                        groupid = 0,
                        voiceUrl = "",
                        voiceBase64Buf = "",
                        picUrl = "",
                        picBase64Buf = "",
                        forwordBuf = json.decode(Data).ForwordBuf, --æ¬²è½¬å‘çš„base64buf å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                        forwordField = json.decode(Data).ForwordField --æ¬²å†™å…¥åè®®çš„å­—æ®µID å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                    }
                )
				end
                if MsgType == "XmlMsg" then
				    
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "XmlMsg",
                            groupid = 0,
                            content = string.format("%s", Data),
                            atUser = 0
                        }
                    )
                end
				if MsgType == "JsonMsg" then
				    
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "JsonMsg",
                            groupid = 0,
                            content = string.format("%s", Data),
                            atUser = 0
                        }
                    )
                end
            end
        end
    end
    return 1
end
2020/09/07 11:54:44.393 [E]  mimoio.lua
2020/09/07 11:54:44.394 [E]  local log = require("log")
local Api = require("coreApi")
local json = require("json")
local http = require("http")
local mysql = require("mysql")

--ç‰ˆæœ¬å·(ä¸è¦æ”¹åŠ¨)
Vabr = "1.0.2"
--æ•°æ®åº“é…ç½®
mysqlhost = "localhost"--é»˜è®¤ä¸åŠ¨
mysqldb = "ffaxx001"--æ•°æ®åº“å
mysqluser = "ffaxx001"--æ•°æ®åº“ç”¨æˆ·å
mysqlpass = "123456"--æ•°æ®åº“å¯†ç 
--ä¸ä½¿ç”¨è¯·ä¸è¦æ”¹åŠ¨

function ReceiveFriendMsg(CurrentQQ, data)
    if (data.Content == "ä½¿ç”¨æ–¹æ³•") then
	    sendfrimsg(CurrentQQ,data,"æ·»åŠ æˆæƒè€…çš„æ–¹æ³•\nå¯¹å•ä¸ªæœºå™¨äººç§èŠå‘é€[æ·»åŠ æˆæƒè€…+æˆæƒè€…QQ]\n\næˆæƒç¾¤çš„æ–¹æ³•\nåˆ°éœ€è¦æˆæƒçš„ç¾¤é‡Œå‘é€[æˆæƒ+ä¸»äººQQ]ã€‚æ³¨æ„:æˆæƒå¿…é¡»æ˜¯æˆæƒè€…è¿›è¡Œæ“ä½œ,ç®¡ç†å‘˜æˆæƒä¸äº†")
	end
    --æ•°æ®åˆå§‹åŒ–
    if (data.Content == "åˆå§‹åŒ–") then
	    root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root ~= nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´è¯·ä¸è¦é‡å¤åˆå§‹åŒ–")
			return 1
		end
    --os.execute('mkdir mimoio/æœºå™¨æˆæƒ')
	    os.execute('mkdir mimoio')
		os.execute('mkdir mimoio/å¤è¯»æœº')
		os.execute('mkdir mimoio/å¤è¯»æœº/æ¬¡æ•°')
		os.execute('mkdir mimoio/å¤è¯»æœº/å†…å®¹')
		os.execute('mkdir mimoio/æœºå™¨æˆæƒ')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨ä¸»äºº')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨èŠå¤©')
		os.execute('mkdir mimoio/æœºå™¨è°ƒæ•™')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æŠ¢çº¢åŒ…')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æœºå™¨èŠå¤©')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æœºå™¨å¼€å…³')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æ’¤å›æ£€æµ‹')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/å›¾ç‰‡è§£æ')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/è§†é¢‘è§£æ')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/é—ªç…§æ£€æµ‹')
		Wirte("mimoio\/"..data.FromUin..".txt","999")
		sendfrimsg(CurrentQQ,data,"åˆå§‹åŒ–å®Œæ¯•ï¼\nå‘é€[ä½¿ç”¨æ–¹æ³•]äº†è§£ä½¿ç”¨å§")
	end
	--æ·»åŠ æˆæƒè€…æ“ä½œ(ç§èŠæœºå™¨äººå‘é€)
	if (string.find(data.Content, "^æ·»åŠ æˆæƒè€…")) then
	    msg = data.Content:gsub("æ·»åŠ æˆæƒè€…", "")
		--Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromUin..".txt","å…³é—­")
		root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root == nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„ç®¡ç†è€…")
			return 1
		end
		Wirte("mimoio\/æœºå™¨æˆæƒ\/"..msg..CurrentQQ..".txt","999")
		sendfrimsg(CurrentQQ,data,"âˆ´æ·»åŠ æˆæƒè€…æˆåŠŸ")
	end
	--åˆ é™¤æˆæƒè€…æ“ä½œ(ç§èŠæœºå™¨äººå‘é€)
	if (string.find(data.Content, "^åˆ é™¤æˆæƒè€…")) then
	    msg = data.Content:gsub("åˆ é™¤æˆæƒè€…", "")
		--Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromUin..".txt","å…³é—­")
		root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root == nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„ç®¡ç†è€…")
			return 1
		end
		os.remove("mimoio\/æœºå™¨æˆæƒ\/"..msg..CurrentQQ..".txt")
		sendfrimsg(CurrentQQ,data,"âˆ´åˆ é™¤æˆæƒè€…æˆåŠŸ")
	end
    return 1
end
function ReceiveGroupMsg(CurrentQQ, data)
    if (tostring(data.FromUserId) == CurrentQQ) then
	    return 1
	end
	--ç¾¤èŠæˆæƒ(åˆ°éœ€è¦æˆæƒçš„ç¾¤é‡Œæ“ä½œ)
	if (string.find(data.Content, "^æˆæƒ")) then
	    root = Read("mimoio\/æœºå™¨æˆæƒ\/"..data.FromUserId..CurrentQQ..".txt","999")
		if (root == nil) then
		    sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„æˆæƒè€…")
			return 1
		end
		msg = data.Content:gsub("æˆæƒ", "")
		os.execute('mkdir mimoio/æœºå™¨è°ƒæ•™/'..data.FromGroupId)
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨ä¸»äºº/'..data.FromGroupId)
		Wirte("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..msg..".txt","999")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt","å›å¤èŠå¤©")
		sedmsg(CurrentQQ,data,"âˆ´æˆæƒæˆåŠŸï¼\nå‘é€[å¼€å¯æœºå™¨äºº]ä½¿ç”¨å§")
	end
	--åˆ é™¤æˆæƒæ“ä½œ(åˆ°éœ€è¦åˆ é™¤æˆæƒçš„ç¾¤é‡Œæ“ä½œ)
	if (string.find(data.Content, "^åˆ é™¤æˆæƒ")) then
	    root = Read("mimoio\/æœºå™¨æˆæƒ\/"..data.FromUserId..CurrentQQ..".txt","999")
		if (root == nil) then
		    sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„æˆæƒè€…")
			return 1
		end
		msg = data.Content:gsub("åˆ é™¤æˆæƒ", "")
		os.remove("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..msg..".txt")
		os.remove("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
		sedmsg(CurrentQQ,data,"âˆ´åˆ é™¤æˆæƒæˆåŠŸï¼")
	end
	--æœºå™¨å¼€å…³æŒ‡ä»¤
	if (data.Content == "å¼€å¯æœºå™¨äºº" or data.Content == "å…³é—­æœºå™¨äºº") then
        mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim ~= nil) then
            msg = data.Content:gsub("æœºå™¨äºº", "")
            str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
			if (str == nil) then
			    Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt",msg)
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äºº"..msg.."æˆåŠŸï¼")
				log.info("Str ====> %s", str)
                return 1
			end
			
            if (string.find(str, msg)) then
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äººä¸€ç›´æ˜¯"..msg.."çš„å‘")
                return 1
            end
            Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt",msg)
            sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äºº"..msg.."æˆåŠŸï¼")
            return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
	end
    --æœºå™¨äººå¼€å¯æ£€æµ‹
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
	if (str == nil) then
	    log.info("Str ====> %s", str)
        return 1
	end
	if (string.find(str, "å…³é—­")) then
	    return 1
	end
	--atæ¶ˆæ¯å¤„ç†
	msgs = ""
	atqq = 0
	if (string.find(data.Content, "ATæ¶ˆæ¯")) then
	    msgs = json.decode(data.Content).Content
		atqq = json.decode(data.Content).UserID
	end
	--å°¾å·´è‡ªå®šä¹‰(å¾…å®Œå–„)
	tips = "â€”â€”å‡¤é£ç¿±ç¿”å…®ä¸·"
    --åŠŸèƒ½æ¨¡å—
    if (data.Content == "åŠŸèƒ½" or data.Content == "ä¸»ç•Œé¢") then
        face = faceArray()
        sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."å½±è§†æœç´¢\n"..face.."èŠå¤©å¨±ä¹\n"..face.."ä¾¿åˆ©åŠŸèƒ½\n"..face.."æœºå™¨è°ƒæ•™\n"..face.."ç®¡ç†ç³»ç»Ÿ\n"..face.."bugåé¦ˆ\n"..face.."æœ¬ç¾¤çŠ¶æ€\n"..face.."æ›´æ–°æ£€æµ‹\n\n"..tips)
    end
    --å½±è§†æœç´¢æ¨¡å—
    if (data.Content == "å½±è§†æœç´¢") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."æœç´¢+å½±è§†å\n"..face.."æˆ‘æƒ³çœ‹+å½±è§†å\n"..face.."æˆ‘è¦çœ‹+å½±è§†å\n\n"..tips)
    elseif (string.find(data.Content, "^æœç´¢")) then
	    msg = data.Content:gsub("æœç´¢", "")
		Sousuo(CurrentQQ,data,msg)
	elseif (string.find(data.Content, "^æˆ‘æƒ³çœ‹")) then
	    msg = data.Content:gsub("æˆ‘æƒ³çœ‹", "")
		Sousuo(CurrentQQ,data,msg)
    elseif (string.find(data.Content, "^æˆ‘è¦çœ‹")) then
	    msg = data.Content:gsub("æˆ‘è¦çœ‹", "")
		Sousuo(CurrentQQ,data,msg)
	end
	--èŠå¤©å¨±ä¹æ¨¡å—
	if (data.Content == "èŠå¤©å¨±ä¹") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."åˆ‡æ¢æ–‡å­—èŠå¤©\n"..face.."åˆ‡æ¢å›å¤èŠå¤©\n"..face.."åˆ‡æ¢è¯­éŸ³èŠå¤©\n\n"..tips)
    elseif (data.Content == "åˆ‡æ¢æ–‡å­—èŠå¤©") then
		liaotian(CurrentQQ,data,1)
	elseif (data.Content == "åˆ‡æ¢è¯­éŸ³èŠå¤©") then
	    liaotian(CurrentQQ,data,2)
    elseif (data.Content == "åˆ‡æ¢å›å¤èŠå¤©") then
	    liaotian(CurrentQQ,data,3)
	else
	    ownthink(CurrentQQ,data,msgs,atqq)
	end
	--ä¾¿åˆ©åŠŸèƒ½æ¨¡å—
	if (data.Content == "ä¾¿åˆ©åŠŸèƒ½") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."ç™¾ç§‘å¤§å…¨\n"..face.."éŸ³ä¹ç‚¹æ­Œ\n"..face.."é—ªä»–@xx\n"..face.."å¤©æ°”æŸ¥è¯¢\n\n"..tips)
	elseif (data.Content == "ç™¾ç§‘å¤§å…¨") then
		sedmsg(CurrentQQ,data,"å‘é€:[ç™¾ç§‘+å…³é”®è¯]\nä¾‹å¦‚:ç™¾ç§‘æ´›å¤©ä¾")
    elseif (data.Content == "éŸ³ä¹ç‚¹æ­Œ") then
		sedmsg(CurrentQQ,data,"å‘é€:[ç‚¹æ­Œ+æ­Œå]\nä¾‹å¦‚:ç‚¹æ­Œé’æŸ ")
	elseif (data.Content == "å¤©æ°”æŸ¥è¯¢") then
		sedmsg(CurrentQQ,data,"å‘é€:[å¤©æ°”+åœ°æ–¹å]\nä¾‹å¦‚:å¤©æ°”åŒ—äº¬(é™äºå›½å†…)")
    elseif (string.find(data.Content, "^å¤©æ°”")) then
        tianqi(CurrentQQ,data)
	    --msg = data.Content:gsub("æœç´¢", "")
		--Sousuo(CurrentQQ,data,msg)
	elseif (string.find(data.Content, "^ç™¾ç§‘")) then
	    baike(CurrentQQ,data)
	    --msg = data.Content:gsub("æˆ‘æƒ³çœ‹", "")
		--Sousuo(CurrentQQ,data,msg)music(CurrentQQ,data)
    elseif (string.find(data.Content, "^ç‚¹æ­Œ")) then
	    music(CurrentQQ,data)
	end
	--æœºå™¨è°ƒæ•™æ¨¡å—
	if (data.Content == "æœºå™¨è°ƒæ•™") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."æ–‡å­—è°ƒæ•™\n"..face.."è¯­éŸ³è°ƒæ•™\n"..face.."å”±æ­Œè°ƒæ•™\n"..face.."éŸ³ä¹è°ƒæ•™\n"..face.."å›¾ç‰‡è°ƒæ•™\n"..face.."åˆ é™¤è°ƒæ•™\n\n"..tips)
    elseif (data.Content == "æ–‡å­—è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#(å†…å®¹)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#ä½ å¥½å•Š")
	elseif (data.Content == "è¯­éŸ³è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#è¯­éŸ³(å†…å®¹)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#è¯­éŸ³ä½ å¥½å•Š")
	elseif (data.Content == "å›¾ç‰‡è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#å›¾ç‰‡(é“¾æ¥)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#å›¾ç‰‡http://../1.jpg")
	elseif (data.Content == "éŸ³ä¹è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#ç‚¹æ­Œ(æ­Œå)]\nä¾‹å¦‚:è°ƒæ•™å–µ#ç‚¹æ­Œå­¦çŒ«å«")
	elseif (data.Content == "å”±æ­Œè°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#å”±æ­Œ(æ­Œå)]\nä¾‹å¦‚:è°ƒæ•™å–µ#å”±æ­Œå­¦çŒ«å«")
	elseif (data.Content == "åˆ é™¤è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[åˆ é™¤è°ƒæ•™(æŒ‡ä»¤)]\nä¾‹å¦‚:åˆ é™¤è°ƒæ•™ä½ å¥½")
	elseif (string.find(data.Content, "^è°ƒæ•™")) then
        tiaojiao(CurrentQQ,data)
	elseif (string.find(data.Content, "^åˆ é™¤è°ƒæ•™")) then
        tiaojiao(CurrentQQ,data)
	end
	--ç®¡ç†ç³»ç»Ÿæ¨¡å—
	if (data.Content == "ç®¡ç†ç³»ç»Ÿ") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."å¼€å¯/å…³é—­æœºå™¨äºº\n"..face.."å¼€å¯/å…³é—­æŠ¢çº¢åŒ…\n"..face.."å¼€å¯/å…³é—­æœºå™¨èŠå¤©\n"..face.."å¼€å¯/å…³é—­é—ªç…§æ£€æµ‹\n"..face.."å¼€å¯/å…³é—­å›¾ç‰‡è§£æ\n"..face.."å¼€å¯/å…³é—­è§†é¢‘è§£æ\n"..face.."å¼€å¯/å…³é—­æ’¤å›æ£€æµ‹\n\n"..tips)
    elseif (data.Content == "å¼€å¯æœºå™¨èŠå¤©" or data.Content == "å…³é—­æœºå™¨èŠå¤©") then
        adminio(CurrentQQ,data,"æœºå™¨èŠå¤©")
    elseif (data.Content == "å¼€å¯æ’¤å›æ£€æµ‹" or data.Content == "å…³é—­æ’¤å›æ£€æµ‹") then
        adminio(CurrentQQ,data,"æ’¤å›æ£€æµ‹")
	elseif (data.Content == "å¼€å¯é—ªç…§æ£€æµ‹" or data.Content == "å…³é—­é—ªç…§æ£€æµ‹") then
        adminio(CurrentQQ,data,"é—ªç…§æ£€æµ‹")
	elseif (data.Content == "å¼€å¯æŠ¢çº¢åŒ…" or data.Content == "å…³é—­æŠ¢çº¢åŒ…") then
        adminio(CurrentQQ,data,"æŠ¢çº¢åŒ…")
	elseif (data.Content == "å¼€å¯è§†é¢‘è§£æ" or data.Content == "å…³é—­è§†é¢‘è§£æ") then
        adminio(CurrentQQ,data,"è§†é¢‘è§£æ")
	elseif (data.Content == "å¼€å¯å›¾ç‰‡è§£æ" or data.Content == "å…³é—­å›¾ç‰‡è§£æ") then
        adminio(CurrentQQ,data,"å›¾ç‰‡è§£æ")
	end
	--bugåé¦ˆæ¨¡å—
	if (data.Content == "BUGåé¦ˆ" or data.Content == "bugåé¦ˆ") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."é‚®ä»¶åé¦ˆ\n"..face.."QQåé¦ˆ\n\n"..tips)
    elseif (data.Content == "QQåé¦ˆ") then
        sedmsg(CurrentQQ,data,"???Î£(ï¾Ÿâˆ€ï¾Ÿï¾‰)ï¾‰\næ’ä»¶æœ‰é—®é¢˜å¯ä»¥åé¦ˆåˆ°:\nQQ:2353065854")
    elseif (data.Content == "é‚®ä»¶åé¦ˆ") then
        sedmsg(CurrentQQ,data,"å®è´å’‹å•¦=ÍÍŸÍŸÍ(ê’ªá—œê’ª â€§Ì£Ì¥Ì‡)\næ’ä»¶æœ‰é—®é¢˜å¯ä»¥åé¦ˆåˆ°:\né‚®ç®±ğŸ“¬:ym-o@qq.com")
	end
	--æœ¬ç¾¤çŠ¶æ€æ¨¡æ¿
	if (data.Content == "æœ¬ç¾¤çŠ¶æ€") then
        face = faceArray()
        hb = Read("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt")
        sz = Read("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt")
		tp = Read("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt")
        sp = Read("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt")
        jqr = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
        lt = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
        ch = Read("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..data.FromGroupId..".txt")
		sedmsg(CurrentQQ,data,"çŠ¶æ€æ•°æ®åˆ—è¡¨â†“â†“â†“\n"..face.."æœºå™¨äºº:"..jqr.."\n"..face.."æŠ¢çº¢åŒ…:"..hb.."\n"..face.."å›¾ç‰‡è§£æ:"..tp.."\n"..face.."æ’¤å›æ£€æµ‹:"..ch.."\n"..face.."è§†é¢‘è§£æ:"..sp.."\n"..face.."æœºå™¨èŠå¤©:"..lt.."\n"..face.."é—ªç…§æ£€æµ‹:"..sz.."\n\n"..tips)
	end
	--æ›´æ–°æ¨¡å—
	if (data.Content == "æ›´æ–°æ£€æµ‹") then
        str = geturl("GET","http://118.25.41.32/Lsb/lua/Vabr.txt","")
		log.info("Str ====> %s", str)
        if (string.find(str, Vabr)) then
            sedmsg(CurrentQQ,data,"å½“å‰ç‰ˆæœ¬ä¸ºæœ€æ–°ç‰ˆ")
        else
            sedmsg(CurrentQQ,data,"å‘ç°æ–°ç‰ˆæœ¬!\nå½“å‰ç‰ˆæœ¬:"..Vabr.."\næ–°ç‰ˆæœ¬å·:"..str.."\nèµ¶å¿«å‘é€[æ›´æ–°æ’ä»¶]å§")
        end
	elseif (data.Content == "æ›´æ–°æ’ä»¶") then
	    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim == nil) then
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
        str = geturl("GET","http://118.25.41.32/Lsb/lua/Vabr.txt","")
		log.info("Str ====> %s", str)
        if (string.find(str, Vabr)) then
            sedmsg(CurrentQQ,data,"å½“å‰ç‰ˆæœ¬ä¸ºæœ€æ–°ç‰ˆ")
        else
            str = geturl("GET","http://118.25.41.32/Lsb/lua/mimoio.txt","")
            Wirte("Plugins\/mimoio.lua",str)
            sedmsg(CurrentQQ,data,"æ›´æ–°å®Œæ¯•ï¼")
        end
	end
	--å›¾ç‰‡ç±»å‹æ¶ˆæ¯å¤„ç†
    if (data.MsgType == "PicMsg") then
	    msg = Read("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt")
		jData = json.decode(data.Content)
	    if (msg ~= nil and jData.tips ~= "[ç¾¤æ¶ˆæ¯-QQé—ªç…§]") then
            if (string.find(str, "å¼€å¯")) then
	            sedmsg(CurrentQQ,data,"å›¾ç‰‡é“¾æ¥è§£æå¦‚ä¸‹â†“â†“\n"..jData.url)
				return 1
	        end
	    end
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt")
	    if (str == nil) then
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    --é—ªç…§ã€å›¾ç‰‡å¤„ç†æ¨¡å—
		PicFlag(CurrentQQ, data)
    end
	--æŠ¢çº¢åŒ…å¤„ç†
	if (string.find(data.MsgType, "RedBagMsg") == 1) then
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt")
		if (str == nil) then
	        log.info("Str ====> %s", str)
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    RedBag(CurrentQQ, data)
	end
	--è§†é¢‘è§£æå¤„ç†
	if (string.find(data.MsgType, "VideoMsg") == 1) then
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt")
		if (str == nil) then
	        log.info("Str ====> %s", str)
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    Video(CurrentQQ, data)
	end
	--até—ªå›¾
	if (data.MsgType == "AtMsg") and (string.find(data.Content, "é—ªä»–")) then
	    shantu(CurrentQQ, data)
    end
	--è°ƒæ•™æœç´¢å¼•æ“
	mim = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..data.Content..".txt")
	if (mim == nil) then
	    --äººç±»çš„æœ¬è´¨æ˜¯å¤è¯»æœº
	    msg = Read("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt")
		if (msg ~= nil) then
		    cs = Read("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt")
			ii = tonumber(cs)
			if (string.find(msg, "^"..data.Content.."$")) then
			    if (ii > 2) then
			         math.randomseed(os.time())
                     sj = math.random(1, 5)
		             if (sj == 1 or sj == 2) then
			             sedmsg(CurrentQQ,data,msg)
					     rr = ii + 1
		                 Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
				     elseif (sj == 3) then
				         os.remove("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt")
					     os.remove("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt")
					     fdArray = {"çªç„¶æˆªæ–­å¤è¯»(ï¾ŸâŠ¿ï¾Ÿ)ï¾‚","å¤è¯»å¯è€»(â€¢Ì€ã¸ â€¢Ì â•® )","ä¸è¦å¤è¯»äº†å•¦","è¿™å°±æ˜¯æ‰€è°“çš„äººç±»çš„æœ¬è´¨","ä½ ä»¬å’‹ä¸ä¸Šå¤©å‘","åˆå¤è¯»ä¸Šç˜¾äº†å•Š"}
                         math.randomseed(os.time())
                         fdsj = math.random(1, 6)
				         sedmsg(CurrentQQ,data,fdArray[fdsj])
				     else
			             rr = ii + 1
		                 Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
		             end
			    else
			        rr = ii + 1
		            Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
			    end
			else
			    if (ii > 2) then
			        math.randomseed(os.time())
                    sj2 = math.random(1, 3)
					if (sj2 == 2) then
					    fdArray2 = {"ä¸­æ–­å¤è¯»å¯è€»","æ‰“æ–­å¤è¯»å¯è€»(â€¢Ì€ã¸ â€¢Ì â•® )","ä½ ä¸ºä»€ä¹ˆè¦æ‰“æ–­å¤è¯»å•Š","å¤è¯»ä¸é¦™å˜›","ç ´åæ°›å›´(à¸‡áµ’ÌŒçš¿áµ’ÌŒ)à¸‡â¼Â³â‚Œâ‚ƒ"}
                        math.randomseed(os.time())
                        fdsj2 = math.random(1, 5)
				        sedmsg(CurrentQQ,data,fdArray2[fdsj2])
					end
				end
				Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt","1")
			    Wirte("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt",data.Content)
			end
		else
		    Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt","1")
			Wirte("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt",data.Content)
		end
	    --å¦‚æœè°ƒæ•™æŒ‡ä»¤ä¸å­˜åœ¨ï¼Œåˆ™è¿›è¡Œå…¶ä»–æ“ä½œ
	    msgsql(CurrentQQ,data)--æ•°æ®å‚¨è“„
		--éšæœºå›å¤æ¶ˆæ¯æ¦‚ç‡0.04
	    math.randomseed(os.time())
        num = math.random(1, 40)
		if (num == 12) then
		    j = xiaosiapi(CurrentQQ,data,data.Content)
			sedmsg(CurrentQQ,data,j.data.info.text)
		end
	else
	    --è§¦å‘è°ƒæ•™æŒ‡ä»¤
		funic(CurrentQQ,data,mim)
	end
    return 1
end

function ReceiveEvents(CurrentQQ, data, extData)
  if data.MsgType == "ON_EVENT_GROUP_REVOKE" then --ç›‘å¬ ç¾¤æ’¤å›äº‹ä»¶
    --æ’¤å›äº‹ä»¶å¤„ç†
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..extData.GroupID..".txt")
    if (str == nil) then
	    log.info("Str ====> %s", str)
        return 1
	end
	if (string.find(str, "å…³é—­")) then
		return 1
	end
	CheHui(CurrentQQ, data, extData)
	--xxxxxxxxxxxxxxx
    return 1
  end
  --è¿›ç¾¤ç§€å›¾æ¬¢è¿


--é—ªç…§æ£€æµ‹å¤„ç†


--åŠŸèƒ½ç»„
function funic(CurrentQQ,data,msg)
    if string.find(msg, "^ç‚¹æ­Œ") then
	    data.Content = msg
        music(CurrentQQ,data,msg)
		return 1
	elseif string.find(msg, "^è¯­éŸ³") then
	    keyWord = msg:gsub("è¯­éŸ³", "")
        sedvoicemsg(CurrentQQ,data,keyWord)
		return 1
	elseif string.find(msg, "^å›¾ç‰‡") then
	    keyWord = msg:gsub("å›¾ç‰‡", "")
        sedimgmsg(CurrentQQ,data,keyWord,"")
		return 1
    elseif string.find(msg, "^å”±æ­Œ") then
        keyWord = msg:gsub("å”±æ­Œ", "")
		if (keyWord == "") then
		    sedmsg(CurrentQQ,data,"æ­Œåä¸èƒ½ç©ºç€å“¦")
		    return 1
		end
		sedmsg(CurrentQQ,data,"å¤©ä¾æ­£åœ¨åŠªåŠ›åŠ è½½Ù©(ËƒÌ¶Ì€Íˆà¯°Ë‚Ì¶ÌÍˆ)Ùˆ")
        response, error_message =
            http.request(
            "POST",
            "http://127.0.0.1:8888/SilkApi/UrlToBuf",--ä¿®æ”¹æ­¤å¤„ipåŠç«¯å£å³å¯
            {
                body = keyWord --ä¼ å…¥æ­Œæ›²å
            }
        )
        log.notice("err   %v", error_message)
        html = response.body --è¿”å›silk base64 buf
		if (string.find(html, "Î´")) then
				    sedmsg(CurrentQQ,data,"å¤©ä¾æ²¡æœ‰æ‰¾åˆ°ç›¸å…³çš„æ­Œå‘€(Ã’Ï‰Ã“×±)ï¼")
					c.close(c)
				    return 2
				end
        luaRes =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "VoiceMsg",
                groupid = 0,
                content = "",
                atUser = 0,
                voiceUrl = "",
                voiceBase64Buf = html 
            }
        )
		return 1
	end
    sedmsg(CurrentQQ,data,msg)
end

--å½±è§†æœç´¢ç”¨
function Sousuo(CurrentQQ,data,msg)
    response, error_message =
        http.request(
            "GET",
            "http://localhost/index.php/ajax/suggest",
            {
                query = "mid=1&f=admin&wd="..msg.."&limit=10&timestamp=1567914326746"
            }
        )
    html = response.body
	json = json.decode(html)
	if (json.total == 0) then
	    sedmsg(CurrentQQ,data,"å½±è§†æŸ¥è¯¢é”™è¯¯\nè¯·æ£€æŸ¥å½±è§†åæ˜¯å¦æ­£ç¡®\nâ•â•â•â•â•â•â•â•â•â•â•\næ³¨æ„âš ï¸å½±è§†åä¸è¦å¸¦æ— å…³æˆ–å¤šä½™çš„å­—ç¬¦")
	else
        sedmsg(CurrentQQ,data,"èµ„æºåœ°å€å¦‚ä¸‹â†“â†“â†“\nâ•â•â•â•â•â•â•â•â•â•\nhttp://118.25.41.32/index.php/vod/search/wd/"..escape(msg)..".html\nâ•â•â•â•â•â•â•â•â•â•â•\næ³¨æ„:å¦‚æœQQå‡ºç°åœæ­¢è®¿é—®ç°è±¡ï¼Œè¯·å¤åˆ¶é“¾æ¥ç”¨æµè§ˆå™¨æ‰“å¼€")
	end
end

--å•çº¯å‘æ¶ˆæ¯å›¾æ–‡é€šç”¨
function sedimgmsg(CurrentQQ,data,url,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "PicMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = url,
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘æ¶ˆæ¯ç”¨
function sedmsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "TextMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘ç§èŠæ¶ˆæ¯ç”¨
function sendfrimsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromUin,
        sendToType = 1,
        sendMsgType = "TextMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘jsonæ¶ˆæ¯ç”¨
function sedjsonmsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "JsonMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--èŠå¤©æ¨¡å—åˆ‡æ¢å‡½æ•°
function liaotian(CurrentQQ,data,msg)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
    if (mim == nil) then
        sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
        return 1
    end
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
	if (str == nil) then
        return 1
    end
	if (string.find(str, "å…³é—­")) then
	    sedmsg(CurrentQQ,data,"æœºå™¨èŠå¤©å¤„äºå…³é—­çŠ¶æ€\nâˆ´è¯·å…ˆå¼€å¯æœºå™¨èŠå¤©")
	    return 1
	end
	--åˆ‡æ¢å¤„ç†
	file = io.open("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt", "w")
	if (msg == 1) then
	    file:write("æ–‡å­—èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°æ–‡å­—èŠå¤©")
	elseif (msg == 2) then
	    file:write("è¯­éŸ³èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°è¯­éŸ³èŠå¤©")
	elseif (msg == 3) then
	    file:write("å›å¤èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°å›å¤èŠå¤©")
	end
	file:close()
end

--éšæœºè¡¨æƒ…å‡½æ•°
function faceArray()
    faceArray = {"[è¡¨æƒ…147]","ğŸ€","ğŸ”¥","ğŸ»","ğŸ’","[è¡¨æƒ…185]","[è¡¨æƒ…219]","[è¡¨æƒ…176]"}
    math.randomseed(os.time())
    num = math.random(1, 9)
    return faceArray[num]
end

--urlç¼–ç è½¬æ¢
function escape(w)
	pattern="[^%w%d%._%-%* ]"
	s=string.gsub(w,pattern,function(c)
		local c=string.format("%%%02X",string.byte(c))
		return c
	end)
	s=string.gsub(s," ","+")
	return s
end

--è¯»å–æ•°æ®å‡½æ•°
function Read(url)
    file = io.open(url, "r")
	if (file == nil) then
	    return nil
	else
        file:seek("set")
	    str = file:read("*a")
	    file:close()
        return str
	end
end

--å†™å…¥æ•°æ®å‡½æ•°
function Wirte(url,msg)
    file = io.open(url, "w+")
    file:write(msg)
	file:close()
    return "ok"
end

--å°æ€èŠå¤©å‡½æ•°
function xiaosiapi(CurrentQQ,data,str)
    response, error_message =
            http.request(
            "GET",
            "https://api.ownthink.com/bot",
            {
                query = "appid="..tostring(data.FromUserId).."&spoken=" .. url_encode(str),
                headers = {
                    Accept = "*/*"
                }
            }
        )
        html = response.body
		jData = json.decode(html)
		return jData
end

--æœºå™¨èŠå¤©å‡½æ•°
function ownthink(CurrentQQ,data,msgs,atqq)
    if (tostring(atqq) == CurrentQQ) then
        m = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
        if (m == nil) then
	        log.info("Str ====> %s", m)
            return 1
	    end
	    if (string.find(m, "å…³é—­")) then
	        sedmsg(CurrentQQ,data,"æœºå™¨èŠå¤©å¤„äºå…³é—­çŠ¶æ€\nâˆ´è¯·å…ˆå¼€å¯æœºå™¨èŠå¤©")
	        return 1
	    end
		res2 = string.find(msgs, " ")
		str = string.sub(msgs,res2)
		jData = xiaosiapi(CurrentQQ,data,str)
		Data = json.decode(data.Content)
		m = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
		if (m == nil) then
	        log.info("Str ====> %s", m)
            return 1
	    end
		if (string.find(m, "å›å¤èŠå¤©")) then
		    Api.Api_SendMsg(
                CurrentQQ,
                {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "ReplayMsg",
                groupid = 0,
                content = jData.data.info.text,
                atUser = 0,
				replayInfo = {
                    MsgSeq = data.MsgSeq,
                    --å›å¤æ¶ˆæ¯çš„Seq
                    MsgTime = data.MsgTime,
                    --å›å¤æ¶ˆæ¯çš„äº‹ä»¶
                    UserID = data.FromUserId,
                    --å›å¤æ¶ˆæ¯å¯¹è±¡
                    RawContent = Data.Content --å›å¤æ¶ˆæ¯çš„åŸå†…å®¹
                }
				}
            )
			return 1
		elseif (string.find(m, "æ–‡å­—èŠå¤©")) then
		    sedmsg(CurrentQQ,data,jData.data.info.text)
		else
		    sedvoicemsg(CurrentQQ,data,url_encode(jData.data.info.text))
		end
    end
end

--å‘é€è¯­éŸ³æ¶ˆæ¯
function sedvoicemsg(CurrentQQ,data,str)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "VoiceMsg",
        groupid = 0,
		voiceUrl = "https://dds.dui.ai/runtime/v1/synthesize?voiceId=qianranfa&speed=0.7&volume=100&audioType=wav&text="..str, --å‘é€è¯­éŸ³çš„ç½‘ç»œåœ°å€ æ–‡æœ¬å‹
        voiceBase64Buf = "",
        content = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å¤©æ°”æŸ¥è¯¢å‡½æ•°
function tianqi(CurrentQQ,data)
    keyWord = data.Content:gsub("å¤©æ°”", "")
        if keyWord == "" then
            return 1
        end

        cookies = Api.Api_GetUserCook(CurrentQQ)

        response, error_message =
            http.request(
            "GET",
            "https://weather.mp.qq.com/cgi-bin/rich",
            {
                query = "g_tk=" .. cookies.Gtk .. "&city=" .. url_encode(keyWord),
                headers = {
                    Referer = "http://weather.mp.qq.com/ark"
                },
                cookies = {
                    uin = CurrentQQ,
                    skey = cookies.Skey
                }
            }
        )
        local html = response.body
        log.notice("From Lua html -->%s", html)

        local j = json.decode(html)
        if j.code ~= 0 then
            return 1
        end

        ApiRet =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "JsonMsg",
                groupid = 0,
                content = string.format(
                    --{"config":{"forward":1,"autosize":1},"prompt":"[åº”ç”¨]å¤©æ°”","app":"com.tencent.weather","ver":"0.0.0.1","view":"RichInfoView","meta":{"richinfo":{"adcode":"101210701","city":"æˆéƒ½","air":"58","min":"20","ts":"1500550866","wind":"1","date":"6æœˆ27æ—¥ å‘¨å››","max":"28","type":"201"}},"desc":"å¤©æ°”"}
                    --[[{"app":"com.tencent.weather","desc":"","meta":{"weather":{"ad":[{"icon":"http://imgcache.qq.com/ac/tq/xz2/tp.jpg","p":"ptype=star","t":"2","title":"æ˜Ÿåº§ | ä»Šå¤©ä¼šå› ä¸ºæ„Ÿæƒ…å’Œå®¶åº­çš„é—®é¢˜ï¼Œå½±å“å·¥ä½œï¼Œè¿˜æœ‰ï¼Œä¹Ÿè¦æ³¨æ„äºº...","url":""},{"icon":"http://imgcache.qq.com/ac/qqweather/image/2019/6/27.png","p":"ptype=lunar","t":"4","title":"é»„å† | å†œå†äº”æœˆå»¿äº”ã€‚å®œè®¢ç›Ÿ.çº³é‡‡.å‡ºè¡Œ.ç¥ˆç¦.æ–‹é†®.å®‰åºŠ.ä¼š...","url":""}],"info":{"it1":{"adcode":"101050101","city":"æ­¦æ±‰","hour":"18","max":"29","min":"17","temp":"24","type":"202","ut":"1561630401","wea":"å¤šäº‘"},"it2":{"hour":"19","temp":"22","type":"202"},"it3":{"hour":"20","temp":"21","type":"202"},"ts":"1561631244"},"url":""}},"prompt":"ã€å“ˆå°”æ»¨ã€‘å¤šäº‘ 17Â°/29Â°, 18:13æ›´æ–°~","ver":"1.0.0.106","view":"WeatherThreeView"}]]
                    [[{"app":"com.tencent.weather","desc":"å¤©æ°”","view":"RichInfoView","ver":"1.0.0.217","prompt":"[åº”ç”¨]å¤©æ°”","meta":{"richinfo":{"adcode":"%s","air":"%s","city":"%s","date":"%s","max":"%s","min":"%s","ts":"1554951408","type":"%s","wind":"%s"}},"config":{"forward":1,"autosize":1,"type":"card"}}]],
                    j.data.adcode,
                    j.data.air,
                    j.data.city,
                    j.data.date,
                    j.data.max,
                    j.data.min,
                    j.data.type,
                    j.data.wind
                ),
                atUser = 0
            }
        )
end

--è°ƒæ•™å¤„ç†å‡½æ•°(å¾…å¤„ç†)
function tiaojiao(CurrentQQ,data)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
	if (mim == nil) then
		sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå“‡")
		return 1
	end
	if (string.find(data.Content, "^åˆ é™¤è°ƒæ•™")) then
	    msg = data.Content:gsub("åˆ é™¤è°ƒæ•™", "")
	    if (msg == "") then
		    sedmsg(CurrentQQ,data,"è¦åˆ é™¤çš„è°ƒæ•™æŒ‡ä»¤ä¸èƒ½ä¸ºç©ºå“¦")
		    return 1
		end
		rese = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..tostring(data.FromGroupId).."\/"..msg..".txt")
	    if (rese == nil) then
			sedmsg(CurrentQQ,data,"è¿™ä¸ªæŒ‡ä»¤ä¸å­˜åœ¨äº†å“¦")
		    return 1
		end
		rm_file = os.remove("mimoio\/æœºå™¨è°ƒæ•™\/"..tostring(data.FromGroupId).."\/"..msg..".txt")
		log.info("åˆ é™¤è°ƒæ•™ ====> %s", rm_file)
		sedmsg(CurrentQQ,data,"åˆ é™¤æˆåŠŸ\nä½ ä¸å–œæ¬¢è¢«è¿™æ ·è°ƒæ•™çš„æˆ‘å—[è¡¨æƒ…9]")
		return 1
	end
    msgs = data.Content:gsub("è°ƒæ•™", "")
		res2 = string.find(msgs, "#")
		str = string.sub(msgs,res2+1)
		str2 = string.sub(msgs,1,res2-1)
		        
		        if (str == "") then
		            sedmsg(CurrentQQ,data,"è°ƒæ•™çš„å›ç­”å†…å®¹ä¸èƒ½ä¸ºç©ºå“¦")
			        return 1
		        end
				if (str2 == "") then
		            sedmsg(CurrentQQ,data,"è°ƒæ•™çš„æŒ‡ä»¤å†…å®¹ä¸èƒ½ä¸ºç©ºå“¦")
			        return 1
		        end
		        rese = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..str2..".txt")
					if (rese ~= nil) then
				        sedmsg(CurrentQQ,data,"æŒ‡ä»¤å·²ç»å­˜åœ¨äº†å“¦")
				        return 1
				    end
				Wirte("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..str2..".txt",str)
				sedmsg(CurrentQQ,data,"è°ƒæ•™æˆåŠŸ\nä½ è¿˜æƒ³å†è°ƒæ•™æˆ‘ä¸€æ¬¡å—[è¡¨æƒ…6]")
		        return 1
end

function url_encode(str)
    if (str) then
        str = string.gsub(str, "\n", "\r\n")
        str =
            string.gsub(
            str,
            "([^%w ])",
            function(c)
                return string.format("%%%02X", string.byte(c))
            end
        )
        str = string.gsub(str, " ", "+")
    end
    return str
end

--æŠ¢çº¢åŒ…å¤„ç†
function RedBag(CurrentQQ, data)
    Api.Api_OpenRedBag(CurrentQQ, data.RedBaginfo)
    if (data.RedBaginfo.RedType == 12) then
         luaRes =
                Api.Api_SendMsg(
                CurrentQQ,
                {
                    toUser = data.FromGroupId,
                    sendToType = 2,
                    sendMsgType = "TextMsg",
                    groupid = 0,
                    content = data.RedBaginfo.Tittle,
                    atUser = 0
                }
            )
        log.notice("From Lua SendMsg Ret\n%d", luaRes.Ret)
    end
end

--è§†é¢‘è§£æå¤„ç†
function Video(CurrentQQ, data)
    vdata = json.decode(data.Content)
        videodata = {
            GroupID = data.FromGroupId,
            VideoUrl = vdata.VideoUrl,
            VideoMd5 = vdata.VideoMd5
        }
        --æ„é€ table å‚æ•°è¡¨
        luaResp = Api.Api_CallFunc(CurrentQQ, "PttCenterSvr.ShortVideoDownReq", videodata) --é€šè¿‡cmdè°ƒç”¨åŠŸèƒ½åŒ…
        luaRes =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "TextMsg",
                groupid = 0,
                content = "è§£æè§†é¢‘URL-->" .. luaResp.VideoUrl,
                atUser = 0
            }
        )
end

--ç®¡ç†å¼€å…³é€šç”¨
function adminio(CurrentQQ,data,oio)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim ~= nil) then
            msg = data.Content:gsub(oio, "")
            str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
            if (string.find(str, "å…³é—­")) then
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äººå·²è¢«å…³é—­...\nè¯·å…ˆå¼€å¯æœºå™¨äºº")
                return 1
            end
			str2 = Read("mimoio\/çŠ¶æ€æ•°æ®\/"..oio.."\/"..data.FromGroupId..".txt")
			if (string.find(str2, msg)) then
			    sedmsg(CurrentQQ,data,"âˆ´"..oio.."æœ¬å°±æ˜¯"..str2.."çŠ¶æ€")
                return 1
			end
            Wirte("mimoio\/çŠ¶æ€æ•°æ®\/"..oio.."\/"..data.FromGroupId..".txt",msg)
            sedmsg(CurrentQQ,data,"âˆ´"..oio..msg.."æˆåŠŸ")
            return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
end

--ç™¾ç§‘å¤§å…¨
function baike(CurrentQQ,data)
    keyWord = data.Content:gsub("ç™¾ç§‘", "")
        if keyWord == "" then
            return 1
        end
        response, error_message =
            http.request(
            "GET",
            "http://baike.baidu.com/api/openapi/BaikeLemmaCardApi",
            {
                query = "scope=103&format=json&appid=379020&bk_key=" .. url_encode(keyWord) .. "&bk_length=600"
            }
        )
        html = response.body
        while(string.find(html, '"errno":2')) do
            response, error_message =
            http.request(
            "GET",
            "http://baike.baidu.com/api/openapi/BaikeLemmaCardApi",
            {
                query = "scope=103&format=json&appid=379020&bk_key=" .. url_encode(keyWord) .. "&bk_length=600"
            })
			html = response.body
        end
        local j = json.decode(html)
        sedmsg(CurrentQQ,data,j.abstract.."\n"..j.url)
end

--éŸ³ä¹ç‚¹æ­Œ
function music(CurrentQQ,data)
    keyWord = data.Content:gsub("ç‚¹æ­Œ", "")
        if keyWord == "" then
            return 1
        end
        response, error_message =
            http.request(
            "GET",
            "https://c.y.qq.com/soso/fcgi-bin/client_search_cp",
            {
                query = "aggr=1&cr=1&flag_qc=0&p=1&n=6&w=" .. url_encode(keyWord)
            }
        )
        html = response.body
		str = string.sub(html,10,-2)
        j = json.decode(str)
        if (j.code == 0) then
            msg = ""
            num = j.data.song.list
            list = num[1]
            songname = list.songname
            singername = list.singer[1].name
            payplay = list.pay.payplay
			albummid = list.albummid
			songmid = list.songmid
	        sedjsonmsg(CurrentQQ,data,'{"app":"com.tencent.structmsg","desc":"éŸ³ä¹","view":"music","ver":"0.0.0.1","prompt":"[åˆ†äº«]' ..songname.. '","meta":{"music":{"sourceMsgId":"0","title":"' ..songname.. '","desc":"' ..singername.. '","preview":"y.gtimg.cn/music/photo_new/T002R150x150M000'..albummid..'.jpg","tag":"QQéŸ³ä¹","musicUrl":"https://v1.itooi.cn/tencent/url?id='..songmid..'","jumpUrl":"y.qq.com/n/yqq/song/'..songmid..'.html","appid":100497308,"app_type":1,"action":"","source_url":"url.cn/5aSZ8Gc","source_icon":"url.cn/5tLgzTm","android_pkg_name":"com.tencent.qqmusic"}},"config":{"forward":true,"type":"normal","autosize":true}}')
			return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´Error:"..j.code)
			return 1
        end
end

--è®¿é—®url
function geturl(url_class,url,caulrt)
        response, error_message =
            http.request(
            url_class,
            url,
            {
                query = caulrt
            }
        )
        html = response.body
		return html
end

--æ¶ˆæ¯å‚¨è“„
function msgsql(CurrentQQ,data)
    if (mysqlpass == "") then
	    return 1
	end
    c = mysql.new()
    -- åˆå§‹åŒ–mysqlå¯¹è±¡
    ok, err = c:connect({host = mysqlhost, port = 3306, database = mysqldb, user = mysqluser, password = mysqlpass})
    --å»ºç«‹è¿æ¥
    if ok then
        sqlstr =
            string.format(
            [[INSERT INTO msgcache (GroupID, MsgSeq, MsgRandom,MsgType,Data,MsgTime)VALUES (%d,%d,%d,'%s','%s',%d)]],
            data.FromGroupId,
            data.MsgSeq,
            data.MsgRandom,
            data.MsgType,
            data.Content,
            data.MsgTime
        )
        res, err = c:query(sqlstr) --å…¥åº“ç¼“å­˜æ¶ˆæ¯
        log.info("%s", err)
        c.close(c)
    --é‡Šæ”¾è¿æ¥
    end
    return 1
end

--æ’¤å›æ£€æµ‹
function CheHui(CurrentQQ, data, extData)
    c = mysql.new()
    -- åˆå§‹åŒ–mysqlå¯¹è±¡
	if (mysqlpass == "") then
	    return 1
	end
	
    if data.MsgType == "ON_EVENT_GROUP_REVOKE" then --ç›‘å¬ ç¾¤æ’¤å›äº‹ä»¶
        str = string.format("ç¾¤æˆ %d  æˆå‘˜ UserID %s æ’¤å›äº†æ¶ˆæ¯Seq %s \n", extData.GroupID, extData.UserID, extData.MsgSeq)
        log.info("%s", str)
        ok, err = c:connect({host = mysqlhost, port = 3306, database = mysqldb, user = mysqluser, password = mysqlpass})
        --å»ºç«‹è¿æ¥
        log.info("sql %v", err)
        if ok then
            sqlstr =
                string.format(
                "select * from msgcache where `GroupID`= %d and `MsgSeq` = %d",
                extData.GroupID,
                extData.MsgSeq
            )
            res, err = c:query(sqlstr) --è·Ÿç¾¤ç¾¤idå’Œæ¶ˆæ¯SEQæŸ¥è¯¢å‡ºæ’¤å›çš„æ¶ˆæ¯å†…å®¹
            if err == nil then
                c.close(c)
                GroupID = tonumber(res[1]["GroupID"])
                MsgType = res[1]["MsgType"]
                Data = res[1]["Data"]

                if MsgType == "TextMsg" then
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            --å‘é€æ–‡æœ¬æ¶ˆæ¯
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡æ–‡æœ¬æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                Data
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "SmallFaceMsg" then
                    --Data {"Content":"[è¡¨æƒ…101]","Hex":"FKY=","Index":101,"tips":"[å°è¡¨æƒ…]"}
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡è¡¨æƒ…æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).Content
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "PicMsg" then
                    --Data {"Content":"","FileId":2820717626,"FileMd5":"q0oEC5aloJJMFr10mplaXw==","FileSize":7026,"tips":"[ç¾¤å›¾ç‰‡]","url":"http://gchat.qpic.cn/gchatpic_new/1700487478/960839480-2534335053-AB4A040B96A5A0924C16BD749A995A5F/0?vuin=u0026term=255u0026pictype=0"}
                    jData = json.decode(Data)
					if (jData.tips == "[ç¾¤æ¶ˆæ¯-QQé—ªç…§]") then
					    
					Api.Api_SendMsg( 
                    CurrentQQ,
                    {
                        toUser = GroupID,
                        sendToType = 2,
                        sendMsgType = "ForwordMsg",
                        content = "",
                        atUser = 0,
                        groupid = 0,
                        voiceUrl = "",
                        voiceBase64Buf = "",
                        picUrl = "",
                        picBase64Buf = "",
                        forwordBuf = json.decode(Data).ForwordBuf, --æ¬²è½¬å‘çš„base64buf å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                        forwordField = json.decode(Data).ForwordField --æ¬²å†™å…¥åè®®çš„å­—æ®µID å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                    }
                )
				    return 1
					end
                    Api.Api_SendMsg( --é€šè¿‡å›¾ç‰‡md5å‘é€å›¾ç‰‡ ç§’å‘ä¸ç”¨ä¸Šä¼  ç›¸å½“äºè½¬å‘
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "PicMsg",
                            --å‘é€å›¾æ–‡æ¶ˆæ¯
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡å›¾ç‰‡æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š[PICFLAG]%s",
                                extData.UserID,
                                jData.Content
                            ),
                            --é€šè¿‡å®[PICFLAG]æ”¹å˜å›¾æ–‡é¡ºåº  æ”¹ä¸ºç°æ–‡å­—åå›¾ç‰‡
                            atUser = 0,
                            voiceUrl = "",
                            voiceBase64Buf = "",
                            picUrl = "",
                            picBase64Buf = "",
                            fileMd5 = jData.FileMd5
                        }
                    )
                end
                if MsgType == "AtMsg" then
                    --Data {"Content":"@Kar98k skjjkssjkjs","UserID":123456789,"tips":"[ATæ¶ˆæ¯]"}
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡atæ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).Content
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "VoiceMsg" then
                    --Data {"tips":"[è¯­éŸ³]","url":"http://grouptalk.c2c.qq.com/?ver=0u0026rkey=3062020101045b305902010102010102041fdef8ae042439416931554e5142586c536d78706a314c686843664959725f327a5f573064697653755902045dac2a21041f0000000866696c6574797065000000013100000005636f64656300000001310400u0026filetype=1u0026voice_codec=1"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "VoiceMsg",
                            --å‘é€ç¾¤è¯­éŸ³æ¶ˆæ¯
                            groupid = 0,
                            content = "",
                            atUser = 0,
                            voiceUrl = json.decode(Data).url,
                            --é€šè¿‡ç½‘ç»œurlè¿›è¡Œå‘é€è¯­éŸ³
                            voiceBase64Buf = "",
                            picUrl = "",
                            picBase64Buf = ""
                        }
                    )
                end

                if MsgType == "ReplayMsg" then
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡å›å¤æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).ReplayContent
                            ),
                            atUser = 0
                        }
                    )
                end
				if MsgType == "VideoMsg" then
	             Api.Api_SendMsg( 
                    CurrentQQ,
                    {
                        toUser = GroupID,
                        sendToType = 2,
                        sendMsgType = "ForwordMsg",
                        content = "",
                        atUser = 0,
                        groupid = 0,
                        voiceUrl = "",
                        voiceBase64Buf = "",
                        picUrl = "",
                        picBase64Buf = "",
                        forwordBuf = json.decode(Data).ForwordBuf, --æ¬²è½¬å‘çš„base64buf å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                        forwordField = json.decode(Data).ForwordField --æ¬²å†™å…¥åè®®çš„å­—æ®µID å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                    }
                )
				end
                if MsgType == "XmlMsg" then
				    
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "XmlMsg",
                            groupid = 0,
                            content = string.format("%s", Data),
                            atUser = 0
                        }
                    )
                end
				if MsgType == "JsonMsg" then
				    
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "JsonMsg",
                            groupid = 0,
                            content = string.format("%s", Data),
                            atUser = 0
                        }
                    )
                end
            end
        end
    end
    return 1
end
2020/09/07 11:54:44.597 [E]  mimoio.lua
2020/09/07 11:54:44.597 [E]  local log = require("log")
local Api = require("coreApi")
local json = require("json")
local http = require("http")
local mysql = require("mysql")

--ç‰ˆæœ¬å·(ä¸è¦æ”¹åŠ¨)
Vabr = "1.0.2"
--æ•°æ®åº“é…ç½®
mysqlhost = "localhost"--é»˜è®¤ä¸åŠ¨
mysqldb = "ffaxx001"--æ•°æ®åº“å
mysqluser = "ffaxx001"--æ•°æ®åº“ç”¨æˆ·å
mysqlpass = "123456"--æ•°æ®åº“å¯†ç 
--ä¸ä½¿ç”¨è¯·ä¸è¦æ”¹åŠ¨

function ReceiveFriendMsg(CurrentQQ, data)
    if (data.Content == "ä½¿ç”¨æ–¹æ³•") then
	    sendfrimsg(CurrentQQ,data,"æ·»åŠ æˆæƒè€…çš„æ–¹æ³•\nå¯¹å•ä¸ªæœºå™¨äººç§èŠå‘é€[æ·»åŠ æˆæƒè€…+æˆæƒè€…QQ]\n\næˆæƒç¾¤çš„æ–¹æ³•\nåˆ°éœ€è¦æˆæƒçš„ç¾¤é‡Œå‘é€[æˆæƒ+ä¸»äººQQ]ã€‚æ³¨æ„:æˆæƒå¿…é¡»æ˜¯æˆæƒè€…è¿›è¡Œæ“ä½œ,ç®¡ç†å‘˜æˆæƒä¸äº†")
	end
    --æ•°æ®åˆå§‹åŒ–
    if (data.Content == "åˆå§‹åŒ–") then
	    root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root ~= nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´è¯·ä¸è¦é‡å¤åˆå§‹åŒ–")
			return 1
		end
    --os.execute('mkdir mimoio/æœºå™¨æˆæƒ')
	    os.execute('mkdir mimoio')
		os.execute('mkdir mimoio/å¤è¯»æœº')
		os.execute('mkdir mimoio/å¤è¯»æœº/æ¬¡æ•°')
		os.execute('mkdir mimoio/å¤è¯»æœº/å†…å®¹')
		os.execute('mkdir mimoio/æœºå™¨æˆæƒ')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨ä¸»äºº')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨èŠå¤©')
		os.execute('mkdir mimoio/æœºå™¨è°ƒæ•™')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æŠ¢çº¢åŒ…')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æœºå™¨èŠå¤©')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æœºå™¨å¼€å…³')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æ’¤å›æ£€æµ‹')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/å›¾ç‰‡è§£æ')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/è§†é¢‘è§£æ')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/é—ªç…§æ£€æµ‹')
		Wirte("mimoio\/"..data.FromUin..".txt","999")
		sendfrimsg(CurrentQQ,data,"åˆå§‹åŒ–å®Œæ¯•ï¼\nå‘é€[ä½¿ç”¨æ–¹æ³•]äº†è§£ä½¿ç”¨å§")
	end
	--æ·»åŠ æˆæƒè€…æ“ä½œ(ç§èŠæœºå™¨äººå‘é€)
	if (string.find(data.Content, "^æ·»åŠ æˆæƒè€…")) then
	    msg = data.Content:gsub("æ·»åŠ æˆæƒè€…", "")
		--Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromUin..".txt","å…³é—­")
		root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root == nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„ç®¡ç†è€…")
			return 1
		end
		Wirte("mimoio\/æœºå™¨æˆæƒ\/"..msg..CurrentQQ..".txt","999")
		sendfrimsg(CurrentQQ,data,"âˆ´æ·»åŠ æˆæƒè€…æˆåŠŸ")
	end
	--åˆ é™¤æˆæƒè€…æ“ä½œ(ç§èŠæœºå™¨äººå‘é€)
	if (string.find(data.Content, "^åˆ é™¤æˆæƒè€…")) then
	    msg = data.Content:gsub("åˆ é™¤æˆæƒè€…", "")
		--Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromUin..".txt","å…³é—­")
		root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root == nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„ç®¡ç†è€…")
			return 1
		end
		os.remove("mimoio\/æœºå™¨æˆæƒ\/"..msg..CurrentQQ..".txt")
		sendfrimsg(CurrentQQ,data,"âˆ´åˆ é™¤æˆæƒè€…æˆåŠŸ")
	end
    return 1
end
function ReceiveGroupMsg(CurrentQQ, data)
    if (tostring(data.FromUserId) == CurrentQQ) then
	    return 1
	end
	--ç¾¤èŠæˆæƒ(åˆ°éœ€è¦æˆæƒçš„ç¾¤é‡Œæ“ä½œ)
	if (string.find(data.Content, "^æˆæƒ")) then
	    root = Read("mimoio\/æœºå™¨æˆæƒ\/"..data.FromUserId..CurrentQQ..".txt","999")
		if (root == nil) then
		    sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„æˆæƒè€…")
			return 1
		end
		msg = data.Content:gsub("æˆæƒ", "")
		os.execute('mkdir mimoio/æœºå™¨è°ƒæ•™/'..data.FromGroupId)
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨ä¸»äºº/'..data.FromGroupId)
		Wirte("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..msg..".txt","999")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt","å›å¤èŠå¤©")
		sedmsg(CurrentQQ,data,"âˆ´æˆæƒæˆåŠŸï¼\nå‘é€[å¼€å¯æœºå™¨äºº]ä½¿ç”¨å§")
	end
	--åˆ é™¤æˆæƒæ“ä½œ(åˆ°éœ€è¦åˆ é™¤æˆæƒçš„ç¾¤é‡Œæ“ä½œ)
	if (string.find(data.Content, "^åˆ é™¤æˆæƒ")) then
	    root = Read("mimoio\/æœºå™¨æˆæƒ\/"..data.FromUserId..CurrentQQ..".txt","999")
		if (root == nil) then
		    sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„æˆæƒè€…")
			return 1
		end
		msg = data.Content:gsub("åˆ é™¤æˆæƒ", "")
		os.remove("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..msg..".txt")
		os.remove("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
		sedmsg(CurrentQQ,data,"âˆ´åˆ é™¤æˆæƒæˆåŠŸï¼")
	end
	--æœºå™¨å¼€å…³æŒ‡ä»¤
	if (data.Content == "å¼€å¯æœºå™¨äºº" or data.Content == "å…³é—­æœºå™¨äºº") then
        mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim ~= nil) then
            msg = data.Content:gsub("æœºå™¨äºº", "")
            str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
			if (str == nil) then
			    Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt",msg)
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äºº"..msg.."æˆåŠŸï¼")
				log.info("Str ====> %s", str)
                return 1
			end
			
            if (string.find(str, msg)) then
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äººä¸€ç›´æ˜¯"..msg.."çš„å‘")
                return 1
            end
            Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt",msg)
            sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äºº"..msg.."æˆåŠŸï¼")
            return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
	end
    --æœºå™¨äººå¼€å¯æ£€æµ‹
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
	if (str == nil) then
	    log.info("Str ====> %s", str)
        return 1
	end
	if (string.find(str, "å…³é—­")) then
	    return 1
	end
	--atæ¶ˆæ¯å¤„ç†
	msgs = ""
	atqq = 0
	if (string.find(data.Content, "ATæ¶ˆæ¯")) then
	    msgs = json.decode(data.Content).Content
		atqq = json.decode(data.Content).UserID
	end
	--å°¾å·´è‡ªå®šä¹‰(å¾…å®Œå–„)
	tips = "â€”â€”å‡¤é£ç¿±ç¿”å…®ä¸·"
    --åŠŸèƒ½æ¨¡å—
    if (data.Content == "åŠŸèƒ½" or data.Content == "ä¸»ç•Œé¢") then
        face = faceArray()
        sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."å½±è§†æœç´¢\n"..face.."èŠå¤©å¨±ä¹\n"..face.."ä¾¿åˆ©åŠŸèƒ½\n"..face.."æœºå™¨è°ƒæ•™\n"..face.."ç®¡ç†ç³»ç»Ÿ\n"..face.."bugåé¦ˆ\n"..face.."æœ¬ç¾¤çŠ¶æ€\n"..face.."æ›´æ–°æ£€æµ‹\n\n"..tips)
    end
    --å½±è§†æœç´¢æ¨¡å—
    if (data.Content == "å½±è§†æœç´¢") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."æœç´¢+å½±è§†å\n"..face.."æˆ‘æƒ³çœ‹+å½±è§†å\n"..face.."æˆ‘è¦çœ‹+å½±è§†å\n\n"..tips)
    elseif (string.find(data.Content, "^æœç´¢")) then
	    msg = data.Content:gsub("æœç´¢", "")
		Sousuo(CurrentQQ,data,msg)
	elseif (string.find(data.Content, "^æˆ‘æƒ³çœ‹")) then
	    msg = data.Content:gsub("æˆ‘æƒ³çœ‹", "")
		Sousuo(CurrentQQ,data,msg)
    elseif (string.find(data.Content, "^æˆ‘è¦çœ‹")) then
	    msg = data.Content:gsub("æˆ‘è¦çœ‹", "")
		Sousuo(CurrentQQ,data,msg)
	end
	--èŠå¤©å¨±ä¹æ¨¡å—
	if (data.Content == "èŠå¤©å¨±ä¹") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."åˆ‡æ¢æ–‡å­—èŠå¤©\n"..face.."åˆ‡æ¢å›å¤èŠå¤©\n"..face.."åˆ‡æ¢è¯­éŸ³èŠå¤©\n\n"..tips)
    elseif (data.Content == "åˆ‡æ¢æ–‡å­—èŠå¤©") then
		liaotian(CurrentQQ,data,1)
	elseif (data.Content == "åˆ‡æ¢è¯­éŸ³èŠå¤©") then
	    liaotian(CurrentQQ,data,2)
    elseif (data.Content == "åˆ‡æ¢å›å¤èŠå¤©") then
	    liaotian(CurrentQQ,data,3)
	else
	    ownthink(CurrentQQ,data,msgs,atqq)
	end
	--ä¾¿åˆ©åŠŸèƒ½æ¨¡å—
	if (data.Content == "ä¾¿åˆ©åŠŸèƒ½") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."ç™¾ç§‘å¤§å…¨\n"..face.."éŸ³ä¹ç‚¹æ­Œ\n"..face.."é—ªä»–@xx\n"..face.."å¤©æ°”æŸ¥è¯¢\n\n"..tips)
	elseif (data.Content == "ç™¾ç§‘å¤§å…¨") then
		sedmsg(CurrentQQ,data,"å‘é€:[ç™¾ç§‘+å…³é”®è¯]\nä¾‹å¦‚:ç™¾ç§‘æ´›å¤©ä¾")
    elseif (data.Content == "éŸ³ä¹ç‚¹æ­Œ") then
		sedmsg(CurrentQQ,data,"å‘é€:[ç‚¹æ­Œ+æ­Œå]\nä¾‹å¦‚:ç‚¹æ­Œé’æŸ ")
	elseif (data.Content == "å¤©æ°”æŸ¥è¯¢") then
		sedmsg(CurrentQQ,data,"å‘é€:[å¤©æ°”+åœ°æ–¹å]\nä¾‹å¦‚:å¤©æ°”åŒ—äº¬(é™äºå›½å†…)")
    elseif (string.find(data.Content, "^å¤©æ°”")) then
        tianqi(CurrentQQ,data)
	    --msg = data.Content:gsub("æœç´¢", "")
		--Sousuo(CurrentQQ,data,msg)
	elseif (string.find(data.Content, "^ç™¾ç§‘")) then
	    baike(CurrentQQ,data)
	    --msg = data.Content:gsub("æˆ‘æƒ³çœ‹", "")
		--Sousuo(CurrentQQ,data,msg)music(CurrentQQ,data)
    elseif (string.find(data.Content, "^ç‚¹æ­Œ")) then
	    music(CurrentQQ,data)
	end
	--æœºå™¨è°ƒæ•™æ¨¡å—
	if (data.Content == "æœºå™¨è°ƒæ•™") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."æ–‡å­—è°ƒæ•™\n"..face.."è¯­éŸ³è°ƒæ•™\n"..face.."å”±æ­Œè°ƒæ•™\n"..face.."éŸ³ä¹è°ƒæ•™\n"..face.."å›¾ç‰‡è°ƒæ•™\n"..face.."åˆ é™¤è°ƒæ•™\n\n"..tips)
    elseif (data.Content == "æ–‡å­—è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#(å†…å®¹)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#ä½ å¥½å•Š")
	elseif (data.Content == "è¯­éŸ³è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#è¯­éŸ³(å†…å®¹)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#è¯­éŸ³ä½ å¥½å•Š")
	elseif (data.Content == "å›¾ç‰‡è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#å›¾ç‰‡(é“¾æ¥)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#å›¾ç‰‡http://../1.jpg")
	elseif (data.Content == "éŸ³ä¹è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#ç‚¹æ­Œ(æ­Œå)]\nä¾‹å¦‚:è°ƒæ•™å–µ#ç‚¹æ­Œå­¦çŒ«å«")
	elseif (data.Content == "å”±æ­Œè°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#å”±æ­Œ(æ­Œå)]\nä¾‹å¦‚:è°ƒæ•™å–µ#å”±æ­Œå­¦çŒ«å«")
	elseif (data.Content == "åˆ é™¤è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[åˆ é™¤è°ƒæ•™(æŒ‡ä»¤)]\nä¾‹å¦‚:åˆ é™¤è°ƒæ•™ä½ å¥½")
	elseif (string.find(data.Content, "^è°ƒæ•™")) then
        tiaojiao(CurrentQQ,data)
	elseif (string.find(data.Content, "^åˆ é™¤è°ƒæ•™")) then
        tiaojiao(CurrentQQ,data)
	end
	--ç®¡ç†ç³»ç»Ÿæ¨¡å—
	if (data.Content == "ç®¡ç†ç³»ç»Ÿ") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."å¼€å¯/å…³é—­æœºå™¨äºº\n"..face.."å¼€å¯/å…³é—­æŠ¢çº¢åŒ…\n"..face.."å¼€å¯/å…³é—­æœºå™¨èŠå¤©\n"..face.."å¼€å¯/å…³é—­é—ªç…§æ£€æµ‹\n"..face.."å¼€å¯/å…³é—­å›¾ç‰‡è§£æ\n"..face.."å¼€å¯/å…³é—­è§†é¢‘è§£æ\n"..face.."å¼€å¯/å…³é—­æ’¤å›æ£€æµ‹\n\n"..tips)
    elseif (data.Content == "å¼€å¯æœºå™¨èŠå¤©" or data.Content == "å…³é—­æœºå™¨èŠå¤©") then
        adminio(CurrentQQ,data,"æœºå™¨èŠå¤©")
    elseif (data.Content == "å¼€å¯æ’¤å›æ£€æµ‹" or data.Content == "å…³é—­æ’¤å›æ£€æµ‹") then
        adminio(CurrentQQ,data,"æ’¤å›æ£€æµ‹")
	elseif (data.Content == "å¼€å¯é—ªç…§æ£€æµ‹" or data.Content == "å…³é—­é—ªç…§æ£€æµ‹") then
        adminio(CurrentQQ,data,"é—ªç…§æ£€æµ‹")
	elseif (data.Content == "å¼€å¯æŠ¢çº¢åŒ…" or data.Content == "å…³é—­æŠ¢çº¢åŒ…") then
        adminio(CurrentQQ,data,"æŠ¢çº¢åŒ…")
	elseif (data.Content == "å¼€å¯è§†é¢‘è§£æ" or data.Content == "å…³é—­è§†é¢‘è§£æ") then
        adminio(CurrentQQ,data,"è§†é¢‘è§£æ")
	elseif (data.Content == "å¼€å¯å›¾ç‰‡è§£æ" or data.Content == "å…³é—­å›¾ç‰‡è§£æ") then
        adminio(CurrentQQ,data,"å›¾ç‰‡è§£æ")
	end
	--bugåé¦ˆæ¨¡å—
	if (data.Content == "BUGåé¦ˆ" or data.Content == "bugåé¦ˆ") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."é‚®ä»¶åé¦ˆ\n"..face.."QQåé¦ˆ\n\n"..tips)
    elseif (data.Content == "QQåé¦ˆ") then
        sedmsg(CurrentQQ,data,"???Î£(ï¾Ÿâˆ€ï¾Ÿï¾‰)ï¾‰\næ’ä»¶æœ‰é—®é¢˜å¯ä»¥åé¦ˆåˆ°:\nQQ:2353065854")
    elseif (data.Content == "é‚®ä»¶åé¦ˆ") then
        sedmsg(CurrentQQ,data,"å®è´å’‹å•¦=ÍÍŸÍŸÍ(ê’ªá—œê’ª â€§Ì£Ì¥Ì‡)\næ’ä»¶æœ‰é—®é¢˜å¯ä»¥åé¦ˆåˆ°:\né‚®ç®±ğŸ“¬:ym-o@qq.com")
	end
	--æœ¬ç¾¤çŠ¶æ€æ¨¡æ¿
	if (data.Content == "æœ¬ç¾¤çŠ¶æ€") then
        face = faceArray()
        hb = Read("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt")
        sz = Read("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt")
		tp = Read("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt")
        sp = Read("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt")
        jqr = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
        lt = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
        ch = Read("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..data.FromGroupId..".txt")
		sedmsg(CurrentQQ,data,"çŠ¶æ€æ•°æ®åˆ—è¡¨â†“â†“â†“\n"..face.."æœºå™¨äºº:"..jqr.."\n"..face.."æŠ¢çº¢åŒ…:"..hb.."\n"..face.."å›¾ç‰‡è§£æ:"..tp.."\n"..face.."æ’¤å›æ£€æµ‹:"..ch.."\n"..face.."è§†é¢‘è§£æ:"..sp.."\n"..face.."æœºå™¨èŠå¤©:"..lt.."\n"..face.."é—ªç…§æ£€æµ‹:"..sz.."\n\n"..tips)
	end
	--æ›´æ–°æ¨¡å—
	if (data.Content == "æ›´æ–°æ£€æµ‹") then
        str = geturl("GET","http://118.25.41.32/Lsb/lua/Vabr.txt","")
		log.info("Str ====> %s", str)
        if (string.find(str, Vabr)) then
            sedmsg(CurrentQQ,data,"å½“å‰ç‰ˆæœ¬ä¸ºæœ€æ–°ç‰ˆ")
        else
            sedmsg(CurrentQQ,data,"å‘ç°æ–°ç‰ˆæœ¬!\nå½“å‰ç‰ˆæœ¬:"..Vabr.."\næ–°ç‰ˆæœ¬å·:"..str.."\nèµ¶å¿«å‘é€[æ›´æ–°æ’ä»¶]å§")
        end
	elseif (data.Content == "æ›´æ–°æ’ä»¶") then
	    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim == nil) then
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
        str = geturl("GET","http://118.25.41.32/Lsb/lua/Vabr.txt","")
		log.info("Str ====> %s", str)
        if (string.find(str, Vabr)) then
            sedmsg(CurrentQQ,data,"å½“å‰ç‰ˆæœ¬ä¸ºæœ€æ–°ç‰ˆ")
        else
            str = geturl("GET","http://118.25.41.32/Lsb/lua/mimoio.txt","")
            Wirte("Plugins\/mimoio.lua",str)
            sedmsg(CurrentQQ,data,"æ›´æ–°å®Œæ¯•ï¼")
        end
	end
	--å›¾ç‰‡ç±»å‹æ¶ˆæ¯å¤„ç†
    if (data.MsgType == "PicMsg") then
	    msg = Read("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt")
		jData = json.decode(data.Content)
	    if (msg ~= nil and jData.tips ~= "[ç¾¤æ¶ˆæ¯-QQé—ªç…§]") then
            if (string.find(str, "å¼€å¯")) then
	            sedmsg(CurrentQQ,data,"å›¾ç‰‡é“¾æ¥è§£æå¦‚ä¸‹â†“â†“\n"..jData.url)
				return 1
	        end
	    end
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt")
	    if (str == nil) then
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    --é—ªç…§ã€å›¾ç‰‡å¤„ç†æ¨¡å—
		PicFlag(CurrentQQ, data)
    end
	--æŠ¢çº¢åŒ…å¤„ç†
	if (string.find(data.MsgType, "RedBagMsg") == 1) then
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt")
		if (str == nil) then
	        log.info("Str ====> %s", str)
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    RedBag(CurrentQQ, data)
	end
	--è§†é¢‘è§£æå¤„ç†
	if (string.find(data.MsgType, "VideoMsg") == 1) then
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt")
		if (str == nil) then
	        log.info("Str ====> %s", str)
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    Video(CurrentQQ, data)
	end
	--até—ªå›¾
	if (data.MsgType == "AtMsg") and (string.find(data.Content, "é—ªä»–")) then
	    shantu(CurrentQQ, data)
    end
	--è°ƒæ•™æœç´¢å¼•æ“
	mim = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..data.Content..".txt")
	if (mim == nil) then
	    --äººç±»çš„æœ¬è´¨æ˜¯å¤è¯»æœº
	    msg = Read("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt")
		if (msg ~= nil) then
		    cs = Read("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt")
			ii = tonumber(cs)
			if (string.find(msg, "^"..data.Content.."$")) then
			    if (ii > 2) then
			         math.randomseed(os.time())
                     sj = math.random(1, 5)
		             if (sj == 1 or sj == 2) then
			             sedmsg(CurrentQQ,data,msg)
					     rr = ii + 1
		                 Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
				     elseif (sj == 3) then
				         os.remove("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt")
					     os.remove("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt")
					     fdArray = {"çªç„¶æˆªæ–­å¤è¯»(ï¾ŸâŠ¿ï¾Ÿ)ï¾‚","å¤è¯»å¯è€»(â€¢Ì€ã¸ â€¢Ì â•® )","ä¸è¦å¤è¯»äº†å•¦","è¿™å°±æ˜¯æ‰€è°“çš„äººç±»çš„æœ¬è´¨","ä½ ä»¬å’‹ä¸ä¸Šå¤©å‘","åˆå¤è¯»ä¸Šç˜¾äº†å•Š"}
                         math.randomseed(os.time())
                         fdsj = math.random(1, 6)
				         sedmsg(CurrentQQ,data,fdArray[fdsj])
				     else
			             rr = ii + 1
		                 Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
		             end
			    else
			        rr = ii + 1
		            Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
			    end
			else
			    if (ii > 2) then
			        math.randomseed(os.time())
                    sj2 = math.random(1, 3)
					if (sj2 == 2) then
					    fdArray2 = {"ä¸­æ–­å¤è¯»å¯è€»","æ‰“æ–­å¤è¯»å¯è€»(â€¢Ì€ã¸ â€¢Ì â•® )","ä½ ä¸ºä»€ä¹ˆè¦æ‰“æ–­å¤è¯»å•Š","å¤è¯»ä¸é¦™å˜›","ç ´åæ°›å›´(à¸‡áµ’ÌŒçš¿áµ’ÌŒ)à¸‡â¼Â³â‚Œâ‚ƒ"}
                        math.randomseed(os.time())
                        fdsj2 = math.random(1, 5)
				        sedmsg(CurrentQQ,data,fdArray2[fdsj2])
					end
				end
				Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt","1")
			    Wirte("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt",data.Content)
			end
		else
		    Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt","1")
			Wirte("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt",data.Content)
		end
	    --å¦‚æœè°ƒæ•™æŒ‡ä»¤ä¸å­˜åœ¨ï¼Œåˆ™è¿›è¡Œå…¶ä»–æ“ä½œ
	    msgsql(CurrentQQ,data)--æ•°æ®å‚¨è“„
		--éšæœºå›å¤æ¶ˆæ¯æ¦‚ç‡0.04
	    math.randomseed(os.time())
        num = math.random(1, 40)
		if (num == 12) then
		    j = xiaosiapi(CurrentQQ,data,data.Content)
			sedmsg(CurrentQQ,data,j.data.info.text)
		end
	else
	    --è§¦å‘è°ƒæ•™æŒ‡ä»¤
		funic(CurrentQQ,data,mim)
	end
    return 1
end

function ReceiveEvents(CurrentQQ, data, extData)
  if data.MsgType == "ON_EVENT_GROUP_REVOKE" then --ç›‘å¬ ç¾¤æ’¤å›äº‹ä»¶
    --æ’¤å›äº‹ä»¶å¤„ç†
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..extData.GroupID..".txt")
    if (str == nil) then
	    log.info("Str ====> %s", str)
        return 1
	end
	if (string.find(str, "å…³é—­")) then
		return 1
	end
	CheHui(CurrentQQ, data, extData)
	--xxxxxxxxxxxxxxx
    return 1
  end
  --è¿›ç¾¤ç§€å›¾æ¬¢è¿


--é—ªç…§æ£€æµ‹å¤„ç†


--åŠŸèƒ½ç»„
function funic(CurrentQQ,data,msg)
    if string.find(msg, "^ç‚¹æ­Œ") then
	    data.Content = msg
        music(CurrentQQ,data,msg)
		return 1
	elseif string.find(msg, "^è¯­éŸ³") then
	    keyWord = msg:gsub("è¯­éŸ³", "")
        sedvoicemsg(CurrentQQ,data,keyWord)
		return 1
	elseif string.find(msg, "^å›¾ç‰‡") then
	    keyWord = msg:gsub("å›¾ç‰‡", "")
        sedimgmsg(CurrentQQ,data,keyWord,"")
		return 1
    elseif string.find(msg, "^å”±æ­Œ") then
        keyWord = msg:gsub("å”±æ­Œ", "")
		if (keyWord == "") then
		    sedmsg(CurrentQQ,data,"æ­Œåä¸èƒ½ç©ºç€å“¦")
		    return 1
		end
		sedmsg(CurrentQQ,data,"å¤©ä¾æ­£åœ¨åŠªåŠ›åŠ è½½Ù©(ËƒÌ¶Ì€Íˆà¯°Ë‚Ì¶ÌÍˆ)Ùˆ")
        response, error_message =
            http.request(
            "POST",
            "http://127.0.0.1:8888/SilkApi/UrlToBuf",--ä¿®æ”¹æ­¤å¤„ipåŠç«¯å£å³å¯
            {
                body = keyWord --ä¼ å…¥æ­Œæ›²å
            }
        )
        log.notice("err   %v", error_message)
        html = response.body --è¿”å›silk base64 buf
		if (string.find(html, "Î´")) then
				    sedmsg(CurrentQQ,data,"å¤©ä¾æ²¡æœ‰æ‰¾åˆ°ç›¸å…³çš„æ­Œå‘€(Ã’Ï‰Ã“×±)ï¼")
					c.close(c)
				    return 2
				end
        luaRes =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "VoiceMsg",
                groupid = 0,
                content = "",
                atUser = 0,
                voiceUrl = "",
                voiceBase64Buf = html 
            }
        )
		return 1
	end
    sedmsg(CurrentQQ,data,msg)
end

--å½±è§†æœç´¢ç”¨
function Sousuo(CurrentQQ,data,msg)
    response, error_message =
        http.request(
            "GET",
            "http://localhost/index.php/ajax/suggest",
            {
                query = "mid=1&f=admin&wd="..msg.."&limit=10&timestamp=1567914326746"
            }
        )
    html = response.body
	json = json.decode(html)
	if (json.total == 0) then
	    sedmsg(CurrentQQ,data,"å½±è§†æŸ¥è¯¢é”™è¯¯\nè¯·æ£€æŸ¥å½±è§†åæ˜¯å¦æ­£ç¡®\nâ•â•â•â•â•â•â•â•â•â•â•\næ³¨æ„âš ï¸å½±è§†åä¸è¦å¸¦æ— å…³æˆ–å¤šä½™çš„å­—ç¬¦")
	else
        sedmsg(CurrentQQ,data,"èµ„æºåœ°å€å¦‚ä¸‹â†“â†“â†“\nâ•â•â•â•â•â•â•â•â•â•\nhttp://118.25.41.32/index.php/vod/search/wd/"..escape(msg)..".html\nâ•â•â•â•â•â•â•â•â•â•â•\næ³¨æ„:å¦‚æœQQå‡ºç°åœæ­¢è®¿é—®ç°è±¡ï¼Œè¯·å¤åˆ¶é“¾æ¥ç”¨æµè§ˆå™¨æ‰“å¼€")
	end
end

--å•çº¯å‘æ¶ˆæ¯å›¾æ–‡é€šç”¨
function sedimgmsg(CurrentQQ,data,url,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "PicMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = url,
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘æ¶ˆæ¯ç”¨
function sedmsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "TextMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘ç§èŠæ¶ˆæ¯ç”¨
function sendfrimsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromUin,
        sendToType = 1,
        sendMsgType = "TextMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘jsonæ¶ˆæ¯ç”¨
function sedjsonmsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "JsonMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--èŠå¤©æ¨¡å—åˆ‡æ¢å‡½æ•°
function liaotian(CurrentQQ,data,msg)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
    if (mim == nil) then
        sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
        return 1
    end
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
	if (str == nil) then
        return 1
    end
	if (string.find(str, "å…³é—­")) then
	    sedmsg(CurrentQQ,data,"æœºå™¨èŠå¤©å¤„äºå…³é—­çŠ¶æ€\nâˆ´è¯·å…ˆå¼€å¯æœºå™¨èŠå¤©")
	    return 1
	end
	--åˆ‡æ¢å¤„ç†
	file = io.open("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt", "w")
	if (msg == 1) then
	    file:write("æ–‡å­—èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°æ–‡å­—èŠå¤©")
	elseif (msg == 2) then
	    file:write("è¯­éŸ³èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°è¯­éŸ³èŠå¤©")
	elseif (msg == 3) then
	    file:write("å›å¤èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°å›å¤èŠå¤©")
	end
	file:close()
end

--éšæœºè¡¨æƒ…å‡½æ•°
function faceArray()
    faceArray = {"[è¡¨æƒ…147]","ğŸ€","ğŸ”¥","ğŸ»","ğŸ’","[è¡¨æƒ…185]","[è¡¨æƒ…219]","[è¡¨æƒ…176]"}
    math.randomseed(os.time())
    num = math.random(1, 9)
    return faceArray[num]
end

--urlç¼–ç è½¬æ¢
function escape(w)
	pattern="[^%w%d%._%-%* ]"
	s=string.gsub(w,pattern,function(c)
		local c=string.format("%%%02X",string.byte(c))
		return c
	end)
	s=string.gsub(s," ","+")
	return s
end

--è¯»å–æ•°æ®å‡½æ•°
function Read(url)
    file = io.open(url, "r")
	if (file == nil) then
	    return nil
	else
        file:seek("set")
	    str = file:read("*a")
	    file:close()
        return str
	end
end

--å†™å…¥æ•°æ®å‡½æ•°
function Wirte(url,msg)
    file = io.open(url, "w+")
    file:write(msg)
	file:close()
    return "ok"
end

--å°æ€èŠå¤©å‡½æ•°
function xiaosiapi(CurrentQQ,data,str)
    response, error_message =
            http.request(
            "GET",
            "https://api.ownthink.com/bot",
            {
                query = "appid="..tostring(data.FromUserId).."&spoken=" .. url_encode(str),
                headers = {
                    Accept = "*/*"
                }
            }
        )
        html = response.body
		jData = json.decode(html)
		return jData
end

--æœºå™¨èŠå¤©å‡½æ•°
function ownthink(CurrentQQ,data,msgs,atqq)
    if (tostring(atqq) == CurrentQQ) then
        m = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
        if (m == nil) then
	        log.info("Str ====> %s", m)
            return 1
	    end
	    if (string.find(m, "å…³é—­")) then
	        sedmsg(CurrentQQ,data,"æœºå™¨èŠå¤©å¤„äºå…³é—­çŠ¶æ€\nâˆ´è¯·å…ˆå¼€å¯æœºå™¨èŠå¤©")
	        return 1
	    end
		res2 = string.find(msgs, " ")
		str = string.sub(msgs,res2)
		jData = xiaosiapi(CurrentQQ,data,str)
		Data = json.decode(data.Content)
		m = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
		if (m == nil) then
	        log.info("Str ====> %s", m)
            return 1
	    end
		if (string.find(m, "å›å¤èŠå¤©")) then
		    Api.Api_SendMsg(
                CurrentQQ,
                {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "ReplayMsg",
                groupid = 0,
                content = jData.data.info.text,
                atUser = 0,
				replayInfo = {
                    MsgSeq = data.MsgSeq,
                    --å›å¤æ¶ˆæ¯çš„Seq
                    MsgTime = data.MsgTime,
                    --å›å¤æ¶ˆæ¯çš„äº‹ä»¶
                    UserID = data.FromUserId,
                    --å›å¤æ¶ˆæ¯å¯¹è±¡
                    RawContent = Data.Content --å›å¤æ¶ˆæ¯çš„åŸå†…å®¹
                }
				}
            )
			return 1
		elseif (string.find(m, "æ–‡å­—èŠå¤©")) then
		    sedmsg(CurrentQQ,data,jData.data.info.text)
		else
		    sedvoicemsg(CurrentQQ,data,url_encode(jData.data.info.text))
		end
    end
end

--å‘é€è¯­éŸ³æ¶ˆæ¯
function sedvoicemsg(CurrentQQ,data,str)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "VoiceMsg",
        groupid = 0,
		voiceUrl = "https://dds.dui.ai/runtime/v1/synthesize?voiceId=qianranfa&speed=0.7&volume=100&audioType=wav&text="..str, --å‘é€è¯­éŸ³çš„ç½‘ç»œåœ°å€ æ–‡æœ¬å‹
        voiceBase64Buf = "",
        content = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å¤©æ°”æŸ¥è¯¢å‡½æ•°
function tianqi(CurrentQQ,data)
    keyWord = data.Content:gsub("å¤©æ°”", "")
        if keyWord == "" then
            return 1
        end

        cookies = Api.Api_GetUserCook(CurrentQQ)

        response, error_message =
            http.request(
            "GET",
            "https://weather.mp.qq.com/cgi-bin/rich",
            {
                query = "g_tk=" .. cookies.Gtk .. "&city=" .. url_encode(keyWord),
                headers = {
                    Referer = "http://weather.mp.qq.com/ark"
                },
                cookies = {
                    uin = CurrentQQ,
                    skey = cookies.Skey
                }
            }
        )
        local html = response.body
        log.notice("From Lua html -->%s", html)

        local j = json.decode(html)
        if j.code ~= 0 then
            return 1
        end

        ApiRet =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "JsonMsg",
                groupid = 0,
                content = string.format(
                    --{"config":{"forward":1,"autosize":1},"prompt":"[åº”ç”¨]å¤©æ°”","app":"com.tencent.weather","ver":"0.0.0.1","view":"RichInfoView","meta":{"richinfo":{"adcode":"101210701","city":"æˆéƒ½","air":"58","min":"20","ts":"1500550866","wind":"1","date":"6æœˆ27æ—¥ å‘¨å››","max":"28","type":"201"}},"desc":"å¤©æ°”"}
                    --[[{"app":"com.tencent.weather","desc":"","meta":{"weather":{"ad":[{"icon":"http://imgcache.qq.com/ac/tq/xz2/tp.jpg","p":"ptype=star","t":"2","title":"æ˜Ÿåº§ | ä»Šå¤©ä¼šå› ä¸ºæ„Ÿæƒ…å’Œå®¶åº­çš„é—®é¢˜ï¼Œå½±å“å·¥ä½œï¼Œè¿˜æœ‰ï¼Œä¹Ÿè¦æ³¨æ„äºº...","url":""},{"icon":"http://imgcache.qq.com/ac/qqweather/image/2019/6/27.png","p":"ptype=lunar","t":"4","title":"é»„å† | å†œå†äº”æœˆå»¿äº”ã€‚å®œè®¢ç›Ÿ.çº³é‡‡.å‡ºè¡Œ.ç¥ˆç¦.æ–‹é†®.å®‰åºŠ.ä¼š...","url":""}],"info":{"it1":{"adcode":"101050101","city":"æ­¦æ±‰","hour":"18","max":"29","min":"17","temp":"24","type":"202","ut":"1561630401","wea":"å¤šäº‘"},"it2":{"hour":"19","temp":"22","type":"202"},"it3":{"hour":"20","temp":"21","type":"202"},"ts":"1561631244"},"url":""}},"prompt":"ã€å“ˆå°”æ»¨ã€‘å¤šäº‘ 17Â°/29Â°, 18:13æ›´æ–°~","ver":"1.0.0.106","view":"WeatherThreeView"}]]
                    [[{"app":"com.tencent.weather","desc":"å¤©æ°”","view":"RichInfoView","ver":"1.0.0.217","prompt":"[åº”ç”¨]å¤©æ°”","meta":{"richinfo":{"adcode":"%s","air":"%s","city":"%s","date":"%s","max":"%s","min":"%s","ts":"1554951408","type":"%s","wind":"%s"}},"config":{"forward":1,"autosize":1,"type":"card"}}]],
                    j.data.adcode,
                    j.data.air,
                    j.data.city,
                    j.data.date,
                    j.data.max,
                    j.data.min,
                    j.data.type,
                    j.data.wind
                ),
                atUser = 0
            }
        )
end

--è°ƒæ•™å¤„ç†å‡½æ•°(å¾…å¤„ç†)
function tiaojiao(CurrentQQ,data)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
	if (mim == nil) then
		sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå“‡")
		return 1
	end
	if (string.find(data.Content, "^åˆ é™¤è°ƒæ•™")) then
	    msg = data.Content:gsub("åˆ é™¤è°ƒæ•™", "")
	    if (msg == "") then
		    sedmsg(CurrentQQ,data,"è¦åˆ é™¤çš„è°ƒæ•™æŒ‡ä»¤ä¸èƒ½ä¸ºç©ºå“¦")
		    return 1
		end
		rese = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..tostring(data.FromGroupId).."\/"..msg..".txt")
	    if (rese == nil) then
			sedmsg(CurrentQQ,data,"è¿™ä¸ªæŒ‡ä»¤ä¸å­˜åœ¨äº†å“¦")
		    return 1
		end
		rm_file = os.remove("mimoio\/æœºå™¨è°ƒæ•™\/"..tostring(data.FromGroupId).."\/"..msg..".txt")
		log.info("åˆ é™¤è°ƒæ•™ ====> %s", rm_file)
		sedmsg(CurrentQQ,data,"åˆ é™¤æˆåŠŸ\nä½ ä¸å–œæ¬¢è¢«è¿™æ ·è°ƒæ•™çš„æˆ‘å—[è¡¨æƒ…9]")
		return 1
	end
    msgs = data.Content:gsub("è°ƒæ•™", "")
		res2 = string.find(msgs, "#")
		str = string.sub(msgs,res2+1)
		str2 = string.sub(msgs,1,res2-1)
		        
		        if (str == "") then
		            sedmsg(CurrentQQ,data,"è°ƒæ•™çš„å›ç­”å†…å®¹ä¸èƒ½ä¸ºç©ºå“¦")
			        return 1
		        end
				if (str2 == "") then
		            sedmsg(CurrentQQ,data,"è°ƒæ•™çš„æŒ‡ä»¤å†…å®¹ä¸èƒ½ä¸ºç©ºå“¦")
			        return 1
		        end
		        rese = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..str2..".txt")
					if (rese ~= nil) then
				        sedmsg(CurrentQQ,data,"æŒ‡ä»¤å·²ç»å­˜åœ¨äº†å“¦")
				        return 1
				    end
				Wirte("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..str2..".txt",str)
				sedmsg(CurrentQQ,data,"è°ƒæ•™æˆåŠŸ\nä½ è¿˜æƒ³å†è°ƒæ•™æˆ‘ä¸€æ¬¡å—[è¡¨æƒ…6]")
		        return 1
end

function url_encode(str)
    if (str) then
        str = string.gsub(str, "\n", "\r\n")
        str =
            string.gsub(
            str,
            "([^%w ])",
            function(c)
                return string.format("%%%02X", string.byte(c))
            end
        )
        str = string.gsub(str, " ", "+")
    end
    return str
end

--æŠ¢çº¢åŒ…å¤„ç†
function RedBag(CurrentQQ, data)
    Api.Api_OpenRedBag(CurrentQQ, data.RedBaginfo)
    if (data.RedBaginfo.RedType == 12) then
         luaRes =
                Api.Api_SendMsg(
                CurrentQQ,
                {
                    toUser = data.FromGroupId,
                    sendToType = 2,
                    sendMsgType = "TextMsg",
                    groupid = 0,
                    content = data.RedBaginfo.Tittle,
                    atUser = 0
                }
            )
        log.notice("From Lua SendMsg Ret\n%d", luaRes.Ret)
    end
end

--è§†é¢‘è§£æå¤„ç†
function Video(CurrentQQ, data)
    vdata = json.decode(data.Content)
        videodata = {
            GroupID = data.FromGroupId,
            VideoUrl = vdata.VideoUrl,
            VideoMd5 = vdata.VideoMd5
        }
        --æ„é€ table å‚æ•°è¡¨
        luaResp = Api.Api_CallFunc(CurrentQQ, "PttCenterSvr.ShortVideoDownReq", videodata) --é€šè¿‡cmdè°ƒç”¨åŠŸèƒ½åŒ…
        luaRes =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "TextMsg",
                groupid = 0,
                content = "è§£æè§†é¢‘URL-->" .. luaResp.VideoUrl,
                atUser = 0
            }
        )
end

--ç®¡ç†å¼€å…³é€šç”¨
function adminio(CurrentQQ,data,oio)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim ~= nil) then
            msg = data.Content:gsub(oio, "")
            str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
            if (string.find(str, "å…³é—­")) then
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äººå·²è¢«å…³é—­...\nè¯·å…ˆå¼€å¯æœºå™¨äºº")
                return 1
            end
			str2 = Read("mimoio\/çŠ¶æ€æ•°æ®\/"..oio.."\/"..data.FromGroupId..".txt")
			if (string.find(str2, msg)) then
			    sedmsg(CurrentQQ,data,"âˆ´"..oio.."æœ¬å°±æ˜¯"..str2.."çŠ¶æ€")
                return 1
			end
            Wirte("mimoio\/çŠ¶æ€æ•°æ®\/"..oio.."\/"..data.FromGroupId..".txt",msg)
            sedmsg(CurrentQQ,data,"âˆ´"..oio..msg.."æˆåŠŸ")
            return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
end

--ç™¾ç§‘å¤§å…¨
function baike(CurrentQQ,data)
    keyWord = data.Content:gsub("ç™¾ç§‘", "")
        if keyWord == "" then
            return 1
        end
        response, error_message =
            http.request(
            "GET",
            "http://baike.baidu.com/api/openapi/BaikeLemmaCardApi",
            {
                query = "scope=103&format=json&appid=379020&bk_key=" .. url_encode(keyWord) .. "&bk_length=600"
            }
        )
        html = response.body
        while(string.find(html, '"errno":2')) do
            response, error_message =
            http.request(
            "GET",
            "http://baike.baidu.com/api/openapi/BaikeLemmaCardApi",
            {
                query = "scope=103&format=json&appid=379020&bk_key=" .. url_encode(keyWord) .. "&bk_length=600"
            })
			html = response.body
        end
        local j = json.decode(html)
        sedmsg(CurrentQQ,data,j.abstract.."\n"..j.url)
end

--éŸ³ä¹ç‚¹æ­Œ
function music(CurrentQQ,data)
    keyWord = data.Content:gsub("ç‚¹æ­Œ", "")
        if keyWord == "" then
            return 1
        end
        response, error_message =
            http.request(
            "GET",
            "https://c.y.qq.com/soso/fcgi-bin/client_search_cp",
            {
                query = "aggr=1&cr=1&flag_qc=0&p=1&n=6&w=" .. url_encode(keyWord)
            }
        )
        html = response.body
		str = string.sub(html,10,-2)
        j = json.decode(str)
        if (j.code == 0) then
            msg = ""
            num = j.data.song.list
            list = num[1]
            songname = list.songname
            singername = list.singer[1].name
            payplay = list.pay.payplay
			albummid = list.albummid
			songmid = list.songmid
	        sedjsonmsg(CurrentQQ,data,'{"app":"com.tencent.structmsg","desc":"éŸ³ä¹","view":"music","ver":"0.0.0.1","prompt":"[åˆ†äº«]' ..songname.. '","meta":{"music":{"sourceMsgId":"0","title":"' ..songname.. '","desc":"' ..singername.. '","preview":"y.gtimg.cn/music/photo_new/T002R150x150M000'..albummid..'.jpg","tag":"QQéŸ³ä¹","musicUrl":"https://v1.itooi.cn/tencent/url?id='..songmid..'","jumpUrl":"y.qq.com/n/yqq/song/'..songmid..'.html","appid":100497308,"app_type":1,"action":"","source_url":"url.cn/5aSZ8Gc","source_icon":"url.cn/5tLgzTm","android_pkg_name":"com.tencent.qqmusic"}},"config":{"forward":true,"type":"normal","autosize":true}}')
			return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´Error:"..j.code)
			return 1
        end
end

--è®¿é—®url
function geturl(url_class,url,caulrt)
        response, error_message =
            http.request(
            url_class,
            url,
            {
                query = caulrt
            }
        )
        html = response.body
		return html
end

--æ¶ˆæ¯å‚¨è“„
function msgsql(CurrentQQ,data)
    if (mysqlpass == "") then
	    return 1
	end
    c = mysql.new()
    -- åˆå§‹åŒ–mysqlå¯¹è±¡
    ok, err = c:connect({host = mysqlhost, port = 3306, database = mysqldb, user = mysqluser, password = mysqlpass})
    --å»ºç«‹è¿æ¥
    if ok then
        sqlstr =
            string.format(
            [[INSERT INTO msgcache (GroupID, MsgSeq, MsgRandom,MsgType,Data,MsgTime)VALUES (%d,%d,%d,'%s','%s',%d)]],
            data.FromGroupId,
            data.MsgSeq,
            data.MsgRandom,
            data.MsgType,
            data.Content,
            data.MsgTime
        )
        res, err = c:query(sqlstr) --å…¥åº“ç¼“å­˜æ¶ˆæ¯
        log.info("%s", err)
        c.close(c)
    --é‡Šæ”¾è¿æ¥
    end
    return 1
end

--æ’¤å›æ£€æµ‹
function CheHui(CurrentQQ, data, extData)
    c = mysql.new()
    -- åˆå§‹åŒ–mysqlå¯¹è±¡
	if (mysqlpass == "") then
	    return 1
	end
	
    if data.MsgType == "ON_EVENT_GROUP_REVOKE" then --ç›‘å¬ ç¾¤æ’¤å›äº‹ä»¶
        str = string.format("ç¾¤æˆ %d  æˆå‘˜ UserID %s æ’¤å›äº†æ¶ˆæ¯Seq %s \n", extData.GroupID, extData.UserID, extData.MsgSeq)
        log.info("%s", str)
        ok, err = c:connect({host = mysqlhost, port = 3306, database = mysqldb, user = mysqluser, password = mysqlpass})
        --å»ºç«‹è¿æ¥
        log.info("sql %v", err)
        if ok then
            sqlstr =
                string.format(
                "select * from msgcache where `GroupID`= %d and `MsgSeq` = %d",
                extData.GroupID,
                extData.MsgSeq
            )
            res, err = c:query(sqlstr) --è·Ÿç¾¤ç¾¤idå’Œæ¶ˆæ¯SEQæŸ¥è¯¢å‡ºæ’¤å›çš„æ¶ˆæ¯å†…å®¹
            if err == nil then
                c.close(c)
                GroupID = tonumber(res[1]["GroupID"])
                MsgType = res[1]["MsgType"]
                Data = res[1]["Data"]

                if MsgType == "TextMsg" then
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            --å‘é€æ–‡æœ¬æ¶ˆæ¯
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡æ–‡æœ¬æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                Data
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "SmallFaceMsg" then
                    --Data {"Content":"[è¡¨æƒ…101]","Hex":"FKY=","Index":101,"tips":"[å°è¡¨æƒ…]"}
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡è¡¨æƒ…æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).Content
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "PicMsg" then
                    --Data {"Content":"","FileId":2820717626,"FileMd5":"q0oEC5aloJJMFr10mplaXw==","FileSize":7026,"tips":"[ç¾¤å›¾ç‰‡]","url":"http://gchat.qpic.cn/gchatpic_new/1700487478/960839480-2534335053-AB4A040B96A5A0924C16BD749A995A5F/0?vuin=u0026term=255u0026pictype=0"}
                    jData = json.decode(Data)
					if (jData.tips == "[ç¾¤æ¶ˆæ¯-QQé—ªç…§]") then
					    
					Api.Api_SendMsg( 
                    CurrentQQ,
                    {
                        toUser = GroupID,
                        sendToType = 2,
                        sendMsgType = "ForwordMsg",
                        content = "",
                        atUser = 0,
                        groupid = 0,
                        voiceUrl = "",
                        voiceBase64Buf = "",
                        picUrl = "",
                        picBase64Buf = "",
                        forwordBuf = json.decode(Data).ForwordBuf, --æ¬²è½¬å‘çš„base64buf å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                        forwordField = json.decode(Data).ForwordField --æ¬²å†™å…¥åè®®çš„å­—æ®µID å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                    }
                )
				    return 1
					end
                    Api.Api_SendMsg( --é€šè¿‡å›¾ç‰‡md5å‘é€å›¾ç‰‡ ç§’å‘ä¸ç”¨ä¸Šä¼  ç›¸å½“äºè½¬å‘
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "PicMsg",
                            --å‘é€å›¾æ–‡æ¶ˆæ¯
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡å›¾ç‰‡æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š[PICFLAG]%s",
                                extData.UserID,
                                jData.Content
                            ),
                            --é€šè¿‡å®[PICFLAG]æ”¹å˜å›¾æ–‡é¡ºåº  æ”¹ä¸ºç°æ–‡å­—åå›¾ç‰‡
                            atUser = 0,
                            voiceUrl = "",
                            voiceBase64Buf = "",
                            picUrl = "",
                            picBase64Buf = "",
                            fileMd5 = jData.FileMd5
                        }
                    )
                end
                if MsgType == "AtMsg" then
                    --Data {"Content":"@Kar98k skjjkssjkjs","UserID":123456789,"tips":"[ATæ¶ˆæ¯]"}
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡atæ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).Content
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "VoiceMsg" then
                    --Data {"tips":"[è¯­éŸ³]","url":"http://grouptalk.c2c.qq.com/?ver=0u0026rkey=3062020101045b305902010102010102041fdef8ae042439416931554e5142586c536d78706a314c686843664959725f327a5f573064697653755902045dac2a21041f0000000866696c6574797065000000013100000005636f64656300000001310400u0026filetype=1u0026voice_codec=1"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "VoiceMsg",
                            --å‘é€ç¾¤è¯­éŸ³æ¶ˆæ¯
                            groupid = 0,
                            content = "",
                            atUser = 0,
                            voiceUrl = json.decode(Data).url,
                            --é€šè¿‡ç½‘ç»œurlè¿›è¡Œå‘é€è¯­éŸ³
                            voiceBase64Buf = "",
                            picUrl = "",
                            picBase64Buf = ""
                        }
                    )
                end

                if MsgType == "ReplayMsg" then
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡å›å¤æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).ReplayContent
                            ),
                            atUser = 0
                        }
                    )
                end
				if MsgType == "VideoMsg" then
	             Api.Api_SendMsg( 
                    CurrentQQ,
                    {
                        toUser = GroupID,
                        sendToType = 2,
                        sendMsgType = "ForwordMsg",
                        content = "",
                        atUser = 0,
                        groupid = 0,
                        voiceUrl = "",
                        voiceBase64Buf = "",
                        picUrl = "",
                        picBase64Buf = "",
                        forwordBuf = json.decode(Data).ForwordBuf, --æ¬²è½¬å‘çš„base64buf å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                        forwordField = json.decode(Data).ForwordField --æ¬²å†™å…¥åè®®çš„å­—æ®µID å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                    }
                )
				end
                if MsgType == "XmlMsg" then
				    
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "XmlMsg",
                            groupid = 0,
                            content = string.format("%s", Data),
                            atUser = 0
                        }
                    )
                end
				if MsgType == "JsonMsg" then
				    
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "JsonMsg",
                            groupid = 0,
                            content = string.format("%s", Data),
                            atUser = 0
                        }
                    )
                end
            end
        end
    end
    return 1
end
2020/09/07 11:54:44.810 [E]  mimoio.lua
2020/09/07 11:54:44.813 [E]  local log = require("log")
local Api = require("coreApi")
local json = require("json")
local http = require("http")
local mysql = require("mysql")

--ç‰ˆæœ¬å·(ä¸è¦æ”¹åŠ¨)
Vabr = "1.0.2"
--æ•°æ®åº“é…ç½®
mysqlhost = "localhost"--é»˜è®¤ä¸åŠ¨
mysqldb = "ffaxx001"--æ•°æ®åº“å
mysqluser = "ffaxx001"--æ•°æ®åº“ç”¨æˆ·å
mysqlpass = "123456"--æ•°æ®åº“å¯†ç 
--ä¸ä½¿ç”¨è¯·ä¸è¦æ”¹åŠ¨

function ReceiveFriendMsg(CurrentQQ, data)
    if (data.Content == "ä½¿ç”¨æ–¹æ³•") then
	    sendfrimsg(CurrentQQ,data,"æ·»åŠ æˆæƒè€…çš„æ–¹æ³•\nå¯¹å•ä¸ªæœºå™¨äººç§èŠå‘é€[æ·»åŠ æˆæƒè€…+æˆæƒè€…QQ]\n\næˆæƒç¾¤çš„æ–¹æ³•\nåˆ°éœ€è¦æˆæƒçš„ç¾¤é‡Œå‘é€[æˆæƒ+ä¸»äººQQ]ã€‚æ³¨æ„:æˆæƒå¿…é¡»æ˜¯æˆæƒè€…è¿›è¡Œæ“ä½œ,ç®¡ç†å‘˜æˆæƒä¸äº†")
	end
    --æ•°æ®åˆå§‹åŒ–
    if (data.Content == "åˆå§‹åŒ–") then
	    root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root ~= nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´è¯·ä¸è¦é‡å¤åˆå§‹åŒ–")
			return 1
		end
    --os.execute('mkdir mimoio/æœºå™¨æˆæƒ')
	    os.execute('mkdir mimoio')
		os.execute('mkdir mimoio/å¤è¯»æœº')
		os.execute('mkdir mimoio/å¤è¯»æœº/æ¬¡æ•°')
		os.execute('mkdir mimoio/å¤è¯»æœº/å†…å®¹')
		os.execute('mkdir mimoio/æœºå™¨æˆæƒ')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨ä¸»äºº')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨èŠå¤©')
		os.execute('mkdir mimoio/æœºå™¨è°ƒæ•™')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æŠ¢çº¢åŒ…')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æœºå™¨èŠå¤©')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æœºå™¨å¼€å…³')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æ’¤å›æ£€æµ‹')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/å›¾ç‰‡è§£æ')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/è§†é¢‘è§£æ')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/é—ªç…§æ£€æµ‹')
		Wirte("mimoio\/"..data.FromUin..".txt","999")
		sendfrimsg(CurrentQQ,data,"åˆå§‹åŒ–å®Œæ¯•ï¼\nå‘é€[ä½¿ç”¨æ–¹æ³•]äº†è§£ä½¿ç”¨å§")
	end
	--æ·»åŠ æˆæƒè€…æ“ä½œ(ç§èŠæœºå™¨äººå‘é€)
	if (string.find(data.Content, "^æ·»åŠ æˆæƒè€…")) then
	    msg = data.Content:gsub("æ·»åŠ æˆæƒè€…", "")
		--Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromUin..".txt","å…³é—­")
		root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root == nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„ç®¡ç†è€…")
			return 1
		end
		Wirte("mimoio\/æœºå™¨æˆæƒ\/"..msg..CurrentQQ..".txt","999")
		sendfrimsg(CurrentQQ,data,"âˆ´æ·»åŠ æˆæƒè€…æˆåŠŸ")
	end
	--åˆ é™¤æˆæƒè€…æ“ä½œ(ç§èŠæœºå™¨äººå‘é€)
	if (string.find(data.Content, "^åˆ é™¤æˆæƒè€…")) then
	    msg = data.Content:gsub("åˆ é™¤æˆæƒè€…", "")
		--Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromUin..".txt","å…³é—­")
		root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root == nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„ç®¡ç†è€…")
			return 1
		end
		os.remove("mimoio\/æœºå™¨æˆæƒ\/"..msg..CurrentQQ..".txt")
		sendfrimsg(CurrentQQ,data,"âˆ´åˆ é™¤æˆæƒè€…æˆåŠŸ")
	end
    return 1
end
function ReceiveGroupMsg(CurrentQQ, data)
    if (tostring(data.FromUserId) == CurrentQQ) then
	    return 1
	end
	--ç¾¤èŠæˆæƒ(åˆ°éœ€è¦æˆæƒçš„ç¾¤é‡Œæ“ä½œ)
	if (string.find(data.Content, "^æˆæƒ")) then
	    root = Read("mimoio\/æœºå™¨æˆæƒ\/"..data.FromUserId..CurrentQQ..".txt","999")
		if (root == nil) then
		    sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„æˆæƒè€…")
			return 1
		end
		msg = data.Content:gsub("æˆæƒ", "")
		os.execute('mkdir mimoio/æœºå™¨è°ƒæ•™/'..data.FromGroupId)
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨ä¸»äºº/'..data.FromGroupId)
		Wirte("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..msg..".txt","999")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt","å›å¤èŠå¤©")
		sedmsg(CurrentQQ,data,"âˆ´æˆæƒæˆåŠŸï¼\nå‘é€[å¼€å¯æœºå™¨äºº]ä½¿ç”¨å§")
	end
	--åˆ é™¤æˆæƒæ“ä½œ(åˆ°éœ€è¦åˆ é™¤æˆæƒçš„ç¾¤é‡Œæ“ä½œ)
	if (string.find(data.Content, "^åˆ é™¤æˆæƒ")) then
	    root = Read("mimoio\/æœºå™¨æˆæƒ\/"..data.FromUserId..CurrentQQ..".txt","999")
		if (root == nil) then
		    sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„æˆæƒè€…")
			return 1
		end
		msg = data.Content:gsub("åˆ é™¤æˆæƒ", "")
		os.remove("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..msg..".txt")
		os.remove("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
		sedmsg(CurrentQQ,data,"âˆ´åˆ é™¤æˆæƒæˆåŠŸï¼")
	end
	--æœºå™¨å¼€å…³æŒ‡ä»¤
	if (data.Content == "å¼€å¯æœºå™¨äºº" or data.Content == "å…³é—­æœºå™¨äºº") then
        mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim ~= nil) then
            msg = data.Content:gsub("æœºå™¨äºº", "")
            str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
			if (str == nil) then
			    Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt",msg)
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äºº"..msg.."æˆåŠŸï¼")
				log.info("Str ====> %s", str)
                return 1
			end
			
            if (string.find(str, msg)) then
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äººä¸€ç›´æ˜¯"..msg.."çš„å‘")
                return 1
            end
            Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt",msg)
            sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äºº"..msg.."æˆåŠŸï¼")
            return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
	end
    --æœºå™¨äººå¼€å¯æ£€æµ‹
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
	if (str == nil) then
	    log.info("Str ====> %s", str)
        return 1
	end
	if (string.find(str, "å…³é—­")) then
	    return 1
	end
	--atæ¶ˆæ¯å¤„ç†
	msgs = ""
	atqq = 0
	if (string.find(data.Content, "ATæ¶ˆæ¯")) then
	    msgs = json.decode(data.Content).Content
		atqq = json.decode(data.Content).UserID
	end
	--å°¾å·´è‡ªå®šä¹‰(å¾…å®Œå–„)
	tips = "â€”â€”å‡¤é£ç¿±ç¿”å…®ä¸·"
    --åŠŸèƒ½æ¨¡å—
    if (data.Content == "åŠŸèƒ½" or data.Content == "ä¸»ç•Œé¢") then
        face = faceArray()
        sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."å½±è§†æœç´¢\n"..face.."èŠå¤©å¨±ä¹\n"..face.."ä¾¿åˆ©åŠŸèƒ½\n"..face.."æœºå™¨è°ƒæ•™\n"..face.."ç®¡ç†ç³»ç»Ÿ\n"..face.."bugåé¦ˆ\n"..face.."æœ¬ç¾¤çŠ¶æ€\n"..face.."æ›´æ–°æ£€æµ‹\n\n"..tips)
    end
    --å½±è§†æœç´¢æ¨¡å—
    if (data.Content == "å½±è§†æœç´¢") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."æœç´¢+å½±è§†å\n"..face.."æˆ‘æƒ³çœ‹+å½±è§†å\n"..face.."æˆ‘è¦çœ‹+å½±è§†å\n\n"..tips)
    elseif (string.find(data.Content, "^æœç´¢")) then
	    msg = data.Content:gsub("æœç´¢", "")
		Sousuo(CurrentQQ,data,msg)
	elseif (string.find(data.Content, "^æˆ‘æƒ³çœ‹")) then
	    msg = data.Content:gsub("æˆ‘æƒ³çœ‹", "")
		Sousuo(CurrentQQ,data,msg)
    elseif (string.find(data.Content, "^æˆ‘è¦çœ‹")) then
	    msg = data.Content:gsub("æˆ‘è¦çœ‹", "")
		Sousuo(CurrentQQ,data,msg)
	end
	--èŠå¤©å¨±ä¹æ¨¡å—
	if (data.Content == "èŠå¤©å¨±ä¹") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."åˆ‡æ¢æ–‡å­—èŠå¤©\n"..face.."åˆ‡æ¢å›å¤èŠå¤©\n"..face.."åˆ‡æ¢è¯­éŸ³èŠå¤©\n\n"..tips)
    elseif (data.Content == "åˆ‡æ¢æ–‡å­—èŠå¤©") then
		liaotian(CurrentQQ,data,1)
	elseif (data.Content == "åˆ‡æ¢è¯­éŸ³èŠå¤©") then
	    liaotian(CurrentQQ,data,2)
    elseif (data.Content == "åˆ‡æ¢å›å¤èŠå¤©") then
	    liaotian(CurrentQQ,data,3)
	else
	    ownthink(CurrentQQ,data,msgs,atqq)
	end
	--ä¾¿åˆ©åŠŸèƒ½æ¨¡å—
	if (data.Content == "ä¾¿åˆ©åŠŸèƒ½") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."ç™¾ç§‘å¤§å…¨\n"..face.."éŸ³ä¹ç‚¹æ­Œ\n"..face.."é—ªä»–@xx\n"..face.."å¤©æ°”æŸ¥è¯¢\n\n"..tips)
	elseif (data.Content == "ç™¾ç§‘å¤§å…¨") then
		sedmsg(CurrentQQ,data,"å‘é€:[ç™¾ç§‘+å…³é”®è¯]\nä¾‹å¦‚:ç™¾ç§‘æ´›å¤©ä¾")
    elseif (data.Content == "éŸ³ä¹ç‚¹æ­Œ") then
		sedmsg(CurrentQQ,data,"å‘é€:[ç‚¹æ­Œ+æ­Œå]\nä¾‹å¦‚:ç‚¹æ­Œé’æŸ ")
	elseif (data.Content == "å¤©æ°”æŸ¥è¯¢") then
		sedmsg(CurrentQQ,data,"å‘é€:[å¤©æ°”+åœ°æ–¹å]\nä¾‹å¦‚:å¤©æ°”åŒ—äº¬(é™äºå›½å†…)")
    elseif (string.find(data.Content, "^å¤©æ°”")) then
        tianqi(CurrentQQ,data)
	    --msg = data.Content:gsub("æœç´¢", "")
		--Sousuo(CurrentQQ,data,msg)
	elseif (string.find(data.Content, "^ç™¾ç§‘")) then
	    baike(CurrentQQ,data)
	    --msg = data.Content:gsub("æˆ‘æƒ³çœ‹", "")
		--Sousuo(CurrentQQ,data,msg)music(CurrentQQ,data)
    elseif (string.find(data.Content, "^ç‚¹æ­Œ")) then
	    music(CurrentQQ,data)
	end
	--æœºå™¨è°ƒæ•™æ¨¡å—
	if (data.Content == "æœºå™¨è°ƒæ•™") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."æ–‡å­—è°ƒæ•™\n"..face.."è¯­éŸ³è°ƒæ•™\n"..face.."å”±æ­Œè°ƒæ•™\n"..face.."éŸ³ä¹è°ƒæ•™\n"..face.."å›¾ç‰‡è°ƒæ•™\n"..face.."åˆ é™¤è°ƒæ•™\n\n"..tips)
    elseif (data.Content == "æ–‡å­—è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#(å†…å®¹)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#ä½ å¥½å•Š")
	elseif (data.Content == "è¯­éŸ³è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#è¯­éŸ³(å†…å®¹)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#è¯­éŸ³ä½ å¥½å•Š")
	elseif (data.Content == "å›¾ç‰‡è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#å›¾ç‰‡(é“¾æ¥)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#å›¾ç‰‡http://../1.jpg")
	elseif (data.Content == "éŸ³ä¹è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#ç‚¹æ­Œ(æ­Œå)]\nä¾‹å¦‚:è°ƒæ•™å–µ#ç‚¹æ­Œå­¦çŒ«å«")
	elseif (data.Content == "å”±æ­Œè°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#å”±æ­Œ(æ­Œå)]\nä¾‹å¦‚:è°ƒæ•™å–µ#å”±æ­Œå­¦çŒ«å«")
	elseif (data.Content == "åˆ é™¤è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[åˆ é™¤è°ƒæ•™(æŒ‡ä»¤)]\nä¾‹å¦‚:åˆ é™¤è°ƒæ•™ä½ å¥½")
	elseif (string.find(data.Content, "^è°ƒæ•™")) then
        tiaojiao(CurrentQQ,data)
	elseif (string.find(data.Content, "^åˆ é™¤è°ƒæ•™")) then
        tiaojiao(CurrentQQ,data)
	end
	--ç®¡ç†ç³»ç»Ÿæ¨¡å—
	if (data.Content == "ç®¡ç†ç³»ç»Ÿ") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."å¼€å¯/å…³é—­æœºå™¨äºº\n"..face.."å¼€å¯/å…³é—­æŠ¢çº¢åŒ…\n"..face.."å¼€å¯/å…³é—­æœºå™¨èŠå¤©\n"..face.."å¼€å¯/å…³é—­é—ªç…§æ£€æµ‹\n"..face.."å¼€å¯/å…³é—­å›¾ç‰‡è§£æ\n"..face.."å¼€å¯/å…³é—­è§†é¢‘è§£æ\n"..face.."å¼€å¯/å…³é—­æ’¤å›æ£€æµ‹\n\n"..tips)
    elseif (data.Content == "å¼€å¯æœºå™¨èŠå¤©" or data.Content == "å…³é—­æœºå™¨èŠå¤©") then
        adminio(CurrentQQ,data,"æœºå™¨èŠå¤©")
    elseif (data.Content == "å¼€å¯æ’¤å›æ£€æµ‹" or data.Content == "å…³é—­æ’¤å›æ£€æµ‹") then
        adminio(CurrentQQ,data,"æ’¤å›æ£€æµ‹")
	elseif (data.Content == "å¼€å¯é—ªç…§æ£€æµ‹" or data.Content == "å…³é—­é—ªç…§æ£€æµ‹") then
        adminio(CurrentQQ,data,"é—ªç…§æ£€æµ‹")
	elseif (data.Content == "å¼€å¯æŠ¢çº¢åŒ…" or data.Content == "å…³é—­æŠ¢çº¢åŒ…") then
        adminio(CurrentQQ,data,"æŠ¢çº¢åŒ…")
	elseif (data.Content == "å¼€å¯è§†é¢‘è§£æ" or data.Content == "å…³é—­è§†é¢‘è§£æ") then
        adminio(CurrentQQ,data,"è§†é¢‘è§£æ")
	elseif (data.Content == "å¼€å¯å›¾ç‰‡è§£æ" or data.Content == "å…³é—­å›¾ç‰‡è§£æ") then
        adminio(CurrentQQ,data,"å›¾ç‰‡è§£æ")
	end
	--bugåé¦ˆæ¨¡å—
	if (data.Content == "BUGåé¦ˆ" or data.Content == "bugåé¦ˆ") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."é‚®ä»¶åé¦ˆ\n"..face.."QQåé¦ˆ\n\n"..tips)
    elseif (data.Content == "QQåé¦ˆ") then
        sedmsg(CurrentQQ,data,"???Î£(ï¾Ÿâˆ€ï¾Ÿï¾‰)ï¾‰\næ’ä»¶æœ‰é—®é¢˜å¯ä»¥åé¦ˆåˆ°:\nQQ:2353065854")
    elseif (data.Content == "é‚®ä»¶åé¦ˆ") then
        sedmsg(CurrentQQ,data,"å®è´å’‹å•¦=ÍÍŸÍŸÍ(ê’ªá—œê’ª â€§Ì£Ì¥Ì‡)\næ’ä»¶æœ‰é—®é¢˜å¯ä»¥åé¦ˆåˆ°:\né‚®ç®±ğŸ“¬:ym-o@qq.com")
	end
	--æœ¬ç¾¤çŠ¶æ€æ¨¡æ¿
	if (data.Content == "æœ¬ç¾¤çŠ¶æ€") then
        face = faceArray()
        hb = Read("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt")
        sz = Read("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt")
		tp = Read("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt")
        sp = Read("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt")
        jqr = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
        lt = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
        ch = Read("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..data.FromGroupId..".txt")
		sedmsg(CurrentQQ,data,"çŠ¶æ€æ•°æ®åˆ—è¡¨â†“â†“â†“\n"..face.."æœºå™¨äºº:"..jqr.."\n"..face.."æŠ¢çº¢åŒ…:"..hb.."\n"..face.."å›¾ç‰‡è§£æ:"..tp.."\n"..face.."æ’¤å›æ£€æµ‹:"..ch.."\n"..face.."è§†é¢‘è§£æ:"..sp.."\n"..face.."æœºå™¨èŠå¤©:"..lt.."\n"..face.."é—ªç…§æ£€æµ‹:"..sz.."\n\n"..tips)
	end
	--æ›´æ–°æ¨¡å—
	if (data.Content == "æ›´æ–°æ£€æµ‹") then
        str = geturl("GET","http://118.25.41.32/Lsb/lua/Vabr.txt","")
		log.info("Str ====> %s", str)
        if (string.find(str, Vabr)) then
            sedmsg(CurrentQQ,data,"å½“å‰ç‰ˆæœ¬ä¸ºæœ€æ–°ç‰ˆ")
        else
            sedmsg(CurrentQQ,data,"å‘ç°æ–°ç‰ˆæœ¬!\nå½“å‰ç‰ˆæœ¬:"..Vabr.."\næ–°ç‰ˆæœ¬å·:"..str.."\nèµ¶å¿«å‘é€[æ›´æ–°æ’ä»¶]å§")
        end
	elseif (data.Content == "æ›´æ–°æ’ä»¶") then
	    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim == nil) then
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
        str = geturl("GET","http://118.25.41.32/Lsb/lua/Vabr.txt","")
		log.info("Str ====> %s", str)
        if (string.find(str, Vabr)) then
            sedmsg(CurrentQQ,data,"å½“å‰ç‰ˆæœ¬ä¸ºæœ€æ–°ç‰ˆ")
        else
            str = geturl("GET","http://118.25.41.32/Lsb/lua/mimoio.txt","")
            Wirte("Plugins\/mimoio.lua",str)
            sedmsg(CurrentQQ,data,"æ›´æ–°å®Œæ¯•ï¼")
        end
	end
	--å›¾ç‰‡ç±»å‹æ¶ˆæ¯å¤„ç†
    if (data.MsgType == "PicMsg") then
	    msg = Read("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt")
		jData = json.decode(data.Content)
	    if (msg ~= nil and jData.tips ~= "[ç¾¤æ¶ˆæ¯-QQé—ªç…§]") then
            if (string.find(str, "å¼€å¯")) then
	            sedmsg(CurrentQQ,data,"å›¾ç‰‡é“¾æ¥è§£æå¦‚ä¸‹â†“â†“\n"..jData.url)
				return 1
	        end
	    end
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt")
	    if (str == nil) then
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    --é—ªç…§ã€å›¾ç‰‡å¤„ç†æ¨¡å—
		PicFlag(CurrentQQ, data)
    end
	--æŠ¢çº¢åŒ…å¤„ç†
	if (string.find(data.MsgType, "RedBagMsg") == 1) then
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt")
		if (str == nil) then
	        log.info("Str ====> %s", str)
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    RedBag(CurrentQQ, data)
	end
	--è§†é¢‘è§£æå¤„ç†
	if (string.find(data.MsgType, "VideoMsg") == 1) then
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt")
		if (str == nil) then
	        log.info("Str ====> %s", str)
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    Video(CurrentQQ, data)
	end
	--até—ªå›¾
	if (data.MsgType == "AtMsg") and (string.find(data.Content, "é—ªä»–")) then
	    shantu(CurrentQQ, data)
    end
	--è°ƒæ•™æœç´¢å¼•æ“
	mim = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..data.Content..".txt")
	if (mim == nil) then
	    --äººç±»çš„æœ¬è´¨æ˜¯å¤è¯»æœº
	    msg = Read("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt")
		if (msg ~= nil) then
		    cs = Read("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt")
			ii = tonumber(cs)
			if (string.find(msg, "^"..data.Content.."$")) then
			    if (ii > 2) then
			         math.randomseed(os.time())
                     sj = math.random(1, 5)
		             if (sj == 1 or sj == 2) then
			             sedmsg(CurrentQQ,data,msg)
					     rr = ii + 1
		                 Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
				     elseif (sj == 3) then
				         os.remove("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt")
					     os.remove("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt")
					     fdArray = {"çªç„¶æˆªæ–­å¤è¯»(ï¾ŸâŠ¿ï¾Ÿ)ï¾‚","å¤è¯»å¯è€»(â€¢Ì€ã¸ â€¢Ì â•® )","ä¸è¦å¤è¯»äº†å•¦","è¿™å°±æ˜¯æ‰€è°“çš„äººç±»çš„æœ¬è´¨","ä½ ä»¬å’‹ä¸ä¸Šå¤©å‘","åˆå¤è¯»ä¸Šç˜¾äº†å•Š"}
                         math.randomseed(os.time())
                         fdsj = math.random(1, 6)
				         sedmsg(CurrentQQ,data,fdArray[fdsj])
				     else
			             rr = ii + 1
		                 Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
		             end
			    else
			        rr = ii + 1
		            Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
			    end
			else
			    if (ii > 2) then
			        math.randomseed(os.time())
                    sj2 = math.random(1, 3)
					if (sj2 == 2) then
					    fdArray2 = {"ä¸­æ–­å¤è¯»å¯è€»","æ‰“æ–­å¤è¯»å¯è€»(â€¢Ì€ã¸ â€¢Ì â•® )","ä½ ä¸ºä»€ä¹ˆè¦æ‰“æ–­å¤è¯»å•Š","å¤è¯»ä¸é¦™å˜›","ç ´åæ°›å›´(à¸‡áµ’ÌŒçš¿áµ’ÌŒ)à¸‡â¼Â³â‚Œâ‚ƒ"}
                        math.randomseed(os.time())
                        fdsj2 = math.random(1, 5)
				        sedmsg(CurrentQQ,data,fdArray2[fdsj2])
					end
				end
				Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt","1")
			    Wirte("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt",data.Content)
			end
		else
		    Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt","1")
			Wirte("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt",data.Content)
		end
	    --å¦‚æœè°ƒæ•™æŒ‡ä»¤ä¸å­˜åœ¨ï¼Œåˆ™è¿›è¡Œå…¶ä»–æ“ä½œ
	    msgsql(CurrentQQ,data)--æ•°æ®å‚¨è“„
		--éšæœºå›å¤æ¶ˆæ¯æ¦‚ç‡0.04
	    math.randomseed(os.time())
        num = math.random(1, 40)
		if (num == 12) then
		    j = xiaosiapi(CurrentQQ,data,data.Content)
			sedmsg(CurrentQQ,data,j.data.info.text)
		end
	else
	    --è§¦å‘è°ƒæ•™æŒ‡ä»¤
		funic(CurrentQQ,data,mim)
	end
    return 1
end

function ReceiveEvents(CurrentQQ, data, extData)
  if data.MsgType == "ON_EVENT_GROUP_REVOKE" then --ç›‘å¬ ç¾¤æ’¤å›äº‹ä»¶
    --æ’¤å›äº‹ä»¶å¤„ç†
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..extData.GroupID..".txt")
    if (str == nil) then
	    log.info("Str ====> %s", str)
        return 1
	end
	if (string.find(str, "å…³é—­")) then
		return 1
	end
	CheHui(CurrentQQ, data, extData)
	--xxxxxxxxxxxxxxx
    return 1
  end
  --è¿›ç¾¤ç§€å›¾æ¬¢è¿


--é—ªç…§æ£€æµ‹å¤„ç†


--åŠŸèƒ½ç»„
function funic(CurrentQQ,data,msg)
    if string.find(msg, "^ç‚¹æ­Œ") then
	    data.Content = msg
        music(CurrentQQ,data,msg)
		return 1
	elseif string.find(msg, "^è¯­éŸ³") then
	    keyWord = msg:gsub("è¯­éŸ³", "")
        sedvoicemsg(CurrentQQ,data,keyWord)
		return 1
	elseif string.find(msg, "^å›¾ç‰‡") then
	    keyWord = msg:gsub("å›¾ç‰‡", "")
        sedimgmsg(CurrentQQ,data,keyWord,"")
		return 1
    elseif string.find(msg, "^å”±æ­Œ") then
        keyWord = msg:gsub("å”±æ­Œ", "")
		if (keyWord == "") then
		    sedmsg(CurrentQQ,data,"æ­Œåä¸èƒ½ç©ºç€å“¦")
		    return 1
		end
		sedmsg(CurrentQQ,data,"å¤©ä¾æ­£åœ¨åŠªåŠ›åŠ è½½Ù©(ËƒÌ¶Ì€Íˆà¯°Ë‚Ì¶ÌÍˆ)Ùˆ")
        response, error_message =
            http.request(
            "POST",
            "http://127.0.0.1:8888/SilkApi/UrlToBuf",--ä¿®æ”¹æ­¤å¤„ipåŠç«¯å£å³å¯
            {
                body = keyWord --ä¼ å…¥æ­Œæ›²å
            }
        )
        log.notice("err   %v", error_message)
        html = response.body --è¿”å›silk base64 buf
		if (string.find(html, "Î´")) then
				    sedmsg(CurrentQQ,data,"å¤©ä¾æ²¡æœ‰æ‰¾åˆ°ç›¸å…³çš„æ­Œå‘€(Ã’Ï‰Ã“×±)ï¼")
					c.close(c)
				    return 2
				end
        luaRes =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "VoiceMsg",
                groupid = 0,
                content = "",
                atUser = 0,
                voiceUrl = "",
                voiceBase64Buf = html 
            }
        )
		return 1
	end
    sedmsg(CurrentQQ,data,msg)
end

--å½±è§†æœç´¢ç”¨
function Sousuo(CurrentQQ,data,msg)
    response, error_message =
        http.request(
            "GET",
            "http://localhost/index.php/ajax/suggest",
            {
                query = "mid=1&f=admin&wd="..msg.."&limit=10&timestamp=1567914326746"
            }
        )
    html = response.body
	json = json.decode(html)
	if (json.total == 0) then
	    sedmsg(CurrentQQ,data,"å½±è§†æŸ¥è¯¢é”™è¯¯\nè¯·æ£€æŸ¥å½±è§†åæ˜¯å¦æ­£ç¡®\nâ•â•â•â•â•â•â•â•â•â•â•\næ³¨æ„âš ï¸å½±è§†åä¸è¦å¸¦æ— å…³æˆ–å¤šä½™çš„å­—ç¬¦")
	else
        sedmsg(CurrentQQ,data,"èµ„æºåœ°å€å¦‚ä¸‹â†“â†“â†“\nâ•â•â•â•â•â•â•â•â•â•\nhttp://118.25.41.32/index.php/vod/search/wd/"..escape(msg)..".html\nâ•â•â•â•â•â•â•â•â•â•â•\næ³¨æ„:å¦‚æœQQå‡ºç°åœæ­¢è®¿é—®ç°è±¡ï¼Œè¯·å¤åˆ¶é“¾æ¥ç”¨æµè§ˆå™¨æ‰“å¼€")
	end
end

--å•çº¯å‘æ¶ˆæ¯å›¾æ–‡é€šç”¨
function sedimgmsg(CurrentQQ,data,url,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "PicMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = url,
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘æ¶ˆæ¯ç”¨
function sedmsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "TextMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘ç§èŠæ¶ˆæ¯ç”¨
function sendfrimsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromUin,
        sendToType = 1,
        sendMsgType = "TextMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘jsonæ¶ˆæ¯ç”¨
function sedjsonmsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "JsonMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--èŠå¤©æ¨¡å—åˆ‡æ¢å‡½æ•°
function liaotian(CurrentQQ,data,msg)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
    if (mim == nil) then
        sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
        return 1
    end
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
	if (str == nil) then
        return 1
    end
	if (string.find(str, "å…³é—­")) then
	    sedmsg(CurrentQQ,data,"æœºå™¨èŠå¤©å¤„äºå…³é—­çŠ¶æ€\nâˆ´è¯·å…ˆå¼€å¯æœºå™¨èŠå¤©")
	    return 1
	end
	--åˆ‡æ¢å¤„ç†
	file = io.open("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt", "w")
	if (msg == 1) then
	    file:write("æ–‡å­—èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°æ–‡å­—èŠå¤©")
	elseif (msg == 2) then
	    file:write("è¯­éŸ³èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°è¯­éŸ³èŠå¤©")
	elseif (msg == 3) then
	    file:write("å›å¤èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°å›å¤èŠå¤©")
	end
	file:close()
end

--éšæœºè¡¨æƒ…å‡½æ•°
function faceArray()
    faceArray = {"[è¡¨æƒ…147]","ğŸ€","ğŸ”¥","ğŸ»","ğŸ’","[è¡¨æƒ…185]","[è¡¨æƒ…219]","[è¡¨æƒ…176]"}
    math.randomseed(os.time())
    num = math.random(1, 9)
    return faceArray[num]
end

--urlç¼–ç è½¬æ¢
function escape(w)
	pattern="[^%w%d%._%-%* ]"
	s=string.gsub(w,pattern,function(c)
		local c=string.format("%%%02X",string.byte(c))
		return c
	end)
	s=string.gsub(s," ","+")
	return s
end

--è¯»å–æ•°æ®å‡½æ•°
function Read(url)
    file = io.open(url, "r")
	if (file == nil) then
	    return nil
	else
        file:seek("set")
	    str = file:read("*a")
	    file:close()
        return str
	end
end

--å†™å…¥æ•°æ®å‡½æ•°
function Wirte(url,msg)
    file = io.open(url, "w+")
    file:write(msg)
	file:close()
    return "ok"
end

--å°æ€èŠå¤©å‡½æ•°
function xiaosiapi(CurrentQQ,data,str)
    response, error_message =
            http.request(
            "GET",
            "https://api.ownthink.com/bot",
            {
                query = "appid="..tostring(data.FromUserId).."&spoken=" .. url_encode(str),
                headers = {
                    Accept = "*/*"
                }
            }
        )
        html = response.body
		jData = json.decode(html)
		return jData
end

--æœºå™¨èŠå¤©å‡½æ•°
function ownthink(CurrentQQ,data,msgs,atqq)
    if (tostring(atqq) == CurrentQQ) then
        m = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
        if (m == nil) then
	        log.info("Str ====> %s", m)
            return 1
	    end
	    if (string.find(m, "å…³é—­")) then
	        sedmsg(CurrentQQ,data,"æœºå™¨èŠå¤©å¤„äºå…³é—­çŠ¶æ€\nâˆ´è¯·å…ˆå¼€å¯æœºå™¨èŠå¤©")
	        return 1
	    end
		res2 = string.find(msgs, " ")
		str = string.sub(msgs,res2)
		jData = xiaosiapi(CurrentQQ,data,str)
		Data = json.decode(data.Content)
		m = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
		if (m == nil) then
	        log.info("Str ====> %s", m)
            return 1
	    end
		if (string.find(m, "å›å¤èŠå¤©")) then
		    Api.Api_SendMsg(
                CurrentQQ,
                {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "ReplayMsg",
                groupid = 0,
                content = jData.data.info.text,
                atUser = 0,
				replayInfo = {
                    MsgSeq = data.MsgSeq,
                    --å›å¤æ¶ˆæ¯çš„Seq
                    MsgTime = data.MsgTime,
                    --å›å¤æ¶ˆæ¯çš„äº‹ä»¶
                    UserID = data.FromUserId,
                    --å›å¤æ¶ˆæ¯å¯¹è±¡
                    RawContent = Data.Content --å›å¤æ¶ˆæ¯çš„åŸå†…å®¹
                }
				}
            )
			return 1
		elseif (string.find(m, "æ–‡å­—èŠå¤©")) then
		    sedmsg(CurrentQQ,data,jData.data.info.text)
		else
		    sedvoicemsg(CurrentQQ,data,url_encode(jData.data.info.text))
		end
    end
end

--å‘é€è¯­éŸ³æ¶ˆæ¯
function sedvoicemsg(CurrentQQ,data,str)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "VoiceMsg",
        groupid = 0,
		voiceUrl = "https://dds.dui.ai/runtime/v1/synthesize?voiceId=qianranfa&speed=0.7&volume=100&audioType=wav&text="..str, --å‘é€è¯­éŸ³çš„ç½‘ç»œåœ°å€ æ–‡æœ¬å‹
        voiceBase64Buf = "",
        content = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å¤©æ°”æŸ¥è¯¢å‡½æ•°
function tianqi(CurrentQQ,data)
    keyWord = data.Content:gsub("å¤©æ°”", "")
        if keyWord == "" then
            return 1
        end

        cookies = Api.Api_GetUserCook(CurrentQQ)

        response, error_message =
            http.request(
            "GET",
            "https://weather.mp.qq.com/cgi-bin/rich",
            {
                query = "g_tk=" .. cookies.Gtk .. "&city=" .. url_encode(keyWord),
                headers = {
                    Referer = "http://weather.mp.qq.com/ark"
                },
                cookies = {
                    uin = CurrentQQ,
                    skey = cookies.Skey
                }
            }
        )
        local html = response.body
        log.notice("From Lua html -->%s", html)

        local j = json.decode(html)
        if j.code ~= 0 then
            return 1
        end

        ApiRet =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "JsonMsg",
                groupid = 0,
                content = string.format(
                    --{"config":{"forward":1,"autosize":1},"prompt":"[åº”ç”¨]å¤©æ°”","app":"com.tencent.weather","ver":"0.0.0.1","view":"RichInfoView","meta":{"richinfo":{"adcode":"101210701","city":"æˆéƒ½","air":"58","min":"20","ts":"1500550866","wind":"1","date":"6æœˆ27æ—¥ å‘¨å››","max":"28","type":"201"}},"desc":"å¤©æ°”"}
                    --[[{"app":"com.tencent.weather","desc":"","meta":{"weather":{"ad":[{"icon":"http://imgcache.qq.com/ac/tq/xz2/tp.jpg","p":"ptype=star","t":"2","title":"æ˜Ÿåº§ | ä»Šå¤©ä¼šå› ä¸ºæ„Ÿæƒ…å’Œå®¶åº­çš„é—®é¢˜ï¼Œå½±å“å·¥ä½œï¼Œè¿˜æœ‰ï¼Œä¹Ÿè¦æ³¨æ„äºº...","url":""},{"icon":"http://imgcache.qq.com/ac/qqweather/image/2019/6/27.png","p":"ptype=lunar","t":"4","title":"é»„å† | å†œå†äº”æœˆå»¿äº”ã€‚å®œè®¢ç›Ÿ.çº³é‡‡.å‡ºè¡Œ.ç¥ˆç¦.æ–‹é†®.å®‰åºŠ.ä¼š...","url":""}],"info":{"it1":{"adcode":"101050101","city":"æ­¦æ±‰","hour":"18","max":"29","min":"17","temp":"24","type":"202","ut":"1561630401","wea":"å¤šäº‘"},"it2":{"hour":"19","temp":"22","type":"202"},"it3":{"hour":"20","temp":"21","type":"202"},"ts":"1561631244"},"url":""}},"prompt":"ã€å“ˆå°”æ»¨ã€‘å¤šäº‘ 17Â°/29Â°, 18:13æ›´æ–°~","ver":"1.0.0.106","view":"WeatherThreeView"}]]
                    [[{"app":"com.tencent.weather","desc":"å¤©æ°”","view":"RichInfoView","ver":"1.0.0.217","prompt":"[åº”ç”¨]å¤©æ°”","meta":{"richinfo":{"adcode":"%s","air":"%s","city":"%s","date":"%s","max":"%s","min":"%s","ts":"1554951408","type":"%s","wind":"%s"}},"config":{"forward":1,"autosize":1,"type":"card"}}]],
                    j.data.adcode,
                    j.data.air,
                    j.data.city,
                    j.data.date,
                    j.data.max,
                    j.data.min,
                    j.data.type,
                    j.data.wind
                ),
                atUser = 0
            }
        )
end

--è°ƒæ•™å¤„ç†å‡½æ•°(å¾…å¤„ç†)
function tiaojiao(CurrentQQ,data)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
	if (mim == nil) then
		sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå“‡")
		return 1
	end
	if (string.find(data.Content, "^åˆ é™¤è°ƒæ•™")) then
	    msg = data.Content:gsub("åˆ é™¤è°ƒæ•™", "")
	    if (msg == "") then
		    sedmsg(CurrentQQ,data,"è¦åˆ é™¤çš„è°ƒæ•™æŒ‡ä»¤ä¸èƒ½ä¸ºç©ºå“¦")
		    return 1
		end
		rese = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..tostring(data.FromGroupId).."\/"..msg..".txt")
	    if (rese == nil) then
			sedmsg(CurrentQQ,data,"è¿™ä¸ªæŒ‡ä»¤ä¸å­˜åœ¨äº†å“¦")
		    return 1
		end
		rm_file = os.remove("mimoio\/æœºå™¨è°ƒæ•™\/"..tostring(data.FromGroupId).."\/"..msg..".txt")
		log.info("åˆ é™¤è°ƒæ•™ ====> %s", rm_file)
		sedmsg(CurrentQQ,data,"åˆ é™¤æˆåŠŸ\nä½ ä¸å–œæ¬¢è¢«è¿™æ ·è°ƒæ•™çš„æˆ‘å—[è¡¨æƒ…9]")
		return 1
	end
    msgs = data.Content:gsub("è°ƒæ•™", "")
		res2 = string.find(msgs, "#")
		str = string.sub(msgs,res2+1)
		str2 = string.sub(msgs,1,res2-1)
		        
		        if (str == "") then
		            sedmsg(CurrentQQ,data,"è°ƒæ•™çš„å›ç­”å†…å®¹ä¸èƒ½ä¸ºç©ºå“¦")
			        return 1
		        end
				if (str2 == "") then
		            sedmsg(CurrentQQ,data,"è°ƒæ•™çš„æŒ‡ä»¤å†…å®¹ä¸èƒ½ä¸ºç©ºå“¦")
			        return 1
		        end
		        rese = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..str2..".txt")
					if (rese ~= nil) then
				        sedmsg(CurrentQQ,data,"æŒ‡ä»¤å·²ç»å­˜åœ¨äº†å“¦")
				        return 1
				    end
				Wirte("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..str2..".txt",str)
				sedmsg(CurrentQQ,data,"è°ƒæ•™æˆåŠŸ\nä½ è¿˜æƒ³å†è°ƒæ•™æˆ‘ä¸€æ¬¡å—[è¡¨æƒ…6]")
		        return 1
end

function url_encode(str)
    if (str) then
        str = string.gsub(str, "\n", "\r\n")
        str =
            string.gsub(
            str,
            "([^%w ])",
            function(c)
                return string.format("%%%02X", string.byte(c))
            end
        )
        str = string.gsub(str, " ", "+")
    end
    return str
end

--æŠ¢çº¢åŒ…å¤„ç†
function RedBag(CurrentQQ, data)
    Api.Api_OpenRedBag(CurrentQQ, data.RedBaginfo)
    if (data.RedBaginfo.RedType == 12) then
         luaRes =
                Api.Api_SendMsg(
                CurrentQQ,
                {
                    toUser = data.FromGroupId,
                    sendToType = 2,
                    sendMsgType = "TextMsg",
                    groupid = 0,
                    content = data.RedBaginfo.Tittle,
                    atUser = 0
                }
            )
        log.notice("From Lua SendMsg Ret\n%d", luaRes.Ret)
    end
end

--è§†é¢‘è§£æå¤„ç†
function Video(CurrentQQ, data)
    vdata = json.decode(data.Content)
        videodata = {
            GroupID = data.FromGroupId,
            VideoUrl = vdata.VideoUrl,
            VideoMd5 = vdata.VideoMd5
        }
        --æ„é€ table å‚æ•°è¡¨
        luaResp = Api.Api_CallFunc(CurrentQQ, "PttCenterSvr.ShortVideoDownReq", videodata) --é€šè¿‡cmdè°ƒç”¨åŠŸèƒ½åŒ…
        luaRes =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "TextMsg",
                groupid = 0,
                content = "è§£æè§†é¢‘URL-->" .. luaResp.VideoUrl,
                atUser = 0
            }
        )
end

--ç®¡ç†å¼€å…³é€šç”¨
function adminio(CurrentQQ,data,oio)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim ~= nil) then
            msg = data.Content:gsub(oio, "")
            str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
            if (string.find(str, "å…³é—­")) then
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äººå·²è¢«å…³é—­...\nè¯·å…ˆå¼€å¯æœºå™¨äºº")
                return 1
            end
			str2 = Read("mimoio\/çŠ¶æ€æ•°æ®\/"..oio.."\/"..data.FromGroupId..".txt")
			if (string.find(str2, msg)) then
			    sedmsg(CurrentQQ,data,"âˆ´"..oio.."æœ¬å°±æ˜¯"..str2.."çŠ¶æ€")
                return 1
			end
            Wirte("mimoio\/çŠ¶æ€æ•°æ®\/"..oio.."\/"..data.FromGroupId..".txt",msg)
            sedmsg(CurrentQQ,data,"âˆ´"..oio..msg.."æˆåŠŸ")
            return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
end

--ç™¾ç§‘å¤§å…¨
function baike(CurrentQQ,data)
    keyWord = data.Content:gsub("ç™¾ç§‘", "")
        if keyWord == "" then
            return 1
        end
        response, error_message =
            http.request(
            "GET",
            "http://baike.baidu.com/api/openapi/BaikeLemmaCardApi",
            {
                query = "scope=103&format=json&appid=379020&bk_key=" .. url_encode(keyWord) .. "&bk_length=600"
            }
        )
        html = response.body
        while(string.find(html, '"errno":2')) do
            response, error_message =
            http.request(
            "GET",
            "http://baike.baidu.com/api/openapi/BaikeLemmaCardApi",
            {
                query = "scope=103&format=json&appid=379020&bk_key=" .. url_encode(keyWord) .. "&bk_length=600"
            })
			html = response.body
        end
        local j = json.decode(html)
        sedmsg(CurrentQQ,data,j.abstract.."\n"..j.url)
end

--éŸ³ä¹ç‚¹æ­Œ
function music(CurrentQQ,data)
    keyWord = data.Content:gsub("ç‚¹æ­Œ", "")
        if keyWord == "" then
            return 1
        end
        response, error_message =
            http.request(
            "GET",
            "https://c.y.qq.com/soso/fcgi-bin/client_search_cp",
            {
                query = "aggr=1&cr=1&flag_qc=0&p=1&n=6&w=" .. url_encode(keyWord)
            }
        )
        html = response.body
		str = string.sub(html,10,-2)
        j = json.decode(str)
        if (j.code == 0) then
            msg = ""
            num = j.data.song.list
            list = num[1]
            songname = list.songname
            singername = list.singer[1].name
            payplay = list.pay.payplay
			albummid = list.albummid
			songmid = list.songmid
	        sedjsonmsg(CurrentQQ,data,'{"app":"com.tencent.structmsg","desc":"éŸ³ä¹","view":"music","ver":"0.0.0.1","prompt":"[åˆ†äº«]' ..songname.. '","meta":{"music":{"sourceMsgId":"0","title":"' ..songname.. '","desc":"' ..singername.. '","preview":"y.gtimg.cn/music/photo_new/T002R150x150M000'..albummid..'.jpg","tag":"QQéŸ³ä¹","musicUrl":"https://v1.itooi.cn/tencent/url?id='..songmid..'","jumpUrl":"y.qq.com/n/yqq/song/'..songmid..'.html","appid":100497308,"app_type":1,"action":"","source_url":"url.cn/5aSZ8Gc","source_icon":"url.cn/5tLgzTm","android_pkg_name":"com.tencent.qqmusic"}},"config":{"forward":true,"type":"normal","autosize":true}}')
			return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´Error:"..j.code)
			return 1
        end
end

--è®¿é—®url
function geturl(url_class,url,caulrt)
        response, error_message =
            http.request(
            url_class,
            url,
            {
                query = caulrt
            }
        )
        html = response.body
		return html
end

--æ¶ˆæ¯å‚¨è“„
function msgsql(CurrentQQ,data)
    if (mysqlpass == "") then
	    return 1
	end
    c = mysql.new()
    -- åˆå§‹åŒ–mysqlå¯¹è±¡
    ok, err = c:connect({host = mysqlhost, port = 3306, database = mysqldb, user = mysqluser, password = mysqlpass})
    --å»ºç«‹è¿æ¥
    if ok then
        sqlstr =
            string.format(
            [[INSERT INTO msgcache (GroupID, MsgSeq, MsgRandom,MsgType,Data,MsgTime)VALUES (%d,%d,%d,'%s','%s',%d)]],
            data.FromGroupId,
            data.MsgSeq,
            data.MsgRandom,
            data.MsgType,
            data.Content,
            data.MsgTime
        )
        res, err = c:query(sqlstr) --å…¥åº“ç¼“å­˜æ¶ˆæ¯
        log.info("%s", err)
        c.close(c)
    --é‡Šæ”¾è¿æ¥
    end
    return 1
end

--æ’¤å›æ£€æµ‹
function CheHui(CurrentQQ, data, extData)
    c = mysql.new()
    -- åˆå§‹åŒ–mysqlå¯¹è±¡
	if (mysqlpass == "") then
	    return 1
	end
	
    if data.MsgType == "ON_EVENT_GROUP_REVOKE" then --ç›‘å¬ ç¾¤æ’¤å›äº‹ä»¶
        str = string.format("ç¾¤æˆ %d  æˆå‘˜ UserID %s æ’¤å›äº†æ¶ˆæ¯Seq %s \n", extData.GroupID, extData.UserID, extData.MsgSeq)
        log.info("%s", str)
        ok, err = c:connect({host = mysqlhost, port = 3306, database = mysqldb, user = mysqluser, password = mysqlpass})
        --å»ºç«‹è¿æ¥
        log.info("sql %v", err)
        if ok then
            sqlstr =
                string.format(
                "select * from msgcache where `GroupID`= %d and `MsgSeq` = %d",
                extData.GroupID,
                extData.MsgSeq
            )
            res, err = c:query(sqlstr) --è·Ÿç¾¤ç¾¤idå’Œæ¶ˆæ¯SEQæŸ¥è¯¢å‡ºæ’¤å›çš„æ¶ˆæ¯å†…å®¹
            if err == nil then
                c.close(c)
                GroupID = tonumber(res[1]["GroupID"])
                MsgType = res[1]["MsgType"]
                Data = res[1]["Data"]

                if MsgType == "TextMsg" then
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            --å‘é€æ–‡æœ¬æ¶ˆæ¯
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡æ–‡æœ¬æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                Data
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "SmallFaceMsg" then
                    --Data {"Content":"[è¡¨æƒ…101]","Hex":"FKY=","Index":101,"tips":"[å°è¡¨æƒ…]"}
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡è¡¨æƒ…æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).Content
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "PicMsg" then
                    --Data {"Content":"","FileId":2820717626,"FileMd5":"q0oEC5aloJJMFr10mplaXw==","FileSize":7026,"tips":"[ç¾¤å›¾ç‰‡]","url":"http://gchat.qpic.cn/gchatpic_new/1700487478/960839480-2534335053-AB4A040B96A5A0924C16BD749A995A5F/0?vuin=u0026term=255u0026pictype=0"}
                    jData = json.decode(Data)
					if (jData.tips == "[ç¾¤æ¶ˆæ¯-QQé—ªç…§]") then
					    
					Api.Api_SendMsg( 
                    CurrentQQ,
                    {
                        toUser = GroupID,
                        sendToType = 2,
                        sendMsgType = "ForwordMsg",
                        content = "",
                        atUser = 0,
                        groupid = 0,
                        voiceUrl = "",
                        voiceBase64Buf = "",
                        picUrl = "",
                        picBase64Buf = "",
                        forwordBuf = json.decode(Data).ForwordBuf, --æ¬²è½¬å‘çš„base64buf å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                        forwordField = json.decode(Data).ForwordField --æ¬²å†™å…¥åè®®çš„å­—æ®µID å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                    }
                )
				    return 1
					end
                    Api.Api_SendMsg( --é€šè¿‡å›¾ç‰‡md5å‘é€å›¾ç‰‡ ç§’å‘ä¸ç”¨ä¸Šä¼  ç›¸å½“äºè½¬å‘
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "PicMsg",
                            --å‘é€å›¾æ–‡æ¶ˆæ¯
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡å›¾ç‰‡æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š[PICFLAG]%s",
                                extData.UserID,
                                jData.Content
                            ),
                            --é€šè¿‡å®[PICFLAG]æ”¹å˜å›¾æ–‡é¡ºåº  æ”¹ä¸ºç°æ–‡å­—åå›¾ç‰‡
                            atUser = 0,
                            voiceUrl = "",
                            voiceBase64Buf = "",
                            picUrl = "",
                            picBase64Buf = "",
                            fileMd5 = jData.FileMd5
                        }
                    )
                end
                if MsgType == "AtMsg" then
                    --Data {"Content":"@Kar98k skjjkssjkjs","UserID":123456789,"tips":"[ATæ¶ˆæ¯]"}
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡atæ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).Content
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "VoiceMsg" then
                    --Data {"tips":"[è¯­éŸ³]","url":"http://grouptalk.c2c.qq.com/?ver=0u0026rkey=3062020101045b305902010102010102041fdef8ae042439416931554e5142586c536d78706a314c686843664959725f327a5f573064697653755902045dac2a21041f0000000866696c6574797065000000013100000005636f64656300000001310400u0026filetype=1u0026voice_codec=1"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "VoiceMsg",
                            --å‘é€ç¾¤è¯­éŸ³æ¶ˆæ¯
                            groupid = 0,
                            content = "",
                            atUser = 0,
                            voiceUrl = json.decode(Data).url,
                            --é€šè¿‡ç½‘ç»œurlè¿›è¡Œå‘é€è¯­éŸ³
                            voiceBase64Buf = "",
                            picUrl = "",
                            picBase64Buf = ""
                        }
                    )
                end

                if MsgType == "ReplayMsg" then
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡å›å¤æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).ReplayContent
                            ),
                            atUser = 0
                        }
                    )
                end
				if MsgType == "VideoMsg" then
	             Api.Api_SendMsg( 
                    CurrentQQ,
                    {
                        toUser = GroupID,
                        sendToType = 2,
                        sendMsgType = "ForwordMsg",
                        content = "",
                        atUser = 0,
                        groupid = 0,
                        voiceUrl = "",
                        voiceBase64Buf = "",
                        picUrl = "",
                        picBase64Buf = "",
                        forwordBuf = json.decode(Data).ForwordBuf, --æ¬²è½¬å‘çš„base64buf å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                        forwordField = json.decode(Data).ForwordField --æ¬²å†™å…¥åè®®çš„å­—æ®µID å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                    }
                )
				end
                if MsgType == "XmlMsg" then
				    
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "XmlMsg",
                            groupid = 0,
                            content = string.format("%s", Data),
                            atUser = 0
                        }
                    )
                end
				if MsgType == "JsonMsg" then
				    
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "JsonMsg",
                            groupid = 0,
                            content = string.format("%s", Data),
                            atUser = 0
                        }
                    )
                end
            end
        end
    end
    return 1
end
2020/09/07 11:54:58.430 [E]  mimoio.lua
2020/09/07 11:54:58.440 [E]  local log = require("log")
local Api = require("coreApi")
local json = require("json")
local http = require("http")
local mysql = require("mysql")

--ç‰ˆæœ¬å·(ä¸è¦æ”¹åŠ¨)
Vabr = "1.0.2"
--æ•°æ®åº“é…ç½®
mysqlhost = "localhost"--é»˜è®¤ä¸åŠ¨
mysqldb = "ffaxx001"--æ•°æ®åº“å
mysqluser = "ffaxx001"--æ•°æ®åº“ç”¨æˆ·å
mysqlpass = "123456"--æ•°æ®åº“å¯†ç 
--ä¸ä½¿ç”¨è¯·ä¸è¦æ”¹åŠ¨

function ReceiveFriendMsg(CurrentQQ, data)
    if (data.Content == "ä½¿ç”¨æ–¹æ³•") then
	    sendfrimsg(CurrentQQ,data,"æ·»åŠ æˆæƒè€…çš„æ–¹æ³•\nå¯¹å•ä¸ªæœºå™¨äººç§èŠå‘é€[æ·»åŠ æˆæƒè€…+æˆæƒè€…QQ]\n\næˆæƒç¾¤çš„æ–¹æ³•\nåˆ°éœ€è¦æˆæƒçš„ç¾¤é‡Œå‘é€[æˆæƒ+ä¸»äººQQ]ã€‚æ³¨æ„:æˆæƒå¿…é¡»æ˜¯æˆæƒè€…è¿›è¡Œæ“ä½œ,ç®¡ç†å‘˜æˆæƒä¸äº†")
	end
    --æ•°æ®åˆå§‹åŒ–
    if (data.Content == "åˆå§‹åŒ–") then
	    root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root ~= nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´è¯·ä¸è¦é‡å¤åˆå§‹åŒ–")
			return 1
		end
    --os.execute('mkdir mimoio/æœºå™¨æˆæƒ')
	    os.execute('mkdir mimoio')
		os.execute('mkdir mimoio/å¤è¯»æœº')
		os.execute('mkdir mimoio/å¤è¯»æœº/æ¬¡æ•°')
		os.execute('mkdir mimoio/å¤è¯»æœº/å†…å®¹')
		os.execute('mkdir mimoio/æœºå™¨æˆæƒ')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨ä¸»äºº')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨èŠå¤©')
		os.execute('mkdir mimoio/æœºå™¨è°ƒæ•™')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æŠ¢çº¢åŒ…')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æœºå™¨èŠå¤©')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æœºå™¨å¼€å…³')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æ’¤å›æ£€æµ‹')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/å›¾ç‰‡è§£æ')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/è§†é¢‘è§£æ')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/é—ªç…§æ£€æµ‹')
		Wirte("mimoio\/"..data.FromUin..".txt","999")
		sendfrimsg(CurrentQQ,data,"åˆå§‹åŒ–å®Œæ¯•ï¼\nå‘é€[ä½¿ç”¨æ–¹æ³•]äº†è§£ä½¿ç”¨å§")
	end
	--æ·»åŠ æˆæƒè€…æ“ä½œ(ç§èŠæœºå™¨äººå‘é€)
	if (string.find(data.Content, "^æ·»åŠ æˆæƒè€…")) then
	    msg = data.Content:gsub("æ·»åŠ æˆæƒè€…", "")
		--Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromUin..".txt","å…³é—­")
		root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root == nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„ç®¡ç†è€…")
			return 1
		end
		Wirte("mimoio\/æœºå™¨æˆæƒ\/"..msg..CurrentQQ..".txt","999")
		sendfrimsg(CurrentQQ,data,"âˆ´æ·»åŠ æˆæƒè€…æˆåŠŸ")
	end
	--åˆ é™¤æˆæƒè€…æ“ä½œ(ç§èŠæœºå™¨äººå‘é€)
	if (string.find(data.Content, "^åˆ é™¤æˆæƒè€…")) then
	    msg = data.Content:gsub("åˆ é™¤æˆæƒè€…", "")
		--Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromUin..".txt","å…³é—­")
		root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root == nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„ç®¡ç†è€…")
			return 1
		end
		os.remove("mimoio\/æœºå™¨æˆæƒ\/"..msg..CurrentQQ..".txt")
		sendfrimsg(CurrentQQ,data,"âˆ´åˆ é™¤æˆæƒè€…æˆåŠŸ")
	end
    return 1
end
function ReceiveGroupMsg(CurrentQQ, data)
    if (tostring(data.FromUserId) == CurrentQQ) then
	    return 1
	end
	--ç¾¤èŠæˆæƒ(åˆ°éœ€è¦æˆæƒçš„ç¾¤é‡Œæ“ä½œ)
	if (string.find(data.Content, "^æˆæƒ")) then
	    root = Read("mimoio\/æœºå™¨æˆæƒ\/"..data.FromUserId..CurrentQQ..".txt","999")
		if (root == nil) then
		    sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„æˆæƒè€…")
			return 1
		end
		msg = data.Content:gsub("æˆæƒ", "")
		os.execute('mkdir mimoio/æœºå™¨è°ƒæ•™/'..data.FromGroupId)
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨ä¸»äºº/'..data.FromGroupId)
		Wirte("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..msg..".txt","999")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt","å›å¤èŠå¤©")
		sedmsg(CurrentQQ,data,"âˆ´æˆæƒæˆåŠŸï¼\nå‘é€[å¼€å¯æœºå™¨äºº]ä½¿ç”¨å§")
	end
	--åˆ é™¤æˆæƒæ“ä½œ(åˆ°éœ€è¦åˆ é™¤æˆæƒçš„ç¾¤é‡Œæ“ä½œ)
	if (string.find(data.Content, "^åˆ é™¤æˆæƒ")) then
	    root = Read("mimoio\/æœºå™¨æˆæƒ\/"..data.FromUserId..CurrentQQ..".txt","999")
		if (root == nil) then
		    sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„æˆæƒè€…")
			return 1
		end
		msg = data.Content:gsub("åˆ é™¤æˆæƒ", "")
		os.remove("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..msg..".txt")
		os.remove("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
		sedmsg(CurrentQQ,data,"âˆ´åˆ é™¤æˆæƒæˆåŠŸï¼")
	end
	--æœºå™¨å¼€å…³æŒ‡ä»¤
	if (data.Content == "å¼€å¯æœºå™¨äºº" or data.Content == "å…³é—­æœºå™¨äºº") then
        mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim ~= nil) then
            msg = data.Content:gsub("æœºå™¨äºº", "")
            str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
			if (str == nil) then
			    Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt",msg)
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äºº"..msg.."æˆåŠŸï¼")
				log.info("Str ====> %s", str)
                return 1
			end
			
            if (string.find(str, msg)) then
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äººä¸€ç›´æ˜¯"..msg.."çš„å‘")
                return 1
            end
            Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt",msg)
            sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äºº"..msg.."æˆåŠŸï¼")
            return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
	end
    --æœºå™¨äººå¼€å¯æ£€æµ‹
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
	if (str == nil) then
	    log.info("Str ====> %s", str)
        return 1
	end
	if (string.find(str, "å…³é—­")) then
	    return 1
	end
	--atæ¶ˆæ¯å¤„ç†
	msgs = ""
	atqq = 0
	if (string.find(data.Content, "ATæ¶ˆæ¯")) then
	    msgs = json.decode(data.Content).Content
		atqq = json.decode(data.Content).UserID
	end
	--å°¾å·´è‡ªå®šä¹‰(å¾…å®Œå–„)
	tips = "â€”â€”å‡¤é£ç¿±ç¿”å…®ä¸·"
    --åŠŸèƒ½æ¨¡å—
    if (data.Content == "åŠŸèƒ½" or data.Content == "ä¸»ç•Œé¢") then
        face = faceArray()
        sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."å½±è§†æœç´¢\n"..face.."èŠå¤©å¨±ä¹\n"..face.."ä¾¿åˆ©åŠŸèƒ½\n"..face.."æœºå™¨è°ƒæ•™\n"..face.."ç®¡ç†ç³»ç»Ÿ\n"..face.."bugåé¦ˆ\n"..face.."æœ¬ç¾¤çŠ¶æ€\n"..face.."æ›´æ–°æ£€æµ‹\n\n"..tips)
    end
    --å½±è§†æœç´¢æ¨¡å—
    if (data.Content == "å½±è§†æœç´¢") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."æœç´¢+å½±è§†å\n"..face.."æˆ‘æƒ³çœ‹+å½±è§†å\n"..face.."æˆ‘è¦çœ‹+å½±è§†å\n\n"..tips)
    elseif (string.find(data.Content, "^æœç´¢")) then
	    msg = data.Content:gsub("æœç´¢", "")
		Sousuo(CurrentQQ,data,msg)
	elseif (string.find(data.Content, "^æˆ‘æƒ³çœ‹")) then
	    msg = data.Content:gsub("æˆ‘æƒ³çœ‹", "")
		Sousuo(CurrentQQ,data,msg)
    elseif (string.find(data.Content, "^æˆ‘è¦çœ‹")) then
	    msg = data.Content:gsub("æˆ‘è¦çœ‹", "")
		Sousuo(CurrentQQ,data,msg)
	end
	--èŠå¤©å¨±ä¹æ¨¡å—
	if (data.Content == "èŠå¤©å¨±ä¹") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."åˆ‡æ¢æ–‡å­—èŠå¤©\n"..face.."åˆ‡æ¢å›å¤èŠå¤©\n"..face.."åˆ‡æ¢è¯­éŸ³èŠå¤©\n\n"..tips)
    elseif (data.Content == "åˆ‡æ¢æ–‡å­—èŠå¤©") then
		liaotian(CurrentQQ,data,1)
	elseif (data.Content == "åˆ‡æ¢è¯­éŸ³èŠå¤©") then
	    liaotian(CurrentQQ,data,2)
    elseif (data.Content == "åˆ‡æ¢å›å¤èŠå¤©") then
	    liaotian(CurrentQQ,data,3)
	else
	    ownthink(CurrentQQ,data,msgs,atqq)
	end
	--ä¾¿åˆ©åŠŸèƒ½æ¨¡å—
	if (data.Content == "ä¾¿åˆ©åŠŸèƒ½") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."ç™¾ç§‘å¤§å…¨\n"..face.."éŸ³ä¹ç‚¹æ­Œ\n"..face.."é—ªä»–@xx\n"..face.."å¤©æ°”æŸ¥è¯¢\n\n"..tips)
	elseif (data.Content == "ç™¾ç§‘å¤§å…¨") then
		sedmsg(CurrentQQ,data,"å‘é€:[ç™¾ç§‘+å…³é”®è¯]\nä¾‹å¦‚:ç™¾ç§‘æ´›å¤©ä¾")
    elseif (data.Content == "éŸ³ä¹ç‚¹æ­Œ") then
		sedmsg(CurrentQQ,data,"å‘é€:[ç‚¹æ­Œ+æ­Œå]\nä¾‹å¦‚:ç‚¹æ­Œé’æŸ ")
	elseif (data.Content == "å¤©æ°”æŸ¥è¯¢") then
		sedmsg(CurrentQQ,data,"å‘é€:[å¤©æ°”+åœ°æ–¹å]\nä¾‹å¦‚:å¤©æ°”åŒ—äº¬(é™äºå›½å†…)")
    elseif (string.find(data.Content, "^å¤©æ°”")) then
        tianqi(CurrentQQ,data)
	    --msg = data.Content:gsub("æœç´¢", "")
		--Sousuo(CurrentQQ,data,msg)
	elseif (string.find(data.Content, "^ç™¾ç§‘")) then
	    baike(CurrentQQ,data)
	    --msg = data.Content:gsub("æˆ‘æƒ³çœ‹", "")
		--Sousuo(CurrentQQ,data,msg)music(CurrentQQ,data)
    elseif (string.find(data.Content, "^ç‚¹æ­Œ")) then
	    music(CurrentQQ,data)
	end
	--æœºå™¨è°ƒæ•™æ¨¡å—
	if (data.Content == "æœºå™¨è°ƒæ•™") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."æ–‡å­—è°ƒæ•™\n"..face.."è¯­éŸ³è°ƒæ•™\n"..face.."å”±æ­Œè°ƒæ•™\n"..face.."éŸ³ä¹è°ƒæ•™\n"..face.."å›¾ç‰‡è°ƒæ•™\n"..face.."åˆ é™¤è°ƒæ•™\n\n"..tips)
    elseif (data.Content == "æ–‡å­—è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#(å†…å®¹)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#ä½ å¥½å•Š")
	elseif (data.Content == "è¯­éŸ³è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#è¯­éŸ³(å†…å®¹)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#è¯­éŸ³ä½ å¥½å•Š")
	elseif (data.Content == "å›¾ç‰‡è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#å›¾ç‰‡(é“¾æ¥)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#å›¾ç‰‡http://../1.jpg")
	elseif (data.Content == "éŸ³ä¹è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#ç‚¹æ­Œ(æ­Œå)]\nä¾‹å¦‚:è°ƒæ•™å–µ#ç‚¹æ­Œå­¦çŒ«å«")
	elseif (data.Content == "å”±æ­Œè°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#å”±æ­Œ(æ­Œå)]\nä¾‹å¦‚:è°ƒæ•™å–µ#å”±æ­Œå­¦çŒ«å«")
	elseif (data.Content == "åˆ é™¤è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[åˆ é™¤è°ƒæ•™(æŒ‡ä»¤)]\nä¾‹å¦‚:åˆ é™¤è°ƒæ•™ä½ å¥½")
	elseif (string.find(data.Content, "^è°ƒæ•™")) then
        tiaojiao(CurrentQQ,data)
	elseif (string.find(data.Content, "^åˆ é™¤è°ƒæ•™")) then
        tiaojiao(CurrentQQ,data)
	end
	--ç®¡ç†ç³»ç»Ÿæ¨¡å—
	if (data.Content == "ç®¡ç†ç³»ç»Ÿ") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."å¼€å¯/å…³é—­æœºå™¨äºº\n"..face.."å¼€å¯/å…³é—­æŠ¢çº¢åŒ…\n"..face.."å¼€å¯/å…³é—­æœºå™¨èŠå¤©\n"..face.."å¼€å¯/å…³é—­é—ªç…§æ£€æµ‹\n"..face.."å¼€å¯/å…³é—­å›¾ç‰‡è§£æ\n"..face.."å¼€å¯/å…³é—­è§†é¢‘è§£æ\n"..face.."å¼€å¯/å…³é—­æ’¤å›æ£€æµ‹\n\n"..tips)
    elseif (data.Content == "å¼€å¯æœºå™¨èŠå¤©" or data.Content == "å…³é—­æœºå™¨èŠå¤©") then
        adminio(CurrentQQ,data,"æœºå™¨èŠå¤©")
    elseif (data.Content == "å¼€å¯æ’¤å›æ£€æµ‹" or data.Content == "å…³é—­æ’¤å›æ£€æµ‹") then
        adminio(CurrentQQ,data,"æ’¤å›æ£€æµ‹")
	elseif (data.Content == "å¼€å¯é—ªç…§æ£€æµ‹" or data.Content == "å…³é—­é—ªç…§æ£€æµ‹") then
        adminio(CurrentQQ,data,"é—ªç…§æ£€æµ‹")
	elseif (data.Content == "å¼€å¯æŠ¢çº¢åŒ…" or data.Content == "å…³é—­æŠ¢çº¢åŒ…") then
        adminio(CurrentQQ,data,"æŠ¢çº¢åŒ…")
	elseif (data.Content == "å¼€å¯è§†é¢‘è§£æ" or data.Content == "å…³é—­è§†é¢‘è§£æ") then
        adminio(CurrentQQ,data,"è§†é¢‘è§£æ")
	elseif (data.Content == "å¼€å¯å›¾ç‰‡è§£æ" or data.Content == "å…³é—­å›¾ç‰‡è§£æ") then
        adminio(CurrentQQ,data,"å›¾ç‰‡è§£æ")
	end
	--bugåé¦ˆæ¨¡å—
	if (data.Content == "BUGåé¦ˆ" or data.Content == "bugåé¦ˆ") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."é‚®ä»¶åé¦ˆ\n"..face.."QQåé¦ˆ\n\n"..tips)
    elseif (data.Content == "QQåé¦ˆ") then
        sedmsg(CurrentQQ,data,"???Î£(ï¾Ÿâˆ€ï¾Ÿï¾‰)ï¾‰\næ’ä»¶æœ‰é—®é¢˜å¯ä»¥åé¦ˆåˆ°:\nQQ:2353065854")
    elseif (data.Content == "é‚®ä»¶åé¦ˆ") then
        sedmsg(CurrentQQ,data,"å®è´å’‹å•¦=ÍÍŸÍŸÍ(ê’ªá—œê’ª â€§Ì£Ì¥Ì‡)\næ’ä»¶æœ‰é—®é¢˜å¯ä»¥åé¦ˆåˆ°:\né‚®ç®±ğŸ“¬:ym-o@qq.com")
	end
	--æœ¬ç¾¤çŠ¶æ€æ¨¡æ¿
	if (data.Content == "æœ¬ç¾¤çŠ¶æ€") then
        face = faceArray()
        hb = Read("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt")
        sz = Read("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt")
		tp = Read("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt")
        sp = Read("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt")
        jqr = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
        lt = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
        ch = Read("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..data.FromGroupId..".txt")
		sedmsg(CurrentQQ,data,"çŠ¶æ€æ•°æ®åˆ—è¡¨â†“â†“â†“\n"..face.."æœºå™¨äºº:"..jqr.."\n"..face.."æŠ¢çº¢åŒ…:"..hb.."\n"..face.."å›¾ç‰‡è§£æ:"..tp.."\n"..face.."æ’¤å›æ£€æµ‹:"..ch.."\n"..face.."è§†é¢‘è§£æ:"..sp.."\n"..face.."æœºå™¨èŠå¤©:"..lt.."\n"..face.."é—ªç…§æ£€æµ‹:"..sz.."\n\n"..tips)
	end
	--æ›´æ–°æ¨¡å—
	if (data.Content == "æ›´æ–°æ£€æµ‹") then
        str = geturl("GET","http://118.25.41.32/Lsb/lua/Vabr.txt","")
		log.info("Str ====> %s", str)
        if (string.find(str, Vabr)) then
            sedmsg(CurrentQQ,data,"å½“å‰ç‰ˆæœ¬ä¸ºæœ€æ–°ç‰ˆ")
        else
            sedmsg(CurrentQQ,data,"å‘ç°æ–°ç‰ˆæœ¬!\nå½“å‰ç‰ˆæœ¬:"..Vabr.."\næ–°ç‰ˆæœ¬å·:"..str.."\nèµ¶å¿«å‘é€[æ›´æ–°æ’ä»¶]å§")
        end
	elseif (data.Content == "æ›´æ–°æ’ä»¶") then
	    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim == nil) then
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
        str = geturl("GET","http://118.25.41.32/Lsb/lua/Vabr.txt","")
		log.info("Str ====> %s", str)
        if (string.find(str, Vabr)) then
            sedmsg(CurrentQQ,data,"å½“å‰ç‰ˆæœ¬ä¸ºæœ€æ–°ç‰ˆ")
        else
            str = geturl("GET","http://118.25.41.32/Lsb/lua/mimoio.txt","")
            Wirte("Plugins\/mimoio.lua",str)
            sedmsg(CurrentQQ,data,"æ›´æ–°å®Œæ¯•ï¼")
        end
	end
	--å›¾ç‰‡ç±»å‹æ¶ˆæ¯å¤„ç†
    if (data.MsgType == "PicMsg") then
	    msg = Read("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt")
		jData = json.decode(data.Content)
	    if (msg ~= nil and jData.tips ~= "[ç¾¤æ¶ˆæ¯-QQé—ªç…§]") then
            if (string.find(str, "å¼€å¯")) then
	            sedmsg(CurrentQQ,data,"å›¾ç‰‡é“¾æ¥è§£æå¦‚ä¸‹â†“â†“\n"..jData.url)
				return 1
	        end
	    end
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt")
	    if (str == nil) then
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    --é—ªç…§ã€å›¾ç‰‡å¤„ç†æ¨¡å—
		PicFlag(CurrentQQ, data)
    end
	--æŠ¢çº¢åŒ…å¤„ç†
	if (string.find(data.MsgType, "RedBagMsg") == 1) then
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt")
		if (str == nil) then
	        log.info("Str ====> %s", str)
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    RedBag(CurrentQQ, data)
	end
	--è§†é¢‘è§£æå¤„ç†
	if (string.find(data.MsgType, "VideoMsg") == 1) then
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt")
		if (str == nil) then
	        log.info("Str ====> %s", str)
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    Video(CurrentQQ, data)
	end
	--até—ªå›¾
	if (data.MsgType == "AtMsg") and (string.find(data.Content, "é—ªä»–")) then
	    shantu(CurrentQQ, data)
    end
	--è°ƒæ•™æœç´¢å¼•æ“
	mim = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..data.Content..".txt")
	if (mim == nil) then
	    --äººç±»çš„æœ¬è´¨æ˜¯å¤è¯»æœº
	    msg = Read("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt")
		if (msg ~= nil) then
		    cs = Read("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt")
			ii = tonumber(cs)
			if (string.find(msg, "^"..data.Content.."$")) then
			    if (ii > 2) then
			         math.randomseed(os.time())
                     sj = math.random(1, 5)
		             if (sj == 1 or sj == 2) then
			             sedmsg(CurrentQQ,data,msg)
					     rr = ii + 1
		                 Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
				     elseif (sj == 3) then
				         os.remove("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt")
					     os.remove("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt")
					     fdArray = {"çªç„¶æˆªæ–­å¤è¯»(ï¾ŸâŠ¿ï¾Ÿ)ï¾‚","å¤è¯»å¯è€»(â€¢Ì€ã¸ â€¢Ì â•® )","ä¸è¦å¤è¯»äº†å•¦","è¿™å°±æ˜¯æ‰€è°“çš„äººç±»çš„æœ¬è´¨","ä½ ä»¬å’‹ä¸ä¸Šå¤©å‘","åˆå¤è¯»ä¸Šç˜¾äº†å•Š"}
                         math.randomseed(os.time())
                         fdsj = math.random(1, 6)
				         sedmsg(CurrentQQ,data,fdArray[fdsj])
				     else
			             rr = ii + 1
		                 Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
		             end
			    else
			        rr = ii + 1
		            Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
			    end
			else
			    if (ii > 2) then
			        math.randomseed(os.time())
                    sj2 = math.random(1, 3)
					if (sj2 == 2) then
					    fdArray2 = {"ä¸­æ–­å¤è¯»å¯è€»","æ‰“æ–­å¤è¯»å¯è€»(â€¢Ì€ã¸ â€¢Ì â•® )","ä½ ä¸ºä»€ä¹ˆè¦æ‰“æ–­å¤è¯»å•Š","å¤è¯»ä¸é¦™å˜›","ç ´åæ°›å›´(à¸‡áµ’ÌŒçš¿áµ’ÌŒ)à¸‡â¼Â³â‚Œâ‚ƒ"}
                        math.randomseed(os.time())
                        fdsj2 = math.random(1, 5)
				        sedmsg(CurrentQQ,data,fdArray2[fdsj2])
					end
				end
				Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt","1")
			    Wirte("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt",data.Content)
			end
		else
		    Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt","1")
			Wirte("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt",data.Content)
		end
	    --å¦‚æœè°ƒæ•™æŒ‡ä»¤ä¸å­˜åœ¨ï¼Œåˆ™è¿›è¡Œå…¶ä»–æ“ä½œ
	    msgsql(CurrentQQ,data)--æ•°æ®å‚¨è“„
		--éšæœºå›å¤æ¶ˆæ¯æ¦‚ç‡0.04
	    math.randomseed(os.time())
        num = math.random(1, 40)
		if (num == 12) then
		    j = xiaosiapi(CurrentQQ,data,data.Content)
			sedmsg(CurrentQQ,data,j.data.info.text)
		end
	else
	    --è§¦å‘è°ƒæ•™æŒ‡ä»¤
		funic(CurrentQQ,data,mim)
	end
    return 1
end

function ReceiveEvents(CurrentQQ, data, extData)
  if data.MsgType == "ON_EVENT_GROUP_REVOKE" then --ç›‘å¬ ç¾¤æ’¤å›äº‹ä»¶
    --æ’¤å›äº‹ä»¶å¤„ç†
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..extData.GroupID..".txt")
    if (str == nil) then
	    log.info("Str ====> %s", str)
        return 1
	end
	if (string.find(str, "å…³é—­")) then
		return 1
	end
	CheHui(CurrentQQ, data, extData)
	--xxxxxxxxxxxxxxx
    return 1
  end
  --è¿›ç¾¤ç§€å›¾æ¬¢è¿


--é—ªç…§æ£€æµ‹å¤„ç†


--åŠŸèƒ½ç»„
function funic(CurrentQQ,data,msg)
    if string.find(msg, "^ç‚¹æ­Œ") then
	    data.Content = msg
        music(CurrentQQ,data,msg)
		return 1
	elseif string.find(msg, "^è¯­éŸ³") then
	    keyWord = msg:gsub("è¯­éŸ³", "")
        sedvoicemsg(CurrentQQ,data,keyWord)
		return 1
	elseif string.find(msg, "^å›¾ç‰‡") then
	    keyWord = msg:gsub("å›¾ç‰‡", "")
        sedimgmsg(CurrentQQ,data,keyWord,"")
		return 1
    elseif string.find(msg, "^å”±æ­Œ") then
        keyWord = msg:gsub("å”±æ­Œ", "")
		if (keyWord == "") then
		    sedmsg(CurrentQQ,data,"æ­Œåä¸èƒ½ç©ºç€å“¦")
		    return 1
		end
		sedmsg(CurrentQQ,data,"å¤©ä¾æ­£åœ¨åŠªåŠ›åŠ è½½Ù©(ËƒÌ¶Ì€Íˆà¯°Ë‚Ì¶ÌÍˆ)Ùˆ")
        response, error_message =
            http.request(
            "POST",
            "http://127.0.0.1:8888/SilkApi/UrlToBuf",--ä¿®æ”¹æ­¤å¤„ipåŠç«¯å£å³å¯
            {
                body = keyWord --ä¼ å…¥æ­Œæ›²å
            }
        )
        log.notice("err   %v", error_message)
        html = response.body --è¿”å›silk base64 buf
		if (string.find(html, "Î´")) then
				    sedmsg(CurrentQQ,data,"å¤©ä¾æ²¡æœ‰æ‰¾åˆ°ç›¸å…³çš„æ­Œå‘€(Ã’Ï‰Ã“×±)ï¼")
					c.close(c)
				    return 2
				end
        luaRes =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "VoiceMsg",
                groupid = 0,
                content = "",
                atUser = 0,
                voiceUrl = "",
                voiceBase64Buf = html 
            }
        )
		return 1
	end
    sedmsg(CurrentQQ,data,msg)
end

--å½±è§†æœç´¢ç”¨
function Sousuo(CurrentQQ,data,msg)
    response, error_message =
        http.request(
            "GET",
            "http://localhost/index.php/ajax/suggest",
            {
                query = "mid=1&f=admin&wd="..msg.."&limit=10&timestamp=1567914326746"
            }
        )
    html = response.body
	json = json.decode(html)
	if (json.total == 0) then
	    sedmsg(CurrentQQ,data,"å½±è§†æŸ¥è¯¢é”™è¯¯\nè¯·æ£€æŸ¥å½±è§†åæ˜¯å¦æ­£ç¡®\nâ•â•â•â•â•â•â•â•â•â•â•\næ³¨æ„âš ï¸å½±è§†åä¸è¦å¸¦æ— å…³æˆ–å¤šä½™çš„å­—ç¬¦")
	else
        sedmsg(CurrentQQ,data,"èµ„æºåœ°å€å¦‚ä¸‹â†“â†“â†“\nâ•â•â•â•â•â•â•â•â•â•\nhttp://118.25.41.32/index.php/vod/search/wd/"..escape(msg)..".html\nâ•â•â•â•â•â•â•â•â•â•â•\næ³¨æ„:å¦‚æœQQå‡ºç°åœæ­¢è®¿é—®ç°è±¡ï¼Œè¯·å¤åˆ¶é“¾æ¥ç”¨æµè§ˆå™¨æ‰“å¼€")
	end
end

--å•çº¯å‘æ¶ˆæ¯å›¾æ–‡é€šç”¨
function sedimgmsg(CurrentQQ,data,url,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "PicMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = url,
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘æ¶ˆæ¯ç”¨
function sedmsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "TextMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘ç§èŠæ¶ˆæ¯ç”¨
function sendfrimsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromUin,
        sendToType = 1,
        sendMsgType = "TextMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘jsonæ¶ˆæ¯ç”¨
function sedjsonmsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "JsonMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--èŠå¤©æ¨¡å—åˆ‡æ¢å‡½æ•°
function liaotian(CurrentQQ,data,msg)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
    if (mim == nil) then
        sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
        return 1
    end
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
	if (str == nil) then
        return 1
    end
	if (string.find(str, "å…³é—­")) then
	    sedmsg(CurrentQQ,data,"æœºå™¨èŠå¤©å¤„äºå…³é—­çŠ¶æ€\nâˆ´è¯·å…ˆå¼€å¯æœºå™¨èŠå¤©")
	    return 1
	end
	--åˆ‡æ¢å¤„ç†
	file = io.open("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt", "w")
	if (msg == 1) then
	    file:write("æ–‡å­—èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°æ–‡å­—èŠå¤©")
	elseif (msg == 2) then
	    file:write("è¯­éŸ³èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°è¯­éŸ³èŠå¤©")
	elseif (msg == 3) then
	    file:write("å›å¤èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°å›å¤èŠå¤©")
	end
	file:close()
end

--éšæœºè¡¨æƒ…å‡½æ•°
function faceArray()
    faceArray = {"[è¡¨æƒ…147]","ğŸ€","ğŸ”¥","ğŸ»","ğŸ’","[è¡¨æƒ…185]","[è¡¨æƒ…219]","[è¡¨æƒ…176]"}
    math.randomseed(os.time())
    num = math.random(1, 9)
    return faceArray[num]
end

--urlç¼–ç è½¬æ¢
function escape(w)
	pattern="[^%w%d%._%-%* ]"
	s=string.gsub(w,pattern,function(c)
		local c=string.format("%%%02X",string.byte(c))
		return c
	end)
	s=string.gsub(s," ","+")
	return s
end

--è¯»å–æ•°æ®å‡½æ•°
function Read(url)
    file = io.open(url, "r")
	if (file == nil) then
	    return nil
	else
        file:seek("set")
	    str = file:read("*a")
	    file:close()
        return str
	end
end

--å†™å…¥æ•°æ®å‡½æ•°
function Wirte(url,msg)
    file = io.open(url, "w+")
    file:write(msg)
	file:close()
    return "ok"
end

--å°æ€èŠå¤©å‡½æ•°
function xiaosiapi(CurrentQQ,data,str)
    response, error_message =
            http.request(
            "GET",
            "https://api.ownthink.com/bot",
            {
                query = "appid="..tostring(data.FromUserId).."&spoken=" .. url_encode(str),
                headers = {
                    Accept = "*/*"
                }
            }
        )
        html = response.body
		jData = json.decode(html)
		return jData
end

--æœºå™¨èŠå¤©å‡½æ•°
function ownthink(CurrentQQ,data,msgs,atqq)
    if (tostring(atqq) == CurrentQQ) then
        m = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
        if (m == nil) then
	        log.info("Str ====> %s", m)
            return 1
	    end
	    if (string.find(m, "å…³é—­")) then
	        sedmsg(CurrentQQ,data,"æœºå™¨èŠå¤©å¤„äºå…³é—­çŠ¶æ€\nâˆ´è¯·å…ˆå¼€å¯æœºå™¨èŠå¤©")
	        return 1
	    end
		res2 = string.find(msgs, " ")
		str = string.sub(msgs,res2)
		jData = xiaosiapi(CurrentQQ,data,str)
		Data = json.decode(data.Content)
		m = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
		if (m == nil) then
	        log.info("Str ====> %s", m)
            return 1
	    end
		if (string.find(m, "å›å¤èŠå¤©")) then
		    Api.Api_SendMsg(
                CurrentQQ,
                {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "ReplayMsg",
                groupid = 0,
                content = jData.data.info.text,
                atUser = 0,
				replayInfo = {
                    MsgSeq = data.MsgSeq,
                    --å›å¤æ¶ˆæ¯çš„Seq
                    MsgTime = data.MsgTime,
                    --å›å¤æ¶ˆæ¯çš„äº‹ä»¶
                    UserID = data.FromUserId,
                    --å›å¤æ¶ˆæ¯å¯¹è±¡
                    RawContent = Data.Content --å›å¤æ¶ˆæ¯çš„åŸå†…å®¹
                }
				}
            )
			return 1
		elseif (string.find(m, "æ–‡å­—èŠå¤©")) then
		    sedmsg(CurrentQQ,data,jData.data.info.text)
		else
		    sedvoicemsg(CurrentQQ,data,url_encode(jData.data.info.text))
		end
    end
end

--å‘é€è¯­éŸ³æ¶ˆæ¯
function sedvoicemsg(CurrentQQ,data,str)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "VoiceMsg",
        groupid = 0,
		voiceUrl = "https://dds.dui.ai/runtime/v1/synthesize?voiceId=qianranfa&speed=0.7&volume=100&audioType=wav&text="..str, --å‘é€è¯­éŸ³çš„ç½‘ç»œåœ°å€ æ–‡æœ¬å‹
        voiceBase64Buf = "",
        content = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å¤©æ°”æŸ¥è¯¢å‡½æ•°
function tianqi(CurrentQQ,data)
    keyWord = data.Content:gsub("å¤©æ°”", "")
        if keyWord == "" then
            return 1
        end

        cookies = Api.Api_GetUserCook(CurrentQQ)

        response, error_message =
            http.request(
            "GET",
            "https://weather.mp.qq.com/cgi-bin/rich",
            {
                query = "g_tk=" .. cookies.Gtk .. "&city=" .. url_encode(keyWord),
                headers = {
                    Referer = "http://weather.mp.qq.com/ark"
                },
                cookies = {
                    uin = CurrentQQ,
                    skey = cookies.Skey
                }
            }
        )
        local html = response.body
        log.notice("From Lua html -->%s", html)

        local j = json.decode(html)
        if j.code ~= 0 then
            return 1
        end

        ApiRet =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "JsonMsg",
                groupid = 0,
                content = string.format(
                    --{"config":{"forward":1,"autosize":1},"prompt":"[åº”ç”¨]å¤©æ°”","app":"com.tencent.weather","ver":"0.0.0.1","view":"RichInfoView","meta":{"richinfo":{"adcode":"101210701","city":"æˆéƒ½","air":"58","min":"20","ts":"1500550866","wind":"1","date":"6æœˆ27æ—¥ å‘¨å››","max":"28","type":"201"}},"desc":"å¤©æ°”"}
                    --[[{"app":"com.tencent.weather","desc":"","meta":{"weather":{"ad":[{"icon":"http://imgcache.qq.com/ac/tq/xz2/tp.jpg","p":"ptype=star","t":"2","title":"æ˜Ÿåº§ | ä»Šå¤©ä¼šå› ä¸ºæ„Ÿæƒ…å’Œå®¶åº­çš„é—®é¢˜ï¼Œå½±å“å·¥ä½œï¼Œè¿˜æœ‰ï¼Œä¹Ÿè¦æ³¨æ„äºº...","url":""},{"icon":"http://imgcache.qq.com/ac/qqweather/image/2019/6/27.png","p":"ptype=lunar","t":"4","title":"é»„å† | å†œå†äº”æœˆå»¿äº”ã€‚å®œè®¢ç›Ÿ.çº³é‡‡.å‡ºè¡Œ.ç¥ˆç¦.æ–‹é†®.å®‰åºŠ.ä¼š...","url":""}],"info":{"it1":{"adcode":"101050101","city":"æ­¦æ±‰","hour":"18","max":"29","min":"17","temp":"24","type":"202","ut":"1561630401","wea":"å¤šäº‘"},"it2":{"hour":"19","temp":"22","type":"202"},"it3":{"hour":"20","temp":"21","type":"202"},"ts":"1561631244"},"url":""}},"prompt":"ã€å“ˆå°”æ»¨ã€‘å¤šäº‘ 17Â°/29Â°, 18:13æ›´æ–°~","ver":"1.0.0.106","view":"WeatherThreeView"}]]
                    [[{"app":"com.tencent.weather","desc":"å¤©æ°”","view":"RichInfoView","ver":"1.0.0.217","prompt":"[åº”ç”¨]å¤©æ°”","meta":{"richinfo":{"adcode":"%s","air":"%s","city":"%s","date":"%s","max":"%s","min":"%s","ts":"1554951408","type":"%s","wind":"%s"}},"config":{"forward":1,"autosize":1,"type":"card"}}]],
                    j.data.adcode,
                    j.data.air,
                    j.data.city,
                    j.data.date,
                    j.data.max,
                    j.data.min,
                    j.data.type,
                    j.data.wind
                ),
                atUser = 0
            }
        )
end

--è°ƒæ•™å¤„ç†å‡½æ•°(å¾…å¤„ç†)
function tiaojiao(CurrentQQ,data)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
	if (mim == nil) then
		sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå“‡")
		return 1
	end
	if (string.find(data.Content, "^åˆ é™¤è°ƒæ•™")) then
	    msg = data.Content:gsub("åˆ é™¤è°ƒæ•™", "")
	    if (msg == "") then
		    sedmsg(CurrentQQ,data,"è¦åˆ é™¤çš„è°ƒæ•™æŒ‡ä»¤ä¸èƒ½ä¸ºç©ºå“¦")
		    return 1
		end
		rese = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..tostring(data.FromGroupId).."\/"..msg..".txt")
	    if (rese == nil) then
			sedmsg(CurrentQQ,data,"è¿™ä¸ªæŒ‡ä»¤ä¸å­˜åœ¨äº†å“¦")
		    return 1
		end
		rm_file = os.remove("mimoio\/æœºå™¨è°ƒæ•™\/"..tostring(data.FromGroupId).."\/"..msg..".txt")
		log.info("åˆ é™¤è°ƒæ•™ ====> %s", rm_file)
		sedmsg(CurrentQQ,data,"åˆ é™¤æˆåŠŸ\nä½ ä¸å–œæ¬¢è¢«è¿™æ ·è°ƒæ•™çš„æˆ‘å—[è¡¨æƒ…9]")
		return 1
	end
    msgs = data.Content:gsub("è°ƒæ•™", "")
		res2 = string.find(msgs, "#")
		str = string.sub(msgs,res2+1)
		str2 = string.sub(msgs,1,res2-1)
		        
		        if (str == "") then
		            sedmsg(CurrentQQ,data,"è°ƒæ•™çš„å›ç­”å†…å®¹ä¸èƒ½ä¸ºç©ºå“¦")
			        return 1
		        end
				if (str2 == "") then
		            sedmsg(CurrentQQ,data,"è°ƒæ•™çš„æŒ‡ä»¤å†…å®¹ä¸èƒ½ä¸ºç©ºå“¦")
			        return 1
		        end
		        rese = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..str2..".txt")
					if (rese ~= nil) then
				        sedmsg(CurrentQQ,data,"æŒ‡ä»¤å·²ç»å­˜åœ¨äº†å“¦")
				        return 1
				    end
				Wirte("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..str2..".txt",str)
				sedmsg(CurrentQQ,data,"è°ƒæ•™æˆåŠŸ\nä½ è¿˜æƒ³å†è°ƒæ•™æˆ‘ä¸€æ¬¡å—[è¡¨æƒ…6]")
		        return 1
end

function url_encode(str)
    if (str) then
        str = string.gsub(str, "\n", "\r\n")
        str =
            string.gsub(
            str,
            "([^%w ])",
            function(c)
                return string.format("%%%02X", string.byte(c))
            end
        )
        str = string.gsub(str, " ", "+")
    end
    return str
end

--æŠ¢çº¢åŒ…å¤„ç†
function RedBag(CurrentQQ, data)
    Api.Api_OpenRedBag(CurrentQQ, data.RedBaginfo)
    if (data.RedBaginfo.RedType == 12) then
         luaRes =
                Api.Api_SendMsg(
                CurrentQQ,
                {
                    toUser = data.FromGroupId,
                    sendToType = 2,
                    sendMsgType = "TextMsg",
                    groupid = 0,
                    content = data.RedBaginfo.Tittle,
                    atUser = 0
                }
            )
        log.notice("From Lua SendMsg Ret\n%d", luaRes.Ret)
    end
end

--è§†é¢‘è§£æå¤„ç†
function Video(CurrentQQ, data)
    vdata = json.decode(data.Content)
        videodata = {
            GroupID = data.FromGroupId,
            VideoUrl = vdata.VideoUrl,
            VideoMd5 = vdata.VideoMd5
        }
        --æ„é€ table å‚æ•°è¡¨
        luaResp = Api.Api_CallFunc(CurrentQQ, "PttCenterSvr.ShortVideoDownReq", videodata) --é€šè¿‡cmdè°ƒç”¨åŠŸèƒ½åŒ…
        luaRes =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "TextMsg",
                groupid = 0,
                content = "è§£æè§†é¢‘URL-->" .. luaResp.VideoUrl,
                atUser = 0
            }
        )
end

--ç®¡ç†å¼€å…³é€šç”¨
function adminio(CurrentQQ,data,oio)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim ~= nil) then
            msg = data.Content:gsub(oio, "")
            str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
            if (string.find(str, "å…³é—­")) then
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äººå·²è¢«å…³é—­...\nè¯·å…ˆå¼€å¯æœºå™¨äºº")
                return 1
            end
			str2 = Read("mimoio\/çŠ¶æ€æ•°æ®\/"..oio.."\/"..data.FromGroupId..".txt")
			if (string.find(str2, msg)) then
			    sedmsg(CurrentQQ,data,"âˆ´"..oio.."æœ¬å°±æ˜¯"..str2.."çŠ¶æ€")
                return 1
			end
            Wirte("mimoio\/çŠ¶æ€æ•°æ®\/"..oio.."\/"..data.FromGroupId..".txt",msg)
            sedmsg(CurrentQQ,data,"âˆ´"..oio..msg.."æˆåŠŸ")
            return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
end

--ç™¾ç§‘å¤§å…¨
function baike(CurrentQQ,data)
    keyWord = data.Content:gsub("ç™¾ç§‘", "")
        if keyWord == "" then
            return 1
        end
        response, error_message =
            http.request(
            "GET",
            "http://baike.baidu.com/api/openapi/BaikeLemmaCardApi",
            {
                query = "scope=103&format=json&appid=379020&bk_key=" .. url_encode(keyWord) .. "&bk_length=600"
            }
        )
        html = response.body
        while(string.find(html, '"errno":2')) do
            response, error_message =
            http.request(
            "GET",
            "http://baike.baidu.com/api/openapi/BaikeLemmaCardApi",
            {
                query = "scope=103&format=json&appid=379020&bk_key=" .. url_encode(keyWord) .. "&bk_length=600"
            })
			html = response.body
        end
        local j = json.decode(html)
        sedmsg(CurrentQQ,data,j.abstract.."\n"..j.url)
end

--éŸ³ä¹ç‚¹æ­Œ
function music(CurrentQQ,data)
    keyWord = data.Content:gsub("ç‚¹æ­Œ", "")
        if keyWord == "" then
            return 1
        end
        response, error_message =
            http.request(
            "GET",
            "https://c.y.qq.com/soso/fcgi-bin/client_search_cp",
            {
                query = "aggr=1&cr=1&flag_qc=0&p=1&n=6&w=" .. url_encode(keyWord)
            }
        )
        html = response.body
		str = string.sub(html,10,-2)
        j = json.decode(str)
        if (j.code == 0) then
            msg = ""
            num = j.data.song.list
            list = num[1]
            songname = list.songname
            singername = list.singer[1].name
            payplay = list.pay.payplay
			albummid = list.albummid
			songmid = list.songmid
	        sedjsonmsg(CurrentQQ,data,'{"app":"com.tencent.structmsg","desc":"éŸ³ä¹","view":"music","ver":"0.0.0.1","prompt":"[åˆ†äº«]' ..songname.. '","meta":{"music":{"sourceMsgId":"0","title":"' ..songname.. '","desc":"' ..singername.. '","preview":"y.gtimg.cn/music/photo_new/T002R150x150M000'..albummid..'.jpg","tag":"QQéŸ³ä¹","musicUrl":"https://v1.itooi.cn/tencent/url?id='..songmid..'","jumpUrl":"y.qq.com/n/yqq/song/'..songmid..'.html","appid":100497308,"app_type":1,"action":"","source_url":"url.cn/5aSZ8Gc","source_icon":"url.cn/5tLgzTm","android_pkg_name":"com.tencent.qqmusic"}},"config":{"forward":true,"type":"normal","autosize":true}}')
			return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´Error:"..j.code)
			return 1
        end
end

--è®¿é—®url
function geturl(url_class,url,caulrt)
        response, error_message =
            http.request(
            url_class,
            url,
            {
                query = caulrt
            }
        )
        html = response.body
		return html
end

--æ¶ˆæ¯å‚¨è“„
function msgsql(CurrentQQ,data)
    if (mysqlpass == "") then
	    return 1
	end
    c = mysql.new()
    -- åˆå§‹åŒ–mysqlå¯¹è±¡
    ok, err = c:connect({host = mysqlhost, port = 3306, database = mysqldb, user = mysqluser, password = mysqlpass})
    --å»ºç«‹è¿æ¥
    if ok then
        sqlstr =
            string.format(
            [[INSERT INTO msgcache (GroupID, MsgSeq, MsgRandom,MsgType,Data,MsgTime)VALUES (%d,%d,%d,'%s','%s',%d)]],
            data.FromGroupId,
            data.MsgSeq,
            data.MsgRandom,
            data.MsgType,
            data.Content,
            data.MsgTime
        )
        res, err = c:query(sqlstr) --å…¥åº“ç¼“å­˜æ¶ˆæ¯
        log.info("%s", err)
        c.close(c)
    --é‡Šæ”¾è¿æ¥
    end
    return 1
end

--æ’¤å›æ£€æµ‹
function CheHui(CurrentQQ, data, extData)
    c = mysql.new()
    -- åˆå§‹åŒ–mysqlå¯¹è±¡
	if (mysqlpass == "") then
	    return 1
	end
	
    if data.MsgType == "ON_EVENT_GROUP_REVOKE" then --ç›‘å¬ ç¾¤æ’¤å›äº‹ä»¶
        str = string.format("ç¾¤æˆ %d  æˆå‘˜ UserID %s æ’¤å›äº†æ¶ˆæ¯Seq %s \n", extData.GroupID, extData.UserID, extData.MsgSeq)
        log.info("%s", str)
        ok, err = c:connect({host = mysqlhost, port = 3306, database = mysqldb, user = mysqluser, password = mysqlpass})
        --å»ºç«‹è¿æ¥
        log.info("sql %v", err)
        if ok then
            sqlstr =
                string.format(
                "select * from msgcache where `GroupID`= %d and `MsgSeq` = %d",
                extData.GroupID,
                extData.MsgSeq
            )
            res, err = c:query(sqlstr) --è·Ÿç¾¤ç¾¤idå’Œæ¶ˆæ¯SEQæŸ¥è¯¢å‡ºæ’¤å›çš„æ¶ˆæ¯å†…å®¹
            if err == nil then
                c.close(c)
                GroupID = tonumber(res[1]["GroupID"])
                MsgType = res[1]["MsgType"]
                Data = res[1]["Data"]

                if MsgType == "TextMsg" then
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            --å‘é€æ–‡æœ¬æ¶ˆæ¯
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡æ–‡æœ¬æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                Data
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "SmallFaceMsg" then
                    --Data {"Content":"[è¡¨æƒ…101]","Hex":"FKY=","Index":101,"tips":"[å°è¡¨æƒ…]"}
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡è¡¨æƒ…æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).Content
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "PicMsg" then
                    --Data {"Content":"","FileId":2820717626,"FileMd5":"q0oEC5aloJJMFr10mplaXw==","FileSize":7026,"tips":"[ç¾¤å›¾ç‰‡]","url":"http://gchat.qpic.cn/gchatpic_new/1700487478/960839480-2534335053-AB4A040B96A5A0924C16BD749A995A5F/0?vuin=u0026term=255u0026pictype=0"}
                    jData = json.decode(Data)
					if (jData.tips == "[ç¾¤æ¶ˆæ¯-QQé—ªç…§]") then
					    
					Api.Api_SendMsg( 
                    CurrentQQ,
                    {
                        toUser = GroupID,
                        sendToType = 2,
                        sendMsgType = "ForwordMsg",
                        content = "",
                        atUser = 0,
                        groupid = 0,
                        voiceUrl = "",
                        voiceBase64Buf = "",
                        picUrl = "",
                        picBase64Buf = "",
                        forwordBuf = json.decode(Data).ForwordBuf, --æ¬²è½¬å‘çš„base64buf å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                        forwordField = json.decode(Data).ForwordField --æ¬²å†™å…¥åè®®çš„å­—æ®µID å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                    }
                )
				    return 1
					end
                    Api.Api_SendMsg( --é€šè¿‡å›¾ç‰‡md5å‘é€å›¾ç‰‡ ç§’å‘ä¸ç”¨ä¸Šä¼  ç›¸å½“äºè½¬å‘
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "PicMsg",
                            --å‘é€å›¾æ–‡æ¶ˆæ¯
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡å›¾ç‰‡æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š[PICFLAG]%s",
                                extData.UserID,
                                jData.Content
                            ),
                            --é€šè¿‡å®[PICFLAG]æ”¹å˜å›¾æ–‡é¡ºåº  æ”¹ä¸ºç°æ–‡å­—åå›¾ç‰‡
                            atUser = 0,
                            voiceUrl = "",
                            voiceBase64Buf = "",
                            picUrl = "",
                            picBase64Buf = "",
                            fileMd5 = jData.FileMd5
                        }
                    )
                end
                if MsgType == "AtMsg" then
                    --Data {"Content":"@Kar98k skjjkssjkjs","UserID":123456789,"tips":"[ATæ¶ˆæ¯]"}
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡atæ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).Content
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "VoiceMsg" then
                    --Data {"tips":"[è¯­éŸ³]","url":"http://grouptalk.c2c.qq.com/?ver=0u0026rkey=3062020101045b305902010102010102041fdef8ae042439416931554e5142586c536d78706a314c686843664959725f327a5f573064697653755902045dac2a21041f0000000866696c6574797065000000013100000005636f64656300000001310400u0026filetype=1u0026voice_codec=1"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "VoiceMsg",
                            --å‘é€ç¾¤è¯­éŸ³æ¶ˆæ¯
                            groupid = 0,
                            content = "",
                            atUser = 0,
                            voiceUrl = json.decode(Data).url,
                            --é€šè¿‡ç½‘ç»œurlè¿›è¡Œå‘é€è¯­éŸ³
                            voiceBase64Buf = "",
                            picUrl = "",
                            picBase64Buf = ""
                        }
                    )
                end

                if MsgType == "ReplayMsg" then
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡å›å¤æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).ReplayContent
                            ),
                            atUser = 0
                        }
                    )
                end
				if MsgType == "VideoMsg" then
	             Api.Api_SendMsg( 
                    CurrentQQ,
                    {
                        toUser = GroupID,
                        sendToType = 2,
                        sendMsgType = "ForwordMsg",
                        content = "",
                        atUser = 0,
                        groupid = 0,
                        voiceUrl = "",
                        voiceBase64Buf = "",
                        picUrl = "",
                        picBase64Buf = "",
                        forwordBuf = json.decode(Data).ForwordBuf, --æ¬²è½¬å‘çš„base64buf å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                        forwordField = json.decode(Data).ForwordField --æ¬²å†™å…¥åè®®çš„å­—æ®µID å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                    }
                )
				end
                if MsgType == "XmlMsg" then
				    
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "XmlMsg",
                            groupid = 0,
                            content = string.format("%s", Data),
                            atUser = 0
                        }
                    )
                end
				if MsgType == "JsonMsg" then
				    
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "JsonMsg",
                            groupid = 0,
                            content = string.format("%s", Data),
                            atUser = 0
                        }
                    )
                end
            end
        end
    end
    return 1
end
2020/09/07 11:55:05.587 [E]  mimoio.lua
2020/09/07 11:55:05.587 [E]  local log = require("log")
local Api = require("coreApi")
local json = require("json")
local http = require("http")
local mysql = require("mysql")

--ç‰ˆæœ¬å·(ä¸è¦æ”¹åŠ¨)
Vabr = "1.0.2"
--æ•°æ®åº“é…ç½®
mysqlhost = "localhost"--é»˜è®¤ä¸åŠ¨
mysqldb = "ffaxx001"--æ•°æ®åº“å
mysqluser = "ffaxx001"--æ•°æ®åº“ç”¨æˆ·å
mysqlpass = "123456"--æ•°æ®åº“å¯†ç 
--ä¸ä½¿ç”¨è¯·ä¸è¦æ”¹åŠ¨

function ReceiveFriendMsg(CurrentQQ, data)
    if (data.Content == "ä½¿ç”¨æ–¹æ³•") then
	    sendfrimsg(CurrentQQ,data,"æ·»åŠ æˆæƒè€…çš„æ–¹æ³•\nå¯¹å•ä¸ªæœºå™¨äººç§èŠå‘é€[æ·»åŠ æˆæƒè€…+æˆæƒè€…QQ]\n\næˆæƒç¾¤çš„æ–¹æ³•\nåˆ°éœ€è¦æˆæƒçš„ç¾¤é‡Œå‘é€[æˆæƒ+ä¸»äººQQ]ã€‚æ³¨æ„:æˆæƒå¿…é¡»æ˜¯æˆæƒè€…è¿›è¡Œæ“ä½œ,ç®¡ç†å‘˜æˆæƒä¸äº†")
	end
    --æ•°æ®åˆå§‹åŒ–
    if (data.Content == "åˆå§‹åŒ–") then
	    root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root ~= nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´è¯·ä¸è¦é‡å¤åˆå§‹åŒ–")
			return 1
		end
    --os.execute('mkdir mimoio/æœºå™¨æˆæƒ')
	    os.execute('mkdir mimoio')
		os.execute('mkdir mimoio/å¤è¯»æœº')
		os.execute('mkdir mimoio/å¤è¯»æœº/æ¬¡æ•°')
		os.execute('mkdir mimoio/å¤è¯»æœº/å†…å®¹')
		os.execute('mkdir mimoio/æœºå™¨æˆæƒ')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨ä¸»äºº')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨èŠå¤©')
		os.execute('mkdir mimoio/æœºå™¨è°ƒæ•™')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æŠ¢çº¢åŒ…')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æœºå™¨èŠå¤©')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æœºå™¨å¼€å…³')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æ’¤å›æ£€æµ‹')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/å›¾ç‰‡è§£æ')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/è§†é¢‘è§£æ')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/é—ªç…§æ£€æµ‹')
		Wirte("mimoio\/"..data.FromUin..".txt","999")
		sendfrimsg(CurrentQQ,data,"åˆå§‹åŒ–å®Œæ¯•ï¼\nå‘é€[ä½¿ç”¨æ–¹æ³•]äº†è§£ä½¿ç”¨å§")
	end
	--æ·»åŠ æˆæƒè€…æ“ä½œ(ç§èŠæœºå™¨äººå‘é€)
	if (string.find(data.Content, "^æ·»åŠ æˆæƒè€…")) then
	    msg = data.Content:gsub("æ·»åŠ æˆæƒè€…", "")
		--Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromUin..".txt","å…³é—­")
		root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root == nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„ç®¡ç†è€…")
			return 1
		end
		Wirte("mimoio\/æœºå™¨æˆæƒ\/"..msg..CurrentQQ..".txt","999")
		sendfrimsg(CurrentQQ,data,"âˆ´æ·»åŠ æˆæƒè€…æˆåŠŸ")
	end
	--åˆ é™¤æˆæƒè€…æ“ä½œ(ç§èŠæœºå™¨äººå‘é€)
	if (string.find(data.Content, "^åˆ é™¤æˆæƒè€…")) then
	    msg = data.Content:gsub("åˆ é™¤æˆæƒè€…", "")
		--Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromUin..".txt","å…³é—­")
		root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root == nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„ç®¡ç†è€…")
			return 1
		end
		os.remove("mimoio\/æœºå™¨æˆæƒ\/"..msg..CurrentQQ..".txt")
		sendfrimsg(CurrentQQ,data,"âˆ´åˆ é™¤æˆæƒè€…æˆåŠŸ")
	end
    return 1
end
function ReceiveGroupMsg(CurrentQQ, data)
    if (tostring(data.FromUserId) == CurrentQQ) then
	    return 1
	end
	--ç¾¤èŠæˆæƒ(åˆ°éœ€è¦æˆæƒçš„ç¾¤é‡Œæ“ä½œ)
	if (string.find(data.Content, "^æˆæƒ")) then
	    root = Read("mimoio\/æœºå™¨æˆæƒ\/"..data.FromUserId..CurrentQQ..".txt","999")
		if (root == nil) then
		    sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„æˆæƒè€…")
			return 1
		end
		msg = data.Content:gsub("æˆæƒ", "")
		os.execute('mkdir mimoio/æœºå™¨è°ƒæ•™/'..data.FromGroupId)
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨ä¸»äºº/'..data.FromGroupId)
		Wirte("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..msg..".txt","999")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt","å›å¤èŠå¤©")
		sedmsg(CurrentQQ,data,"âˆ´æˆæƒæˆåŠŸï¼\nå‘é€[å¼€å¯æœºå™¨äºº]ä½¿ç”¨å§")
	end
	--åˆ é™¤æˆæƒæ“ä½œ(åˆ°éœ€è¦åˆ é™¤æˆæƒçš„ç¾¤é‡Œæ“ä½œ)
	if (string.find(data.Content, "^åˆ é™¤æˆæƒ")) then
	    root = Read("mimoio\/æœºå™¨æˆæƒ\/"..data.FromUserId..CurrentQQ..".txt","999")
		if (root == nil) then
		    sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„æˆæƒè€…")
			return 1
		end
		msg = data.Content:gsub("åˆ é™¤æˆæƒ", "")
		os.remove("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..msg..".txt")
		os.remove("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
		sedmsg(CurrentQQ,data,"âˆ´åˆ é™¤æˆæƒæˆåŠŸï¼")
	end
	--æœºå™¨å¼€å…³æŒ‡ä»¤
	if (data.Content == "å¼€å¯æœºå™¨äºº" or data.Content == "å…³é—­æœºå™¨äºº") then
        mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim ~= nil) then
            msg = data.Content:gsub("æœºå™¨äºº", "")
            str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
			if (str == nil) then
			    Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt",msg)
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äºº"..msg.."æˆåŠŸï¼")
				log.info("Str ====> %s", str)
                return 1
			end
			
            if (string.find(str, msg)) then
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äººä¸€ç›´æ˜¯"..msg.."çš„å‘")
                return 1
            end
            Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt",msg)
            sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äºº"..msg.."æˆåŠŸï¼")
            return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
	end
    --æœºå™¨äººå¼€å¯æ£€æµ‹
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
	if (str == nil) then
	    log.info("Str ====> %s", str)
        return 1
	end
	if (string.find(str, "å…³é—­")) then
	    return 1
	end
	--atæ¶ˆæ¯å¤„ç†
	msgs = ""
	atqq = 0
	if (string.find(data.Content, "ATæ¶ˆæ¯")) then
	    msgs = json.decode(data.Content).Content
		atqq = json.decode(data.Content).UserID
	end
	--å°¾å·´è‡ªå®šä¹‰(å¾…å®Œå–„)
	tips = "â€”â€”å‡¤é£ç¿±ç¿”å…®ä¸·"
    --åŠŸèƒ½æ¨¡å—
    if (data.Content == "åŠŸèƒ½" or data.Content == "ä¸»ç•Œé¢") then
        face = faceArray()
        sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."å½±è§†æœç´¢\n"..face.."èŠå¤©å¨±ä¹\n"..face.."ä¾¿åˆ©åŠŸèƒ½\n"..face.."æœºå™¨è°ƒæ•™\n"..face.."ç®¡ç†ç³»ç»Ÿ\n"..face.."bugåé¦ˆ\n"..face.."æœ¬ç¾¤çŠ¶æ€\n"..face.."æ›´æ–°æ£€æµ‹\n\n"..tips)
    end
    --å½±è§†æœç´¢æ¨¡å—
    if (data.Content == "å½±è§†æœç´¢") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."æœç´¢+å½±è§†å\n"..face.."æˆ‘æƒ³çœ‹+å½±è§†å\n"..face.."æˆ‘è¦çœ‹+å½±è§†å\n\n"..tips)
    elseif (string.find(data.Content, "^æœç´¢")) then
	    msg = data.Content:gsub("æœç´¢", "")
		Sousuo(CurrentQQ,data,msg)
	elseif (string.find(data.Content, "^æˆ‘æƒ³çœ‹")) then
	    msg = data.Content:gsub("æˆ‘æƒ³çœ‹", "")
		Sousuo(CurrentQQ,data,msg)
    elseif (string.find(data.Content, "^æˆ‘è¦çœ‹")) then
	    msg = data.Content:gsub("æˆ‘è¦çœ‹", "")
		Sousuo(CurrentQQ,data,msg)
	end
	--èŠå¤©å¨±ä¹æ¨¡å—
	if (data.Content == "èŠå¤©å¨±ä¹") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."åˆ‡æ¢æ–‡å­—èŠå¤©\n"..face.."åˆ‡æ¢å›å¤èŠå¤©\n"..face.."åˆ‡æ¢è¯­éŸ³èŠå¤©\n\n"..tips)
    elseif (data.Content == "åˆ‡æ¢æ–‡å­—èŠå¤©") then
		liaotian(CurrentQQ,data,1)
	elseif (data.Content == "åˆ‡æ¢è¯­éŸ³èŠå¤©") then
	    liaotian(CurrentQQ,data,2)
    elseif (data.Content == "åˆ‡æ¢å›å¤èŠå¤©") then
	    liaotian(CurrentQQ,data,3)
	else
	    ownthink(CurrentQQ,data,msgs,atqq)
	end
	--ä¾¿åˆ©åŠŸèƒ½æ¨¡å—
	if (data.Content == "ä¾¿åˆ©åŠŸèƒ½") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."ç™¾ç§‘å¤§å…¨\n"..face.."éŸ³ä¹ç‚¹æ­Œ\n"..face.."é—ªä»–@xx\n"..face.."å¤©æ°”æŸ¥è¯¢\n\n"..tips)
	elseif (data.Content == "ç™¾ç§‘å¤§å…¨") then
		sedmsg(CurrentQQ,data,"å‘é€:[ç™¾ç§‘+å…³é”®è¯]\nä¾‹å¦‚:ç™¾ç§‘æ´›å¤©ä¾")
    elseif (data.Content == "éŸ³ä¹ç‚¹æ­Œ") then
		sedmsg(CurrentQQ,data,"å‘é€:[ç‚¹æ­Œ+æ­Œå]\nä¾‹å¦‚:ç‚¹æ­Œé’æŸ ")
	elseif (data.Content == "å¤©æ°”æŸ¥è¯¢") then
		sedmsg(CurrentQQ,data,"å‘é€:[å¤©æ°”+åœ°æ–¹å]\nä¾‹å¦‚:å¤©æ°”åŒ—äº¬(é™äºå›½å†…)")
    elseif (string.find(data.Content, "^å¤©æ°”")) then
        tianqi(CurrentQQ,data)
	    --msg = data.Content:gsub("æœç´¢", "")
		--Sousuo(CurrentQQ,data,msg)
	elseif (string.find(data.Content, "^ç™¾ç§‘")) then
	    baike(CurrentQQ,data)
	    --msg = data.Content:gsub("æˆ‘æƒ³çœ‹", "")
		--Sousuo(CurrentQQ,data,msg)music(CurrentQQ,data)
    elseif (string.find(data.Content, "^ç‚¹æ­Œ")) then
	    music(CurrentQQ,data)
	end
	--æœºå™¨è°ƒæ•™æ¨¡å—
	if (data.Content == "æœºå™¨è°ƒæ•™") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."æ–‡å­—è°ƒæ•™\n"..face.."è¯­éŸ³è°ƒæ•™\n"..face.."å”±æ­Œè°ƒæ•™\n"..face.."éŸ³ä¹è°ƒæ•™\n"..face.."å›¾ç‰‡è°ƒæ•™\n"..face.."åˆ é™¤è°ƒæ•™\n\n"..tips)
    elseif (data.Content == "æ–‡å­—è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#(å†…å®¹)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#ä½ å¥½å•Š")
	elseif (data.Content == "è¯­éŸ³è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#è¯­éŸ³(å†…å®¹)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#è¯­éŸ³ä½ å¥½å•Š")
	elseif (data.Content == "å›¾ç‰‡è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#å›¾ç‰‡(é“¾æ¥)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#å›¾ç‰‡http://../1.jpg")
	elseif (data.Content == "éŸ³ä¹è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#ç‚¹æ­Œ(æ­Œå)]\nä¾‹å¦‚:è°ƒæ•™å–µ#ç‚¹æ­Œå­¦çŒ«å«")
	elseif (data.Content == "å”±æ­Œè°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#å”±æ­Œ(æ­Œå)]\nä¾‹å¦‚:è°ƒæ•™å–µ#å”±æ­Œå­¦çŒ«å«")
	elseif (data.Content == "åˆ é™¤è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[åˆ é™¤è°ƒæ•™(æŒ‡ä»¤)]\nä¾‹å¦‚:åˆ é™¤è°ƒæ•™ä½ å¥½")
	elseif (string.find(data.Content, "^è°ƒæ•™")) then
        tiaojiao(CurrentQQ,data)
	elseif (string.find(data.Content, "^åˆ é™¤è°ƒæ•™")) then
        tiaojiao(CurrentQQ,data)
	end
	--ç®¡ç†ç³»ç»Ÿæ¨¡å—
	if (data.Content == "ç®¡ç†ç³»ç»Ÿ") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."å¼€å¯/å…³é—­æœºå™¨äºº\n"..face.."å¼€å¯/å…³é—­æŠ¢çº¢åŒ…\n"..face.."å¼€å¯/å…³é—­æœºå™¨èŠå¤©\n"..face.."å¼€å¯/å…³é—­é—ªç…§æ£€æµ‹\n"..face.."å¼€å¯/å…³é—­å›¾ç‰‡è§£æ\n"..face.."å¼€å¯/å…³é—­è§†é¢‘è§£æ\n"..face.."å¼€å¯/å…³é—­æ’¤å›æ£€æµ‹\n\n"..tips)
    elseif (data.Content == "å¼€å¯æœºå™¨èŠå¤©" or data.Content == "å…³é—­æœºå™¨èŠå¤©") then
        adminio(CurrentQQ,data,"æœºå™¨èŠå¤©")
    elseif (data.Content == "å¼€å¯æ’¤å›æ£€æµ‹" or data.Content == "å…³é—­æ’¤å›æ£€æµ‹") then
        adminio(CurrentQQ,data,"æ’¤å›æ£€æµ‹")
	elseif (data.Content == "å¼€å¯é—ªç…§æ£€æµ‹" or data.Content == "å…³é—­é—ªç…§æ£€æµ‹") then
        adminio(CurrentQQ,data,"é—ªç…§æ£€æµ‹")
	elseif (data.Content == "å¼€å¯æŠ¢çº¢åŒ…" or data.Content == "å…³é—­æŠ¢çº¢åŒ…") then
        adminio(CurrentQQ,data,"æŠ¢çº¢åŒ…")
	elseif (data.Content == "å¼€å¯è§†é¢‘è§£æ" or data.Content == "å…³é—­è§†é¢‘è§£æ") then
        adminio(CurrentQQ,data,"è§†é¢‘è§£æ")
	elseif (data.Content == "å¼€å¯å›¾ç‰‡è§£æ" or data.Content == "å…³é—­å›¾ç‰‡è§£æ") then
        adminio(CurrentQQ,data,"å›¾ç‰‡è§£æ")
	end
	--bugåé¦ˆæ¨¡å—
	if (data.Content == "BUGåé¦ˆ" or data.Content == "bugåé¦ˆ") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."é‚®ä»¶åé¦ˆ\n"..face.."QQåé¦ˆ\n\n"..tips)
    elseif (data.Content == "QQåé¦ˆ") then
        sedmsg(CurrentQQ,data,"???Î£(ï¾Ÿâˆ€ï¾Ÿï¾‰)ï¾‰\næ’ä»¶æœ‰é—®é¢˜å¯ä»¥åé¦ˆåˆ°:\nQQ:2353065854")
    elseif (data.Content == "é‚®ä»¶åé¦ˆ") then
        sedmsg(CurrentQQ,data,"å®è´å’‹å•¦=ÍÍŸÍŸÍ(ê’ªá—œê’ª â€§Ì£Ì¥Ì‡)\næ’ä»¶æœ‰é—®é¢˜å¯ä»¥åé¦ˆåˆ°:\né‚®ç®±ğŸ“¬:ym-o@qq.com")
	end
	--æœ¬ç¾¤çŠ¶æ€æ¨¡æ¿
	if (data.Content == "æœ¬ç¾¤çŠ¶æ€") then
        face = faceArray()
        hb = Read("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt")
        sz = Read("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt")
		tp = Read("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt")
        sp = Read("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt")
        jqr = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
        lt = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
        ch = Read("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..data.FromGroupId..".txt")
		sedmsg(CurrentQQ,data,"çŠ¶æ€æ•°æ®åˆ—è¡¨â†“â†“â†“\n"..face.."æœºå™¨äºº:"..jqr.."\n"..face.."æŠ¢çº¢åŒ…:"..hb.."\n"..face.."å›¾ç‰‡è§£æ:"..tp.."\n"..face.."æ’¤å›æ£€æµ‹:"..ch.."\n"..face.."è§†é¢‘è§£æ:"..sp.."\n"..face.."æœºå™¨èŠå¤©:"..lt.."\n"..face.."é—ªç…§æ£€æµ‹:"..sz.."\n\n"..tips)
	end
	--æ›´æ–°æ¨¡å—
	if (data.Content == "æ›´æ–°æ£€æµ‹") then
        str = geturl("GET","http://118.25.41.32/Lsb/lua/Vabr.txt","")
		log.info("Str ====> %s", str)
        if (string.find(str, Vabr)) then
            sedmsg(CurrentQQ,data,"å½“å‰ç‰ˆæœ¬ä¸ºæœ€æ–°ç‰ˆ")
        else
            sedmsg(CurrentQQ,data,"å‘ç°æ–°ç‰ˆæœ¬!\nå½“å‰ç‰ˆæœ¬:"..Vabr.."\næ–°ç‰ˆæœ¬å·:"..str.."\nèµ¶å¿«å‘é€[æ›´æ–°æ’ä»¶]å§")
        end
	elseif (data.Content == "æ›´æ–°æ’ä»¶") then
	    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim == nil) then
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
        str = geturl("GET","http://118.25.41.32/Lsb/lua/Vabr.txt","")
		log.info("Str ====> %s", str)
        if (string.find(str, Vabr)) then
            sedmsg(CurrentQQ,data,"å½“å‰ç‰ˆæœ¬ä¸ºæœ€æ–°ç‰ˆ")
        else
            str = geturl("GET","http://118.25.41.32/Lsb/lua/mimoio.txt","")
            Wirte("Plugins\/mimoio.lua",str)
            sedmsg(CurrentQQ,data,"æ›´æ–°å®Œæ¯•ï¼")
        end
	end
	--å›¾ç‰‡ç±»å‹æ¶ˆæ¯å¤„ç†
    if (data.MsgType == "PicMsg") then
	    msg = Read("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt")
		jData = json.decode(data.Content)
	    if (msg ~= nil and jData.tips ~= "[ç¾¤æ¶ˆæ¯-QQé—ªç…§]") then
            if (string.find(str, "å¼€å¯")) then
	            sedmsg(CurrentQQ,data,"å›¾ç‰‡é“¾æ¥è§£æå¦‚ä¸‹â†“â†“\n"..jData.url)
				return 1
	        end
	    end
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt")
	    if (str == nil) then
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    --é—ªç…§ã€å›¾ç‰‡å¤„ç†æ¨¡å—
		PicFlag(CurrentQQ, data)
    end
	--æŠ¢çº¢åŒ…å¤„ç†
	if (string.find(data.MsgType, "RedBagMsg") == 1) then
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt")
		if (str == nil) then
	        log.info("Str ====> %s", str)
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    RedBag(CurrentQQ, data)
	end
	--è§†é¢‘è§£æå¤„ç†
	if (string.find(data.MsgType, "VideoMsg") == 1) then
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt")
		if (str == nil) then
	        log.info("Str ====> %s", str)
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    Video(CurrentQQ, data)
	end
	--até—ªå›¾
	if (data.MsgType == "AtMsg") and (string.find(data.Content, "é—ªä»–")) then
	    shantu(CurrentQQ, data)
    end
	--è°ƒæ•™æœç´¢å¼•æ“
	mim = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..data.Content..".txt")
	if (mim == nil) then
	    --äººç±»çš„æœ¬è´¨æ˜¯å¤è¯»æœº
	    msg = Read("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt")
		if (msg ~= nil) then
		    cs = Read("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt")
			ii = tonumber(cs)
			if (string.find(msg, "^"..data.Content.."$")) then
			    if (ii > 2) then
			         math.randomseed(os.time())
                     sj = math.random(1, 5)
		             if (sj == 1 or sj == 2) then
			             sedmsg(CurrentQQ,data,msg)
					     rr = ii + 1
		                 Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
				     elseif (sj == 3) then
				         os.remove("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt")
					     os.remove("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt")
					     fdArray = {"çªç„¶æˆªæ–­å¤è¯»(ï¾ŸâŠ¿ï¾Ÿ)ï¾‚","å¤è¯»å¯è€»(â€¢Ì€ã¸ â€¢Ì â•® )","ä¸è¦å¤è¯»äº†å•¦","è¿™å°±æ˜¯æ‰€è°“çš„äººç±»çš„æœ¬è´¨","ä½ ä»¬å’‹ä¸ä¸Šå¤©å‘","åˆå¤è¯»ä¸Šç˜¾äº†å•Š"}
                         math.randomseed(os.time())
                         fdsj = math.random(1, 6)
				         sedmsg(CurrentQQ,data,fdArray[fdsj])
				     else
			             rr = ii + 1
		                 Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
		             end
			    else
			        rr = ii + 1
		            Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
			    end
			else
			    if (ii > 2) then
			        math.randomseed(os.time())
                    sj2 = math.random(1, 3)
					if (sj2 == 2) then
					    fdArray2 = {"ä¸­æ–­å¤è¯»å¯è€»","æ‰“æ–­å¤è¯»å¯è€»(â€¢Ì€ã¸ â€¢Ì â•® )","ä½ ä¸ºä»€ä¹ˆè¦æ‰“æ–­å¤è¯»å•Š","å¤è¯»ä¸é¦™å˜›","ç ´åæ°›å›´(à¸‡áµ’ÌŒçš¿áµ’ÌŒ)à¸‡â¼Â³â‚Œâ‚ƒ"}
                        math.randomseed(os.time())
                        fdsj2 = math.random(1, 5)
				        sedmsg(CurrentQQ,data,fdArray2[fdsj2])
					end
				end
				Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt","1")
			    Wirte("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt",data.Content)
			end
		else
		    Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt","1")
			Wirte("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt",data.Content)
		end
	    --å¦‚æœè°ƒæ•™æŒ‡ä»¤ä¸å­˜åœ¨ï¼Œåˆ™è¿›è¡Œå…¶ä»–æ“ä½œ
	    msgsql(CurrentQQ,data)--æ•°æ®å‚¨è“„
		--éšæœºå›å¤æ¶ˆæ¯æ¦‚ç‡0.04
	    math.randomseed(os.time())
        num = math.random(1, 40)
		if (num == 12) then
		    j = xiaosiapi(CurrentQQ,data,data.Content)
			sedmsg(CurrentQQ,data,j.data.info.text)
		end
	else
	    --è§¦å‘è°ƒæ•™æŒ‡ä»¤
		funic(CurrentQQ,data,mim)
	end
    return 1
end

function ReceiveEvents(CurrentQQ, data, extData)
  if data.MsgType == "ON_EVENT_GROUP_REVOKE" then --ç›‘å¬ ç¾¤æ’¤å›äº‹ä»¶
    --æ’¤å›äº‹ä»¶å¤„ç†
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..extData.GroupID..".txt")
    if (str == nil) then
	    log.info("Str ====> %s", str)
        return 1
	end
	if (string.find(str, "å…³é—­")) then
		return 1
	end
	CheHui(CurrentQQ, data, extData)
	--xxxxxxxxxxxxxxx
    return 1
  end
  --è¿›ç¾¤ç§€å›¾æ¬¢è¿


--é—ªç…§æ£€æµ‹å¤„ç†


--åŠŸèƒ½ç»„
function funic(CurrentQQ,data,msg)
    if string.find(msg, "^ç‚¹æ­Œ") then
	    data.Content = msg
        music(CurrentQQ,data,msg)
		return 1
	elseif string.find(msg, "^è¯­éŸ³") then
	    keyWord = msg:gsub("è¯­éŸ³", "")
        sedvoicemsg(CurrentQQ,data,keyWord)
		return 1
	elseif string.find(msg, "^å›¾ç‰‡") then
	    keyWord = msg:gsub("å›¾ç‰‡", "")
        sedimgmsg(CurrentQQ,data,keyWord,"")
		return 1
    elseif string.find(msg, "^å”±æ­Œ") then
        keyWord = msg:gsub("å”±æ­Œ", "")
		if (keyWord == "") then
		    sedmsg(CurrentQQ,data,"æ­Œåä¸èƒ½ç©ºç€å“¦")
		    return 1
		end
		sedmsg(CurrentQQ,data,"å¤©ä¾æ­£åœ¨åŠªåŠ›åŠ è½½Ù©(ËƒÌ¶Ì€Íˆà¯°Ë‚Ì¶ÌÍˆ)Ùˆ")
        response, error_message =
            http.request(
            "POST",
            "http://127.0.0.1:8888/SilkApi/UrlToBuf",--ä¿®æ”¹æ­¤å¤„ipåŠç«¯å£å³å¯
            {
                body = keyWord --ä¼ å…¥æ­Œæ›²å
            }
        )
        log.notice("err   %v", error_message)
        html = response.body --è¿”å›silk base64 buf
		if (string.find(html, "Î´")) then
				    sedmsg(CurrentQQ,data,"å¤©ä¾æ²¡æœ‰æ‰¾åˆ°ç›¸å…³çš„æ­Œå‘€(Ã’Ï‰Ã“×±)ï¼")
					c.close(c)
				    return 2
				end
        luaRes =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "VoiceMsg",
                groupid = 0,
                content = "",
                atUser = 0,
                voiceUrl = "",
                voiceBase64Buf = html 
            }
        )
		return 1
	end
    sedmsg(CurrentQQ,data,msg)
end

--å½±è§†æœç´¢ç”¨
function Sousuo(CurrentQQ,data,msg)
    response, error_message =
        http.request(
            "GET",
            "http://localhost/index.php/ajax/suggest",
            {
                query = "mid=1&f=admin&wd="..msg.."&limit=10&timestamp=1567914326746"
            }
        )
    html = response.body
	json = json.decode(html)
	if (json.total == 0) then
	    sedmsg(CurrentQQ,data,"å½±è§†æŸ¥è¯¢é”™è¯¯\nè¯·æ£€æŸ¥å½±è§†åæ˜¯å¦æ­£ç¡®\nâ•â•â•â•â•â•â•â•â•â•â•\næ³¨æ„âš ï¸å½±è§†åä¸è¦å¸¦æ— å…³æˆ–å¤šä½™çš„å­—ç¬¦")
	else
        sedmsg(CurrentQQ,data,"èµ„æºåœ°å€å¦‚ä¸‹â†“â†“â†“\nâ•â•â•â•â•â•â•â•â•â•\nhttp://118.25.41.32/index.php/vod/search/wd/"..escape(msg)..".html\nâ•â•â•â•â•â•â•â•â•â•â•\næ³¨æ„:å¦‚æœQQå‡ºç°åœæ­¢è®¿é—®ç°è±¡ï¼Œè¯·å¤åˆ¶é“¾æ¥ç”¨æµè§ˆå™¨æ‰“å¼€")
	end
end

--å•çº¯å‘æ¶ˆæ¯å›¾æ–‡é€šç”¨
function sedimgmsg(CurrentQQ,data,url,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "PicMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = url,
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘æ¶ˆæ¯ç”¨
function sedmsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "TextMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘ç§èŠæ¶ˆæ¯ç”¨
function sendfrimsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromUin,
        sendToType = 1,
        sendMsgType = "TextMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘jsonæ¶ˆæ¯ç”¨
function sedjsonmsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "JsonMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--èŠå¤©æ¨¡å—åˆ‡æ¢å‡½æ•°
function liaotian(CurrentQQ,data,msg)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
    if (mim == nil) then
        sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
        return 1
    end
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
	if (str == nil) then
        return 1
    end
	if (string.find(str, "å…³é—­")) then
	    sedmsg(CurrentQQ,data,"æœºå™¨èŠå¤©å¤„äºå…³é—­çŠ¶æ€\nâˆ´è¯·å…ˆå¼€å¯æœºå™¨èŠå¤©")
	    return 1
	end
	--åˆ‡æ¢å¤„ç†
	file = io.open("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt", "w")
	if (msg == 1) then
	    file:write("æ–‡å­—èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°æ–‡å­—èŠå¤©")
	elseif (msg == 2) then
	    file:write("è¯­éŸ³èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°è¯­éŸ³èŠå¤©")
	elseif (msg == 3) then
	    file:write("å›å¤èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°å›å¤èŠå¤©")
	end
	file:close()
end

--éšæœºè¡¨æƒ…å‡½æ•°
function faceArray()
    faceArray = {"[è¡¨æƒ…147]","ğŸ€","ğŸ”¥","ğŸ»","ğŸ’","[è¡¨æƒ…185]","[è¡¨æƒ…219]","[è¡¨æƒ…176]"}
    math.randomseed(os.time())
    num = math.random(1, 9)
    return faceArray[num]
end

--urlç¼–ç è½¬æ¢
function escape(w)
	pattern="[^%w%d%._%-%* ]"
	s=string.gsub(w,pattern,function(c)
		local c=string.format("%%%02X",string.byte(c))
		return c
	end)
	s=string.gsub(s," ","+")
	return s
end

--è¯»å–æ•°æ®å‡½æ•°
function Read(url)
    file = io.open(url, "r")
	if (file == nil) then
	    return nil
	else
        file:seek("set")
	    str = file:read("*a")
	    file:close()
        return str
	end
end

--å†™å…¥æ•°æ®å‡½æ•°
function Wirte(url,msg)
    file = io.open(url, "w+")
    file:write(msg)
	file:close()
    return "ok"
end

--å°æ€èŠå¤©å‡½æ•°
function xiaosiapi(CurrentQQ,data,str)
    response, error_message =
            http.request(
            "GET",
            "https://api.ownthink.com/bot",
            {
                query = "appid="..tostring(data.FromUserId).."&spoken=" .. url_encode(str),
                headers = {
                    Accept = "*/*"
                }
            }
        )
        html = response.body
		jData = json.decode(html)
		return jData
end

--æœºå™¨èŠå¤©å‡½æ•°
function ownthink(CurrentQQ,data,msgs,atqq)
    if (tostring(atqq) == CurrentQQ) then
        m = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
        if (m == nil) then
	        log.info("Str ====> %s", m)
            return 1
	    end
	    if (string.find(m, "å…³é—­")) then
	        sedmsg(CurrentQQ,data,"æœºå™¨èŠå¤©å¤„äºå…³é—­çŠ¶æ€\nâˆ´è¯·å…ˆå¼€å¯æœºå™¨èŠå¤©")
	        return 1
	    end
		res2 = string.find(msgs, " ")
		str = string.sub(msgs,res2)
		jData = xiaosiapi(CurrentQQ,data,str)
		Data = json.decode(data.Content)
		m = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
		if (m == nil) then
	        log.info("Str ====> %s", m)
            return 1
	    end
		if (string.find(m, "å›å¤èŠå¤©")) then
		    Api.Api_SendMsg(
                CurrentQQ,
                {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "ReplayMsg",
                groupid = 0,
                content = jData.data.info.text,
                atUser = 0,
				replayInfo = {
                    MsgSeq = data.MsgSeq,
                    --å›å¤æ¶ˆæ¯çš„Seq
                    MsgTime = data.MsgTime,
                    --å›å¤æ¶ˆæ¯çš„äº‹ä»¶
                    UserID = data.FromUserId,
                    --å›å¤æ¶ˆæ¯å¯¹è±¡
                    RawContent = Data.Content --å›å¤æ¶ˆæ¯çš„åŸå†…å®¹
                }
				}
            )
			return 1
		elseif (string.find(m, "æ–‡å­—èŠå¤©")) then
		    sedmsg(CurrentQQ,data,jData.data.info.text)
		else
		    sedvoicemsg(CurrentQQ,data,url_encode(jData.data.info.text))
		end
    end
end

--å‘é€è¯­éŸ³æ¶ˆæ¯
function sedvoicemsg(CurrentQQ,data,str)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "VoiceMsg",
        groupid = 0,
		voiceUrl = "https://dds.dui.ai/runtime/v1/synthesize?voiceId=qianranfa&speed=0.7&volume=100&audioType=wav&text="..str, --å‘é€è¯­éŸ³çš„ç½‘ç»œåœ°å€ æ–‡æœ¬å‹
        voiceBase64Buf = "",
        content = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å¤©æ°”æŸ¥è¯¢å‡½æ•°
function tianqi(CurrentQQ,data)
    keyWord = data.Content:gsub("å¤©æ°”", "")
        if keyWord == "" then
            return 1
        end

        cookies = Api.Api_GetUserCook(CurrentQQ)

        response, error_message =
            http.request(
            "GET",
            "https://weather.mp.qq.com/cgi-bin/rich",
            {
                query = "g_tk=" .. cookies.Gtk .. "&city=" .. url_encode(keyWord),
                headers = {
                    Referer = "http://weather.mp.qq.com/ark"
                },
                cookies = {
                    uin = CurrentQQ,
                    skey = cookies.Skey
                }
            }
        )
        local html = response.body
        log.notice("From Lua html -->%s", html)

        local j = json.decode(html)
        if j.code ~= 0 then
            return 1
        end

        ApiRet =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "JsonMsg",
                groupid = 0,
                content = string.format(
                    --{"config":{"forward":1,"autosize":1},"prompt":"[åº”ç”¨]å¤©æ°”","app":"com.tencent.weather","ver":"0.0.0.1","view":"RichInfoView","meta":{"richinfo":{"adcode":"101210701","city":"æˆéƒ½","air":"58","min":"20","ts":"1500550866","wind":"1","date":"6æœˆ27æ—¥ å‘¨å››","max":"28","type":"201"}},"desc":"å¤©æ°”"}
                    --[[{"app":"com.tencent.weather","desc":"","meta":{"weather":{"ad":[{"icon":"http://imgcache.qq.com/ac/tq/xz2/tp.jpg","p":"ptype=star","t":"2","title":"æ˜Ÿåº§ | ä»Šå¤©ä¼šå› ä¸ºæ„Ÿæƒ…å’Œå®¶åº­çš„é—®é¢˜ï¼Œå½±å“å·¥ä½œï¼Œè¿˜æœ‰ï¼Œä¹Ÿè¦æ³¨æ„äºº...","url":""},{"icon":"http://imgcache.qq.com/ac/qqweather/image/2019/6/27.png","p":"ptype=lunar","t":"4","title":"é»„å† | å†œå†äº”æœˆå»¿äº”ã€‚å®œè®¢ç›Ÿ.çº³é‡‡.å‡ºè¡Œ.ç¥ˆç¦.æ–‹é†®.å®‰åºŠ.ä¼š...","url":""}],"info":{"it1":{"adcode":"101050101","city":"æ­¦æ±‰","hour":"18","max":"29","min":"17","temp":"24","type":"202","ut":"1561630401","wea":"å¤šäº‘"},"it2":{"hour":"19","temp":"22","type":"202"},"it3":{"hour":"20","temp":"21","type":"202"},"ts":"1561631244"},"url":""}},"prompt":"ã€å“ˆå°”æ»¨ã€‘å¤šäº‘ 17Â°/29Â°, 18:13æ›´æ–°~","ver":"1.0.0.106","view":"WeatherThreeView"}]]
                    [[{"app":"com.tencent.weather","desc":"å¤©æ°”","view":"RichInfoView","ver":"1.0.0.217","prompt":"[åº”ç”¨]å¤©æ°”","meta":{"richinfo":{"adcode":"%s","air":"%s","city":"%s","date":"%s","max":"%s","min":"%s","ts":"1554951408","type":"%s","wind":"%s"}},"config":{"forward":1,"autosize":1,"type":"card"}}]],
                    j.data.adcode,
                    j.data.air,
                    j.data.city,
                    j.data.date,
                    j.data.max,
                    j.data.min,
                    j.data.type,
                    j.data.wind
                ),
                atUser = 0
            }
        )
end

--è°ƒæ•™å¤„ç†å‡½æ•°(å¾…å¤„ç†)
function tiaojiao(CurrentQQ,data)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
	if (mim == nil) then
		sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå“‡")
		return 1
	end
	if (string.find(data.Content, "^åˆ é™¤è°ƒæ•™")) then
	    msg = data.Content:gsub("åˆ é™¤è°ƒæ•™", "")
	    if (msg == "") then
		    sedmsg(CurrentQQ,data,"è¦åˆ é™¤çš„è°ƒæ•™æŒ‡ä»¤ä¸èƒ½ä¸ºç©ºå“¦")
		    return 1
		end
		rese = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..tostring(data.FromGroupId).."\/"..msg..".txt")
	    if (rese == nil) then
			sedmsg(CurrentQQ,data,"è¿™ä¸ªæŒ‡ä»¤ä¸å­˜åœ¨äº†å“¦")
		    return 1
		end
		rm_file = os.remove("mimoio\/æœºå™¨è°ƒæ•™\/"..tostring(data.FromGroupId).."\/"..msg..".txt")
		log.info("åˆ é™¤è°ƒæ•™ ====> %s", rm_file)
		sedmsg(CurrentQQ,data,"åˆ é™¤æˆåŠŸ\nä½ ä¸å–œæ¬¢è¢«è¿™æ ·è°ƒæ•™çš„æˆ‘å—[è¡¨æƒ…9]")
		return 1
	end
    msgs = data.Content:gsub("è°ƒæ•™", "")
		res2 = string.find(msgs, "#")
		str = string.sub(msgs,res2+1)
		str2 = string.sub(msgs,1,res2-1)
		        
		        if (str == "") then
		            sedmsg(CurrentQQ,data,"è°ƒæ•™çš„å›ç­”å†…å®¹ä¸èƒ½ä¸ºç©ºå“¦")
			        return 1
		        end
				if (str2 == "") then
		            sedmsg(CurrentQQ,data,"è°ƒæ•™çš„æŒ‡ä»¤å†…å®¹ä¸èƒ½ä¸ºç©ºå“¦")
			        return 1
		        end
		        rese = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..str2..".txt")
					if (rese ~= nil) then
				        sedmsg(CurrentQQ,data,"æŒ‡ä»¤å·²ç»å­˜åœ¨äº†å“¦")
				        return 1
				    end
				Wirte("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..str2..".txt",str)
				sedmsg(CurrentQQ,data,"è°ƒæ•™æˆåŠŸ\nä½ è¿˜æƒ³å†è°ƒæ•™æˆ‘ä¸€æ¬¡å—[è¡¨æƒ…6]")
		        return 1
end

function url_encode(str)
    if (str) then
        str = string.gsub(str, "\n", "\r\n")
        str =
            string.gsub(
            str,
            "([^%w ])",
            function(c)
                return string.format("%%%02X", string.byte(c))
            end
        )
        str = string.gsub(str, " ", "+")
    end
    return str
end

--æŠ¢çº¢åŒ…å¤„ç†
function RedBag(CurrentQQ, data)
    Api.Api_OpenRedBag(CurrentQQ, data.RedBaginfo)
    if (data.RedBaginfo.RedType == 12) then
         luaRes =
                Api.Api_SendMsg(
                CurrentQQ,
                {
                    toUser = data.FromGroupId,
                    sendToType = 2,
                    sendMsgType = "TextMsg",
                    groupid = 0,
                    content = data.RedBaginfo.Tittle,
                    atUser = 0
                }
            )
        log.notice("From Lua SendMsg Ret\n%d", luaRes.Ret)
    end
end

--è§†é¢‘è§£æå¤„ç†
function Video(CurrentQQ, data)
    vdata = json.decode(data.Content)
        videodata = {
            GroupID = data.FromGroupId,
            VideoUrl = vdata.VideoUrl,
            VideoMd5 = vdata.VideoMd5
        }
        --æ„é€ table å‚æ•°è¡¨
        luaResp = Api.Api_CallFunc(CurrentQQ, "PttCenterSvr.ShortVideoDownReq", videodata) --é€šè¿‡cmdè°ƒç”¨åŠŸèƒ½åŒ…
        luaRes =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "TextMsg",
                groupid = 0,
                content = "è§£æè§†é¢‘URL-->" .. luaResp.VideoUrl,
                atUser = 0
            }
        )
end

--ç®¡ç†å¼€å…³é€šç”¨
function adminio(CurrentQQ,data,oio)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim ~= nil) then
            msg = data.Content:gsub(oio, "")
            str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
            if (string.find(str, "å…³é—­")) then
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äººå·²è¢«å…³é—­...\nè¯·å…ˆå¼€å¯æœºå™¨äºº")
                return 1
            end
			str2 = Read("mimoio\/çŠ¶æ€æ•°æ®\/"..oio.."\/"..data.FromGroupId..".txt")
			if (string.find(str2, msg)) then
			    sedmsg(CurrentQQ,data,"âˆ´"..oio.."æœ¬å°±æ˜¯"..str2.."çŠ¶æ€")
                return 1
			end
            Wirte("mimoio\/çŠ¶æ€æ•°æ®\/"..oio.."\/"..data.FromGroupId..".txt",msg)
            sedmsg(CurrentQQ,data,"âˆ´"..oio..msg.."æˆåŠŸ")
            return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
end

--ç™¾ç§‘å¤§å…¨
function baike(CurrentQQ,data)
    keyWord = data.Content:gsub("ç™¾ç§‘", "")
        if keyWord == "" then
            return 1
        end
        response, error_message =
            http.request(
            "GET",
            "http://baike.baidu.com/api/openapi/BaikeLemmaCardApi",
            {
                query = "scope=103&format=json&appid=379020&bk_key=" .. url_encode(keyWord) .. "&bk_length=600"
            }
        )
        html = response.body
        while(string.find(html, '"errno":2')) do
            response, error_message =
            http.request(
            "GET",
            "http://baike.baidu.com/api/openapi/BaikeLemmaCardApi",
            {
                query = "scope=103&format=json&appid=379020&bk_key=" .. url_encode(keyWord) .. "&bk_length=600"
            })
			html = response.body
        end
        local j = json.decode(html)
        sedmsg(CurrentQQ,data,j.abstract.."\n"..j.url)
end

--éŸ³ä¹ç‚¹æ­Œ
function music(CurrentQQ,data)
    keyWord = data.Content:gsub("ç‚¹æ­Œ", "")
        if keyWord == "" then
            return 1
        end
        response, error_message =
            http.request(
            "GET",
            "https://c.y.qq.com/soso/fcgi-bin/client_search_cp",
            {
                query = "aggr=1&cr=1&flag_qc=0&p=1&n=6&w=" .. url_encode(keyWord)
            }
        )
        html = response.body
		str = string.sub(html,10,-2)
        j = json.decode(str)
        if (j.code == 0) then
            msg = ""
            num = j.data.song.list
            list = num[1]
            songname = list.songname
            singername = list.singer[1].name
            payplay = list.pay.payplay
			albummid = list.albummid
			songmid = list.songmid
	        sedjsonmsg(CurrentQQ,data,'{"app":"com.tencent.structmsg","desc":"éŸ³ä¹","view":"music","ver":"0.0.0.1","prompt":"[åˆ†äº«]' ..songname.. '","meta":{"music":{"sourceMsgId":"0","title":"' ..songname.. '","desc":"' ..singername.. '","preview":"y.gtimg.cn/music/photo_new/T002R150x150M000'..albummid..'.jpg","tag":"QQéŸ³ä¹","musicUrl":"https://v1.itooi.cn/tencent/url?id='..songmid..'","jumpUrl":"y.qq.com/n/yqq/song/'..songmid..'.html","appid":100497308,"app_type":1,"action":"","source_url":"url.cn/5aSZ8Gc","source_icon":"url.cn/5tLgzTm","android_pkg_name":"com.tencent.qqmusic"}},"config":{"forward":true,"type":"normal","autosize":true}}')
			return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´Error:"..j.code)
			return 1
        end
end

--è®¿é—®url
function geturl(url_class,url,caulrt)
        response, error_message =
            http.request(
            url_class,
            url,
            {
                query = caulrt
            }
        )
        html = response.body
		return html
end

--æ¶ˆæ¯å‚¨è“„
function msgsql(CurrentQQ,data)
    if (mysqlpass == "") then
	    return 1
	end
    c = mysql.new()
    -- åˆå§‹åŒ–mysqlå¯¹è±¡
    ok, err = c:connect({host = mysqlhost, port = 3306, database = mysqldb, user = mysqluser, password = mysqlpass})
    --å»ºç«‹è¿æ¥
    if ok then
        sqlstr =
            string.format(
            [[INSERT INTO msgcache (GroupID, MsgSeq, MsgRandom,MsgType,Data,MsgTime)VALUES (%d,%d,%d,'%s','%s',%d)]],
            data.FromGroupId,
            data.MsgSeq,
            data.MsgRandom,
            data.MsgType,
            data.Content,
            data.MsgTime
        )
        res, err = c:query(sqlstr) --å…¥åº“ç¼“å­˜æ¶ˆæ¯
        log.info("%s", err)
        c.close(c)
    --é‡Šæ”¾è¿æ¥
    end
    return 1
end

--æ’¤å›æ£€æµ‹
function CheHui(CurrentQQ, data, extData)
    c = mysql.new()
    -- åˆå§‹åŒ–mysqlå¯¹è±¡
	if (mysqlpass == "") then
	    return 1
	end
	
    if data.MsgType == "ON_EVENT_GROUP_REVOKE" then --ç›‘å¬ ç¾¤æ’¤å›äº‹ä»¶
        str = string.format("ç¾¤æˆ %d  æˆå‘˜ UserID %s æ’¤å›äº†æ¶ˆæ¯Seq %s \n", extData.GroupID, extData.UserID, extData.MsgSeq)
        log.info("%s", str)
        ok, err = c:connect({host = mysqlhost, port = 3306, database = mysqldb, user = mysqluser, password = mysqlpass})
        --å»ºç«‹è¿æ¥
        log.info("sql %v", err)
        if ok then
            sqlstr =
                string.format(
                "select * from msgcache where `GroupID`= %d and `MsgSeq` = %d",
                extData.GroupID,
                extData.MsgSeq
            )
            res, err = c:query(sqlstr) --è·Ÿç¾¤ç¾¤idå’Œæ¶ˆæ¯SEQæŸ¥è¯¢å‡ºæ’¤å›çš„æ¶ˆæ¯å†…å®¹
            if err == nil then
                c.close(c)
                GroupID = tonumber(res[1]["GroupID"])
                MsgType = res[1]["MsgType"]
                Data = res[1]["Data"]

                if MsgType == "TextMsg" then
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            --å‘é€æ–‡æœ¬æ¶ˆæ¯
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡æ–‡æœ¬æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                Data
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "SmallFaceMsg" then
                    --Data {"Content":"[è¡¨æƒ…101]","Hex":"FKY=","Index":101,"tips":"[å°è¡¨æƒ…]"}
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡è¡¨æƒ…æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).Content
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "PicMsg" then
                    --Data {"Content":"","FileId":2820717626,"FileMd5":"q0oEC5aloJJMFr10mplaXw==","FileSize":7026,"tips":"[ç¾¤å›¾ç‰‡]","url":"http://gchat.qpic.cn/gchatpic_new/1700487478/960839480-2534335053-AB4A040B96A5A0924C16BD749A995A5F/0?vuin=u0026term=255u0026pictype=0"}
                    jData = json.decode(Data)
					if (jData.tips == "[ç¾¤æ¶ˆæ¯-QQé—ªç…§]") then
					    
					Api.Api_SendMsg( 
                    CurrentQQ,
                    {
                        toUser = GroupID,
                        sendToType = 2,
                        sendMsgType = "ForwordMsg",
                        content = "",
                        atUser = 0,
                        groupid = 0,
                        voiceUrl = "",
                        voiceBase64Buf = "",
                        picUrl = "",
                        picBase64Buf = "",
                        forwordBuf = json.decode(Data).ForwordBuf, --æ¬²è½¬å‘çš„base64buf å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                        forwordField = json.decode(Data).ForwordField --æ¬²å†™å…¥åè®®çš„å­—æ®µID å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                    }
                )
				    return 1
					end
                    Api.Api_SendMsg( --é€šè¿‡å›¾ç‰‡md5å‘é€å›¾ç‰‡ ç§’å‘ä¸ç”¨ä¸Šä¼  ç›¸å½“äºè½¬å‘
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "PicMsg",
                            --å‘é€å›¾æ–‡æ¶ˆæ¯
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡å›¾ç‰‡æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š[PICFLAG]%s",
                                extData.UserID,
                                jData.Content
                            ),
                            --é€šè¿‡å®[PICFLAG]æ”¹å˜å›¾æ–‡é¡ºåº  æ”¹ä¸ºç°æ–‡å­—åå›¾ç‰‡
                            atUser = 0,
                            voiceUrl = "",
                            voiceBase64Buf = "",
                            picUrl = "",
                            picBase64Buf = "",
                            fileMd5 = jData.FileMd5
                        }
                    )
                end
                if MsgType == "AtMsg" then
                    --Data {"Content":"@Kar98k skjjkssjkjs","UserID":123456789,"tips":"[ATæ¶ˆæ¯]"}
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡atæ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).Content
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "VoiceMsg" then
                    --Data {"tips":"[è¯­éŸ³]","url":"http://grouptalk.c2c.qq.com/?ver=0u0026rkey=3062020101045b305902010102010102041fdef8ae042439416931554e5142586c536d78706a314c686843664959725f327a5f573064697653755902045dac2a21041f0000000866696c6574797065000000013100000005636f64656300000001310400u0026filetype=1u0026voice_codec=1"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "VoiceMsg",
                            --å‘é€ç¾¤è¯­éŸ³æ¶ˆæ¯
                            groupid = 0,
                            content = "",
                            atUser = 0,
                            voiceUrl = json.decode(Data).url,
                            --é€šè¿‡ç½‘ç»œurlè¿›è¡Œå‘é€è¯­éŸ³
                            voiceBase64Buf = "",
                            picUrl = "",
                            picBase64Buf = ""
                        }
                    )
                end

                if MsgType == "ReplayMsg" then
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡å›å¤æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).ReplayContent
                            ),
                            atUser = 0
                        }
                    )
                end
				if MsgType == "VideoMsg" then
	             Api.Api_SendMsg( 
                    CurrentQQ,
                    {
                        toUser = GroupID,
                        sendToType = 2,
                        sendMsgType = "ForwordMsg",
                        content = "",
                        atUser = 0,
                        groupid = 0,
                        voiceUrl = "",
                        voiceBase64Buf = "",
                        picUrl = "",
                        picBase64Buf = "",
                        forwordBuf = json.decode(Data).ForwordBuf, --æ¬²è½¬å‘çš„base64buf å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                        forwordField = json.decode(Data).ForwordField --æ¬²å†™å…¥åè®®çš„å­—æ®µID å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                    }
                )
				end
                if MsgType == "XmlMsg" then
				    
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "XmlMsg",
                            groupid = 0,
                            content = string.format("%s", Data),
                            atUser = 0
                        }
                    )
                end
				if MsgType == "JsonMsg" then
				    
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "JsonMsg",
                            groupid = 0,
                            content = string.format("%s", Data),
                            atUser = 0
                        }
                    )
                end
            end
        end
    end
    return 1
end
2020/09/07 12:30:24.618 [E]  QQLuaVmRun CallGlobal err Unknow Lua Function:ReceiveEvents detail File weatherfy4a.lua when  call ReceiveEvents params [0] 1689236904  [1] &{928308961 0 ON_EVENT_GROUP_REVOKE 529765 ç¾¤æˆå‘˜æ’¤å›æ¶ˆæ¯äº‹ä»¶ <nil>}  [2] map[AdminUserID:2369500214 GroupID:928308961 MsgRandom:1429157433 MsgSeq:529765 UserID:2369500214]
2020/09/07 12:54:09.014 [E]  mimoio.lua
2020/09/07 12:54:09.016 [E]  local log = require("log")
local Api = require("coreApi")
local json = require("json")
local http = require("http")
local mysql = require("mysql")

--ç‰ˆæœ¬å·(ä¸è¦æ”¹åŠ¨)
Vabr = "1.0.2"
--æ•°æ®åº“é…ç½®
mysqlhost = "localhost"--é»˜è®¤ä¸åŠ¨
mysqldb = "ffaxx001"--æ•°æ®åº“å
mysqluser = "ffaxx001"--æ•°æ®åº“ç”¨æˆ·å
mysqlpass = "123456"--æ•°æ®åº“å¯†ç 
--ä¸ä½¿ç”¨è¯·ä¸è¦æ”¹åŠ¨

function ReceiveFriendMsg(CurrentQQ, data)
    if (data.Content == "ä½¿ç”¨æ–¹æ³•") then
	    sendfrimsg(CurrentQQ,data,"æ·»åŠ æˆæƒè€…çš„æ–¹æ³•\nå¯¹å•ä¸ªæœºå™¨äººç§èŠå‘é€[æ·»åŠ æˆæƒè€…+æˆæƒè€…QQ]\n\næˆæƒç¾¤çš„æ–¹æ³•\nåˆ°éœ€è¦æˆæƒçš„ç¾¤é‡Œå‘é€[æˆæƒ+ä¸»äººQQ]ã€‚æ³¨æ„:æˆæƒå¿…é¡»æ˜¯æˆæƒè€…è¿›è¡Œæ“ä½œ,ç®¡ç†å‘˜æˆæƒä¸äº†")
	end
    --æ•°æ®åˆå§‹åŒ–
    if (data.Content == "åˆå§‹åŒ–") then
	    root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root ~= nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´è¯·ä¸è¦é‡å¤åˆå§‹åŒ–")
			return 1
		end
    --os.execute('mkdir mimoio/æœºå™¨æˆæƒ')
	    os.execute('mkdir mimoio')
		os.execute('mkdir mimoio/å¤è¯»æœº')
		os.execute('mkdir mimoio/å¤è¯»æœº/æ¬¡æ•°')
		os.execute('mkdir mimoio/å¤è¯»æœº/å†…å®¹')
		os.execute('mkdir mimoio/æœºå™¨æˆæƒ')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨ä¸»äºº')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨èŠå¤©')
		os.execute('mkdir mimoio/æœºå™¨è°ƒæ•™')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æŠ¢çº¢åŒ…')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æœºå™¨èŠå¤©')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æœºå™¨å¼€å…³')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æ’¤å›æ£€æµ‹')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/å›¾ç‰‡è§£æ')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/è§†é¢‘è§£æ')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/é—ªç…§æ£€æµ‹')
		Wirte("mimoio\/"..data.FromUin..".txt","999")
		sendfrimsg(CurrentQQ,data,"åˆå§‹åŒ–å®Œæ¯•ï¼\nå‘é€[ä½¿ç”¨æ–¹æ³•]äº†è§£ä½¿ç”¨å§")
	end
	--æ·»åŠ æˆæƒè€…æ“ä½œ(ç§èŠæœºå™¨äººå‘é€)
	if (string.find(data.Content, "^æ·»åŠ æˆæƒè€…")) then
	    msg = data.Content:gsub("æ·»åŠ æˆæƒè€…", "")
		--Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromUin..".txt","å…³é—­")
		root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root == nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„ç®¡ç†è€…")
			return 1
		end
		Wirte("mimoio\/æœºå™¨æˆæƒ\/"..msg..CurrentQQ..".txt","999")
		sendfrimsg(CurrentQQ,data,"âˆ´æ·»åŠ æˆæƒè€…æˆåŠŸ")
	end
	--åˆ é™¤æˆæƒè€…æ“ä½œ(ç§èŠæœºå™¨äººå‘é€)
	if (string.find(data.Content, "^åˆ é™¤æˆæƒè€…")) then
	    msg = data.Content:gsub("åˆ é™¤æˆæƒè€…", "")
		--Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromUin..".txt","å…³é—­")
		root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root == nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„ç®¡ç†è€…")
			return 1
		end
		os.remove("mimoio\/æœºå™¨æˆæƒ\/"..msg..CurrentQQ..".txt")
		sendfrimsg(CurrentQQ,data,"âˆ´åˆ é™¤æˆæƒè€…æˆåŠŸ")
	end
    return 1
end
function ReceiveGroupMsg(CurrentQQ, data)
    if (tostring(data.FromUserId) == CurrentQQ) then
	    return 1
	end
	--ç¾¤èŠæˆæƒ(åˆ°éœ€è¦æˆæƒçš„ç¾¤é‡Œæ“ä½œ)
	if (string.find(data.Content, "^æˆæƒ")) then
	    root = Read("mimoio\/æœºå™¨æˆæƒ\/"..data.FromUserId..CurrentQQ..".txt","999")
		if (root == nil) then
		    sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„æˆæƒè€…")
			return 1
		end
		msg = data.Content:gsub("æˆæƒ", "")
		os.execute('mkdir mimoio/æœºå™¨è°ƒæ•™/'..data.FromGroupId)
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨ä¸»äºº/'..data.FromGroupId)
		Wirte("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..msg..".txt","999")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt","å›å¤èŠå¤©")
		sedmsg(CurrentQQ,data,"âˆ´æˆæƒæˆåŠŸï¼\nå‘é€[å¼€å¯æœºå™¨äºº]ä½¿ç”¨å§")
	end
	--åˆ é™¤æˆæƒæ“ä½œ(åˆ°éœ€è¦åˆ é™¤æˆæƒçš„ç¾¤é‡Œæ“ä½œ)
	if (string.find(data.Content, "^åˆ é™¤æˆæƒ")) then
	    root = Read("mimoio\/æœºå™¨æˆæƒ\/"..data.FromUserId..CurrentQQ..".txt","999")
		if (root == nil) then
		    sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„æˆæƒè€…")
			return 1
		end
		msg = data.Content:gsub("åˆ é™¤æˆæƒ", "")
		os.remove("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..msg..".txt")
		os.remove("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
		sedmsg(CurrentQQ,data,"âˆ´åˆ é™¤æˆæƒæˆåŠŸï¼")
	end
	--æœºå™¨å¼€å…³æŒ‡ä»¤
	if (data.Content == "å¼€å¯æœºå™¨äºº" or data.Content == "å…³é—­æœºå™¨äºº") then
        mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim ~= nil) then
            msg = data.Content:gsub("æœºå™¨äºº", "")
            str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
			if (str == nil) then
			    Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt",msg)
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äºº"..msg.."æˆåŠŸï¼")
				log.info("Str ====> %s", str)
                return 1
			end
			
            if (string.find(str, msg)) then
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äººä¸€ç›´æ˜¯"..msg.."çš„å‘")
                return 1
            end
            Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt",msg)
            sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äºº"..msg.."æˆåŠŸï¼")
            return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
	end
    --æœºå™¨äººå¼€å¯æ£€æµ‹
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
	if (str == nil) then
	    log.info("Str ====> %s", str)
        return 1
	end
	if (string.find(str, "å…³é—­")) then
	    return 1
	end
	--atæ¶ˆæ¯å¤„ç†
	msgs = ""
	atqq = 0
	if (string.find(data.Content, "ATæ¶ˆæ¯")) then
	    msgs = json.decode(data.Content).Content
		atqq = json.decode(data.Content).UserID
	end
	--å°¾å·´è‡ªå®šä¹‰(å¾…å®Œå–„)
	tips = "â€”â€”å‡¤é£ç¿±ç¿”å…®ä¸·"
    --åŠŸèƒ½æ¨¡å—
    if (data.Content == "åŠŸèƒ½" or data.Content == "ä¸»ç•Œé¢") then
        face = faceArray()
        sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."å½±è§†æœç´¢\n"..face.."èŠå¤©å¨±ä¹\n"..face.."ä¾¿åˆ©åŠŸèƒ½\n"..face.."æœºå™¨è°ƒæ•™\n"..face.."ç®¡ç†ç³»ç»Ÿ\n"..face.."bugåé¦ˆ\n"..face.."æœ¬ç¾¤çŠ¶æ€\n"..face.."æ›´æ–°æ£€æµ‹\n\n"..tips)
    end
    --å½±è§†æœç´¢æ¨¡å—
    if (data.Content == "å½±è§†æœç´¢") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."æœç´¢+å½±è§†å\n"..face.."æˆ‘æƒ³çœ‹+å½±è§†å\n"..face.."æˆ‘è¦çœ‹+å½±è§†å\n\n"..tips)
    elseif (string.find(data.Content, "^æœç´¢")) then
	    msg = data.Content:gsub("æœç´¢", "")
		Sousuo(CurrentQQ,data,msg)
	elseif (string.find(data.Content, "^æˆ‘æƒ³çœ‹")) then
	    msg = data.Content:gsub("æˆ‘æƒ³çœ‹", "")
		Sousuo(CurrentQQ,data,msg)
    elseif (string.find(data.Content, "^æˆ‘è¦çœ‹")) then
	    msg = data.Content:gsub("æˆ‘è¦çœ‹", "")
		Sousuo(CurrentQQ,data,msg)
	end
	--èŠå¤©å¨±ä¹æ¨¡å—
	if (data.Content == "èŠå¤©å¨±ä¹") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."åˆ‡æ¢æ–‡å­—èŠå¤©\n"..face.."åˆ‡æ¢å›å¤èŠå¤©\n"..face.."åˆ‡æ¢è¯­éŸ³èŠå¤©\n\n"..tips)
    elseif (data.Content == "åˆ‡æ¢æ–‡å­—èŠå¤©") then
		liaotian(CurrentQQ,data,1)
	elseif (data.Content == "åˆ‡æ¢è¯­éŸ³èŠå¤©") then
	    liaotian(CurrentQQ,data,2)
    elseif (data.Content == "åˆ‡æ¢å›å¤èŠå¤©") then
	    liaotian(CurrentQQ,data,3)
	else
	    ownthink(CurrentQQ,data,msgs,atqq)
	end
	--ä¾¿åˆ©åŠŸèƒ½æ¨¡å—
	if (data.Content == "ä¾¿åˆ©åŠŸèƒ½") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."ç™¾ç§‘å¤§å…¨\n"..face.."éŸ³ä¹ç‚¹æ­Œ\n"..face.."é—ªä»–@xx\n"..face.."å¤©æ°”æŸ¥è¯¢\n\n"..tips)
	elseif (data.Content == "ç™¾ç§‘å¤§å…¨") then
		sedmsg(CurrentQQ,data,"å‘é€:[ç™¾ç§‘+å…³é”®è¯]\nä¾‹å¦‚:ç™¾ç§‘æ´›å¦¾èº«")
    elseif (data.Content == "éŸ³ä¹ç‚¹æ­Œ") then
		sedmsg(CurrentQQ,data,"å‘é€:[ç‚¹æ­Œ+æ­Œå]\nä¾‹å¦‚:ç‚¹æ­Œé’æŸ ")
	elseif (data.Content == "å¤©æ°”æŸ¥è¯¢") then
		sedmsg(CurrentQQ,data,"å‘é€:[å¤©æ°”+åœ°æ–¹å]\nä¾‹å¦‚:å¤©æ°”åŒ—äº¬(é™äºå›½å†…)")
    elseif (string.find(data.Content, "^å¤©æ°”")) then
        tianqi(CurrentQQ,data)
	    --msg = data.Content:gsub("æœç´¢", "")
		--Sousuo(CurrentQQ,data,msg)
	elseif (string.find(data.Content, "^ç™¾ç§‘")) then
	    baike(CurrentQQ,data)
	    --msg = data.Content:gsub("æˆ‘æƒ³çœ‹", "")
		--Sousuo(CurrentQQ,data,msg)music(CurrentQQ,data)
    elseif (string.find(data.Content, "^ç‚¹æ­Œ")) then
	    music(CurrentQQ,data)
	end
	--æœºå™¨è°ƒæ•™æ¨¡å—
	if (data.Content == "æœºå™¨è°ƒæ•™") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."æ–‡å­—è°ƒæ•™\n"..face.."è¯­éŸ³è°ƒæ•™\n"..face.."å”±æ­Œè°ƒæ•™\n"..face.."éŸ³ä¹è°ƒæ•™\n"..face.."å›¾ç‰‡è°ƒæ•™\n"..face.."åˆ é™¤è°ƒæ•™\n\n"..tips)
    elseif (data.Content == "æ–‡å­—è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#(å†…å®¹)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#ä½ å¥½å•Š")
	elseif (data.Content == "è¯­éŸ³è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#è¯­éŸ³(å†…å®¹)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#è¯­éŸ³ä½ å¥½å•Š")
	elseif (data.Content == "å›¾ç‰‡è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#å›¾ç‰‡(é“¾æ¥)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#å›¾ç‰‡http://../1.jpg")
	elseif (data.Content == "éŸ³ä¹è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#ç‚¹æ­Œ(æ­Œå)]\nä¾‹å¦‚:è°ƒæ•™å–µ#ç‚¹æ­Œå­¦çŒ«å«")
	elseif (data.Content == "å”±æ­Œè°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#å”±æ­Œ(æ­Œå)]\nä¾‹å¦‚:è°ƒæ•™å–µ#å”±æ­Œå­¦çŒ«å«")
	elseif (data.Content == "åˆ é™¤è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[åˆ é™¤è°ƒæ•™(æŒ‡ä»¤)]\nä¾‹å¦‚:åˆ é™¤è°ƒæ•™ä½ å¥½")
	elseif (string.find(data.Content, "^è°ƒæ•™")) then
        tiaojiao(CurrentQQ,data)
	elseif (string.find(data.Content, "^åˆ é™¤è°ƒæ•™")) then
        tiaojiao(CurrentQQ,data)
	end
	--ç®¡ç†ç³»ç»Ÿæ¨¡å—
	if (data.Content == "ç®¡ç†ç³»ç»Ÿ") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."å¼€å¯/å…³é—­æœºå™¨äºº\n"..face.."å¼€å¯/å…³é—­æŠ¢çº¢åŒ…\n"..face.."å¼€å¯/å…³é—­æœºå™¨èŠå¤©\n"..face.."å¼€å¯/å…³é—­é—ªç…§æ£€æµ‹\n"..face.."å¼€å¯/å…³é—­å›¾ç‰‡è§£æ\n"..face.."å¼€å¯/å…³é—­è§†é¢‘è§£æ\n"..face.."å¼€å¯/å…³é—­æ’¤å›æ£€æµ‹\n\n"..tips)
    elseif (data.Content == "å¼€å¯æœºå™¨èŠå¤©" or data.Content == "å…³é—­æœºå™¨èŠå¤©") then
        adminio(CurrentQQ,data,"æœºå™¨èŠå¤©")
    elseif (data.Content == "å¼€å¯æ’¤å›æ£€æµ‹" or data.Content == "å…³é—­æ’¤å›æ£€æµ‹") then
        adminio(CurrentQQ,data,"æ’¤å›æ£€æµ‹")
	elseif (data.Content == "å¼€å¯é—ªç…§æ£€æµ‹" or data.Content == "å…³é—­é—ªç…§æ£€æµ‹") then
        adminio(CurrentQQ,data,"é—ªç…§æ£€æµ‹")
	elseif (data.Content == "å¼€å¯æŠ¢çº¢åŒ…" or data.Content == "å…³é—­æŠ¢çº¢åŒ…") then
        adminio(CurrentQQ,data,"æŠ¢çº¢åŒ…")
	elseif (data.Content == "å¼€å¯è§†é¢‘è§£æ" or data.Content == "å…³é—­è§†é¢‘è§£æ") then
        adminio(CurrentQQ,data,"è§†é¢‘è§£æ")
	elseif (data.Content == "å¼€å¯å›¾ç‰‡è§£æ" or data.Content == "å…³é—­å›¾ç‰‡è§£æ") then
        adminio(CurrentQQ,data,"å›¾ç‰‡è§£æ")
	end
	--bugåé¦ˆæ¨¡å—
	if (data.Content == "BUGåé¦ˆ" or data.Content == "bugåé¦ˆ") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."é‚®ä»¶åé¦ˆ\n"..face.."QQåé¦ˆ\n\n"..tips)
    elseif (data.Content == "QQåé¦ˆ") then
        sedmsg(CurrentQQ,data,"???Î£(ï¾Ÿâˆ€ï¾Ÿï¾‰)ï¾‰\næ’ä»¶æœ‰é—®é¢˜å¯ä»¥åé¦ˆåˆ°:\nQQ:2353065854")
    elseif (data.Content == "é‚®ä»¶åé¦ˆ") then
        sedmsg(CurrentQQ,data,"å®è´å’‹å•¦=ÍÍŸÍŸÍ(ê’ªá—œê’ª â€§Ì£Ì¥Ì‡)\næ’ä»¶æœ‰é—®é¢˜å¯ä»¥åé¦ˆåˆ°:\né‚®ç®±ğŸ“¬:ym-o@qq.com")
	end
	--æœ¬ç¾¤çŠ¶æ€æ¨¡æ¿
	if (data.Content == "æœ¬ç¾¤çŠ¶æ€") then
        face = faceArray()
        hb = Read("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt")
        sz = Read("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt")
		tp = Read("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt")
        sp = Read("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt")
        jqr = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
        lt = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
        ch = Read("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..data.FromGroupId..".txt")
		sedmsg(CurrentQQ,data,"çŠ¶æ€æ•°æ®åˆ—è¡¨â†“â†“â†“\n"..face.."æœºå™¨äºº:"..jqr.."\n"..face.."æŠ¢çº¢åŒ…:"..hb.."\n"..face.."å›¾ç‰‡è§£æ:"..tp.."\n"..face.."æ’¤å›æ£€æµ‹:"..ch.."\n"..face.."è§†é¢‘è§£æ:"..sp.."\n"..face.."æœºå™¨èŠå¤©:"..lt.."\n"..face.."é—ªç…§æ£€æµ‹:"..sz.."\n\n"..tips)
	end
	--æ›´æ–°æ¨¡å—
	if (data.Content == "æ›´æ–°æ£€æµ‹") then
        str = geturl("GET","http://118.25.41.32/Lsb/lua/Vabr.txt","")
		log.info("Str ====> %s", str)
        if (string.find(str, Vabr)) then
            sedmsg(CurrentQQ,data,"å½“å‰ç‰ˆæœ¬ä¸ºæœ€æ–°ç‰ˆ")
        else
            sedmsg(CurrentQQ,data,"å‘ç°æ–°ç‰ˆæœ¬!\nå½“å‰ç‰ˆæœ¬:"..Vabr.."\næ–°ç‰ˆæœ¬å·:"..str.."\nèµ¶å¿«å‘é€[æ›´æ–°æ’ä»¶]å§")
        end
	elseif (data.Content == "æ›´æ–°æ’ä»¶") then
	    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim == nil) then
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
        str = geturl("GET","http://118.25.41.32/Lsb/lua/Vabr.txt","")
		log.info("Str ====> %s", str)
        if (string.find(str, Vabr)) then
            sedmsg(CurrentQQ,data,"å½“å‰ç‰ˆæœ¬ä¸ºæœ€æ–°ç‰ˆ")
        else
            str = geturl("GET","http://118.25.41.32/Lsb/lua/mimoio.txt","")
            Wirte("Plugins\/mimoio.lua",str)
            sedmsg(CurrentQQ,data,"æ›´æ–°å®Œæ¯•ï¼")
        end
	end
	--å›¾ç‰‡ç±»å‹æ¶ˆæ¯å¤„ç†
    if (data.MsgType == "PicMsg") then
	    msg = Read("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt")
		jData = json.decode(data.Content)
	    if (msg ~= nil and jData.tips ~= "[ç¾¤æ¶ˆæ¯-QQé—ªç…§]") then
            if (string.find(str, "å¼€å¯")) then
	            sedmsg(CurrentQQ,data,"å›¾ç‰‡é“¾æ¥è§£æå¦‚ä¸‹â†“â†“\n"..jData.url)
				return 1
	        end
	    end
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt")
	    if (str == nil) then
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    --é—ªç…§ã€å›¾ç‰‡å¤„ç†æ¨¡å—
		PicFlag(CurrentQQ, data)
    end
	--æŠ¢çº¢åŒ…å¤„ç†
	if (string.find(data.MsgType, "RedBagMsg") == 1) then
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt")
		if (str == nil) then
	        log.info("Str ====> %s", str)
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    RedBag(CurrentQQ, data)
	end
	--è§†é¢‘è§£æå¤„ç†
	if (string.find(data.MsgType, "VideoMsg") == 1) then
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt")
		if (str == nil) then
	        log.info("Str ====> %s", str)
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    Video(CurrentQQ, data)
	end
	--até—ªå›¾
	if (data.MsgType == "AtMsg") and (string.find(data.Content, "é—ªä»–")) then
	    shantu(CurrentQQ, data)
    end
	--è°ƒæ•™æœç´¢å¼•æ“
	mim = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..data.Content..".txt")
	if (mim == nil) then
	    --äººç±»çš„æœ¬è´¨æ˜¯å¤è¯»æœº
	    msg = Read("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt")
		if (msg ~= nil) then
		    cs = Read("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt")
			ii = tonumber(cs)
			if (string.find(msg, "^"..data.Content.."$")) then
			    if (ii > 2) then
			         math.randomseed(os.time())
                     sj = math.random(1, 5)
		             if (sj == 1 or sj == 2) then
			             sedmsg(CurrentQQ,data,msg)
					     rr = ii + 1
		                 Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
				     elseif (sj == 3) then
				         os.remove("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt")
					     os.remove("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt")
					     fdArray = {"çªç„¶æˆªæ–­å¤è¯»(ï¾ŸâŠ¿ï¾Ÿ)ï¾‚","å¤è¯»å¯è€»(â€¢Ì€ã¸ â€¢Ì â•® )","ä¸è¦å¤è¯»äº†å•¦","è¿™å°±æ˜¯æ‰€è°“çš„äººç±»çš„æœ¬è´¨","ä½ ä»¬å’‹ä¸ä¸Šå¤©å‘","åˆå¤è¯»ä¸Šç˜¾äº†å•Š"}
                         math.randomseed(os.time())
                         fdsj = math.random(1, 6)
				         sedmsg(CurrentQQ,data,fdArray[fdsj])
				     else
			             rr = ii + 1
		                 Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
		             end
			    else
			        rr = ii + 1
		            Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
			    end
			else
			    if (ii > 2) then
			        math.randomseed(os.time())
                    sj2 = math.random(1, 3)
					if (sj2 == 2) then
					    fdArray2 = {"ä¸­æ–­å¤è¯»å¯è€»","æ‰“æ–­å¤è¯»å¯è€»(â€¢Ì€ã¸ â€¢Ì â•® )","ä½ ä¸ºä»€ä¹ˆè¦æ‰“æ–­å¤è¯»å•Š","å¤è¯»ä¸é¦™å˜›","ç ´åæ°›å›´(à¸‡áµ’ÌŒçš¿áµ’ÌŒ)à¸‡â¼Â³â‚Œâ‚ƒ"}
                        math.randomseed(os.time())
                        fdsj2 = math.random(1, 5)
				        sedmsg(CurrentQQ,data,fdArray2[fdsj2])
					end
				end
				Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt","1")
			    Wirte("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt",data.Content)
			end
		else
		    Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt","1")
			Wirte("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt",data.Content)
		end
	    --å¦‚æœè°ƒæ•™æŒ‡ä»¤ä¸å­˜åœ¨ï¼Œåˆ™è¿›è¡Œå…¶ä»–æ“ä½œ
	    msgsql(CurrentQQ,data)--æ•°æ®å‚¨è“„
		--éšæœºå›å¤æ¶ˆæ¯æ¦‚ç‡0.04
	    math.randomseed(os.time())
        num = math.random(1, 40)
		if (num == 12) then
		    j = xiaosiapi(CurrentQQ,data,data.Content)
			sedmsg(CurrentQQ,data,j.data.info.text)
		end
	else
	    --è§¦å‘è°ƒæ•™æŒ‡ä»¤
		funic(CurrentQQ,data,mim)
	end
    return 1
end

function ReceiveEvents(CurrentQQ, data, extData)
  if data.MsgType == "ON_EVENT_GROUP_REVOKE" then --ç›‘å¬ ç¾¤æ’¤å›äº‹ä»¶
    --æ’¤å›äº‹ä»¶å¤„ç†
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..extData.GroupID..".txt")
    if (str == nil) then
	    log.info("Str ====> %s", str)
        return 1
	end
	if (string.find(str, "å…³é—­")) then
		return 1
	end
	CheHui(CurrentQQ, data, extData)
	--xxxxxxxxxxxxxxx
    return 1
  end
end
  --è¿›ç¾¤ç§€å›¾æ¬¢è¿


--é—ªç…§æ£€æµ‹å¤„ç†


--åŠŸèƒ½ç»„
function funic(CurrentQQ,data,msg)
    if string.find(msg, "^ç‚¹æ­Œ") then
	    data.Content = msg
        music(CurrentQQ,data,msg)
		return 1
	elseif string.find(msg, "^è¯­éŸ³") then
	    keyWord = msg:gsub("è¯­éŸ³", "")
        sedvoicemsg(CurrentQQ,data,keyWord)
		return 1
	elseif string.find(msg, "^å›¾ç‰‡") then
	    keyWord = msg:gsub("å›¾ç‰‡", "")
        sedimgmsg(CurrentQQ,data,keyWord,"")
		return 1
    elseif string.find(msg, "^å”±æ­Œ") then
        keyWord = msg:gsub("å”±æ­Œ", "")
		if (keyWord == "") then
		    sedmsg(CurrentQQ,data,"æ­Œåä¸èƒ½ç©ºç€å“¦")
		    return 1
		end
		sedmsg(CurrentQQ,data,"å¦¾èº«æ­£åœ¨åŠªåŠ›åŠ è½½Ù©(ËƒÌ¶Ì€Íˆà¯°Ë‚Ì¶ÌÍˆ)Ùˆ")
        response, error_message =
            http.request(
            "POST",
            "http://127.0.0.1:8888/SilkApi/UrlToBuf",--ä¿®æ”¹æ­¤å¤„ipåŠç«¯å£å³å¯
            {
                body = keyWord --ä¼ å…¥æ­Œæ›²å
            }
        )
        log.notice("err   %v", error_message)
        html = response.body --è¿”å›silk base64 buf
		if (string.find(html, "Î´")) then
				    sedmsg(CurrentQQ,data,"å¤©ä¾æ²¡æœ‰æ‰¾åˆ°ç›¸å…³çš„æ­Œå‘€(Ã’Ï‰Ã“×±)ï¼")
					c.close(c)
				    return 2
				end
        luaRes =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "VoiceMsg",
                groupid = 0,
                content = "",
                atUser = 0,
                voiceUrl = "",
                voiceBase64Buf = html 
            }
        )
		return 1
	end
    sedmsg(CurrentQQ,data,msg)
end

--å½±è§†æœç´¢ç”¨
function Sousuo(CurrentQQ,data,msg)
    response, error_message =
        http.request(
            "GET",
            "http://localhost/index.php/ajax/suggest",
            {
                query = "mid=1&f=admin&wd="..msg.."&limit=10&timestamp=1567914326746"
            }
        )
    html = response.body
	json = json.decode(html)
	if (json.total == 0) then
	    sedmsg(CurrentQQ,data,"å½±è§†æŸ¥è¯¢é”™è¯¯\nè¯·æ£€æŸ¥å½±è§†åæ˜¯å¦æ­£ç¡®\nâ•â•â•â•â•â•â•â•â•â•â•\næ³¨æ„âš ï¸å½±è§†åä¸è¦å¸¦æ— å…³æˆ–å¤šä½™çš„å­—ç¬¦")
	else
        sedmsg(CurrentQQ,data,"èµ„æºåœ°å€å¦‚ä¸‹â†“â†“â†“\nâ•â•â•â•â•â•â•â•â•â•\nhttp://118.25.41.32/index.php/vod/search/wd/"..escape(msg)..".html\nâ•â•â•â•â•â•â•â•â•â•â•\næ³¨æ„:å¦‚æœQQå‡ºç°åœæ­¢è®¿é—®ç°è±¡ï¼Œè¯·å¤åˆ¶é“¾æ¥ç”¨æµè§ˆå™¨æ‰“å¼€")
	end
end

--å•çº¯å‘æ¶ˆæ¯å›¾æ–‡é€šç”¨
function sedimgmsg(CurrentQQ,data,url,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "PicMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = url,
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘æ¶ˆæ¯ç”¨
function sedmsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "TextMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘ç§èŠæ¶ˆæ¯ç”¨
function sendfrimsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromUin,
        sendToType = 1,
        sendMsgType = "TextMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘jsonæ¶ˆæ¯ç”¨
function sedjsonmsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "JsonMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--èŠå¤©æ¨¡å—åˆ‡æ¢å‡½æ•°
function liaotian(CurrentQQ,data,msg)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
    if (mim == nil) then
        sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
        return 1
    end
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
	if (str == nil) then
        return 1
    end
	if (string.find(str, "å…³é—­")) then
	    sedmsg(CurrentQQ,data,"æœºå™¨èŠå¤©å¤„äºå…³é—­çŠ¶æ€\nâˆ´è¯·å…ˆå¼€å¯æœºå™¨èŠå¤©")
	    return 1
	end
	--åˆ‡æ¢å¤„ç†
	file = io.open("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt", "w")
	if (msg == 1) then
	    file:write("æ–‡å­—èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°æ–‡å­—èŠå¤©")
	elseif (msg == 2) then
	    file:write("è¯­éŸ³èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°è¯­éŸ³èŠå¤©")
	elseif (msg == 3) then
	    file:write("å›å¤èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°å›å¤èŠå¤©")
	end
	file:close()
end

--éšæœºè¡¨æƒ…å‡½æ•°
function faceArray()
    faceArray = {"[è¡¨æƒ…147]","ğŸ€","ğŸ”¥","ğŸ»","ğŸ’","[è¡¨æƒ…185]","[è¡¨æƒ…219]","[è¡¨æƒ…176]"}
    math.randomseed(os.time())
    num = math.random(1, 9)
    return faceArray[num]
end

--urlç¼–ç è½¬æ¢
function escape(w)
	pattern="[^%w%d%._%-%* ]"
	s=string.gsub(w,pattern,function(c)
		local c=string.format("%%%02X",string.byte(c))
		return c
	end)
	s=string.gsub(s," ","+")
	return s
end

--è¯»å–æ•°æ®å‡½æ•°
function Read(url)
    file = io.open(url, "r")
	if (file == nil) then
	    return nil
	else
        file:seek("set")
	    str = file:read("*a")
	    file:close()
        return str
	end
end

--å†™å…¥æ•°æ®å‡½æ•°
function Wirte(url,msg)
    file = io.open(url, "w+")
    file:write(msg)
	file:close()
    return "ok"
end

--å°æ€èŠå¤©å‡½æ•°
function xiaosiapi(CurrentQQ,data,str)
    response, error_message =
            http.request(
            "GET",
            "https://api.ownthink.com/bot",
            {
                query = "appid="..tostring(data.FromUserId).."&spoken=" .. url_encode(str),
                headers = {
                    Accept = "*/*"
                }
            }
        )
        html = response.body
		jData = json.decode(html)
		return jData
end

--æœºå™¨èŠå¤©å‡½æ•°
function ownthink(CurrentQQ,data,msgs,atqq)
    if (tostring(atqq) == CurrentQQ) then
        m = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
        if (m == nil) then
	        log.info("Str ====> %s", m)
            return 1
	    end
	    if (string.find(m, "å…³é—­")) then
	        sedmsg(CurrentQQ,data,"æœºå™¨èŠå¤©å¤„äºå…³é—­çŠ¶æ€\nâˆ´è¯·å…ˆå¼€å¯æœºå™¨èŠå¤©")
	        return 1
	    end
		res2 = string.find(msgs, " ")
		str = string.sub(msgs,res2)
		jData = xiaosiapi(CurrentQQ,data,str)
		Data = json.decode(data.Content)
		m = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
		if (m == nil) then
	        log.info("Str ====> %s", m)
            return 1
	    end
		if (string.find(m, "å›å¤èŠå¤©")) then
		    Api.Api_SendMsg(
                CurrentQQ,
                {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "ReplayMsg",
                groupid = 0,
                content = jData.data.info.text,
                atUser = 0,
				replayInfo = {
                    MsgSeq = data.MsgSeq,
                    --å›å¤æ¶ˆæ¯çš„Seq
                    MsgTime = data.MsgTime,
                    --å›å¤æ¶ˆæ¯çš„äº‹ä»¶
                    UserID = data.FromUserId,
                    --å›å¤æ¶ˆæ¯å¯¹è±¡
                    RawContent = Data.Content --å›å¤æ¶ˆæ¯çš„åŸå†…å®¹
                }
				}
            )
			return 1
		elseif (string.find(m, "æ–‡å­—èŠå¤©")) then
		    sedmsg(CurrentQQ,data,jData.data.info.text)
		else
		    sedvoicemsg(CurrentQQ,data,url_encode(jData.data.info.text))
		end
    end
end

--å‘é€è¯­éŸ³æ¶ˆæ¯
function sedvoicemsg(CurrentQQ,data,str)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "VoiceMsg",
        groupid = 0,
		voiceUrl = "https://dds.dui.ai/runtime/v1/synthesize?voiceId=qianranfa&speed=0.7&volume=100&audioType=wav&text="..str, --å‘é€è¯­éŸ³çš„ç½‘ç»œåœ°å€ æ–‡æœ¬å‹
        voiceBase64Buf = "",
        content = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å¤©æ°”æŸ¥è¯¢å‡½æ•°
--[[function tianqi(CurrentQQ,data)
    keyWord = data.Content:gsub("å¤©æ°”", "")
        if keyWord == "" then
            return 1
        end

        cookies = Api.Api_GetUserCook(CurrentQQ)

        response, error_message =
            http.request(
            "GET",
            "https://weather.mp.qq.com/cgi-bin/rich",
            {
                query = "g_tk=" .. cookies.Gtk .. "&city=" .. url_encode(keyWord),
                headers = {
                    Referer = "http://weather.mp.qq.com/ark"
                },
                cookies = {
                    uin = CurrentQQ,
                    skey = cookies.Skey
                }
            }
        )
        local html = response.body
        log.notice("From Lua html -->%s", html)

        local j = json.decode(html)
        if j.code ~= 0 then
            return 1
        end

        ApiRet =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "JsonMsg",
                groupid = 0,
                content = string.format(
                    --{"config":{"forward":1,"autosize":1},"prompt":"[åº”ç”¨]å¤©æ°”","app":"com.tencent.weather","ver":"0.0.0.1","view":"RichInfoView","meta":{"richinfo":{"adcode":"101210701","city":"æˆéƒ½","air":"58","min":"20","ts":"1500550866","wind":"1","date":"6æœˆ27æ—¥ å‘¨å››","max":"28","type":"201"}},"desc":"å¤©æ°”"}
                    --[[{"app":"com.tencent.weather","desc":"","meta":{"weather":{"ad":[{"icon":"http://imgcache.qq.com/ac/tq/xz2/tp.jpg","p":"ptype=star","t":"2","title":"æ˜Ÿåº§ | ä»Šå¤©ä¼šå› ä¸ºæ„Ÿæƒ…å’Œå®¶åº­çš„é—®é¢˜ï¼Œå½±å“å·¥ä½œï¼Œè¿˜æœ‰ï¼Œä¹Ÿè¦æ³¨æ„äºº...","url":""},{"icon":"http://imgcache.qq.com/ac/qqweather/image/2019/6/27.png","p":"ptype=lunar","t":"4","title":"é»„å† | å†œå†äº”æœˆå»¿äº”ã€‚å®œè®¢ç›Ÿ.çº³é‡‡.å‡ºè¡Œ.ç¥ˆç¦.æ–‹é†®.å®‰åºŠ.ä¼š...","url":""}],"info":{"it1":{"adcode":"101050101","city":"æ­¦æ±‰","hour":"18","max":"29","min":"17","temp":"24","type":"202","ut":"1561630401","wea":"å¤šäº‘"},"it2":{"hour":"19","temp":"22","type":"202"},"it3":{"hour":"20","temp":"21","type":"202"},"ts":"1561631244"},"url":""}},"prompt":"ã€å“ˆå°”æ»¨ã€‘å¤šäº‘ 17Â°/29Â°, 18:13æ›´æ–°~","ver":"1.0.0.106","view":"WeatherThreeView"}]]
--[[                    [[{"app":"com.tencent.weather","desc":"å¤©æ°”","view":"RichInfoView","ver":"1.0.0.217","prompt":"[åº”ç”¨]å¤©æ°”","meta":{"richinfo":{"adcode":"%s","air":"%s","city":"%s","date":"%s","max":"%s","min":"%s","ts":"1554951408","type":"%s","wind":"%s"}},"config":{"forward":1,"autosize":1,"type":"card"}}]],
--[[                    j.data.adcode,
                    j.data.air,
                    j.data.city,
                    j.data.date,
                    j.data.max,
                    j.data.min,
                    j.data.type,
                    j.data.wind
                ),
                atUser = 0
            }
        )
end
--]]
--è°ƒæ•™å¤„ç†å‡½æ•°(å¾…å¤„ç†)
function tiaojiao(CurrentQQ,data)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
	if (mim == nil) then
		sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå“‡")
		return 1
	end
	if (string.find(data.Content, "^åˆ é™¤è°ƒæ•™")) then
	    msg = data.Content:gsub("åˆ é™¤è°ƒæ•™", "")
	    if (msg == "") then
		    sedmsg(CurrentQQ,data,"è¦åˆ é™¤çš„è°ƒæ•™æŒ‡ä»¤ä¸èƒ½ä¸ºç©ºå“¦")
		    return 1
		end
		rese = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..tostring(data.FromGroupId).."\/"..msg..".txt")
	    if (rese == nil) then
			sedmsg(CurrentQQ,data,"è¿™ä¸ªæŒ‡ä»¤ä¸å­˜åœ¨äº†å“¦")
		    return 1
		end
		rm_file = os.remove("mimoio\/æœºå™¨è°ƒæ•™\/"..tostring(data.FromGroupId).."\/"..msg..".txt")
		log.info("åˆ é™¤è°ƒæ•™ ====> %s", rm_file)
		sedmsg(CurrentQQ,data,"åˆ é™¤æˆåŠŸ\nä½ ä¸å–œæ¬¢è¢«è¿™æ ·è°ƒæ•™çš„æˆ‘å—[è¡¨æƒ…9]")
		return 1
	end
    msgs = data.Content:gsub("è°ƒæ•™", "")
		res2 = string.find(msgs, "#")
		str = string.sub(msgs,res2+1)
		str2 = string.sub(msgs,1,res2-1)
		        
		        if (str == "") then
		            sedmsg(CurrentQQ,data,"è°ƒæ•™çš„å›ç­”å†…å®¹ä¸èƒ½ä¸ºç©ºå“¦")
			        return 1
		        end
				if (str2 == "") then
		            sedmsg(CurrentQQ,data,"è°ƒæ•™çš„æŒ‡ä»¤å†…å®¹ä¸èƒ½ä¸ºç©ºå“¦")
			        return 1
		        end
		        rese = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..str2..".txt")
					if (rese ~= nil) then
				        sedmsg(CurrentQQ,data,"æŒ‡ä»¤å·²ç»å­˜åœ¨äº†å“¦")
				        return 1
				    end
				Wirte("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..str2..".txt",str)
				sedmsg(CurrentQQ,data,"è°ƒæ•™æˆåŠŸ\nä½ è¿˜æƒ³å†è°ƒæ•™æˆ‘ä¸€æ¬¡å—[è¡¨æƒ…6]")
		        return 1
end

function url_encode(str)
    if (str) then
        str = string.gsub(str, "\n", "\r\n")
        str =
            string.gsub(
            str,
            "([^%w ])",
            function(c)
                return string.format("%%%02X", string.byte(c))
            end
        )
        str = string.gsub(str, " ", "+")
    end
    return str
end

--æŠ¢çº¢åŒ…å¤„ç†
function RedBag(CurrentQQ, data)
    Api.Api_OpenRedBag(CurrentQQ, data.RedBaginfo)
    if (data.RedBaginfo.RedType == 12) then
         luaRes =
                Api.Api_SendMsg(
                CurrentQQ,
                {
                    toUser = data.FromGroupId,
                    sendToType = 2,
                    sendMsgType = "TextMsg",
                    groupid = 0,
                    content = data.RedBaginfo.Tittle,
                    atUser = 0
                }
            )
        log.notice("From Lua SendMsg Ret\n%d", luaRes.Ret)
    end
end

--è§†é¢‘è§£æå¤„ç†
function Video(CurrentQQ, data)
    vdata = json.decode(data.Content)
        videodata = {
            GroupID = data.FromGroupId,
            VideoUrl = vdata.VideoUrl,
            VideoMd5 = vdata.VideoMd5
        }
        --æ„é€ table å‚æ•°è¡¨
        luaResp = Api.Api_CallFunc(CurrentQQ, "PttCenterSvr.ShortVideoDownReq", videodata) --é€šè¿‡cmdè°ƒç”¨åŠŸèƒ½åŒ…
        luaRes =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "TextMsg",
                groupid = 0,
                content = "è§£æè§†é¢‘URL-->" .. luaResp.VideoUrl,
                atUser = 0
            }
        )
end

--ç®¡ç†å¼€å…³é€šç”¨
function adminio(CurrentQQ,data,oio)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim ~= nil) then
            msg = data.Content:gsub(oio, "")
            str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
            if (string.find(str, "å…³é—­")) then
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äººå·²è¢«å…³é—­...\nè¯·å…ˆå¼€å¯æœºå™¨äºº")
                return 1
            end
			str2 = Read("mimoio\/çŠ¶æ€æ•°æ®\/"..oio.."\/"..data.FromGroupId..".txt")
			if (string.find(str2, msg)) then
			    sedmsg(CurrentQQ,data,"âˆ´"..oio.."æœ¬å°±æ˜¯"..str2.."çŠ¶æ€")
                return 1
			end
            Wirte("mimoio\/çŠ¶æ€æ•°æ®\/"..oio.."\/"..data.FromGroupId..".txt",msg)
            sedmsg(CurrentQQ,data,"âˆ´"..oio..msg.."æˆåŠŸ")
            return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
end

--ç™¾ç§‘å¤§å…¨
function baike(CurrentQQ,data)
    keyWord = data.Content:gsub("ç™¾ç§‘", "")
        if keyWord == "" then
            return 1
        end
        response, error_message =
            http.request(
            "GET",
            "http://baike.baidu.com/api/openapi/BaikeLemmaCardApi",
            {
                query = "scope=103&format=json&appid=379020&bk_key=" .. url_encode(keyWord) .. "&bk_length=600"
            }
        )
        html = response.body
        while(string.find(html, '"errno":2')) do
            response, error_message =
            http.request(
            "GET",
            "http://baike.baidu.com/api/openapi/BaikeLemmaCardApi",
            {
                query = "scope=103&format=json&appid=379020&bk_key=" .. url_encode(keyWord) .. "&bk_length=600"
            })
			html = response.body
        end
        local j = json.decode(html)
        sedmsg(CurrentQQ,data,j.abstract.."\n"..j.url)
end

--éŸ³ä¹ç‚¹æ­Œ
function music(CurrentQQ,data)
    keyWord = data.Content:gsub("ç‚¹æ­Œ", "")
        if keyWord == "" then
            return 1
        end
        response, error_message =
            http.request(
            "GET",
            "https://c.y.qq.com/soso/fcgi-bin/client_search_cp",
            {
                query = "aggr=1&cr=1&flag_qc=0&p=1&n=6&w=" .. url_encode(keyWord)
            }
        )
        html = response.body
		str = string.sub(html,10,-2)
        j = json.decode(str)
        if (j.code == 0) then
            msg = ""
            num = j.data.song.list
            list = num[1]
            songname = list.songname
            singername = list.singer[1].name
            payplay = list.pay.payplay
			albummid = list.albummid
			songmid = list.songmid
	        sedjsonmsg(CurrentQQ,data,'{"app":"com.tencent.structmsg","desc":"éŸ³ä¹","view":"music","ver":"0.0.0.1","prompt":"[åˆ†äº«]' ..songname.. '","meta":{"music":{"sourceMsgId":"0","title":"' ..songname.. '","desc":"' ..singername.. '","preview":"y.gtimg.cn/music/photo_new/T002R150x150M000'..albummid..'.jpg","tag":"QQéŸ³ä¹","musicUrl":"https://v1.itooi.cn/tencent/url?id='..songmid..'","jumpUrl":"y.qq.com/n/yqq/song/'..songmid..'.html","appid":100497308,"app_type":1,"action":"","source_url":"url.cn/5aSZ8Gc","source_icon":"url.cn/5tLgzTm","android_pkg_name":"com.tencent.qqmusic"}},"config":{"forward":true,"type":"normal","autosize":true}}')
			return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´Error:"..j.code)
			return 1
        end
end

--è®¿é—®url
function geturl(url_class,url,caulrt)
        response, error_message =
            http.request(
            url_class,
            url,
            {
                query = caulrt
            }
        )
        html = response.body
		return html
end

--æ¶ˆæ¯å‚¨è“„
function msgsql(CurrentQQ,data)
    if (mysqlpass == "") then
	    return 1
	end
    c = mysql.new()
    -- åˆå§‹åŒ–mysqlå¯¹è±¡
    ok, err = c:connect({host = mysqlhost, port = 3306, database = mysqldb, user = mysqluser, password = mysqlpass})
    --å»ºç«‹è¿æ¥
    if ok then
        sqlstr =
            string.format(
            [[INSERT INTO msgcache (GroupID, MsgSeq, MsgRandom,MsgType,Data,MsgTime)VALUES (%d,%d,%d,'%s','%s',%d)]],
            data.FromGroupId,
            data.MsgSeq,
            data.MsgRandom,
            data.MsgType,
            data.Content,
            data.MsgTime
        )
        res, err = c:query(sqlstr) --å…¥åº“ç¼“å­˜æ¶ˆæ¯
        log.info("%s", err)
        c.close(c)
    --é‡Šæ”¾è¿æ¥
    end
    return 1
end

--æ’¤å›æ£€æµ‹
function CheHui(CurrentQQ, data, extData)
    c = mysql.new()
    -- åˆå§‹åŒ–mysqlå¯¹è±¡
	if (mysqlpass == "") then
	    return 1
	end
	
    if data.MsgType == "ON_EVENT_GROUP_REVOKE" then --ç›‘å¬ ç¾¤æ’¤å›äº‹ä»¶
        str = string.format("ç¾¤æˆ %d  æˆå‘˜ UserID %s æ’¤å›äº†æ¶ˆæ¯Seq %s \n", extData.GroupID, extData.UserID, extData.MsgSeq)
        log.info("%s", str)
        ok, err = c:connect({host = mysqlhost, port = 3306, database = mysqldb, user = mysqluser, password = mysqlpass})
        --å»ºç«‹è¿æ¥
        log.info("sql %v", err)
        if ok then
            sqlstr =
                string.format(
                "select * from msgcache where `GroupID`= %d and `MsgSeq` = %d",
                extData.GroupID,
                extData.MsgSeq
            )
            res, err = c:query(sqlstr) --è·Ÿç¾¤ç¾¤idå’Œæ¶ˆæ¯SEQæŸ¥è¯¢å‡ºæ’¤å›çš„æ¶ˆæ¯å†…å®¹
            if err == nil then
                c.close(c)
                GroupID = tonumber(res[1]["GroupID"])
                MsgType = res[1]["MsgType"]
                Data = res[1]["Data"]

                if MsgType == "TextMsg" then
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            --å‘é€æ–‡æœ¬æ¶ˆæ¯
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡æ–‡æœ¬æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                Data
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "SmallFaceMsg" then
                    --Data {"Content":"[è¡¨æƒ…101]","Hex":"FKY=","Index":101,"tips":"[å°è¡¨æƒ…]"}
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡è¡¨æƒ…æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).Content
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "PicMsg" then
                    --Data {"Content":"","FileId":2820717626,"FileMd5":"q0oEC5aloJJMFr10mplaXw==","FileSize":7026,"tips":"[ç¾¤å›¾ç‰‡]","url":"http://gchat.qpic.cn/gchatpic_new/1700487478/960839480-2534335053-AB4A040B96A5A0924C16BD749A995A5F/0?vuin=u0026term=255u0026pictype=0"}
                    jData = json.decode(Data)
					if (jData.tips == "[ç¾¤æ¶ˆæ¯-QQé—ªç…§]") then
					    
					Api.Api_SendMsg( 
                    CurrentQQ,
                    {
                        toUser = GroupID,
                        sendToType = 2,
                        sendMsgType = "ForwordMsg",
                        content = "",
                        atUser = 0,
                        groupid = 0,
                        voiceUrl = "",
                        voiceBase64Buf = "",
                        picUrl = "",
                        picBase64Buf = "",
                        forwordBuf = json.decode(Data).ForwordBuf, --æ¬²è½¬å‘çš„base64buf å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                        forwordField = json.decode(Data).ForwordField --æ¬²å†™å…¥åè®®çš„å­—æ®µID å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                    }
                )
				    return 1
					end
                    Api.Api_SendMsg( --é€šè¿‡å›¾ç‰‡md5å‘é€å›¾ç‰‡ ç§’å‘ä¸ç”¨ä¸Šä¼  ç›¸å½“äºè½¬å‘
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "PicMsg",
                            --å‘é€å›¾æ–‡æ¶ˆæ¯
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡å›¾ç‰‡æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š[PICFLAG]%s",
                                extData.UserID,
                                jData.Content
                            ),
                            --é€šè¿‡å®[PICFLAG]æ”¹å˜å›¾æ–‡é¡ºåº  æ”¹ä¸ºç°æ–‡å­—åå›¾ç‰‡
                            atUser = 0,
                            voiceUrl = "",
                            voiceBase64Buf = "",
                            picUrl = "",
                            picBase64Buf = "",
                            fileMd5 = jData.FileMd5
                        }
                    )
                end
                if MsgType == "AtMsg" then
                    --Data {"Content":"@Kar98k skjjkssjkjs","UserID":123456789,"tips":"[ATæ¶ˆæ¯]"}
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡atæ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).Content
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "VoiceMsg" then
                    --Data {"tips":"[è¯­éŸ³]","url":"http://grouptalk.c2c.qq.com/?ver=0u0026rkey=3062020101045b305902010102010102041fdef8ae042439416931554e5142586c536d78706a314c686843664959725f327a5f573064697653755902045dac2a21041f0000000866696c6574797065000000013100000005636f64656300000001310400u0026filetype=1u0026voice_codec=1"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "VoiceMsg",
                            --å‘é€ç¾¤è¯­éŸ³æ¶ˆæ¯
                            groupid = 0,
                            content = "",
                            atUser = 0,
                            voiceUrl = json.decode(Data).url,
                            --é€šè¿‡ç½‘ç»œurlè¿›è¡Œå‘é€è¯­éŸ³
                            voiceBase64Buf = "",
                            picUrl = "",
                            picBase64Buf = ""
                        }
                    )
                end

                if MsgType == "ReplayMsg" then
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡å›å¤æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).ReplayContent
                            ),
                            atUser = 0
                        }
                    )
                end
				if MsgType == "VideoMsg" then
	             Api.Api_SendMsg( 
                    CurrentQQ,
                    {
                        toUser = GroupID,
                        sendToType = 2,
                        sendMsgType = "ForwordMsg",
                        content = "",
                        atUser = 0,
                        groupid = 0,
                        voiceUrl = "",
                        voiceBase64Buf = "",
                        picUrl = "",
                        picBase64Buf = "",
                        forwordBuf = json.decode(Data).ForwordBuf, --æ¬²è½¬å‘çš„base64buf å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                        forwordField = json.decode(Data).ForwordField --æ¬²å†™å…¥åè®®çš„å­—æ®µID å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                    }
                )
				end
                if MsgType == "XmlMsg" then
				    
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "XmlMsg",
                            groupid = 0,
                            content = string.format("%s", Data),
                            atUser = 0
                        }
                    )
                end
				if MsgType == "JsonMsg" then
				    
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "JsonMsg",
                            groupid = 0,
                            content = string.format("%s", Data),
                            atUser = 0
                        }
                    )
                end
            end
        end
    end
    return 1
end
2020/09/07 12:54:09.085 [E]  mimoio.lua
2020/09/07 12:54:09.086 [E]  local log = require("log")
local Api = require("coreApi")
local json = require("json")
local http = require("http")
local mysql = require("mysql")

--ç‰ˆæœ¬å·(ä¸è¦æ”¹åŠ¨)
Vabr = "1.0.2"
--æ•°æ®åº“é…ç½®
mysqlhost = "localhost"--é»˜è®¤ä¸åŠ¨
mysqldb = "ffaxx001"--æ•°æ®åº“å
mysqluser = "ffaxx001"--æ•°æ®åº“ç”¨æˆ·å
mysqlpass = "123456"--æ•°æ®åº“å¯†ç 
--ä¸ä½¿ç”¨è¯·ä¸è¦æ”¹åŠ¨

function ReceiveFriendMsg(CurrentQQ, data)
    if (data.Content == "ä½¿ç”¨æ–¹æ³•") then
	    sendfrimsg(CurrentQQ,data,"æ·»åŠ æˆæƒè€…çš„æ–¹æ³•\nå¯¹å•ä¸ªæœºå™¨äººç§èŠå‘é€[æ·»åŠ æˆæƒè€…+æˆæƒè€…QQ]\n\næˆæƒç¾¤çš„æ–¹æ³•\nåˆ°éœ€è¦æˆæƒçš„ç¾¤é‡Œå‘é€[æˆæƒ+ä¸»äººQQ]ã€‚æ³¨æ„:æˆæƒå¿…é¡»æ˜¯æˆæƒè€…è¿›è¡Œæ“ä½œ,ç®¡ç†å‘˜æˆæƒä¸äº†")
	end
    --æ•°æ®åˆå§‹åŒ–
    if (data.Content == "åˆå§‹åŒ–") then
	    root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root ~= nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´è¯·ä¸è¦é‡å¤åˆå§‹åŒ–")
			return 1
		end
    --os.execute('mkdir mimoio/æœºå™¨æˆæƒ')
	    os.execute('mkdir mimoio')
		os.execute('mkdir mimoio/å¤è¯»æœº')
		os.execute('mkdir mimoio/å¤è¯»æœº/æ¬¡æ•°')
		os.execute('mkdir mimoio/å¤è¯»æœº/å†…å®¹')
		os.execute('mkdir mimoio/æœºå™¨æˆæƒ')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨ä¸»äºº')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨èŠå¤©')
		os.execute('mkdir mimoio/æœºå™¨è°ƒæ•™')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æŠ¢çº¢åŒ…')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æœºå™¨èŠå¤©')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æœºå™¨å¼€å…³')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æ’¤å›æ£€æµ‹')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/å›¾ç‰‡è§£æ')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/è§†é¢‘è§£æ')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/é—ªç…§æ£€æµ‹')
		Wirte("mimoio\/"..data.FromUin..".txt","999")
		sendfrimsg(CurrentQQ,data,"åˆå§‹åŒ–å®Œæ¯•ï¼\nå‘é€[ä½¿ç”¨æ–¹æ³•]äº†è§£ä½¿ç”¨å§")
	end
	--æ·»åŠ æˆæƒè€…æ“ä½œ(ç§èŠæœºå™¨äººå‘é€)
	if (string.find(data.Content, "^æ·»åŠ æˆæƒè€…")) then
	    msg = data.Content:gsub("æ·»åŠ æˆæƒè€…", "")
		--Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromUin..".txt","å…³é—­")
		root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root == nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„ç®¡ç†è€…")
			return 1
		end
		Wirte("mimoio\/æœºå™¨æˆæƒ\/"..msg..CurrentQQ..".txt","999")
		sendfrimsg(CurrentQQ,data,"âˆ´æ·»åŠ æˆæƒè€…æˆåŠŸ")
	end
	--åˆ é™¤æˆæƒè€…æ“ä½œ(ç§èŠæœºå™¨äººå‘é€)
	if (string.find(data.Content, "^åˆ é™¤æˆæƒè€…")) then
	    msg = data.Content:gsub("åˆ é™¤æˆæƒè€…", "")
		--Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromUin..".txt","å…³é—­")
		root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root == nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„ç®¡ç†è€…")
			return 1
		end
		os.remove("mimoio\/æœºå™¨æˆæƒ\/"..msg..CurrentQQ..".txt")
		sendfrimsg(CurrentQQ,data,"âˆ´åˆ é™¤æˆæƒè€…æˆåŠŸ")
	end
    return 1
end
function ReceiveGroupMsg(CurrentQQ, data)
    if (tostring(data.FromUserId) == CurrentQQ) then
	    return 1
	end
	--ç¾¤èŠæˆæƒ(åˆ°éœ€è¦æˆæƒçš„ç¾¤é‡Œæ“ä½œ)
	if (string.find(data.Content, "^æˆæƒ")) then
	    root = Read("mimoio\/æœºå™¨æˆæƒ\/"..data.FromUserId..CurrentQQ..".txt","999")
		if (root == nil) then
		    sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„æˆæƒè€…")
			return 1
		end
		msg = data.Content:gsub("æˆæƒ", "")
		os.execute('mkdir mimoio/æœºå™¨è°ƒæ•™/'..data.FromGroupId)
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨ä¸»äºº/'..data.FromGroupId)
		Wirte("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..msg..".txt","999")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt","å›å¤èŠå¤©")
		sedmsg(CurrentQQ,data,"âˆ´æˆæƒæˆåŠŸï¼\nå‘é€[å¼€å¯æœºå™¨äºº]ä½¿ç”¨å§")
	end
	--åˆ é™¤æˆæƒæ“ä½œ(åˆ°éœ€è¦åˆ é™¤æˆæƒçš„ç¾¤é‡Œæ“ä½œ)
	if (string.find(data.Content, "^åˆ é™¤æˆæƒ")) then
	    root = Read("mimoio\/æœºå™¨æˆæƒ\/"..data.FromUserId..CurrentQQ..".txt","999")
		if (root == nil) then
		    sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„æˆæƒè€…")
			return 1
		end
		msg = data.Content:gsub("åˆ é™¤æˆæƒ", "")
		os.remove("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..msg..".txt")
		os.remove("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
		sedmsg(CurrentQQ,data,"âˆ´åˆ é™¤æˆæƒæˆåŠŸï¼")
	end
	--æœºå™¨å¼€å…³æŒ‡ä»¤
	if (data.Content == "å¼€å¯æœºå™¨äºº" or data.Content == "å…³é—­æœºå™¨äºº") then
        mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim ~= nil) then
            msg = data.Content:gsub("æœºå™¨äºº", "")
            str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
			if (str == nil) then
			    Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt",msg)
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äºº"..msg.."æˆåŠŸï¼")
				log.info("Str ====> %s", str)
                return 1
			end
			
            if (string.find(str, msg)) then
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äººä¸€ç›´æ˜¯"..msg.."çš„å‘")
                return 1
            end
            Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt",msg)
            sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äºº"..msg.."æˆåŠŸï¼")
            return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
	end
    --æœºå™¨äººå¼€å¯æ£€æµ‹
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
	if (str == nil) then
	    log.info("Str ====> %s", str)
        return 1
	end
	if (string.find(str, "å…³é—­")) then
	    return 1
	end
	--atæ¶ˆæ¯å¤„ç†
	msgs = ""
	atqq = 0
	if (string.find(data.Content, "ATæ¶ˆæ¯")) then
	    msgs = json.decode(data.Content).Content
		atqq = json.decode(data.Content).UserID
	end
	--å°¾å·´è‡ªå®šä¹‰(å¾…å®Œå–„)
	tips = "â€”â€”å‡¤é£ç¿±ç¿”å…®ä¸·"
    --åŠŸèƒ½æ¨¡å—
    if (data.Content == "åŠŸèƒ½" or data.Content == "ä¸»ç•Œé¢") then
        face = faceArray()
        sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."å½±è§†æœç´¢\n"..face.."èŠå¤©å¨±ä¹\n"..face.."ä¾¿åˆ©åŠŸèƒ½\n"..face.."æœºå™¨è°ƒæ•™\n"..face.."ç®¡ç†ç³»ç»Ÿ\n"..face.."bugåé¦ˆ\n"..face.."æœ¬ç¾¤çŠ¶æ€\n"..face.."æ›´æ–°æ£€æµ‹\n\n"..tips)
    end
    --å½±è§†æœç´¢æ¨¡å—
    if (data.Content == "å½±è§†æœç´¢") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."æœç´¢+å½±è§†å\n"..face.."æˆ‘æƒ³çœ‹+å½±è§†å\n"..face.."æˆ‘è¦çœ‹+å½±è§†å\n\n"..tips)
    elseif (string.find(data.Content, "^æœç´¢")) then
	    msg = data.Content:gsub("æœç´¢", "")
		Sousuo(CurrentQQ,data,msg)
	elseif (string.find(data.Content, "^æˆ‘æƒ³çœ‹")) then
	    msg = data.Content:gsub("æˆ‘æƒ³çœ‹", "")
		Sousuo(CurrentQQ,data,msg)
    elseif (string.find(data.Content, "^æˆ‘è¦çœ‹")) then
	    msg = data.Content:gsub("æˆ‘è¦çœ‹", "")
		Sousuo(CurrentQQ,data,msg)
	end
	--èŠå¤©å¨±ä¹æ¨¡å—
	if (data.Content == "èŠå¤©å¨±ä¹") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."åˆ‡æ¢æ–‡å­—èŠå¤©\n"..face.."åˆ‡æ¢å›å¤èŠå¤©\n"..face.."åˆ‡æ¢è¯­éŸ³èŠå¤©\n\n"..tips)
    elseif (data.Content == "åˆ‡æ¢æ–‡å­—èŠå¤©") then
		liaotian(CurrentQQ,data,1)
	elseif (data.Content == "åˆ‡æ¢è¯­éŸ³èŠå¤©") then
	    liaotian(CurrentQQ,data,2)
    elseif (data.Content == "åˆ‡æ¢å›å¤èŠå¤©") then
	    liaotian(CurrentQQ,data,3)
	else
	    ownthink(CurrentQQ,data,msgs,atqq)
	end
	--ä¾¿åˆ©åŠŸèƒ½æ¨¡å—
	if (data.Content == "ä¾¿åˆ©åŠŸèƒ½") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."ç™¾ç§‘å¤§å…¨\n"..face.."éŸ³ä¹ç‚¹æ­Œ\n"..face.."é—ªä»–@xx\n"..face.."å¤©æ°”æŸ¥è¯¢\n\n"..tips)
	elseif (data.Content == "ç™¾ç§‘å¤§å…¨") then
		sedmsg(CurrentQQ,data,"å‘é€:[ç™¾ç§‘+å…³é”®è¯]\nä¾‹å¦‚:ç™¾ç§‘æ´›å¦¾èº«")
    elseif (data.Content == "éŸ³ä¹ç‚¹æ­Œ") then
		sedmsg(CurrentQQ,data,"å‘é€:[ç‚¹æ­Œ+æ­Œå]\nä¾‹å¦‚:ç‚¹æ­Œé’æŸ ")
	elseif (data.Content == "å¤©æ°”æŸ¥è¯¢") then
		sedmsg(CurrentQQ,data,"å‘é€:[å¤©æ°”+åœ°æ–¹å]\nä¾‹å¦‚:å¤©æ°”åŒ—äº¬(é™äºå›½å†…)")
    elseif (string.find(data.Content, "^å¤©æ°”")) then
        tianqi(CurrentQQ,data)
	    --msg = data.Content:gsub("æœç´¢", "")
		--Sousuo(CurrentQQ,data,msg)
	elseif (string.find(data.Content, "^ç™¾ç§‘")) then
	    baike(CurrentQQ,data)
	    --msg = data.Content:gsub("æˆ‘æƒ³çœ‹", "")
		--Sousuo(CurrentQQ,data,msg)music(CurrentQQ,data)
    elseif (string.find(data.Content, "^ç‚¹æ­Œ")) then
	    music(CurrentQQ,data)
	end
	--æœºå™¨è°ƒæ•™æ¨¡å—
	if (data.Content == "æœºå™¨è°ƒæ•™") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."æ–‡å­—è°ƒæ•™\n"..face.."è¯­éŸ³è°ƒæ•™\n"..face.."å”±æ­Œè°ƒæ•™\n"..face.."éŸ³ä¹è°ƒæ•™\n"..face.."å›¾ç‰‡è°ƒæ•™\n"..face.."åˆ é™¤è°ƒæ•™\n\n"..tips)
    elseif (data.Content == "æ–‡å­—è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#(å†…å®¹)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#ä½ å¥½å•Š")
	elseif (data.Content == "è¯­éŸ³è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#è¯­éŸ³(å†…å®¹)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#è¯­éŸ³ä½ å¥½å•Š")
	elseif (data.Content == "å›¾ç‰‡è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#å›¾ç‰‡(é“¾æ¥)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#å›¾ç‰‡http://../1.jpg")
	elseif (data.Content == "éŸ³ä¹è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#ç‚¹æ­Œ(æ­Œå)]\nä¾‹å¦‚:è°ƒæ•™å–µ#ç‚¹æ­Œå­¦çŒ«å«")
	elseif (data.Content == "å”±æ­Œè°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#å”±æ­Œ(æ­Œå)]\nä¾‹å¦‚:è°ƒæ•™å–µ#å”±æ­Œå­¦çŒ«å«")
	elseif (data.Content == "åˆ é™¤è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[åˆ é™¤è°ƒæ•™(æŒ‡ä»¤)]\nä¾‹å¦‚:åˆ é™¤è°ƒæ•™ä½ å¥½")
	elseif (string.find(data.Content, "^è°ƒæ•™")) then
        tiaojiao(CurrentQQ,data)
	elseif (string.find(data.Content, "^åˆ é™¤è°ƒæ•™")) then
        tiaojiao(CurrentQQ,data)
	end
	--ç®¡ç†ç³»ç»Ÿæ¨¡å—
	if (data.Content == "ç®¡ç†ç³»ç»Ÿ") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."å¼€å¯/å…³é—­æœºå™¨äºº\n"..face.."å¼€å¯/å…³é—­æŠ¢çº¢åŒ…\n"..face.."å¼€å¯/å…³é—­æœºå™¨èŠå¤©\n"..face.."å¼€å¯/å…³é—­é—ªç…§æ£€æµ‹\n"..face.."å¼€å¯/å…³é—­å›¾ç‰‡è§£æ\n"..face.."å¼€å¯/å…³é—­è§†é¢‘è§£æ\n"..face.."å¼€å¯/å…³é—­æ’¤å›æ£€æµ‹\n\n"..tips)
    elseif (data.Content == "å¼€å¯æœºå™¨èŠå¤©" or data.Content == "å…³é—­æœºå™¨èŠå¤©") then
        adminio(CurrentQQ,data,"æœºå™¨èŠå¤©")
    elseif (data.Content == "å¼€å¯æ’¤å›æ£€æµ‹" or data.Content == "å…³é—­æ’¤å›æ£€æµ‹") then
        adminio(CurrentQQ,data,"æ’¤å›æ£€æµ‹")
	elseif (data.Content == "å¼€å¯é—ªç…§æ£€æµ‹" or data.Content == "å…³é—­é—ªç…§æ£€æµ‹") then
        adminio(CurrentQQ,data,"é—ªç…§æ£€æµ‹")
	elseif (data.Content == "å¼€å¯æŠ¢çº¢åŒ…" or data.Content == "å…³é—­æŠ¢çº¢åŒ…") then
        adminio(CurrentQQ,data,"æŠ¢çº¢åŒ…")
	elseif (data.Content == "å¼€å¯è§†é¢‘è§£æ" or data.Content == "å…³é—­è§†é¢‘è§£æ") then
        adminio(CurrentQQ,data,"è§†é¢‘è§£æ")
	elseif (data.Content == "å¼€å¯å›¾ç‰‡è§£æ" or data.Content == "å…³é—­å›¾ç‰‡è§£æ") then
        adminio(CurrentQQ,data,"å›¾ç‰‡è§£æ")
	end
	--bugåé¦ˆæ¨¡å—
	if (data.Content == "BUGåé¦ˆ" or data.Content == "bugåé¦ˆ") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."é‚®ä»¶åé¦ˆ\n"..face.."QQåé¦ˆ\n\n"..tips)
    elseif (data.Content == "QQåé¦ˆ") then
        sedmsg(CurrentQQ,data,"???Î£(ï¾Ÿâˆ€ï¾Ÿï¾‰)ï¾‰\næ’ä»¶æœ‰é—®é¢˜å¯ä»¥åé¦ˆåˆ°:\nQQ:2353065854")
    elseif (data.Content == "é‚®ä»¶åé¦ˆ") then
        sedmsg(CurrentQQ,data,"å®è´å’‹å•¦=ÍÍŸÍŸÍ(ê’ªá—œê’ª â€§Ì£Ì¥Ì‡)\næ’ä»¶æœ‰é—®é¢˜å¯ä»¥åé¦ˆåˆ°:\né‚®ç®±ğŸ“¬:ym-o@qq.com")
	end
	--æœ¬ç¾¤çŠ¶æ€æ¨¡æ¿
	if (data.Content == "æœ¬ç¾¤çŠ¶æ€") then
        face = faceArray()
        hb = Read("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt")
        sz = Read("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt")
		tp = Read("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt")
        sp = Read("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt")
        jqr = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
        lt = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
        ch = Read("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..data.FromGroupId..".txt")
		sedmsg(CurrentQQ,data,"çŠ¶æ€æ•°æ®åˆ—è¡¨â†“â†“â†“\n"..face.."æœºå™¨äºº:"..jqr.."\n"..face.."æŠ¢çº¢åŒ…:"..hb.."\n"..face.."å›¾ç‰‡è§£æ:"..tp.."\n"..face.."æ’¤å›æ£€æµ‹:"..ch.."\n"..face.."è§†é¢‘è§£æ:"..sp.."\n"..face.."æœºå™¨èŠå¤©:"..lt.."\n"..face.."é—ªç…§æ£€æµ‹:"..sz.."\n\n"..tips)
	end
	--æ›´æ–°æ¨¡å—
	if (data.Content == "æ›´æ–°æ£€æµ‹") then
        str = geturl("GET","http://118.25.41.32/Lsb/lua/Vabr.txt","")
		log.info("Str ====> %s", str)
        if (string.find(str, Vabr)) then
            sedmsg(CurrentQQ,data,"å½“å‰ç‰ˆæœ¬ä¸ºæœ€æ–°ç‰ˆ")
        else
            sedmsg(CurrentQQ,data,"å‘ç°æ–°ç‰ˆæœ¬!\nå½“å‰ç‰ˆæœ¬:"..Vabr.."\næ–°ç‰ˆæœ¬å·:"..str.."\nèµ¶å¿«å‘é€[æ›´æ–°æ’ä»¶]å§")
        end
	elseif (data.Content == "æ›´æ–°æ’ä»¶") then
	    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim == nil) then
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
        str = geturl("GET","http://118.25.41.32/Lsb/lua/Vabr.txt","")
		log.info("Str ====> %s", str)
        if (string.find(str, Vabr)) then
            sedmsg(CurrentQQ,data,"å½“å‰ç‰ˆæœ¬ä¸ºæœ€æ–°ç‰ˆ")
        else
            str = geturl("GET","http://118.25.41.32/Lsb/lua/mimoio.txt","")
            Wirte("Plugins\/mimoio.lua",str)
            sedmsg(CurrentQQ,data,"æ›´æ–°å®Œæ¯•ï¼")
        end
	end
	--å›¾ç‰‡ç±»å‹æ¶ˆæ¯å¤„ç†
    if (data.MsgType == "PicMsg") then
	    msg = Read("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt")
		jData = json.decode(data.Content)
	    if (msg ~= nil and jData.tips ~= "[ç¾¤æ¶ˆæ¯-QQé—ªç…§]") then
            if (string.find(str, "å¼€å¯")) then
	            sedmsg(CurrentQQ,data,"å›¾ç‰‡é“¾æ¥è§£æå¦‚ä¸‹â†“â†“\n"..jData.url)
				return 1
	        end
	    end
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt")
	    if (str == nil) then
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    --é—ªç…§ã€å›¾ç‰‡å¤„ç†æ¨¡å—
		PicFlag(CurrentQQ, data)
    end
	--æŠ¢çº¢åŒ…å¤„ç†
	if (string.find(data.MsgType, "RedBagMsg") == 1) then
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt")
		if (str == nil) then
	        log.info("Str ====> %s", str)
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    RedBag(CurrentQQ, data)
	end
	--è§†é¢‘è§£æå¤„ç†
	if (string.find(data.MsgType, "VideoMsg") == 1) then
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt")
		if (str == nil) then
	        log.info("Str ====> %s", str)
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    Video(CurrentQQ, data)
	end
	--até—ªå›¾
	if (data.MsgType == "AtMsg") and (string.find(data.Content, "é—ªä»–")) then
	    shantu(CurrentQQ, data)
    end
	--è°ƒæ•™æœç´¢å¼•æ“
	mim = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..data.Content..".txt")
	if (mim == nil) then
	    --äººç±»çš„æœ¬è´¨æ˜¯å¤è¯»æœº
	    msg = Read("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt")
		if (msg ~= nil) then
		    cs = Read("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt")
			ii = tonumber(cs)
			if (string.find(msg, "^"..data.Content.."$")) then
			    if (ii > 2) then
			         math.randomseed(os.time())
                     sj = math.random(1, 5)
		             if (sj == 1 or sj == 2) then
			             sedmsg(CurrentQQ,data,msg)
					     rr = ii + 1
		                 Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
				     elseif (sj == 3) then
				         os.remove("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt")
					     os.remove("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt")
					     fdArray = {"çªç„¶æˆªæ–­å¤è¯»(ï¾ŸâŠ¿ï¾Ÿ)ï¾‚","å¤è¯»å¯è€»(â€¢Ì€ã¸ â€¢Ì â•® )","ä¸è¦å¤è¯»äº†å•¦","è¿™å°±æ˜¯æ‰€è°“çš„äººç±»çš„æœ¬è´¨","ä½ ä»¬å’‹ä¸ä¸Šå¤©å‘","åˆå¤è¯»ä¸Šç˜¾äº†å•Š"}
                         math.randomseed(os.time())
                         fdsj = math.random(1, 6)
				         sedmsg(CurrentQQ,data,fdArray[fdsj])
				     else
			             rr = ii + 1
		                 Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
		             end
			    else
			        rr = ii + 1
		            Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
			    end
			else
			    if (ii > 2) then
			        math.randomseed(os.time())
                    sj2 = math.random(1, 3)
					if (sj2 == 2) then
					    fdArray2 = {"ä¸­æ–­å¤è¯»å¯è€»","æ‰“æ–­å¤è¯»å¯è€»(â€¢Ì€ã¸ â€¢Ì â•® )","ä½ ä¸ºä»€ä¹ˆè¦æ‰“æ–­å¤è¯»å•Š","å¤è¯»ä¸é¦™å˜›","ç ´åæ°›å›´(à¸‡áµ’ÌŒçš¿áµ’ÌŒ)à¸‡â¼Â³â‚Œâ‚ƒ"}
                        math.randomseed(os.time())
                        fdsj2 = math.random(1, 5)
				        sedmsg(CurrentQQ,data,fdArray2[fdsj2])
					end
				end
				Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt","1")
			    Wirte("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt",data.Content)
			end
		else
		    Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt","1")
			Wirte("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt",data.Content)
		end
	    --å¦‚æœè°ƒæ•™æŒ‡ä»¤ä¸å­˜åœ¨ï¼Œåˆ™è¿›è¡Œå…¶ä»–æ“ä½œ
	    msgsql(CurrentQQ,data)--æ•°æ®å‚¨è“„
		--éšæœºå›å¤æ¶ˆæ¯æ¦‚ç‡0.04
	    math.randomseed(os.time())
        num = math.random(1, 40)
		if (num == 12) then
		    j = xiaosiapi(CurrentQQ,data,data.Content)
			sedmsg(CurrentQQ,data,j.data.info.text)
		end
	else
	    --è§¦å‘è°ƒæ•™æŒ‡ä»¤
		funic(CurrentQQ,data,mim)
	end
    return 1
end

function ReceiveEvents(CurrentQQ, data, extData)
  if data.MsgType == "ON_EVENT_GROUP_REVOKE" then --ç›‘å¬ ç¾¤æ’¤å›äº‹ä»¶
    --æ’¤å›äº‹ä»¶å¤„ç†
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..extData.GroupID..".txt")
    if (str == nil) then
	    log.info("Str ====> %s", str)
        return 1
	end
	if (string.find(str, "å…³é—­")) then
		return 1
	end
	CheHui(CurrentQQ, data, extData)
	--xxxxxxxxxxxxxxx
    return 1
  end
end
  --è¿›ç¾¤ç§€å›¾æ¬¢è¿


--é—ªç…§æ£€æµ‹å¤„ç†


--åŠŸèƒ½ç»„
function funic(CurrentQQ,data,msg)
    if string.find(msg, "^ç‚¹æ­Œ") then
	    data.Content = msg
        music(CurrentQQ,data,msg)
		return 1
	elseif string.find(msg, "^è¯­éŸ³") then
	    keyWord = msg:gsub("è¯­éŸ³", "")
        sedvoicemsg(CurrentQQ,data,keyWord)
		return 1
	elseif string.find(msg, "^å›¾ç‰‡") then
	    keyWord = msg:gsub("å›¾ç‰‡", "")
        sedimgmsg(CurrentQQ,data,keyWord,"")
		return 1
    elseif string.find(msg, "^å”±æ­Œ") then
        keyWord = msg:gsub("å”±æ­Œ", "")
		if (keyWord == "") then
		    sedmsg(CurrentQQ,data,"æ­Œåä¸èƒ½ç©ºç€å“¦")
		    return 1
		end
		sedmsg(CurrentQQ,data,"å¦¾èº«æ­£åœ¨åŠªåŠ›åŠ è½½Ù©(ËƒÌ¶Ì€Íˆà¯°Ë‚Ì¶ÌÍˆ)Ùˆ")
        response, error_message =
            http.request(
            "POST",
            "http://127.0.0.1:8888/SilkApi/UrlToBuf",--ä¿®æ”¹æ­¤å¤„ipåŠç«¯å£å³å¯
            {
                body = keyWord --ä¼ å…¥æ­Œæ›²å
            }
        )
        log.notice("err   %v", error_message)
        html = response.body --è¿”å›silk base64 buf
		if (string.find(html, "Î´")) then
				    sedmsg(CurrentQQ,data,"å¤©ä¾æ²¡æœ‰æ‰¾åˆ°ç›¸å…³çš„æ­Œå‘€(Ã’Ï‰Ã“×±)ï¼")
					c.close(c)
				    return 2
				end
        luaRes =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "VoiceMsg",
                groupid = 0,
                content = "",
                atUser = 0,
                voiceUrl = "",
                voiceBase64Buf = html 
            }
        )
		return 1
	end
    sedmsg(CurrentQQ,data,msg)
end

--å½±è§†æœç´¢ç”¨
function Sousuo(CurrentQQ,data,msg)
    response, error_message =
        http.request(
            "GET",
            "http://localhost/index.php/ajax/suggest",
            {
                query = "mid=1&f=admin&wd="..msg.."&limit=10&timestamp=1567914326746"
            }
        )
    html = response.body
	json = json.decode(html)
	if (json.total == 0) then
	    sedmsg(CurrentQQ,data,"å½±è§†æŸ¥è¯¢é”™è¯¯\nè¯·æ£€æŸ¥å½±è§†åæ˜¯å¦æ­£ç¡®\nâ•â•â•â•â•â•â•â•â•â•â•\næ³¨æ„âš ï¸å½±è§†åä¸è¦å¸¦æ— å…³æˆ–å¤šä½™çš„å­—ç¬¦")
	else
        sedmsg(CurrentQQ,data,"èµ„æºåœ°å€å¦‚ä¸‹â†“â†“â†“\nâ•â•â•â•â•â•â•â•â•â•\nhttp://118.25.41.32/index.php/vod/search/wd/"..escape(msg)..".html\nâ•â•â•â•â•â•â•â•â•â•â•\næ³¨æ„:å¦‚æœQQå‡ºç°åœæ­¢è®¿é—®ç°è±¡ï¼Œè¯·å¤åˆ¶é“¾æ¥ç”¨æµè§ˆå™¨æ‰“å¼€")
	end
end

--å•çº¯å‘æ¶ˆæ¯å›¾æ–‡é€šç”¨
function sedimgmsg(CurrentQQ,data,url,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "PicMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = url,
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘æ¶ˆæ¯ç”¨
function sedmsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "TextMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘ç§èŠæ¶ˆæ¯ç”¨
function sendfrimsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromUin,
        sendToType = 1,
        sendMsgType = "TextMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘jsonæ¶ˆæ¯ç”¨
function sedjsonmsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "JsonMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--èŠå¤©æ¨¡å—åˆ‡æ¢å‡½æ•°
function liaotian(CurrentQQ,data,msg)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
    if (mim == nil) then
        sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
        return 1
    end
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
	if (str == nil) then
        return 1
    end
	if (string.find(str, "å…³é—­")) then
	    sedmsg(CurrentQQ,data,"æœºå™¨èŠå¤©å¤„äºå…³é—­çŠ¶æ€\nâˆ´è¯·å…ˆå¼€å¯æœºå™¨èŠå¤©")
	    return 1
	end
	--åˆ‡æ¢å¤„ç†
	file = io.open("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt", "w")
	if (msg == 1) then
	    file:write("æ–‡å­—èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°æ–‡å­—èŠå¤©")
	elseif (msg == 2) then
	    file:write("è¯­éŸ³èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°è¯­éŸ³èŠå¤©")
	elseif (msg == 3) then
	    file:write("å›å¤èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°å›å¤èŠå¤©")
	end
	file:close()
end

--éšæœºè¡¨æƒ…å‡½æ•°
function faceArray()
    faceArray = {"[è¡¨æƒ…147]","ğŸ€","ğŸ”¥","ğŸ»","ğŸ’","[è¡¨æƒ…185]","[è¡¨æƒ…219]","[è¡¨æƒ…176]"}
    math.randomseed(os.time())
    num = math.random(1, 9)
    return faceArray[num]
end

--urlç¼–ç è½¬æ¢
function escape(w)
	pattern="[^%w%d%._%-%* ]"
	s=string.gsub(w,pattern,function(c)
		local c=string.format("%%%02X",string.byte(c))
		return c
	end)
	s=string.gsub(s," ","+")
	return s
end

--è¯»å–æ•°æ®å‡½æ•°
function Read(url)
    file = io.open(url, "r")
	if (file == nil) then
	    return nil
	else
        file:seek("set")
	    str = file:read("*a")
	    file:close()
        return str
	end
end

--å†™å…¥æ•°æ®å‡½æ•°
function Wirte(url,msg)
    file = io.open(url, "w+")
    file:write(msg)
	file:close()
    return "ok"
end

--å°æ€èŠå¤©å‡½æ•°
function xiaosiapi(CurrentQQ,data,str)
    response, error_message =
            http.request(
            "GET",
            "https://api.ownthink.com/bot",
            {
                query = "appid="..tostring(data.FromUserId).."&spoken=" .. url_encode(str),
                headers = {
                    Accept = "*/*"
                }
            }
        )
        html = response.body
		jData = json.decode(html)
		return jData
end

--æœºå™¨èŠå¤©å‡½æ•°
function ownthink(CurrentQQ,data,msgs,atqq)
    if (tostring(atqq) == CurrentQQ) then
        m = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
        if (m == nil) then
	        log.info("Str ====> %s", m)
            return 1
	    end
	    if (string.find(m, "å…³é—­")) then
	        sedmsg(CurrentQQ,data,"æœºå™¨èŠå¤©å¤„äºå…³é—­çŠ¶æ€\nâˆ´è¯·å…ˆå¼€å¯æœºå™¨èŠå¤©")
	        return 1
	    end
		res2 = string.find(msgs, " ")
		str = string.sub(msgs,res2)
		jData = xiaosiapi(CurrentQQ,data,str)
		Data = json.decode(data.Content)
		m = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
		if (m == nil) then
	        log.info("Str ====> %s", m)
            return 1
	    end
		if (string.find(m, "å›å¤èŠå¤©")) then
		    Api.Api_SendMsg(
                CurrentQQ,
                {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "ReplayMsg",
                groupid = 0,
                content = jData.data.info.text,
                atUser = 0,
				replayInfo = {
                    MsgSeq = data.MsgSeq,
                    --å›å¤æ¶ˆæ¯çš„Seq
                    MsgTime = data.MsgTime,
                    --å›å¤æ¶ˆæ¯çš„äº‹ä»¶
                    UserID = data.FromUserId,
                    --å›å¤æ¶ˆæ¯å¯¹è±¡
                    RawContent = Data.Content --å›å¤æ¶ˆæ¯çš„åŸå†…å®¹
                }
				}
            )
			return 1
		elseif (string.find(m, "æ–‡å­—èŠå¤©")) then
		    sedmsg(CurrentQQ,data,jData.data.info.text)
		else
		    sedvoicemsg(CurrentQQ,data,url_encode(jData.data.info.text))
		end
    end
end

--å‘é€è¯­éŸ³æ¶ˆæ¯
function sedvoicemsg(CurrentQQ,data,str)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "VoiceMsg",
        groupid = 0,
		voiceUrl = "https://dds.dui.ai/runtime/v1/synthesize?voiceId=qianranfa&speed=0.7&volume=100&audioType=wav&text="..str, --å‘é€è¯­éŸ³çš„ç½‘ç»œåœ°å€ æ–‡æœ¬å‹
        voiceBase64Buf = "",
        content = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å¤©æ°”æŸ¥è¯¢å‡½æ•°
--[[function tianqi(CurrentQQ,data)
    keyWord = data.Content:gsub("å¤©æ°”", "")
        if keyWord == "" then
            return 1
        end

        cookies = Api.Api_GetUserCook(CurrentQQ)

        response, error_message =
            http.request(
            "GET",
            "https://weather.mp.qq.com/cgi-bin/rich",
            {
                query = "g_tk=" .. cookies.Gtk .. "&city=" .. url_encode(keyWord),
                headers = {
                    Referer = "http://weather.mp.qq.com/ark"
                },
                cookies = {
                    uin = CurrentQQ,
                    skey = cookies.Skey
                }
            }
        )
        local html = response.body
        log.notice("From Lua html -->%s", html)

        local j = json.decode(html)
        if j.code ~= 0 then
            return 1
        end

        ApiRet =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "JsonMsg",
                groupid = 0,
                content = string.format(
                    --{"config":{"forward":1,"autosize":1},"prompt":"[åº”ç”¨]å¤©æ°”","app":"com.tencent.weather","ver":"0.0.0.1","view":"RichInfoView","meta":{"richinfo":{"adcode":"101210701","city":"æˆéƒ½","air":"58","min":"20","ts":"1500550866","wind":"1","date":"6æœˆ27æ—¥ å‘¨å››","max":"28","type":"201"}},"desc":"å¤©æ°”"}
                    --[[{"app":"com.tencent.weather","desc":"","meta":{"weather":{"ad":[{"icon":"http://imgcache.qq.com/ac/tq/xz2/tp.jpg","p":"ptype=star","t":"2","title":"æ˜Ÿåº§ | ä»Šå¤©ä¼šå› ä¸ºæ„Ÿæƒ…å’Œå®¶åº­çš„é—®é¢˜ï¼Œå½±å“å·¥ä½œï¼Œè¿˜æœ‰ï¼Œä¹Ÿè¦æ³¨æ„äºº...","url":""},{"icon":"http://imgcache.qq.com/ac/qqweather/image/2019/6/27.png","p":"ptype=lunar","t":"4","title":"é»„å† | å†œå†äº”æœˆå»¿äº”ã€‚å®œè®¢ç›Ÿ.çº³é‡‡.å‡ºè¡Œ.ç¥ˆç¦.æ–‹é†®.å®‰åºŠ.ä¼š...","url":""}],"info":{"it1":{"adcode":"101050101","city":"æ­¦æ±‰","hour":"18","max":"29","min":"17","temp":"24","type":"202","ut":"1561630401","wea":"å¤šäº‘"},"it2":{"hour":"19","temp":"22","type":"202"},"it3":{"hour":"20","temp":"21","type":"202"},"ts":"1561631244"},"url":""}},"prompt":"ã€å“ˆå°”æ»¨ã€‘å¤šäº‘ 17Â°/29Â°, 18:13æ›´æ–°~","ver":"1.0.0.106","view":"WeatherThreeView"}]]
--[[                    [[{"app":"com.tencent.weather","desc":"å¤©æ°”","view":"RichInfoView","ver":"1.0.0.217","prompt":"[åº”ç”¨]å¤©æ°”","meta":{"richinfo":{"adcode":"%s","air":"%s","city":"%s","date":"%s","max":"%s","min":"%s","ts":"1554951408","type":"%s","wind":"%s"}},"config":{"forward":1,"autosize":1,"type":"card"}}]],
--[[                    j.data.adcode,
                    j.data.air,
                    j.data.city,
                    j.data.date,
                    j.data.max,
                    j.data.min,
                    j.data.type,
                    j.data.wind
                ),
                atUser = 0
            }
        )
end
--]]
--è°ƒæ•™å¤„ç†å‡½æ•°(å¾…å¤„ç†)
function tiaojiao(CurrentQQ,data)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
	if (mim == nil) then
		sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå“‡")
		return 1
	end
	if (string.find(data.Content, "^åˆ é™¤è°ƒæ•™")) then
	    msg = data.Content:gsub("åˆ é™¤è°ƒæ•™", "")
	    if (msg == "") then
		    sedmsg(CurrentQQ,data,"è¦åˆ é™¤çš„è°ƒæ•™æŒ‡ä»¤ä¸èƒ½ä¸ºç©ºå“¦")
		    return 1
		end
		rese = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..tostring(data.FromGroupId).."\/"..msg..".txt")
	    if (rese == nil) then
			sedmsg(CurrentQQ,data,"è¿™ä¸ªæŒ‡ä»¤ä¸å­˜åœ¨äº†å“¦")
		    return 1
		end
		rm_file = os.remove("mimoio\/æœºå™¨è°ƒæ•™\/"..tostring(data.FromGroupId).."\/"..msg..".txt")
		log.info("åˆ é™¤è°ƒæ•™ ====> %s", rm_file)
		sedmsg(CurrentQQ,data,"åˆ é™¤æˆåŠŸ\nä½ ä¸å–œæ¬¢è¢«è¿™æ ·è°ƒæ•™çš„æˆ‘å—[è¡¨æƒ…9]")
		return 1
	end
    msgs = data.Content:gsub("è°ƒæ•™", "")
		res2 = string.find(msgs, "#")
		str = string.sub(msgs,res2+1)
		str2 = string.sub(msgs,1,res2-1)
		        
		        if (str == "") then
		            sedmsg(CurrentQQ,data,"è°ƒæ•™çš„å›ç­”å†…å®¹ä¸èƒ½ä¸ºç©ºå“¦")
			        return 1
		        end
				if (str2 == "") then
		            sedmsg(CurrentQQ,data,"è°ƒæ•™çš„æŒ‡ä»¤å†…å®¹ä¸èƒ½ä¸ºç©ºå“¦")
			        return 1
		        end
		        rese = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..str2..".txt")
					if (rese ~= nil) then
				        sedmsg(CurrentQQ,data,"æŒ‡ä»¤å·²ç»å­˜åœ¨äº†å“¦")
				        return 1
				    end
				Wirte("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..str2..".txt",str)
				sedmsg(CurrentQQ,data,"è°ƒæ•™æˆåŠŸ\nä½ è¿˜æƒ³å†è°ƒæ•™æˆ‘ä¸€æ¬¡å—[è¡¨æƒ…6]")
		        return 1
end

function url_encode(str)
    if (str) then
        str = string.gsub(str, "\n", "\r\n")
        str =
            string.gsub(
            str,
            "([^%w ])",
            function(c)
                return string.format("%%%02X", string.byte(c))
            end
        )
        str = string.gsub(str, " ", "+")
    end
    return str
end

--æŠ¢çº¢åŒ…å¤„ç†
function RedBag(CurrentQQ, data)
    Api.Api_OpenRedBag(CurrentQQ, data.RedBaginfo)
    if (data.RedBaginfo.RedType == 12) then
         luaRes =
                Api.Api_SendMsg(
                CurrentQQ,
                {
                    toUser = data.FromGroupId,
                    sendToType = 2,
                    sendMsgType = "TextMsg",
                    groupid = 0,
                    content = data.RedBaginfo.Tittle,
                    atUser = 0
                }
            )
        log.notice("From Lua SendMsg Ret\n%d", luaRes.Ret)
    end
end

--è§†é¢‘è§£æå¤„ç†
function Video(CurrentQQ, data)
    vdata = json.decode(data.Content)
        videodata = {
            GroupID = data.FromGroupId,
            VideoUrl = vdata.VideoUrl,
            VideoMd5 = vdata.VideoMd5
        }
        --æ„é€ table å‚æ•°è¡¨
        luaResp = Api.Api_CallFunc(CurrentQQ, "PttCenterSvr.ShortVideoDownReq", videodata) --é€šè¿‡cmdè°ƒç”¨åŠŸèƒ½åŒ…
        luaRes =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "TextMsg",
                groupid = 0,
                content = "è§£æè§†é¢‘URL-->" .. luaResp.VideoUrl,
                atUser = 0
            }
        )
end

--ç®¡ç†å¼€å…³é€šç”¨
function adminio(CurrentQQ,data,oio)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim ~= nil) then
            msg = data.Content:gsub(oio, "")
            str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
            if (string.find(str, "å…³é—­")) then
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äººå·²è¢«å…³é—­...\nè¯·å…ˆå¼€å¯æœºå™¨äºº")
                return 1
            end
			str2 = Read("mimoio\/çŠ¶æ€æ•°æ®\/"..oio.."\/"..data.FromGroupId..".txt")
			if (string.find(str2, msg)) then
			    sedmsg(CurrentQQ,data,"âˆ´"..oio.."æœ¬å°±æ˜¯"..str2.."çŠ¶æ€")
                return 1
			end
            Wirte("mimoio\/çŠ¶æ€æ•°æ®\/"..oio.."\/"..data.FromGroupId..".txt",msg)
            sedmsg(CurrentQQ,data,"âˆ´"..oio..msg.."æˆåŠŸ")
            return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
end

--ç™¾ç§‘å¤§å…¨
function baike(CurrentQQ,data)
    keyWord = data.Content:gsub("ç™¾ç§‘", "")
        if keyWord == "" then
            return 1
        end
        response, error_message =
            http.request(
            "GET",
            "http://baike.baidu.com/api/openapi/BaikeLemmaCardApi",
            {
                query = "scope=103&format=json&appid=379020&bk_key=" .. url_encode(keyWord) .. "&bk_length=600"
            }
        )
        html = response.body
        while(string.find(html, '"errno":2')) do
            response, error_message =
            http.request(
            "GET",
            "http://baike.baidu.com/api/openapi/BaikeLemmaCardApi",
            {
                query = "scope=103&format=json&appid=379020&bk_key=" .. url_encode(keyWord) .. "&bk_length=600"
            })
			html = response.body
        end
        local j = json.decode(html)
        sedmsg(CurrentQQ,data,j.abstract.."\n"..j.url)
end

--éŸ³ä¹ç‚¹æ­Œ
function music(CurrentQQ,data)
    keyWord = data.Content:gsub("ç‚¹æ­Œ", "")
        if keyWord == "" then
            return 1
        end
        response, error_message =
            http.request(
            "GET",
            "https://c.y.qq.com/soso/fcgi-bin/client_search_cp",
            {
                query = "aggr=1&cr=1&flag_qc=0&p=1&n=6&w=" .. url_encode(keyWord)
            }
        )
        html = response.body
		str = string.sub(html,10,-2)
        j = json.decode(str)
        if (j.code == 0) then
            msg = ""
            num = j.data.song.list
            list = num[1]
            songname = list.songname
            singername = list.singer[1].name
            payplay = list.pay.payplay
			albummid = list.albummid
			songmid = list.songmid
	        sedjsonmsg(CurrentQQ,data,'{"app":"com.tencent.structmsg","desc":"éŸ³ä¹","view":"music","ver":"0.0.0.1","prompt":"[åˆ†äº«]' ..songname.. '","meta":{"music":{"sourceMsgId":"0","title":"' ..songname.. '","desc":"' ..singername.. '","preview":"y.gtimg.cn/music/photo_new/T002R150x150M000'..albummid..'.jpg","tag":"QQéŸ³ä¹","musicUrl":"https://v1.itooi.cn/tencent/url?id='..songmid..'","jumpUrl":"y.qq.com/n/yqq/song/'..songmid..'.html","appid":100497308,"app_type":1,"action":"","source_url":"url.cn/5aSZ8Gc","source_icon":"url.cn/5tLgzTm","android_pkg_name":"com.tencent.qqmusic"}},"config":{"forward":true,"type":"normal","autosize":true}}')
			return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´Error:"..j.code)
			return 1
        end
end

--è®¿é—®url
function geturl(url_class,url,caulrt)
        response, error_message =
            http.request(
            url_class,
            url,
            {
                query = caulrt
            }
        )
        html = response.body
		return html
end

--æ¶ˆæ¯å‚¨è“„
function msgsql(CurrentQQ,data)
    if (mysqlpass == "") then
	    return 1
	end
    c = mysql.new()
    -- åˆå§‹åŒ–mysqlå¯¹è±¡
    ok, err = c:connect({host = mysqlhost, port = 3306, database = mysqldb, user = mysqluser, password = mysqlpass})
    --å»ºç«‹è¿æ¥
    if ok then
        sqlstr =
            string.format(
            [[INSERT INTO msgcache (GroupID, MsgSeq, MsgRandom,MsgType,Data,MsgTime)VALUES (%d,%d,%d,'%s','%s',%d)]],
            data.FromGroupId,
            data.MsgSeq,
            data.MsgRandom,
            data.MsgType,
            data.Content,
            data.MsgTime
        )
        res, err = c:query(sqlstr) --å…¥åº“ç¼“å­˜æ¶ˆæ¯
        log.info("%s", err)
        c.close(c)
    --é‡Šæ”¾è¿æ¥
    end
    return 1
end

--æ’¤å›æ£€æµ‹
function CheHui(CurrentQQ, data, extData)
    c = mysql.new()
    -- åˆå§‹åŒ–mysqlå¯¹è±¡
	if (mysqlpass == "") then
	    return 1
	end
	
    if data.MsgType == "ON_EVENT_GROUP_REVOKE" then --ç›‘å¬ ç¾¤æ’¤å›äº‹ä»¶
        str = string.format("ç¾¤æˆ %d  æˆå‘˜ UserID %s æ’¤å›äº†æ¶ˆæ¯Seq %s \n", extData.GroupID, extData.UserID, extData.MsgSeq)
        log.info("%s", str)
        ok, err = c:connect({host = mysqlhost, port = 3306, database = mysqldb, user = mysqluser, password = mysqlpass})
        --å»ºç«‹è¿æ¥
        log.info("sql %v", err)
        if ok then
            sqlstr =
                string.format(
                "select * from msgcache where `GroupID`= %d and `MsgSeq` = %d",
                extData.GroupID,
                extData.MsgSeq
            )
            res, err = c:query(sqlstr) --è·Ÿç¾¤ç¾¤idå’Œæ¶ˆæ¯SEQæŸ¥è¯¢å‡ºæ’¤å›çš„æ¶ˆæ¯å†…å®¹
            if err == nil then
                c.close(c)
                GroupID = tonumber(res[1]["GroupID"])
                MsgType = res[1]["MsgType"]
                Data = res[1]["Data"]

                if MsgType == "TextMsg" then
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            --å‘é€æ–‡æœ¬æ¶ˆæ¯
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡æ–‡æœ¬æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                Data
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "SmallFaceMsg" then
                    --Data {"Content":"[è¡¨æƒ…101]","Hex":"FKY=","Index":101,"tips":"[å°è¡¨æƒ…]"}
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡è¡¨æƒ…æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).Content
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "PicMsg" then
                    --Data {"Content":"","FileId":2820717626,"FileMd5":"q0oEC5aloJJMFr10mplaXw==","FileSize":7026,"tips":"[ç¾¤å›¾ç‰‡]","url":"http://gchat.qpic.cn/gchatpic_new/1700487478/960839480-2534335053-AB4A040B96A5A0924C16BD749A995A5F/0?vuin=u0026term=255u0026pictype=0"}
                    jData = json.decode(Data)
					if (jData.tips == "[ç¾¤æ¶ˆæ¯-QQé—ªç…§]") then
					    
					Api.Api_SendMsg( 
                    CurrentQQ,
                    {
                        toUser = GroupID,
                        sendToType = 2,
                        sendMsgType = "ForwordMsg",
                        content = "",
                        atUser = 0,
                        groupid = 0,
                        voiceUrl = "",
                        voiceBase64Buf = "",
                        picUrl = "",
                        picBase64Buf = "",
                        forwordBuf = json.decode(Data).ForwordBuf, --æ¬²è½¬å‘çš„base64buf å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                        forwordField = json.decode(Data).ForwordField --æ¬²å†™å…¥åè®®çš„å­—æ®µID å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                    }
                )
				    return 1
					end
                    Api.Api_SendMsg( --é€šè¿‡å›¾ç‰‡md5å‘é€å›¾ç‰‡ ç§’å‘ä¸ç”¨ä¸Šä¼  ç›¸å½“äºè½¬å‘
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "PicMsg",
                            --å‘é€å›¾æ–‡æ¶ˆæ¯
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡å›¾ç‰‡æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š[PICFLAG]%s",
                                extData.UserID,
                                jData.Content
                            ),
                            --é€šè¿‡å®[PICFLAG]æ”¹å˜å›¾æ–‡é¡ºåº  æ”¹ä¸ºç°æ–‡å­—åå›¾ç‰‡
                            atUser = 0,
                            voiceUrl = "",
                            voiceBase64Buf = "",
                            picUrl = "",
                            picBase64Buf = "",
                            fileMd5 = jData.FileMd5
                        }
                    )
                end
                if MsgType == "AtMsg" then
                    --Data {"Content":"@Kar98k skjjkssjkjs","UserID":123456789,"tips":"[ATæ¶ˆæ¯]"}
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡atæ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).Content
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "VoiceMsg" then
                    --Data {"tips":"[è¯­éŸ³]","url":"http://grouptalk.c2c.qq.com/?ver=0u0026rkey=3062020101045b305902010102010102041fdef8ae042439416931554e5142586c536d78706a314c686843664959725f327a5f573064697653755902045dac2a21041f0000000866696c6574797065000000013100000005636f64656300000001310400u0026filetype=1u0026voice_codec=1"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "VoiceMsg",
                            --å‘é€ç¾¤è¯­éŸ³æ¶ˆæ¯
                            groupid = 0,
                            content = "",
                            atUser = 0,
                            voiceUrl = json.decode(Data).url,
                            --é€šè¿‡ç½‘ç»œurlè¿›è¡Œå‘é€è¯­éŸ³
                            voiceBase64Buf = "",
                            picUrl = "",
                            picBase64Buf = ""
                        }
                    )
                end

                if MsgType == "ReplayMsg" then
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡å›å¤æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).ReplayContent
                            ),
                            atUser = 0
                        }
                    )
                end
				if MsgType == "VideoMsg" then
	             Api.Api_SendMsg( 
                    CurrentQQ,
                    {
                        toUser = GroupID,
                        sendToType = 2,
                        sendMsgType = "ForwordMsg",
                        content = "",
                        atUser = 0,
                        groupid = 0,
                        voiceUrl = "",
                        voiceBase64Buf = "",
                        picUrl = "",
                        picBase64Buf = "",
                        forwordBuf = json.decode(Data).ForwordBuf, --æ¬²è½¬å‘çš„base64buf å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                        forwordField = json.decode(Data).ForwordField --æ¬²å†™å…¥åè®®çš„å­—æ®µID å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                    }
                )
				end
                if MsgType == "XmlMsg" then
				    
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "XmlMsg",
                            groupid = 0,
                            content = string.format("%s", Data),
                            atUser = 0
                        }
                    )
                end
				if MsgType == "JsonMsg" then
				    
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "JsonMsg",
                            groupid = 0,
                            content = string.format("%s", Data),
                            atUser = 0
                        }
                    )
                end
            end
        end
    end
    return 1
end
2020/09/07 12:54:09.967 [E]  mimoio.lua
2020/09/07 12:54:09.967 [E]  local log = require("log")
local Api = require("coreApi")
local json = require("json")
local http = require("http")
local mysql = require("mysql")

--ç‰ˆæœ¬å·(ä¸è¦æ”¹åŠ¨)
Vabr = "1.0.2"
--æ•°æ®åº“é…ç½®
mysqlhost = "localhost"--é»˜è®¤ä¸åŠ¨
mysqldb = "ffaxx001"--æ•°æ®åº“å
mysqluser = "ffaxx001"--æ•°æ®åº“ç”¨æˆ·å
mysqlpass = "123456"--æ•°æ®åº“å¯†ç 
--ä¸ä½¿ç”¨è¯·ä¸è¦æ”¹åŠ¨

function ReceiveFriendMsg(CurrentQQ, data)
    if (data.Content == "ä½¿ç”¨æ–¹æ³•") then
	    sendfrimsg(CurrentQQ,data,"æ·»åŠ æˆæƒè€…çš„æ–¹æ³•\nå¯¹å•ä¸ªæœºå™¨äººç§èŠå‘é€[æ·»åŠ æˆæƒè€…+æˆæƒè€…QQ]\n\næˆæƒç¾¤çš„æ–¹æ³•\nåˆ°éœ€è¦æˆæƒçš„ç¾¤é‡Œå‘é€[æˆæƒ+ä¸»äººQQ]ã€‚æ³¨æ„:æˆæƒå¿…é¡»æ˜¯æˆæƒè€…è¿›è¡Œæ“ä½œ,ç®¡ç†å‘˜æˆæƒä¸äº†")
	end
    --æ•°æ®åˆå§‹åŒ–
    if (data.Content == "åˆå§‹åŒ–") then
	    root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root ~= nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´è¯·ä¸è¦é‡å¤åˆå§‹åŒ–")
			return 1
		end
    --os.execute('mkdir mimoio/æœºå™¨æˆæƒ')
	    os.execute('mkdir mimoio')
		os.execute('mkdir mimoio/å¤è¯»æœº')
		os.execute('mkdir mimoio/å¤è¯»æœº/æ¬¡æ•°')
		os.execute('mkdir mimoio/å¤è¯»æœº/å†…å®¹')
		os.execute('mkdir mimoio/æœºå™¨æˆæƒ')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨ä¸»äºº')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨èŠå¤©')
		os.execute('mkdir mimoio/æœºå™¨è°ƒæ•™')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æŠ¢çº¢åŒ…')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æœºå™¨èŠå¤©')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æœºå™¨å¼€å…³')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æ’¤å›æ£€æµ‹')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/å›¾ç‰‡è§£æ')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/è§†é¢‘è§£æ')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/é—ªç…§æ£€æµ‹')
		Wirte("mimoio\/"..data.FromUin..".txt","999")
		sendfrimsg(CurrentQQ,data,"åˆå§‹åŒ–å®Œæ¯•ï¼\nå‘é€[ä½¿ç”¨æ–¹æ³•]äº†è§£ä½¿ç”¨å§")
	end
	--æ·»åŠ æˆæƒè€…æ“ä½œ(ç§èŠæœºå™¨äººå‘é€)
	if (string.find(data.Content, "^æ·»åŠ æˆæƒè€…")) then
	    msg = data.Content:gsub("æ·»åŠ æˆæƒè€…", "")
		--Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromUin..".txt","å…³é—­")
		root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root == nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„ç®¡ç†è€…")
			return 1
		end
		Wirte("mimoio\/æœºå™¨æˆæƒ\/"..msg..CurrentQQ..".txt","999")
		sendfrimsg(CurrentQQ,data,"âˆ´æ·»åŠ æˆæƒè€…æˆåŠŸ")
	end
	--åˆ é™¤æˆæƒè€…æ“ä½œ(ç§èŠæœºå™¨äººå‘é€)
	if (string.find(data.Content, "^åˆ é™¤æˆæƒè€…")) then
	    msg = data.Content:gsub("åˆ é™¤æˆæƒè€…", "")
		--Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromUin..".txt","å…³é—­")
		root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root == nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„ç®¡ç†è€…")
			return 1
		end
		os.remove("mimoio\/æœºå™¨æˆæƒ\/"..msg..CurrentQQ..".txt")
		sendfrimsg(CurrentQQ,data,"âˆ´åˆ é™¤æˆæƒè€…æˆåŠŸ")
	end
    return 1
end
function ReceiveGroupMsg(CurrentQQ, data)
    if (tostring(data.FromUserId) == CurrentQQ) then
	    return 1
	end
	--ç¾¤èŠæˆæƒ(åˆ°éœ€è¦æˆæƒçš„ç¾¤é‡Œæ“ä½œ)
	if (string.find(data.Content, "^æˆæƒ")) then
	    root = Read("mimoio\/æœºå™¨æˆæƒ\/"..data.FromUserId..CurrentQQ..".txt","999")
		if (root == nil) then
		    sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„æˆæƒè€…")
			return 1
		end
		msg = data.Content:gsub("æˆæƒ", "")
		os.execute('mkdir mimoio/æœºå™¨è°ƒæ•™/'..data.FromGroupId)
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨ä¸»äºº/'..data.FromGroupId)
		Wirte("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..msg..".txt","999")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt","å›å¤èŠå¤©")
		sedmsg(CurrentQQ,data,"âˆ´æˆæƒæˆåŠŸï¼\nå‘é€[å¼€å¯æœºå™¨äºº]ä½¿ç”¨å§")
	end
	--åˆ é™¤æˆæƒæ“ä½œ(åˆ°éœ€è¦åˆ é™¤æˆæƒçš„ç¾¤é‡Œæ“ä½œ)
	if (string.find(data.Content, "^åˆ é™¤æˆæƒ")) then
	    root = Read("mimoio\/æœºå™¨æˆæƒ\/"..data.FromUserId..CurrentQQ..".txt","999")
		if (root == nil) then
		    sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„æˆæƒè€…")
			return 1
		end
		msg = data.Content:gsub("åˆ é™¤æˆæƒ", "")
		os.remove("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..msg..".txt")
		os.remove("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
		sedmsg(CurrentQQ,data,"âˆ´åˆ é™¤æˆæƒæˆåŠŸï¼")
	end
	--æœºå™¨å¼€å…³æŒ‡ä»¤
	if (data.Content == "å¼€å¯æœºå™¨äºº" or data.Content == "å…³é—­æœºå™¨äºº") then
        mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim ~= nil) then
            msg = data.Content:gsub("æœºå™¨äºº", "")
            str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
			if (str == nil) then
			    Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt",msg)
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äºº"..msg.."æˆåŠŸï¼")
				log.info("Str ====> %s", str)
                return 1
			end
			
            if (string.find(str, msg)) then
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äººä¸€ç›´æ˜¯"..msg.."çš„å‘")
                return 1
            end
            Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt",msg)
            sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äºº"..msg.."æˆåŠŸï¼")
            return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
	end
    --æœºå™¨äººå¼€å¯æ£€æµ‹
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
	if (str == nil) then
	    log.info("Str ====> %s", str)
        return 1
	end
	if (string.find(str, "å…³é—­")) then
	    return 1
	end
	--atæ¶ˆæ¯å¤„ç†
	msgs = ""
	atqq = 0
	if (string.find(data.Content, "ATæ¶ˆæ¯")) then
	    msgs = json.decode(data.Content).Content
		atqq = json.decode(data.Content).UserID
	end
	--å°¾å·´è‡ªå®šä¹‰(å¾…å®Œå–„)
	tips = "â€”â€”å‡¤é£ç¿±ç¿”å…®ä¸·"
    --åŠŸèƒ½æ¨¡å—
    if (data.Content == "åŠŸèƒ½" or data.Content == "ä¸»ç•Œé¢") then
        face = faceArray()
        sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."å½±è§†æœç´¢\n"..face.."èŠå¤©å¨±ä¹\n"..face.."ä¾¿åˆ©åŠŸèƒ½\n"..face.."æœºå™¨è°ƒæ•™\n"..face.."ç®¡ç†ç³»ç»Ÿ\n"..face.."bugåé¦ˆ\n"..face.."æœ¬ç¾¤çŠ¶æ€\n"..face.."æ›´æ–°æ£€æµ‹\n\n"..tips)
    end
    --å½±è§†æœç´¢æ¨¡å—
    if (data.Content == "å½±è§†æœç´¢") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."æœç´¢+å½±è§†å\n"..face.."æˆ‘æƒ³çœ‹+å½±è§†å\n"..face.."æˆ‘è¦çœ‹+å½±è§†å\n\n"..tips)
    elseif (string.find(data.Content, "^æœç´¢")) then
	    msg = data.Content:gsub("æœç´¢", "")
		Sousuo(CurrentQQ,data,msg)
	elseif (string.find(data.Content, "^æˆ‘æƒ³çœ‹")) then
	    msg = data.Content:gsub("æˆ‘æƒ³çœ‹", "")
		Sousuo(CurrentQQ,data,msg)
    elseif (string.find(data.Content, "^æˆ‘è¦çœ‹")) then
	    msg = data.Content:gsub("æˆ‘è¦çœ‹", "")
		Sousuo(CurrentQQ,data,msg)
	end
	--èŠå¤©å¨±ä¹æ¨¡å—
	if (data.Content == "èŠå¤©å¨±ä¹") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."åˆ‡æ¢æ–‡å­—èŠå¤©\n"..face.."åˆ‡æ¢å›å¤èŠå¤©\n"..face.."åˆ‡æ¢è¯­éŸ³èŠå¤©\n\n"..tips)
    elseif (data.Content == "åˆ‡æ¢æ–‡å­—èŠå¤©") then
		liaotian(CurrentQQ,data,1)
	elseif (data.Content == "åˆ‡æ¢è¯­éŸ³èŠå¤©") then
	    liaotian(CurrentQQ,data,2)
    elseif (data.Content == "åˆ‡æ¢å›å¤èŠå¤©") then
	    liaotian(CurrentQQ,data,3)
	else
	    ownthink(CurrentQQ,data,msgs,atqq)
	end
	--ä¾¿åˆ©åŠŸèƒ½æ¨¡å—
	if (data.Content == "ä¾¿åˆ©åŠŸèƒ½") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."ç™¾ç§‘å¤§å…¨\n"..face.."éŸ³ä¹ç‚¹æ­Œ\n"..face.."é—ªä»–@xx\n"..face.."å¤©æ°”æŸ¥è¯¢\n\n"..tips)
	elseif (data.Content == "ç™¾ç§‘å¤§å…¨") then
		sedmsg(CurrentQQ,data,"å‘é€:[ç™¾ç§‘+å…³é”®è¯]\nä¾‹å¦‚:ç™¾ç§‘æ´›å¦¾èº«")
    elseif (data.Content == "éŸ³ä¹ç‚¹æ­Œ") then
		sedmsg(CurrentQQ,data,"å‘é€:[ç‚¹æ­Œ+æ­Œå]\nä¾‹å¦‚:ç‚¹æ­Œé’æŸ ")
	elseif (data.Content == "å¤©æ°”æŸ¥è¯¢") then
		sedmsg(CurrentQQ,data,"å‘é€:[å¤©æ°”+åœ°æ–¹å]\nä¾‹å¦‚:å¤©æ°”åŒ—äº¬(é™äºå›½å†…)")
    elseif (string.find(data.Content, "^å¤©æ°”")) then
        tianqi(CurrentQQ,data)
	    --msg = data.Content:gsub("æœç´¢", "")
		--Sousuo(CurrentQQ,data,msg)
	elseif (string.find(data.Content, "^ç™¾ç§‘")) then
	    baike(CurrentQQ,data)
	    --msg = data.Content:gsub("æˆ‘æƒ³çœ‹", "")
		--Sousuo(CurrentQQ,data,msg)music(CurrentQQ,data)
    elseif (string.find(data.Content, "^ç‚¹æ­Œ")) then
	    music(CurrentQQ,data)
	end
	--æœºå™¨è°ƒæ•™æ¨¡å—
	if (data.Content == "æœºå™¨è°ƒæ•™") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."æ–‡å­—è°ƒæ•™\n"..face.."è¯­éŸ³è°ƒæ•™\n"..face.."å”±æ­Œè°ƒæ•™\n"..face.."éŸ³ä¹è°ƒæ•™\n"..face.."å›¾ç‰‡è°ƒæ•™\n"..face.."åˆ é™¤è°ƒæ•™\n\n"..tips)
    elseif (data.Content == "æ–‡å­—è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#(å†…å®¹)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#ä½ å¥½å•Š")
	elseif (data.Content == "è¯­éŸ³è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#è¯­éŸ³(å†…å®¹)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#è¯­éŸ³ä½ å¥½å•Š")
	elseif (data.Content == "å›¾ç‰‡è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#å›¾ç‰‡(é“¾æ¥)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#å›¾ç‰‡http://../1.jpg")
	elseif (data.Content == "éŸ³ä¹è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#ç‚¹æ­Œ(æ­Œå)]\nä¾‹å¦‚:è°ƒæ•™å–µ#ç‚¹æ­Œå­¦çŒ«å«")
	elseif (data.Content == "å”±æ­Œè°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#å”±æ­Œ(æ­Œå)]\nä¾‹å¦‚:è°ƒæ•™å–µ#å”±æ­Œå­¦çŒ«å«")
	elseif (data.Content == "åˆ é™¤è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[åˆ é™¤è°ƒæ•™(æŒ‡ä»¤)]\nä¾‹å¦‚:åˆ é™¤è°ƒæ•™ä½ å¥½")
	elseif (string.find(data.Content, "^è°ƒæ•™")) then
        tiaojiao(CurrentQQ,data)
	elseif (string.find(data.Content, "^åˆ é™¤è°ƒæ•™")) then
        tiaojiao(CurrentQQ,data)
	end
	--ç®¡ç†ç³»ç»Ÿæ¨¡å—
	if (data.Content == "ç®¡ç†ç³»ç»Ÿ") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."å¼€å¯/å…³é—­æœºå™¨äºº\n"..face.."å¼€å¯/å…³é—­æŠ¢çº¢åŒ…\n"..face.."å¼€å¯/å…³é—­æœºå™¨èŠå¤©\n"..face.."å¼€å¯/å…³é—­é—ªç…§æ£€æµ‹\n"..face.."å¼€å¯/å…³é—­å›¾ç‰‡è§£æ\n"..face.."å¼€å¯/å…³é—­è§†é¢‘è§£æ\n"..face.."å¼€å¯/å…³é—­æ’¤å›æ£€æµ‹\n\n"..tips)
    elseif (data.Content == "å¼€å¯æœºå™¨èŠå¤©" or data.Content == "å…³é—­æœºå™¨èŠå¤©") then
        adminio(CurrentQQ,data,"æœºå™¨èŠå¤©")
    elseif (data.Content == "å¼€å¯æ’¤å›æ£€æµ‹" or data.Content == "å…³é—­æ’¤å›æ£€æµ‹") then
        adminio(CurrentQQ,data,"æ’¤å›æ£€æµ‹")
	elseif (data.Content == "å¼€å¯é—ªç…§æ£€æµ‹" or data.Content == "å…³é—­é—ªç…§æ£€æµ‹") then
        adminio(CurrentQQ,data,"é—ªç…§æ£€æµ‹")
	elseif (data.Content == "å¼€å¯æŠ¢çº¢åŒ…" or data.Content == "å…³é—­æŠ¢çº¢åŒ…") then
        adminio(CurrentQQ,data,"æŠ¢çº¢åŒ…")
	elseif (data.Content == "å¼€å¯è§†é¢‘è§£æ" or data.Content == "å…³é—­è§†é¢‘è§£æ") then
        adminio(CurrentQQ,data,"è§†é¢‘è§£æ")
	elseif (data.Content == "å¼€å¯å›¾ç‰‡è§£æ" or data.Content == "å…³é—­å›¾ç‰‡è§£æ") then
        adminio(CurrentQQ,data,"å›¾ç‰‡è§£æ")
	end
	--bugåé¦ˆæ¨¡å—
	if (data.Content == "BUGåé¦ˆ" or data.Content == "bugåé¦ˆ") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."é‚®ä»¶åé¦ˆ\n"..face.."QQåé¦ˆ\n\n"..tips)
    elseif (data.Content == "QQåé¦ˆ") then
        sedmsg(CurrentQQ,data,"???Î£(ï¾Ÿâˆ€ï¾Ÿï¾‰)ï¾‰\næ’ä»¶æœ‰é—®é¢˜å¯ä»¥åé¦ˆåˆ°:\nQQ:2353065854")
    elseif (data.Content == "é‚®ä»¶åé¦ˆ") then
        sedmsg(CurrentQQ,data,"å®è´å’‹å•¦=ÍÍŸÍŸÍ(ê’ªá—œê’ª â€§Ì£Ì¥Ì‡)\næ’ä»¶æœ‰é—®é¢˜å¯ä»¥åé¦ˆåˆ°:\né‚®ç®±ğŸ“¬:ym-o@qq.com")
	end
	--æœ¬ç¾¤çŠ¶æ€æ¨¡æ¿
	if (data.Content == "æœ¬ç¾¤çŠ¶æ€") then
        face = faceArray()
        hb = Read("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt")
        sz = Read("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt")
		tp = Read("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt")
        sp = Read("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt")
        jqr = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
        lt = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
        ch = Read("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..data.FromGroupId..".txt")
		sedmsg(CurrentQQ,data,"çŠ¶æ€æ•°æ®åˆ—è¡¨â†“â†“â†“\n"..face.."æœºå™¨äºº:"..jqr.."\n"..face.."æŠ¢çº¢åŒ…:"..hb.."\n"..face.."å›¾ç‰‡è§£æ:"..tp.."\n"..face.."æ’¤å›æ£€æµ‹:"..ch.."\n"..face.."è§†é¢‘è§£æ:"..sp.."\n"..face.."æœºå™¨èŠå¤©:"..lt.."\n"..face.."é—ªç…§æ£€æµ‹:"..sz.."\n\n"..tips)
	end
	--æ›´æ–°æ¨¡å—
	if (data.Content == "æ›´æ–°æ£€æµ‹") then
        str = geturl("GET","http://118.25.41.32/Lsb/lua/Vabr.txt","")
		log.info("Str ====> %s", str)
        if (string.find(str, Vabr)) then
            sedmsg(CurrentQQ,data,"å½“å‰ç‰ˆæœ¬ä¸ºæœ€æ–°ç‰ˆ")
        else
            sedmsg(CurrentQQ,data,"å‘ç°æ–°ç‰ˆæœ¬!\nå½“å‰ç‰ˆæœ¬:"..Vabr.."\næ–°ç‰ˆæœ¬å·:"..str.."\nèµ¶å¿«å‘é€[æ›´æ–°æ’ä»¶]å§")
        end
	elseif (data.Content == "æ›´æ–°æ’ä»¶") then
	    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim == nil) then
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
        str = geturl("GET","http://118.25.41.32/Lsb/lua/Vabr.txt","")
		log.info("Str ====> %s", str)
        if (string.find(str, Vabr)) then
            sedmsg(CurrentQQ,data,"å½“å‰ç‰ˆæœ¬ä¸ºæœ€æ–°ç‰ˆ")
        else
            str = geturl("GET","http://118.25.41.32/Lsb/lua/mimoio.txt","")
            Wirte("Plugins\/mimoio.lua",str)
            sedmsg(CurrentQQ,data,"æ›´æ–°å®Œæ¯•ï¼")
        end
	end
	--å›¾ç‰‡ç±»å‹æ¶ˆæ¯å¤„ç†
    if (data.MsgType == "PicMsg") then
	    msg = Read("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt")
		jData = json.decode(data.Content)
	    if (msg ~= nil and jData.tips ~= "[ç¾¤æ¶ˆæ¯-QQé—ªç…§]") then
            if (string.find(str, "å¼€å¯")) then
	            sedmsg(CurrentQQ,data,"å›¾ç‰‡é“¾æ¥è§£æå¦‚ä¸‹â†“â†“\n"..jData.url)
				return 1
	        end
	    end
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt")
	    if (str == nil) then
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    --é—ªç…§ã€å›¾ç‰‡å¤„ç†æ¨¡å—
		PicFlag(CurrentQQ, data)
    end
	--æŠ¢çº¢åŒ…å¤„ç†
	if (string.find(data.MsgType, "RedBagMsg") == 1) then
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt")
		if (str == nil) then
	        log.info("Str ====> %s", str)
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    RedBag(CurrentQQ, data)
	end
	--è§†é¢‘è§£æå¤„ç†
	if (string.find(data.MsgType, "VideoMsg") == 1) then
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt")
		if (str == nil) then
	        log.info("Str ====> %s", str)
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    Video(CurrentQQ, data)
	end
	--até—ªå›¾
	if (data.MsgType == "AtMsg") and (string.find(data.Content, "é—ªä»–")) then
	    shantu(CurrentQQ, data)
    end
	--è°ƒæ•™æœç´¢å¼•æ“
	mim = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..data.Content..".txt")
	if (mim == nil) then
	    --äººç±»çš„æœ¬è´¨æ˜¯å¤è¯»æœº
	    msg = Read("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt")
		if (msg ~= nil) then
		    cs = Read("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt")
			ii = tonumber(cs)
			if (string.find(msg, "^"..data.Content.."$")) then
			    if (ii > 2) then
			         math.randomseed(os.time())
                     sj = math.random(1, 5)
		             if (sj == 1 or sj == 2) then
			             sedmsg(CurrentQQ,data,msg)
					     rr = ii + 1
		                 Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
				     elseif (sj == 3) then
				         os.remove("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt")
					     os.remove("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt")
					     fdArray = {"çªç„¶æˆªæ–­å¤è¯»(ï¾ŸâŠ¿ï¾Ÿ)ï¾‚","å¤è¯»å¯è€»(â€¢Ì€ã¸ â€¢Ì â•® )","ä¸è¦å¤è¯»äº†å•¦","è¿™å°±æ˜¯æ‰€è°“çš„äººç±»çš„æœ¬è´¨","ä½ ä»¬å’‹ä¸ä¸Šå¤©å‘","åˆå¤è¯»ä¸Šç˜¾äº†å•Š"}
                         math.randomseed(os.time())
                         fdsj = math.random(1, 6)
				         sedmsg(CurrentQQ,data,fdArray[fdsj])
				     else
			             rr = ii + 1
		                 Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
		             end
			    else
			        rr = ii + 1
		            Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
			    end
			else
			    if (ii > 2) then
			        math.randomseed(os.time())
                    sj2 = math.random(1, 3)
					if (sj2 == 2) then
					    fdArray2 = {"ä¸­æ–­å¤è¯»å¯è€»","æ‰“æ–­å¤è¯»å¯è€»(â€¢Ì€ã¸ â€¢Ì â•® )","ä½ ä¸ºä»€ä¹ˆè¦æ‰“æ–­å¤è¯»å•Š","å¤è¯»ä¸é¦™å˜›","ç ´åæ°›å›´(à¸‡áµ’ÌŒçš¿áµ’ÌŒ)à¸‡â¼Â³â‚Œâ‚ƒ"}
                        math.randomseed(os.time())
                        fdsj2 = math.random(1, 5)
				        sedmsg(CurrentQQ,data,fdArray2[fdsj2])
					end
				end
				Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt","1")
			    Wirte("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt",data.Content)
			end
		else
		    Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt","1")
			Wirte("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt",data.Content)
		end
	    --å¦‚æœè°ƒæ•™æŒ‡ä»¤ä¸å­˜åœ¨ï¼Œåˆ™è¿›è¡Œå…¶ä»–æ“ä½œ
	    msgsql(CurrentQQ,data)--æ•°æ®å‚¨è“„
		--éšæœºå›å¤æ¶ˆæ¯æ¦‚ç‡0.04
	    math.randomseed(os.time())
        num = math.random(1, 40)
		if (num == 12) then
		    j = xiaosiapi(CurrentQQ,data,data.Content)
			sedmsg(CurrentQQ,data,j.data.info.text)
		end
	else
	    --è§¦å‘è°ƒæ•™æŒ‡ä»¤
		funic(CurrentQQ,data,mim)
	end
    return 1
end

function ReceiveEvents(CurrentQQ, data, extData)
  if data.MsgType == "ON_EVENT_GROUP_REVOKE" then --ç›‘å¬ ç¾¤æ’¤å›äº‹ä»¶
    --æ’¤å›äº‹ä»¶å¤„ç†
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..extData.GroupID..".txt")
    if (str == nil) then
	    log.info("Str ====> %s", str)
        return 1
	end
	if (string.find(str, "å…³é—­")) then
		return 1
	end
	CheHui(CurrentQQ, data, extData)
	--xxxxxxxxxxxxxxx
    return 1
  end
end
  --è¿›ç¾¤ç§€å›¾æ¬¢è¿


--é—ªç…§æ£€æµ‹å¤„ç†


--åŠŸèƒ½ç»„
function funic(CurrentQQ,data,msg)
    if string.find(msg, "^ç‚¹æ­Œ") then
	    data.Content = msg
        music(CurrentQQ,data,msg)
		return 1
	elseif string.find(msg, "^è¯­éŸ³") then
	    keyWord = msg:gsub("è¯­éŸ³", "")
        sedvoicemsg(CurrentQQ,data,keyWord)
		return 1
	elseif string.find(msg, "^å›¾ç‰‡") then
	    keyWord = msg:gsub("å›¾ç‰‡", "")
        sedimgmsg(CurrentQQ,data,keyWord,"")
		return 1
    elseif string.find(msg, "^å”±æ­Œ") then
        keyWord = msg:gsub("å”±æ­Œ", "")
		if (keyWord == "") then
		    sedmsg(CurrentQQ,data,"æ­Œåä¸èƒ½ç©ºç€å“¦")
		    return 1
		end
		sedmsg(CurrentQQ,data,"å¦¾èº«æ­£åœ¨åŠªåŠ›åŠ è½½Ù©(ËƒÌ¶Ì€Íˆà¯°Ë‚Ì¶ÌÍˆ)Ùˆ")
        response, error_message =
            http.request(
            "POST",
            "http://127.0.0.1:8888/SilkApi/UrlToBuf",--ä¿®æ”¹æ­¤å¤„ipåŠç«¯å£å³å¯
            {
                body = keyWord --ä¼ å…¥æ­Œæ›²å
            }
        )
        log.notice("err   %v", error_message)
        html = response.body --è¿”å›silk base64 buf
		if (string.find(html, "Î´")) then
				    sedmsg(CurrentQQ,data,"å¤©ä¾æ²¡æœ‰æ‰¾åˆ°ç›¸å…³çš„æ­Œå‘€(Ã’Ï‰Ã“×±)ï¼")
					c.close(c)
				    return 2
				end
        luaRes =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "VoiceMsg",
                groupid = 0,
                content = "",
                atUser = 0,
                voiceUrl = "",
                voiceBase64Buf = html 
            }
        )
		return 1
	end
    sedmsg(CurrentQQ,data,msg)
end

--å½±è§†æœç´¢ç”¨
function Sousuo(CurrentQQ,data,msg)
    response, error_message =
        http.request(
            "GET",
            "http://localhost/index.php/ajax/suggest",
            {
                query = "mid=1&f=admin&wd="..msg.."&limit=10&timestamp=1567914326746"
            }
        )
    html = response.body
	json = json.decode(html)
	if (json.total == 0) then
	    sedmsg(CurrentQQ,data,"å½±è§†æŸ¥è¯¢é”™è¯¯\nè¯·æ£€æŸ¥å½±è§†åæ˜¯å¦æ­£ç¡®\nâ•â•â•â•â•â•â•â•â•â•â•\næ³¨æ„âš ï¸å½±è§†åä¸è¦å¸¦æ— å…³æˆ–å¤šä½™çš„å­—ç¬¦")
	else
        sedmsg(CurrentQQ,data,"èµ„æºåœ°å€å¦‚ä¸‹â†“â†“â†“\nâ•â•â•â•â•â•â•â•â•â•\nhttp://118.25.41.32/index.php/vod/search/wd/"..escape(msg)..".html\nâ•â•â•â•â•â•â•â•â•â•â•\næ³¨æ„:å¦‚æœQQå‡ºç°åœæ­¢è®¿é—®ç°è±¡ï¼Œè¯·å¤åˆ¶é“¾æ¥ç”¨æµè§ˆå™¨æ‰“å¼€")
	end
end

--å•çº¯å‘æ¶ˆæ¯å›¾æ–‡é€šç”¨
function sedimgmsg(CurrentQQ,data,url,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "PicMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = url,
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘æ¶ˆæ¯ç”¨
function sedmsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "TextMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘ç§èŠæ¶ˆæ¯ç”¨
function sendfrimsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromUin,
        sendToType = 1,
        sendMsgType = "TextMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘jsonæ¶ˆæ¯ç”¨
function sedjsonmsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "JsonMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--èŠå¤©æ¨¡å—åˆ‡æ¢å‡½æ•°
function liaotian(CurrentQQ,data,msg)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
    if (mim == nil) then
        sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
        return 1
    end
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
	if (str == nil) then
        return 1
    end
	if (string.find(str, "å…³é—­")) then
	    sedmsg(CurrentQQ,data,"æœºå™¨èŠå¤©å¤„äºå…³é—­çŠ¶æ€\nâˆ´è¯·å…ˆå¼€å¯æœºå™¨èŠå¤©")
	    return 1
	end
	--åˆ‡æ¢å¤„ç†
	file = io.open("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt", "w")
	if (msg == 1) then
	    file:write("æ–‡å­—èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°æ–‡å­—èŠå¤©")
	elseif (msg == 2) then
	    file:write("è¯­éŸ³èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°è¯­éŸ³èŠå¤©")
	elseif (msg == 3) then
	    file:write("å›å¤èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°å›å¤èŠå¤©")
	end
	file:close()
end

--éšæœºè¡¨æƒ…å‡½æ•°
function faceArray()
    faceArray = {"[è¡¨æƒ…147]","ğŸ€","ğŸ”¥","ğŸ»","ğŸ’","[è¡¨æƒ…185]","[è¡¨æƒ…219]","[è¡¨æƒ…176]"}
    math.randomseed(os.time())
    num = math.random(1, 9)
    return faceArray[num]
end

--urlç¼–ç è½¬æ¢
function escape(w)
	pattern="[^%w%d%._%-%* ]"
	s=string.gsub(w,pattern,function(c)
		local c=string.format("%%%02X",string.byte(c))
		return c
	end)
	s=string.gsub(s," ","+")
	return s
end

--è¯»å–æ•°æ®å‡½æ•°
function Read(url)
    file = io.open(url, "r")
	if (file == nil) then
	    return nil
	else
        file:seek("set")
	    str = file:read("*a")
	    file:close()
        return str
	end
end

--å†™å…¥æ•°æ®å‡½æ•°
function Wirte(url,msg)
    file = io.open(url, "w+")
    file:write(msg)
	file:close()
    return "ok"
end

--å°æ€èŠå¤©å‡½æ•°
function xiaosiapi(CurrentQQ,data,str)
    response, error_message =
            http.request(
            "GET",
            "https://api.ownthink.com/bot",
            {
                query = "appid="..tostring(data.FromUserId).."&spoken=" .. url_encode(str),
                headers = {
                    Accept = "*/*"
                }
            }
        )
        html = response.body
		jData = json.decode(html)
		return jData
end

--æœºå™¨èŠå¤©å‡½æ•°
function ownthink(CurrentQQ,data,msgs,atqq)
    if (tostring(atqq) == CurrentQQ) then
        m = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
        if (m == nil) then
	        log.info("Str ====> %s", m)
            return 1
	    end
	    if (string.find(m, "å…³é—­")) then
	        sedmsg(CurrentQQ,data,"æœºå™¨èŠå¤©å¤„äºå…³é—­çŠ¶æ€\nâˆ´è¯·å…ˆå¼€å¯æœºå™¨èŠå¤©")
	        return 1
	    end
		res2 = string.find(msgs, " ")
		str = string.sub(msgs,res2)
		jData = xiaosiapi(CurrentQQ,data,str)
		Data = json.decode(data.Content)
		m = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
		if (m == nil) then
	        log.info("Str ====> %s", m)
            return 1
	    end
		if (string.find(m, "å›å¤èŠå¤©")) then
		    Api.Api_SendMsg(
                CurrentQQ,
                {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "ReplayMsg",
                groupid = 0,
                content = jData.data.info.text,
                atUser = 0,
				replayInfo = {
                    MsgSeq = data.MsgSeq,
                    --å›å¤æ¶ˆæ¯çš„Seq
                    MsgTime = data.MsgTime,
                    --å›å¤æ¶ˆæ¯çš„äº‹ä»¶
                    UserID = data.FromUserId,
                    --å›å¤æ¶ˆæ¯å¯¹è±¡
                    RawContent = Data.Content --å›å¤æ¶ˆæ¯çš„åŸå†…å®¹
                }
				}
            )
			return 1
		elseif (string.find(m, "æ–‡å­—èŠå¤©")) then
		    sedmsg(CurrentQQ,data,jData.data.info.text)
		else
		    sedvoicemsg(CurrentQQ,data,url_encode(jData.data.info.text))
		end
    end
end

--å‘é€è¯­éŸ³æ¶ˆæ¯
function sedvoicemsg(CurrentQQ,data,str)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "VoiceMsg",
        groupid = 0,
		voiceUrl = "https://dds.dui.ai/runtime/v1/synthesize?voiceId=qianranfa&speed=0.7&volume=100&audioType=wav&text="..str, --å‘é€è¯­éŸ³çš„ç½‘ç»œåœ°å€ æ–‡æœ¬å‹
        voiceBase64Buf = "",
        content = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å¤©æ°”æŸ¥è¯¢å‡½æ•°
--[[function tianqi(CurrentQQ,data)
    keyWord = data.Content:gsub("å¤©æ°”", "")
        if keyWord == "" then
            return 1
        end

        cookies = Api.Api_GetUserCook(CurrentQQ)

        response, error_message =
            http.request(
            "GET",
            "https://weather.mp.qq.com/cgi-bin/rich",
            {
                query = "g_tk=" .. cookies.Gtk .. "&city=" .. url_encode(keyWord),
                headers = {
                    Referer = "http://weather.mp.qq.com/ark"
                },
                cookies = {
                    uin = CurrentQQ,
                    skey = cookies.Skey
                }
            }
        )
        local html = response.body
        log.notice("From Lua html -->%s", html)

        local j = json.decode(html)
        if j.code ~= 0 then
            return 1
        end

        ApiRet =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "JsonMsg",
                groupid = 0,
                content = string.format(
                    --{"config":{"forward":1,"autosize":1},"prompt":"[åº”ç”¨]å¤©æ°”","app":"com.tencent.weather","ver":"0.0.0.1","view":"RichInfoView","meta":{"richinfo":{"adcode":"101210701","city":"æˆéƒ½","air":"58","min":"20","ts":"1500550866","wind":"1","date":"6æœˆ27æ—¥ å‘¨å››","max":"28","type":"201"}},"desc":"å¤©æ°”"}
                    --[[{"app":"com.tencent.weather","desc":"","meta":{"weather":{"ad":[{"icon":"http://imgcache.qq.com/ac/tq/xz2/tp.jpg","p":"ptype=star","t":"2","title":"æ˜Ÿåº§ | ä»Šå¤©ä¼šå› ä¸ºæ„Ÿæƒ…å’Œå®¶åº­çš„é—®é¢˜ï¼Œå½±å“å·¥ä½œï¼Œè¿˜æœ‰ï¼Œä¹Ÿè¦æ³¨æ„äºº...","url":""},{"icon":"http://imgcache.qq.com/ac/qqweather/image/2019/6/27.png","p":"ptype=lunar","t":"4","title":"é»„å† | å†œå†äº”æœˆå»¿äº”ã€‚å®œè®¢ç›Ÿ.çº³é‡‡.å‡ºè¡Œ.ç¥ˆç¦.æ–‹é†®.å®‰åºŠ.ä¼š...","url":""}],"info":{"it1":{"adcode":"101050101","city":"æ­¦æ±‰","hour":"18","max":"29","min":"17","temp":"24","type":"202","ut":"1561630401","wea":"å¤šäº‘"},"it2":{"hour":"19","temp":"22","type":"202"},"it3":{"hour":"20","temp":"21","type":"202"},"ts":"1561631244"},"url":""}},"prompt":"ã€å“ˆå°”æ»¨ã€‘å¤šäº‘ 17Â°/29Â°, 18:13æ›´æ–°~","ver":"1.0.0.106","view":"WeatherThreeView"}]]
--[[                    [[{"app":"com.tencent.weather","desc":"å¤©æ°”","view":"RichInfoView","ver":"1.0.0.217","prompt":"[åº”ç”¨]å¤©æ°”","meta":{"richinfo":{"adcode":"%s","air":"%s","city":"%s","date":"%s","max":"%s","min":"%s","ts":"1554951408","type":"%s","wind":"%s"}},"config":{"forward":1,"autosize":1,"type":"card"}}]],
--[[                    j.data.adcode,
                    j.data.air,
                    j.data.city,
                    j.data.date,
                    j.data.max,
                    j.data.min,
                    j.data.type,
                    j.data.wind
                ),
                atUser = 0
            }
        )
end
--]]
--è°ƒæ•™å¤„ç†å‡½æ•°(å¾…å¤„ç†)
function tiaojiao(CurrentQQ,data)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
	if (mim == nil) then
		sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå“‡")
		return 1
	end
	if (string.find(data.Content, "^åˆ é™¤è°ƒæ•™")) then
	    msg = data.Content:gsub("åˆ é™¤è°ƒæ•™", "")
	    if (msg == "") then
		    sedmsg(CurrentQQ,data,"è¦åˆ é™¤çš„è°ƒæ•™æŒ‡ä»¤ä¸èƒ½ä¸ºç©ºå“¦")
		    return 1
		end
		rese = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..tostring(data.FromGroupId).."\/"..msg..".txt")
	    if (rese == nil) then
			sedmsg(CurrentQQ,data,"è¿™ä¸ªæŒ‡ä»¤ä¸å­˜åœ¨äº†å“¦")
		    return 1
		end
		rm_file = os.remove("mimoio\/æœºå™¨è°ƒæ•™\/"..tostring(data.FromGroupId).."\/"..msg..".txt")
		log.info("åˆ é™¤è°ƒæ•™ ====> %s", rm_file)
		sedmsg(CurrentQQ,data,"åˆ é™¤æˆåŠŸ\nä½ ä¸å–œæ¬¢è¢«è¿™æ ·è°ƒæ•™çš„æˆ‘å—[è¡¨æƒ…9]")
		return 1
	end
    msgs = data.Content:gsub("è°ƒæ•™", "")
		res2 = string.find(msgs, "#")
		str = string.sub(msgs,res2+1)
		str2 = string.sub(msgs,1,res2-1)
		        
		        if (str == "") then
		            sedmsg(CurrentQQ,data,"è°ƒæ•™çš„å›ç­”å†…å®¹ä¸èƒ½ä¸ºç©ºå“¦")
			        return 1
		        end
				if (str2 == "") then
		            sedmsg(CurrentQQ,data,"è°ƒæ•™çš„æŒ‡ä»¤å†…å®¹ä¸èƒ½ä¸ºç©ºå“¦")
			        return 1
		        end
		        rese = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..str2..".txt")
					if (rese ~= nil) then
				        sedmsg(CurrentQQ,data,"æŒ‡ä»¤å·²ç»å­˜åœ¨äº†å“¦")
				        return 1
				    end
				Wirte("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..str2..".txt",str)
				sedmsg(CurrentQQ,data,"è°ƒæ•™æˆåŠŸ\nä½ è¿˜æƒ³å†è°ƒæ•™æˆ‘ä¸€æ¬¡å—[è¡¨æƒ…6]")
		        return 1
end

function url_encode(str)
    if (str) then
        str = string.gsub(str, "\n", "\r\n")
        str =
            string.gsub(
            str,
            "([^%w ])",
            function(c)
                return string.format("%%%02X", string.byte(c))
            end
        )
        str = string.gsub(str, " ", "+")
    end
    return str
end

--æŠ¢çº¢åŒ…å¤„ç†
function RedBag(CurrentQQ, data)
    Api.Api_OpenRedBag(CurrentQQ, data.RedBaginfo)
    if (data.RedBaginfo.RedType == 12) then
         luaRes =
                Api.Api_SendMsg(
                CurrentQQ,
                {
                    toUser = data.FromGroupId,
                    sendToType = 2,
                    sendMsgType = "TextMsg",
                    groupid = 0,
                    content = data.RedBaginfo.Tittle,
                    atUser = 0
                }
            )
        log.notice("From Lua SendMsg Ret\n%d", luaRes.Ret)
    end
end

--è§†é¢‘è§£æå¤„ç†
function Video(CurrentQQ, data)
    vdata = json.decode(data.Content)
        videodata = {
            GroupID = data.FromGroupId,
            VideoUrl = vdata.VideoUrl,
            VideoMd5 = vdata.VideoMd5
        }
        --æ„é€ table å‚æ•°è¡¨
        luaResp = Api.Api_CallFunc(CurrentQQ, "PttCenterSvr.ShortVideoDownReq", videodata) --é€šè¿‡cmdè°ƒç”¨åŠŸèƒ½åŒ…
        luaRes =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "TextMsg",
                groupid = 0,
                content = "è§£æè§†é¢‘URL-->" .. luaResp.VideoUrl,
                atUser = 0
            }
        )
end

--ç®¡ç†å¼€å…³é€šç”¨
function adminio(CurrentQQ,data,oio)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim ~= nil) then
            msg = data.Content:gsub(oio, "")
            str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
            if (string.find(str, "å…³é—­")) then
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äººå·²è¢«å…³é—­...\nè¯·å…ˆå¼€å¯æœºå™¨äºº")
                return 1
            end
			str2 = Read("mimoio\/çŠ¶æ€æ•°æ®\/"..oio.."\/"..data.FromGroupId..".txt")
			if (string.find(str2, msg)) then
			    sedmsg(CurrentQQ,data,"âˆ´"..oio.."æœ¬å°±æ˜¯"..str2.."çŠ¶æ€")
                return 1
			end
            Wirte("mimoio\/çŠ¶æ€æ•°æ®\/"..oio.."\/"..data.FromGroupId..".txt",msg)
            sedmsg(CurrentQQ,data,"âˆ´"..oio..msg.."æˆåŠŸ")
            return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
end

--ç™¾ç§‘å¤§å…¨
function baike(CurrentQQ,data)
    keyWord = data.Content:gsub("ç™¾ç§‘", "")
        if keyWord == "" then
            return 1
        end
        response, error_message =
            http.request(
            "GET",
            "http://baike.baidu.com/api/openapi/BaikeLemmaCardApi",
            {
                query = "scope=103&format=json&appid=379020&bk_key=" .. url_encode(keyWord) .. "&bk_length=600"
            }
        )
        html = response.body
        while(string.find(html, '"errno":2')) do
            response, error_message =
            http.request(
            "GET",
            "http://baike.baidu.com/api/openapi/BaikeLemmaCardApi",
            {
                query = "scope=103&format=json&appid=379020&bk_key=" .. url_encode(keyWord) .. "&bk_length=600"
            })
			html = response.body
        end
        local j = json.decode(html)
        sedmsg(CurrentQQ,data,j.abstract.."\n"..j.url)
end

--éŸ³ä¹ç‚¹æ­Œ
function music(CurrentQQ,data)
    keyWord = data.Content:gsub("ç‚¹æ­Œ", "")
        if keyWord == "" then
            return 1
        end
        response, error_message =
            http.request(
            "GET",
            "https://c.y.qq.com/soso/fcgi-bin/client_search_cp",
            {
                query = "aggr=1&cr=1&flag_qc=0&p=1&n=6&w=" .. url_encode(keyWord)
            }
        )
        html = response.body
		str = string.sub(html,10,-2)
        j = json.decode(str)
        if (j.code == 0) then
            msg = ""
            num = j.data.song.list
            list = num[1]
            songname = list.songname
            singername = list.singer[1].name
            payplay = list.pay.payplay
			albummid = list.albummid
			songmid = list.songmid
	        sedjsonmsg(CurrentQQ,data,'{"app":"com.tencent.structmsg","desc":"éŸ³ä¹","view":"music","ver":"0.0.0.1","prompt":"[åˆ†äº«]' ..songname.. '","meta":{"music":{"sourceMsgId":"0","title":"' ..songname.. '","desc":"' ..singername.. '","preview":"y.gtimg.cn/music/photo_new/T002R150x150M000'..albummid..'.jpg","tag":"QQéŸ³ä¹","musicUrl":"https://v1.itooi.cn/tencent/url?id='..songmid..'","jumpUrl":"y.qq.com/n/yqq/song/'..songmid..'.html","appid":100497308,"app_type":1,"action":"","source_url":"url.cn/5aSZ8Gc","source_icon":"url.cn/5tLgzTm","android_pkg_name":"com.tencent.qqmusic"}},"config":{"forward":true,"type":"normal","autosize":true}}')
			return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´Error:"..j.code)
			return 1
        end
end

--è®¿é—®url
function geturl(url_class,url,caulrt)
        response, error_message =
            http.request(
            url_class,
            url,
            {
                query = caulrt
            }
        )
        html = response.body
		return html
end

--æ¶ˆæ¯å‚¨è“„
function msgsql(CurrentQQ,data)
    if (mysqlpass == "") then
	    return 1
	end
    c = mysql.new()
    -- åˆå§‹åŒ–mysqlå¯¹è±¡
    ok, err = c:connect({host = mysqlhost, port = 3306, database = mysqldb, user = mysqluser, password = mysqlpass})
    --å»ºç«‹è¿æ¥
    if ok then
        sqlstr =
            string.format(
            [[INSERT INTO msgcache (GroupID, MsgSeq, MsgRandom,MsgType,Data,MsgTime)VALUES (%d,%d,%d,'%s','%s',%d)]],
            data.FromGroupId,
            data.MsgSeq,
            data.MsgRandom,
            data.MsgType,
            data.Content,
            data.MsgTime
        )
        res, err = c:query(sqlstr) --å…¥åº“ç¼“å­˜æ¶ˆæ¯
        log.info("%s", err)
        c.close(c)
    --é‡Šæ”¾è¿æ¥
    end
    return 1
end

--æ’¤å›æ£€æµ‹
function CheHui(CurrentQQ, data, extData)
    c = mysql.new()
    -- åˆå§‹åŒ–mysqlå¯¹è±¡
	if (mysqlpass == "") then
	    return 1
	end
	
    if data.MsgType == "ON_EVENT_GROUP_REVOKE" then --ç›‘å¬ ç¾¤æ’¤å›äº‹ä»¶
        str = string.format("ç¾¤æˆ %d  æˆå‘˜ UserID %s æ’¤å›äº†æ¶ˆæ¯Seq %s \n", extData.GroupID, extData.UserID, extData.MsgSeq)
        log.info("%s", str)
        ok, err = c:connect({host = mysqlhost, port = 3306, database = mysqldb, user = mysqluser, password = mysqlpass})
        --å»ºç«‹è¿æ¥
        log.info("sql %v", err)
        if ok then
            sqlstr =
                string.format(
                "select * from msgcache where `GroupID`= %d and `MsgSeq` = %d",
                extData.GroupID,
                extData.MsgSeq
            )
            res, err = c:query(sqlstr) --è·Ÿç¾¤ç¾¤idå’Œæ¶ˆæ¯SEQæŸ¥è¯¢å‡ºæ’¤å›çš„æ¶ˆæ¯å†…å®¹
            if err == nil then
                c.close(c)
                GroupID = tonumber(res[1]["GroupID"])
                MsgType = res[1]["MsgType"]
                Data = res[1]["Data"]

                if MsgType == "TextMsg" then
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            --å‘é€æ–‡æœ¬æ¶ˆæ¯
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡æ–‡æœ¬æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                Data
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "SmallFaceMsg" then
                    --Data {"Content":"[è¡¨æƒ…101]","Hex":"FKY=","Index":101,"tips":"[å°è¡¨æƒ…]"}
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡è¡¨æƒ…æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).Content
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "PicMsg" then
                    --Data {"Content":"","FileId":2820717626,"FileMd5":"q0oEC5aloJJMFr10mplaXw==","FileSize":7026,"tips":"[ç¾¤å›¾ç‰‡]","url":"http://gchat.qpic.cn/gchatpic_new/1700487478/960839480-2534335053-AB4A040B96A5A0924C16BD749A995A5F/0?vuin=u0026term=255u0026pictype=0"}
                    jData = json.decode(Data)
					if (jData.tips == "[ç¾¤æ¶ˆæ¯-QQé—ªç…§]") then
					    
					Api.Api_SendMsg( 
                    CurrentQQ,
                    {
                        toUser = GroupID,
                        sendToType = 2,
                        sendMsgType = "ForwordMsg",
                        content = "",
                        atUser = 0,
                        groupid = 0,
                        voiceUrl = "",
                        voiceBase64Buf = "",
                        picUrl = "",
                        picBase64Buf = "",
                        forwordBuf = json.decode(Data).ForwordBuf, --æ¬²è½¬å‘çš„base64buf å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                        forwordField = json.decode(Data).ForwordField --æ¬²å†™å…¥åè®®çš„å­—æ®µID å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                    }
                )
				    return 1
					end
                    Api.Api_SendMsg( --é€šè¿‡å›¾ç‰‡md5å‘é€å›¾ç‰‡ ç§’å‘ä¸ç”¨ä¸Šä¼  ç›¸å½“äºè½¬å‘
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "PicMsg",
                            --å‘é€å›¾æ–‡æ¶ˆæ¯
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡å›¾ç‰‡æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š[PICFLAG]%s",
                                extData.UserID,
                                jData.Content
                            ),
                            --é€šè¿‡å®[PICFLAG]æ”¹å˜å›¾æ–‡é¡ºåº  æ”¹ä¸ºç°æ–‡å­—åå›¾ç‰‡
                            atUser = 0,
                            voiceUrl = "",
                            voiceBase64Buf = "",
                            picUrl = "",
                            picBase64Buf = "",
                            fileMd5 = jData.FileMd5
                        }
                    )
                end
                if MsgType == "AtMsg" then
                    --Data {"Content":"@Kar98k skjjkssjkjs","UserID":123456789,"tips":"[ATæ¶ˆæ¯]"}
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡atæ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).Content
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "VoiceMsg" then
                    --Data {"tips":"[è¯­éŸ³]","url":"http://grouptalk.c2c.qq.com/?ver=0u0026rkey=3062020101045b305902010102010102041fdef8ae042439416931554e5142586c536d78706a314c686843664959725f327a5f573064697653755902045dac2a21041f0000000866696c6574797065000000013100000005636f64656300000001310400u0026filetype=1u0026voice_codec=1"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "VoiceMsg",
                            --å‘é€ç¾¤è¯­éŸ³æ¶ˆæ¯
                            groupid = 0,
                            content = "",
                            atUser = 0,
                            voiceUrl = json.decode(Data).url,
                            --é€šè¿‡ç½‘ç»œurlè¿›è¡Œå‘é€è¯­éŸ³
                            voiceBase64Buf = "",
                            picUrl = "",
                            picBase64Buf = ""
                        }
                    )
                end

                if MsgType == "ReplayMsg" then
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡å›å¤æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).ReplayContent
                            ),
                            atUser = 0
                        }
                    )
                end
				if MsgType == "VideoMsg" then
	             Api.Api_SendMsg( 
                    CurrentQQ,
                    {
                        toUser = GroupID,
                        sendToType = 2,
                        sendMsgType = "ForwordMsg",
                        content = "",
                        atUser = 0,
                        groupid = 0,
                        voiceUrl = "",
                        voiceBase64Buf = "",
                        picUrl = "",
                        picBase64Buf = "",
                        forwordBuf = json.decode(Data).ForwordBuf, --æ¬²è½¬å‘çš„base64buf å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                        forwordField = json.decode(Data).ForwordField --æ¬²å†™å…¥åè®®çš„å­—æ®µID å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                    }
                )
				end
                if MsgType == "XmlMsg" then
				    
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "XmlMsg",
                            groupid = 0,
                            content = string.format("%s", Data),
                            atUser = 0
                        }
                    )
                end
				if MsgType == "JsonMsg" then
				    
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "JsonMsg",
                            groupid = 0,
                            content = string.format("%s", Data),
                            atUser = 0
                        }
                    )
                end
            end
        end
    end
    return 1
end
2020/09/07 12:54:36.181 [E]  mimoio.lua
2020/09/07 12:54:36.182 [E]  local log = require("log")
local Api = require("coreApi")
local json = require("json")
local http = require("http")
local mysql = require("mysql")

--ç‰ˆæœ¬å·(ä¸è¦æ”¹åŠ¨)
Vabr = "1.0.2"
--æ•°æ®åº“é…ç½®
mysqlhost = "localhost"--é»˜è®¤ä¸åŠ¨
mysqldb = "ffaxx001"--æ•°æ®åº“å
mysqluser = "ffaxx001"--æ•°æ®åº“ç”¨æˆ·å
mysqlpass = "123456"--æ•°æ®åº“å¯†ç 
--ä¸ä½¿ç”¨è¯·ä¸è¦æ”¹åŠ¨

function ReceiveFriendMsg(CurrentQQ, data)
    if (data.Content == "ä½¿ç”¨æ–¹æ³•") then
	    sendfrimsg(CurrentQQ,data,"æ·»åŠ æˆæƒè€…çš„æ–¹æ³•\nå¯¹å•ä¸ªæœºå™¨äººç§èŠå‘é€[æ·»åŠ æˆæƒè€…+æˆæƒè€…QQ]\n\næˆæƒç¾¤çš„æ–¹æ³•\nåˆ°éœ€è¦æˆæƒçš„ç¾¤é‡Œå‘é€[æˆæƒ+ä¸»äººQQ]ã€‚æ³¨æ„:æˆæƒå¿…é¡»æ˜¯æˆæƒè€…è¿›è¡Œæ“ä½œ,ç®¡ç†å‘˜æˆæƒä¸äº†")
	end
    --æ•°æ®åˆå§‹åŒ–
    if (data.Content == "åˆå§‹åŒ–") then
	    root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root ~= nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´è¯·ä¸è¦é‡å¤åˆå§‹åŒ–")
			return 1
		end
    --os.execute('mkdir mimoio/æœºå™¨æˆæƒ')
	    os.execute('mkdir mimoio')
		os.execute('mkdir mimoio/å¤è¯»æœº')
		os.execute('mkdir mimoio/å¤è¯»æœº/æ¬¡æ•°')
		os.execute('mkdir mimoio/å¤è¯»æœº/å†…å®¹')
		os.execute('mkdir mimoio/æœºå™¨æˆæƒ')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨ä¸»äºº')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨èŠå¤©')
		os.execute('mkdir mimoio/æœºå™¨è°ƒæ•™')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æŠ¢çº¢åŒ…')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æœºå™¨èŠå¤©')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æœºå™¨å¼€å…³')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æ’¤å›æ£€æµ‹')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/å›¾ç‰‡è§£æ')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/è§†é¢‘è§£æ')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/é—ªç…§æ£€æµ‹')
		Wirte("mimoio\/"..data.FromUin..".txt","999")
		sendfrimsg(CurrentQQ,data,"åˆå§‹åŒ–å®Œæ¯•ï¼\nå‘é€[ä½¿ç”¨æ–¹æ³•]äº†è§£ä½¿ç”¨å§")
	end
	--æ·»åŠ æˆæƒè€…æ“ä½œ(ç§èŠæœºå™¨äººå‘é€)
	if (string.find(data.Content, "^æ·»åŠ æˆæƒè€…")) then
	    msg = data.Content:gsub("æ·»åŠ æˆæƒè€…", "")
		--Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromUin..".txt","å…³é—­")
		root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root == nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„ç®¡ç†è€…")
			return 1
		end
		Wirte("mimoio\/æœºå™¨æˆæƒ\/"..msg..CurrentQQ..".txt","999")
		sendfrimsg(CurrentQQ,data,"âˆ´æ·»åŠ æˆæƒè€…æˆåŠŸ")
	end
	--åˆ é™¤æˆæƒè€…æ“ä½œ(ç§èŠæœºå™¨äººå‘é€)
	if (string.find(data.Content, "^åˆ é™¤æˆæƒè€…")) then
	    msg = data.Content:gsub("åˆ é™¤æˆæƒè€…", "")
		--Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromUin..".txt","å…³é—­")
		root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root == nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„ç®¡ç†è€…")
			return 1
		end
		os.remove("mimoio\/æœºå™¨æˆæƒ\/"..msg..CurrentQQ..".txt")
		sendfrimsg(CurrentQQ,data,"âˆ´åˆ é™¤æˆæƒè€…æˆåŠŸ")
	end
    return 1
end
function ReceiveGroupMsg(CurrentQQ, data)
    if (tostring(data.FromUserId) == CurrentQQ) then
	    return 1
	end
	--ç¾¤èŠæˆæƒ(åˆ°éœ€è¦æˆæƒçš„ç¾¤é‡Œæ“ä½œ)
	if (string.find(data.Content, "^æˆæƒ")) then
	    root = Read("mimoio\/æœºå™¨æˆæƒ\/"..data.FromUserId..CurrentQQ..".txt","999")
		if (root == nil) then
		    sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„æˆæƒè€…")
			return 1
		end
		msg = data.Content:gsub("æˆæƒ", "")
		os.execute('mkdir mimoio/æœºå™¨è°ƒæ•™/'..data.FromGroupId)
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨ä¸»äºº/'..data.FromGroupId)
		Wirte("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..msg..".txt","999")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt","å›å¤èŠå¤©")
		sedmsg(CurrentQQ,data,"âˆ´æˆæƒæˆåŠŸï¼\nå‘é€[å¼€å¯æœºå™¨äºº]ä½¿ç”¨å§")
	end
	--åˆ é™¤æˆæƒæ“ä½œ(åˆ°éœ€è¦åˆ é™¤æˆæƒçš„ç¾¤é‡Œæ“ä½œ)
	if (string.find(data.Content, "^åˆ é™¤æˆæƒ")) then
	    root = Read("mimoio\/æœºå™¨æˆæƒ\/"..data.FromUserId..CurrentQQ..".txt","999")
		if (root == nil) then
		    sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„æˆæƒè€…")
			return 1
		end
		msg = data.Content:gsub("åˆ é™¤æˆæƒ", "")
		os.remove("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..msg..".txt")
		os.remove("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
		sedmsg(CurrentQQ,data,"âˆ´åˆ é™¤æˆæƒæˆåŠŸï¼")
	end
	--æœºå™¨å¼€å…³æŒ‡ä»¤
	if (data.Content == "å¼€å¯æœºå™¨äºº" or data.Content == "å…³é—­æœºå™¨äºº") then
        mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim ~= nil) then
            msg = data.Content:gsub("æœºå™¨äºº", "")
            str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
			if (str == nil) then
			    Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt",msg)
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äºº"..msg.."æˆåŠŸï¼")
				log.info("Str ====> %s", str)
                return 1
			end
			
            if (string.find(str, msg)) then
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äººä¸€ç›´æ˜¯"..msg.."çš„å‘")
                return 1
            end
            Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt",msg)
            sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äºº"..msg.."æˆåŠŸï¼")
            return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
	end
    --æœºå™¨äººå¼€å¯æ£€æµ‹
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
	if (str == nil) then
	    log.info("Str ====> %s", str)
        return 1
	end
	if (string.find(str, "å…³é—­")) then
	    return 1
	end
	--atæ¶ˆæ¯å¤„ç†
	msgs = ""
	atqq = 0
	if (string.find(data.Content, "ATæ¶ˆæ¯")) then
	    msgs = json.decode(data.Content).Content
		atqq = json.decode(data.Content).UserID
	end
	--å°¾å·´è‡ªå®šä¹‰(å¾…å®Œå–„)
	tips = "â€”â€”å‡¤é£ç¿±ç¿”å…®ä¸·"
    --åŠŸèƒ½æ¨¡å—
    if (data.Content == "åŠŸèƒ½" or data.Content == "ä¸»ç•Œé¢") then
        face = faceArray()
        sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."å½±è§†æœç´¢\n"..face.."èŠå¤©å¨±ä¹\n"..face.."ä¾¿åˆ©åŠŸèƒ½\n"..face.."æœºå™¨è°ƒæ•™\n"..face.."ç®¡ç†ç³»ç»Ÿ\n"..face.."bugåé¦ˆ\n"..face.."æœ¬ç¾¤çŠ¶æ€\n"..face.."æ›´æ–°æ£€æµ‹\n\n"..tips)
    end
    --å½±è§†æœç´¢æ¨¡å—
    if (data.Content == "å½±è§†æœç´¢") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."æœç´¢+å½±è§†å\n"..face.."æˆ‘æƒ³çœ‹+å½±è§†å\n"..face.."æˆ‘è¦çœ‹+å½±è§†å\n\n"..tips)
    elseif (string.find(data.Content, "^æœç´¢")) then
	    msg = data.Content:gsub("æœç´¢", "")
		Sousuo(CurrentQQ,data,msg)
	elseif (string.find(data.Content, "^æˆ‘æƒ³çœ‹")) then
	    msg = data.Content:gsub("æˆ‘æƒ³çœ‹", "")
		Sousuo(CurrentQQ,data,msg)
    elseif (string.find(data.Content, "^æˆ‘è¦çœ‹")) then
	    msg = data.Content:gsub("æˆ‘è¦çœ‹", "")
		Sousuo(CurrentQQ,data,msg)
	end
	--èŠå¤©å¨±ä¹æ¨¡å—
	if (data.Content == "èŠå¤©å¨±ä¹") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."åˆ‡æ¢æ–‡å­—èŠå¤©\n"..face.."åˆ‡æ¢å›å¤èŠå¤©\n"..face.."åˆ‡æ¢è¯­éŸ³èŠå¤©\n\n"..tips)
    elseif (data.Content == "åˆ‡æ¢æ–‡å­—èŠå¤©") then
		liaotian(CurrentQQ,data,1)
	elseif (data.Content == "åˆ‡æ¢è¯­éŸ³èŠå¤©") then
	    liaotian(CurrentQQ,data,2)
    elseif (data.Content == "åˆ‡æ¢å›å¤èŠå¤©") then
	    liaotian(CurrentQQ,data,3)
	else
	    ownthink(CurrentQQ,data,msgs,atqq)
	end
	--ä¾¿åˆ©åŠŸèƒ½æ¨¡å—
	if (data.Content == "ä¾¿åˆ©åŠŸèƒ½") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."ç™¾ç§‘å¤§å…¨\n"..face.."éŸ³ä¹ç‚¹æ­Œ\n"..face.."é—ªä»–@xx\n"..face.."å¤©æ°”æŸ¥è¯¢\n\n"..tips)
	elseif (data.Content == "ç™¾ç§‘å¤§å…¨") then
		sedmsg(CurrentQQ,data,"å‘é€:[ç™¾ç§‘+å…³é”®è¯]\nä¾‹å¦‚:ç™¾ç§‘æ´›å¦¾èº«")
    elseif (data.Content == "éŸ³ä¹ç‚¹æ­Œ") then
		sedmsg(CurrentQQ,data,"å‘é€:[ç‚¹æ­Œ+æ­Œå]\nä¾‹å¦‚:ç‚¹æ­Œé’æŸ ")
	elseif (data.Content == "å¤©æ°”æŸ¥è¯¢") then
		sedmsg(CurrentQQ,data,"å‘é€:[å¤©æ°”+åœ°æ–¹å]\nä¾‹å¦‚:å¤©æ°”åŒ—äº¬(é™äºå›½å†…)")
    elseif (string.find(data.Content, "^å¤©æ°”")) then
        tianqi(CurrentQQ,data)
	    --msg = data.Content:gsub("æœç´¢", "")
		--Sousuo(CurrentQQ,data,msg)
	elseif (string.find(data.Content, "^ç™¾ç§‘")) then
	    baike(CurrentQQ,data)
	    --msg = data.Content:gsub("æˆ‘æƒ³çœ‹", "")
		--Sousuo(CurrentQQ,data,msg)music(CurrentQQ,data)
    elseif (string.find(data.Content, "^ç‚¹æ­Œ")) then
	    music(CurrentQQ,data)
	end
	--æœºå™¨è°ƒæ•™æ¨¡å—
	if (data.Content == "æœºå™¨è°ƒæ•™") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."æ–‡å­—è°ƒæ•™\n"..face.."è¯­éŸ³è°ƒæ•™\n"..face.."å”±æ­Œè°ƒæ•™\n"..face.."éŸ³ä¹è°ƒæ•™\n"..face.."å›¾ç‰‡è°ƒæ•™\n"..face.."åˆ é™¤è°ƒæ•™\n\n"..tips)
    elseif (data.Content == "æ–‡å­—è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#(å†…å®¹)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#ä½ å¥½å•Š")
	elseif (data.Content == "è¯­éŸ³è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#è¯­éŸ³(å†…å®¹)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#è¯­éŸ³ä½ å¥½å•Š")
	elseif (data.Content == "å›¾ç‰‡è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#å›¾ç‰‡(é“¾æ¥)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#å›¾ç‰‡http://../1.jpg")
	elseif (data.Content == "éŸ³ä¹è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#ç‚¹æ­Œ(æ­Œå)]\nä¾‹å¦‚:è°ƒæ•™å–µ#ç‚¹æ­Œå­¦çŒ«å«")
	elseif (data.Content == "å”±æ­Œè°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#å”±æ­Œ(æ­Œå)]\nä¾‹å¦‚:è°ƒæ•™å–µ#å”±æ­Œå­¦çŒ«å«")
	elseif (data.Content == "åˆ é™¤è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[åˆ é™¤è°ƒæ•™(æŒ‡ä»¤)]\nä¾‹å¦‚:åˆ é™¤è°ƒæ•™ä½ å¥½")
	elseif (string.find(data.Content, "^è°ƒæ•™")) then
        tiaojiao(CurrentQQ,data)
	elseif (string.find(data.Content, "^åˆ é™¤è°ƒæ•™")) then
        tiaojiao(CurrentQQ,data)
	end
	--ç®¡ç†ç³»ç»Ÿæ¨¡å—
	if (data.Content == "ç®¡ç†ç³»ç»Ÿ") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."å¼€å¯/å…³é—­æœºå™¨äºº\n"..face.."å¼€å¯/å…³é—­æŠ¢çº¢åŒ…\n"..face.."å¼€å¯/å…³é—­æœºå™¨èŠå¤©\n"..face.."å¼€å¯/å…³é—­é—ªç…§æ£€æµ‹\n"..face.."å¼€å¯/å…³é—­å›¾ç‰‡è§£æ\n"..face.."å¼€å¯/å…³é—­è§†é¢‘è§£æ\n"..face.."å¼€å¯/å…³é—­æ’¤å›æ£€æµ‹\n\n"..tips)
    elseif (data.Content == "å¼€å¯æœºå™¨èŠå¤©" or data.Content == "å…³é—­æœºå™¨èŠå¤©") then
        adminio(CurrentQQ,data,"æœºå™¨èŠå¤©")
    elseif (data.Content == "å¼€å¯æ’¤å›æ£€æµ‹" or data.Content == "å…³é—­æ’¤å›æ£€æµ‹") then
        adminio(CurrentQQ,data,"æ’¤å›æ£€æµ‹")
	elseif (data.Content == "å¼€å¯é—ªç…§æ£€æµ‹" or data.Content == "å…³é—­é—ªç…§æ£€æµ‹") then
        adminio(CurrentQQ,data,"é—ªç…§æ£€æµ‹")
	elseif (data.Content == "å¼€å¯æŠ¢çº¢åŒ…" or data.Content == "å…³é—­æŠ¢çº¢åŒ…") then
        adminio(CurrentQQ,data,"æŠ¢çº¢åŒ…")
	elseif (data.Content == "å¼€å¯è§†é¢‘è§£æ" or data.Content == "å…³é—­è§†é¢‘è§£æ") then
        adminio(CurrentQQ,data,"è§†é¢‘è§£æ")
	elseif (data.Content == "å¼€å¯å›¾ç‰‡è§£æ" or data.Content == "å…³é—­å›¾ç‰‡è§£æ") then
        adminio(CurrentQQ,data,"å›¾ç‰‡è§£æ")
	end
	--bugåé¦ˆæ¨¡å—
	if (data.Content == "BUGåé¦ˆ" or data.Content == "bugåé¦ˆ") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."é‚®ä»¶åé¦ˆ\n"..face.."QQåé¦ˆ\n\n"..tips)
    elseif (data.Content == "QQåé¦ˆ") then
        sedmsg(CurrentQQ,data,"???Î£(ï¾Ÿâˆ€ï¾Ÿï¾‰)ï¾‰\næ’ä»¶æœ‰é—®é¢˜å¯ä»¥åé¦ˆåˆ°:\nQQ:2353065854")
    elseif (data.Content == "é‚®ä»¶åé¦ˆ") then
        sedmsg(CurrentQQ,data,"å®è´å’‹å•¦=ÍÍŸÍŸÍ(ê’ªá—œê’ª â€§Ì£Ì¥Ì‡)\næ’ä»¶æœ‰é—®é¢˜å¯ä»¥åé¦ˆåˆ°:\né‚®ç®±ğŸ“¬:ym-o@qq.com")
	end
	--æœ¬ç¾¤çŠ¶æ€æ¨¡æ¿
	if (data.Content == "æœ¬ç¾¤çŠ¶æ€") then
        face = faceArray()
        hb = Read("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt")
        sz = Read("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt")
		tp = Read("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt")
        sp = Read("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt")
        jqr = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
        lt = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
        ch = Read("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..data.FromGroupId..".txt")
		sedmsg(CurrentQQ,data,"çŠ¶æ€æ•°æ®åˆ—è¡¨â†“â†“â†“\n"..face.."æœºå™¨äºº:"..jqr.."\n"..face.."æŠ¢çº¢åŒ…:"..hb.."\n"..face.."å›¾ç‰‡è§£æ:"..tp.."\n"..face.."æ’¤å›æ£€æµ‹:"..ch.."\n"..face.."è§†é¢‘è§£æ:"..sp.."\n"..face.."æœºå™¨èŠå¤©:"..lt.."\n"..face.."é—ªç…§æ£€æµ‹:"..sz.."\n\n"..tips)
	end
	--æ›´æ–°æ¨¡å—
	if (data.Content == "æ›´æ–°æ£€æµ‹") then
        str = geturl("GET","http://118.25.41.32/Lsb/lua/Vabr.txt","")
		log.info("Str ====> %s", str)
        if (string.find(str, Vabr)) then
            sedmsg(CurrentQQ,data,"å½“å‰ç‰ˆæœ¬ä¸ºæœ€æ–°ç‰ˆ")
        else
            sedmsg(CurrentQQ,data,"å‘ç°æ–°ç‰ˆæœ¬!\nå½“å‰ç‰ˆæœ¬:"..Vabr.."\næ–°ç‰ˆæœ¬å·:"..str.."\nèµ¶å¿«å‘é€[æ›´æ–°æ’ä»¶]å§")
        end
	elseif (data.Content == "æ›´æ–°æ’ä»¶") then
	    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim == nil) then
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
        str = geturl("GET","http://118.25.41.32/Lsb/lua/Vabr.txt","")
		log.info("Str ====> %s", str)
        if (string.find(str, Vabr)) then
            sedmsg(CurrentQQ,data,"å½“å‰ç‰ˆæœ¬ä¸ºæœ€æ–°ç‰ˆ")
        else
            str = geturl("GET","http://118.25.41.32/Lsb/lua/mimoio.txt","")
            Wirte("Plugins\/mimoio.lua",str)
            sedmsg(CurrentQQ,data,"æ›´æ–°å®Œæ¯•ï¼")
        end
	end
	--å›¾ç‰‡ç±»å‹æ¶ˆæ¯å¤„ç†
    if (data.MsgType == "PicMsg") then
	    msg = Read("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt")
		jData = json.decode(data.Content)
	    if (msg ~= nil and jData.tips ~= "[ç¾¤æ¶ˆæ¯-QQé—ªç…§]") then
            if (string.find(str, "å¼€å¯")) then
	            sedmsg(CurrentQQ,data,"å›¾ç‰‡é“¾æ¥è§£æå¦‚ä¸‹â†“â†“\n"..jData.url)
				return 1
	        end
	    end
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt")
	    if (str == nil) then
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    --é—ªç…§ã€å›¾ç‰‡å¤„ç†æ¨¡å—
		PicFlag(CurrentQQ, data)
    end
	--æŠ¢çº¢åŒ…å¤„ç†
	if (string.find(data.MsgType, "RedBagMsg") == 1) then
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt")
		if (str == nil) then
	        log.info("Str ====> %s", str)
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    RedBag(CurrentQQ, data)
	end
	--è§†é¢‘è§£æå¤„ç†
	if (string.find(data.MsgType, "VideoMsg") == 1) then
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt")
		if (str == nil) then
	        log.info("Str ====> %s", str)
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    Video(CurrentQQ, data)
	end
	--até—ªå›¾
	if (data.MsgType == "AtMsg") and (string.find(data.Content, "é—ªä»–")) then
	    shantu(CurrentQQ, data)
    end
	--è°ƒæ•™æœç´¢å¼•æ“
	mim = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..data.Content..".txt")
	if (mim == nil) then
	    --äººç±»çš„æœ¬è´¨æ˜¯å¤è¯»æœº
	    msg = Read("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt")
		if (msg ~= nil) then
		    cs = Read("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt")
			ii = tonumber(cs)
			if (string.find(msg, "^"..data.Content.."$")) then
			    if (ii > 2) then
			         math.randomseed(os.time())
                     sj = math.random(1, 5)
		             if (sj == 1 or sj == 2) then
			             sedmsg(CurrentQQ,data,msg)
					     rr = ii + 1
		                 Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
				     elseif (sj == 3) then
				         os.remove("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt")
					     os.remove("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt")
					     fdArray = {"çªç„¶æˆªæ–­å¤è¯»(ï¾ŸâŠ¿ï¾Ÿ)ï¾‚","å¤è¯»å¯è€»(â€¢Ì€ã¸ â€¢Ì â•® )","ä¸è¦å¤è¯»äº†å•¦","è¿™å°±æ˜¯æ‰€è°“çš„äººç±»çš„æœ¬è´¨","ä½ ä»¬å’‹ä¸ä¸Šå¤©å‘","åˆå¤è¯»ä¸Šç˜¾äº†å•Š"}
                         math.randomseed(os.time())
                         fdsj = math.random(1, 6)
				         sedmsg(CurrentQQ,data,fdArray[fdsj])
				     else
			             rr = ii + 1
		                 Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
		             end
			    else
			        rr = ii + 1
		            Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
			    end
			else
			    if (ii > 2) then
			        math.randomseed(os.time())
                    sj2 = math.random(1, 3)
					if (sj2 == 2) then
					    fdArray2 = {"ä¸­æ–­å¤è¯»å¯è€»","æ‰“æ–­å¤è¯»å¯è€»(â€¢Ì€ã¸ â€¢Ì â•® )","ä½ ä¸ºä»€ä¹ˆè¦æ‰“æ–­å¤è¯»å•Š","å¤è¯»ä¸é¦™å˜›","ç ´åæ°›å›´(à¸‡áµ’ÌŒçš¿áµ’ÌŒ)à¸‡â¼Â³â‚Œâ‚ƒ"}
                        math.randomseed(os.time())
                        fdsj2 = math.random(1, 5)
				        sedmsg(CurrentQQ,data,fdArray2[fdsj2])
					end
				end
				Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt","1")
			    Wirte("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt",data.Content)
			end
		else
		    Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt","1")
			Wirte("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt",data.Content)
		end
	    --å¦‚æœè°ƒæ•™æŒ‡ä»¤ä¸å­˜åœ¨ï¼Œåˆ™è¿›è¡Œå…¶ä»–æ“ä½œ
	    msgsql(CurrentQQ,data)--æ•°æ®å‚¨è“„
		--éšæœºå›å¤æ¶ˆæ¯æ¦‚ç‡0.04
	    math.randomseed(os.time())
        num = math.random(1, 40)
		if (num == 12) then
		    j = xiaosiapi(CurrentQQ,data,data.Content)
			sedmsg(CurrentQQ,data,j.data.info.text)
		end
	else
	    --è§¦å‘è°ƒæ•™æŒ‡ä»¤
		funic(CurrentQQ,data,mim)
	end
    return 1
end

function ReceiveEvents(CurrentQQ, data, extData)
  if data.MsgType == "ON_EVENT_GROUP_REVOKE" then --ç›‘å¬ ç¾¤æ’¤å›äº‹ä»¶
    --æ’¤å›äº‹ä»¶å¤„ç†
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..extData.GroupID..".txt")
    if (str == nil) then
	    log.info("Str ====> %s", str)
        return 1
	end
	if (string.find(str, "å…³é—­")) then
		return 1
	end
	CheHui(CurrentQQ, data, extData)
	--xxxxxxxxxxxxxxx
    return 1
  end
end
  --è¿›ç¾¤ç§€å›¾æ¬¢è¿


--é—ªç…§æ£€æµ‹å¤„ç†


--åŠŸèƒ½ç»„
function funic(CurrentQQ,data,msg)
    if string.find(msg, "^ç‚¹æ­Œ") then
	    data.Content = msg
        music(CurrentQQ,data,msg)
		return 1
	elseif string.find(msg, "^è¯­éŸ³") then
	    keyWord = msg:gsub("è¯­éŸ³", "")
        sedvoicemsg(CurrentQQ,data,keyWord)
		return 1
	elseif string.find(msg, "^å›¾ç‰‡") then
	    keyWord = msg:gsub("å›¾ç‰‡", "")
        sedimgmsg(CurrentQQ,data,keyWord,"")
		return 1
    elseif string.find(msg, "^å”±æ­Œ") then
        keyWord = msg:gsub("å”±æ­Œ", "")
		if (keyWord == "") then
		    sedmsg(CurrentQQ,data,"æ­Œåä¸èƒ½ç©ºç€å“¦")
		    return 1
		end
		sedmsg(CurrentQQ,data,"å¦¾èº«æ­£åœ¨åŠªåŠ›åŠ è½½Ù©(ËƒÌ¶Ì€Íˆà¯°Ë‚Ì¶ÌÍˆ)Ùˆ")
        response, error_message =
            http.request(
            "POST",
            "http://127.0.0.1:8888/SilkApi/UrlToBuf",--ä¿®æ”¹æ­¤å¤„ipåŠç«¯å£å³å¯
            {
                body = keyWord --ä¼ å…¥æ­Œæ›²å
            }
        )
        log.notice("err   %v", error_message)
        html = response.body --è¿”å›silk base64 buf
		if (string.find(html, "Î´")) then
				    sedmsg(CurrentQQ,data,"å¤©ä¾æ²¡æœ‰æ‰¾åˆ°ç›¸å…³çš„æ­Œå‘€(Ã’Ï‰Ã“×±)ï¼")
					c.close(c)
				    return 2
				end
        luaRes =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "VoiceMsg",
                groupid = 0,
                content = "",
                atUser = 0,
                voiceUrl = "",
                voiceBase64Buf = html 
            }
        )
		return 1
	end
    sedmsg(CurrentQQ,data,msg)
end

--å½±è§†æœç´¢ç”¨
function Sousuo(CurrentQQ,data,msg)
    response, error_message =
        http.request(
            "GET",
            "http://localhost/index.php/ajax/suggest",
            {
                query = "mid=1&f=admin&wd="..msg.."&limit=10&timestamp=1567914326746"
            }
        )
    html = response.body
	json = json.decode(html)
	if (json.total == 0) then
	    sedmsg(CurrentQQ,data,"å½±è§†æŸ¥è¯¢é”™è¯¯\nè¯·æ£€æŸ¥å½±è§†åæ˜¯å¦æ­£ç¡®\nâ•â•â•â•â•â•â•â•â•â•â•\næ³¨æ„âš ï¸å½±è§†åä¸è¦å¸¦æ— å…³æˆ–å¤šä½™çš„å­—ç¬¦")
	else
        sedmsg(CurrentQQ,data,"èµ„æºåœ°å€å¦‚ä¸‹â†“â†“â†“\nâ•â•â•â•â•â•â•â•â•â•\nhttp://118.25.41.32/index.php/vod/search/wd/"..escape(msg)..".html\nâ•â•â•â•â•â•â•â•â•â•â•\næ³¨æ„:å¦‚æœQQå‡ºç°åœæ­¢è®¿é—®ç°è±¡ï¼Œè¯·å¤åˆ¶é“¾æ¥ç”¨æµè§ˆå™¨æ‰“å¼€")
	end
end

--å•çº¯å‘æ¶ˆæ¯å›¾æ–‡é€šç”¨
function sedimgmsg(CurrentQQ,data,url,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "PicMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = url,
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘æ¶ˆæ¯ç”¨
function sedmsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "TextMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘ç§èŠæ¶ˆæ¯ç”¨
function sendfrimsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromUin,
        sendToType = 1,
        sendMsgType = "TextMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘jsonæ¶ˆæ¯ç”¨
function sedjsonmsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "JsonMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--èŠå¤©æ¨¡å—åˆ‡æ¢å‡½æ•°
function liaotian(CurrentQQ,data,msg)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
    if (mim == nil) then
        sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
        return 1
    end
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
	if (str == nil) then
        return 1
    end
	if (string.find(str, "å…³é—­")) then
	    sedmsg(CurrentQQ,data,"æœºå™¨èŠå¤©å¤„äºå…³é—­çŠ¶æ€\nâˆ´è¯·å…ˆå¼€å¯æœºå™¨èŠå¤©")
	    return 1
	end
	--åˆ‡æ¢å¤„ç†
	file = io.open("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt", "w")
	if (msg == 1) then
	    file:write("æ–‡å­—èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°æ–‡å­—èŠå¤©")
	elseif (msg == 2) then
	    file:write("è¯­éŸ³èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°è¯­éŸ³èŠå¤©")
	elseif (msg == 3) then
	    file:write("å›å¤èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°å›å¤èŠå¤©")
	end
	file:close()
end

--éšæœºè¡¨æƒ…å‡½æ•°
function faceArray()
    faceArray = {"[è¡¨æƒ…147]","ğŸ€","ğŸ”¥","ğŸ»","ğŸ’","[è¡¨æƒ…185]","[è¡¨æƒ…219]","[è¡¨æƒ…176]"}
    math.randomseed(os.time())
    num = math.random(1, 9)
    return faceArray[num]
end

--urlç¼–ç è½¬æ¢
function escape(w)
	pattern="[^%w%d%._%-%* ]"
	s=string.gsub(w,pattern,function(c)
		local c=string.format("%%%02X",string.byte(c))
		return c
	end)
	s=string.gsub(s," ","+")
	return s
end

--è¯»å–æ•°æ®å‡½æ•°
function Read(url)
    file = io.open(url, "r")
	if (file == nil) then
	    return nil
	else
        file:seek("set")
	    str = file:read("*a")
	    file:close()
        return str
	end
end

--å†™å…¥æ•°æ®å‡½æ•°
function Wirte(url,msg)
    file = io.open(url, "w+")
    file:write(msg)
	file:close()
    return "ok"
end

--å°æ€èŠå¤©å‡½æ•°
function xiaosiapi(CurrentQQ,data,str)
    response, error_message =
            http.request(
            "GET",
            "https://api.ownthink.com/bot",
            {
                query = "appid="..tostring(data.FromUserId).."&spoken=" .. url_encode(str),
                headers = {
                    Accept = "*/*"
                }
            }
        )
        html = response.body
		jData = json.decode(html)
		return jData
end

--æœºå™¨èŠå¤©å‡½æ•°
function ownthink(CurrentQQ,data,msgs,atqq)
    if (tostring(atqq) == CurrentQQ) then
        m = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
        if (m == nil) then
	        log.info("Str ====> %s", m)
            return 1
	    end
	    if (string.find(m, "å…³é—­")) then
	        sedmsg(CurrentQQ,data,"æœºå™¨èŠå¤©å¤„äºå…³é—­çŠ¶æ€\nâˆ´è¯·å…ˆå¼€å¯æœºå™¨èŠå¤©")
	        return 1
	    end
		res2 = string.find(msgs, " ")
		str = string.sub(msgs,res2)
		jData = xiaosiapi(CurrentQQ,data,str)
		Data = json.decode(data.Content)
		m = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
		if (m == nil) then
	        log.info("Str ====> %s", m)
            return 1
	    end
		if (string.find(m, "å›å¤èŠå¤©")) then
		    Api.Api_SendMsg(
                CurrentQQ,
                {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "ReplayMsg",
                groupid = 0,
                content = jData.data.info.text,
                atUser = 0,
				replayInfo = {
                    MsgSeq = data.MsgSeq,
                    --å›å¤æ¶ˆæ¯çš„Seq
                    MsgTime = data.MsgTime,
                    --å›å¤æ¶ˆæ¯çš„äº‹ä»¶
                    UserID = data.FromUserId,
                    --å›å¤æ¶ˆæ¯å¯¹è±¡
                    RawContent = Data.Content --å›å¤æ¶ˆæ¯çš„åŸå†…å®¹
                }
				}
            )
			return 1
		elseif (string.find(m, "æ–‡å­—èŠå¤©")) then
		    sedmsg(CurrentQQ,data,jData.data.info.text)
		else
		    sedvoicemsg(CurrentQQ,data,url_encode(jData.data.info.text))
		end
    end
end

--å‘é€è¯­éŸ³æ¶ˆæ¯
function sedvoicemsg(CurrentQQ,data,str)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "VoiceMsg",
        groupid = 0,
		voiceUrl = "https://dds.dui.ai/runtime/v1/synthesize?voiceId=qianranfa&speed=0.7&volume=100&audioType=wav&text="..str, --å‘é€è¯­éŸ³çš„ç½‘ç»œåœ°å€ æ–‡æœ¬å‹
        voiceBase64Buf = "",
        content = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å¤©æ°”æŸ¥è¯¢å‡½æ•°
--[[function tianqi(CurrentQQ,data)
    keyWord = data.Content:gsub("å¤©æ°”", "")
        if keyWord == "" then
            return 1
        end

        cookies = Api.Api_GetUserCook(CurrentQQ)

        response, error_message =
            http.request(
            "GET",
            "https://weather.mp.qq.com/cgi-bin/rich",
            {
                query = "g_tk=" .. cookies.Gtk .. "&city=" .. url_encode(keyWord),
                headers = {
                    Referer = "http://weather.mp.qq.com/ark"
                },
                cookies = {
                    uin = CurrentQQ,
                    skey = cookies.Skey
                }
            }
        )
        local html = response.body
        log.notice("From Lua html -->%s", html)

        local j = json.decode(html)
        if j.code ~= 0 then
            return 1
        end

        ApiRet =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "JsonMsg",
                groupid = 0,
                content = string.format(
                    --{"config":{"forward":1,"autosize":1},"prompt":"[åº”ç”¨]å¤©æ°”","app":"com.tencent.weather","ver":"0.0.0.1","view":"RichInfoView","meta":{"richinfo":{"adcode":"101210701","city":"æˆéƒ½","air":"58","min":"20","ts":"1500550866","wind":"1","date":"6æœˆ27æ—¥ å‘¨å››","max":"28","type":"201"}},"desc":"å¤©æ°”"}
                    --[[{"app":"com.tencent.weather","desc":"","meta":{"weather":{"ad":[{"icon":"http://imgcache.qq.com/ac/tq/xz2/tp.jpg","p":"ptype=star","t":"2","title":"æ˜Ÿåº§ | ä»Šå¤©ä¼šå› ä¸ºæ„Ÿæƒ…å’Œå®¶åº­çš„é—®é¢˜ï¼Œå½±å“å·¥ä½œï¼Œè¿˜æœ‰ï¼Œä¹Ÿè¦æ³¨æ„äºº...","url":""},{"icon":"http://imgcache.qq.com/ac/qqweather/image/2019/6/27.png","p":"ptype=lunar","t":"4","title":"é»„å† | å†œå†äº”æœˆå»¿äº”ã€‚å®œè®¢ç›Ÿ.çº³é‡‡.å‡ºè¡Œ.ç¥ˆç¦.æ–‹é†®.å®‰åºŠ.ä¼š...","url":""}],"info":{"it1":{"adcode":"101050101","city":"æ­¦æ±‰","hour":"18","max":"29","min":"17","temp":"24","type":"202","ut":"1561630401","wea":"å¤šäº‘"},"it2":{"hour":"19","temp":"22","type":"202"},"it3":{"hour":"20","temp":"21","type":"202"},"ts":"1561631244"},"url":""}},"prompt":"ã€å“ˆå°”æ»¨ã€‘å¤šäº‘ 17Â°/29Â°, 18:13æ›´æ–°~","ver":"1.0.0.106","view":"WeatherThreeView"}]]
--[[                    [[{"app":"com.tencent.weather","desc":"å¤©æ°”","view":"RichInfoView","ver":"1.0.0.217","prompt":"[åº”ç”¨]å¤©æ°”","meta":{"richinfo":{"adcode":"%s","air":"%s","city":"%s","date":"%s","max":"%s","min":"%s","ts":"1554951408","type":"%s","wind":"%s"}},"config":{"forward":1,"autosize":1,"type":"card"}}]],
--[[                    j.data.adcode,
                    j.data.air,
                    j.data.city,
                    j.data.date,
                    j.data.max,
                    j.data.min,
                    j.data.type,
                    j.data.wind
                ),
                atUser = 0
            }
        )
end
--]]
--è°ƒæ•™å¤„ç†å‡½æ•°(å¾…å¤„ç†)
function tiaojiao(CurrentQQ,data)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
	if (mim == nil) then
		sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå“‡")
		return 1
	end
	if (string.find(data.Content, "^åˆ é™¤è°ƒæ•™")) then
	    msg = data.Content:gsub("åˆ é™¤è°ƒæ•™", "")
	    if (msg == "") then
		    sedmsg(CurrentQQ,data,"è¦åˆ é™¤çš„è°ƒæ•™æŒ‡ä»¤ä¸èƒ½ä¸ºç©ºå“¦")
		    return 1
		end
		rese = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..tostring(data.FromGroupId).."\/"..msg..".txt")
	    if (rese == nil) then
			sedmsg(CurrentQQ,data,"è¿™ä¸ªæŒ‡ä»¤ä¸å­˜åœ¨äº†å“¦")
		    return 1
		end
		rm_file = os.remove("mimoio\/æœºå™¨è°ƒæ•™\/"..tostring(data.FromGroupId).."\/"..msg..".txt")
		log.info("åˆ é™¤è°ƒæ•™ ====> %s", rm_file)
		sedmsg(CurrentQQ,data,"åˆ é™¤æˆåŠŸ\nä½ ä¸å–œæ¬¢è¢«è¿™æ ·è°ƒæ•™çš„æˆ‘å—[è¡¨æƒ…9]")
		return 1
	end
    msgs = data.Content:gsub("è°ƒæ•™", "")
		res2 = string.find(msgs, "#")
		str = string.sub(msgs,res2+1)
		str2 = string.sub(msgs,1,res2-1)
		        
		        if (str == "") then
		            sedmsg(CurrentQQ,data,"è°ƒæ•™çš„å›ç­”å†…å®¹ä¸èƒ½ä¸ºç©ºå“¦")
			        return 1
		        end
				if (str2 == "") then
		            sedmsg(CurrentQQ,data,"è°ƒæ•™çš„æŒ‡ä»¤å†…å®¹ä¸èƒ½ä¸ºç©ºå“¦")
			        return 1
		        end
		        rese = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..str2..".txt")
					if (rese ~= nil) then
				        sedmsg(CurrentQQ,data,"æŒ‡ä»¤å·²ç»å­˜åœ¨äº†å“¦")
				        return 1
				    end
				Wirte("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..str2..".txt",str)
				sedmsg(CurrentQQ,data,"è°ƒæ•™æˆåŠŸ\nä½ è¿˜æƒ³å†è°ƒæ•™æˆ‘ä¸€æ¬¡å—[è¡¨æƒ…6]")
		        return 1
end

function url_encode(str)
    if (str) then
        str = string.gsub(str, "\n", "\r\n")
        str =
            string.gsub(
            str,
            "([^%w ])",
            function(c)
                return string.format("%%%02X", string.byte(c))
            end
        )
        str = string.gsub(str, " ", "+")
    end
    return str
end

--æŠ¢çº¢åŒ…å¤„ç†
function RedBag(CurrentQQ, data)
    Api.Api_OpenRedBag(CurrentQQ, data.RedBaginfo)
    if (data.RedBaginfo.RedType == 12) then
         luaRes =
                Api.Api_SendMsg(
                CurrentQQ,
                {
                    toUser = data.FromGroupId,
                    sendToType = 2,
                    sendMsgType = "TextMsg",
                    groupid = 0,
                    content = data.RedBaginfo.Tittle,
                    atUser = 0
                }
            )
        log.notice("From Lua SendMsg Ret\n%d", luaRes.Ret)
    end
end

--è§†é¢‘è§£æå¤„ç†
function Video(CurrentQQ, data)
    vdata = json.decode(data.Content)
        videodata = {
            GroupID = data.FromGroupId,
            VideoUrl = vdata.VideoUrl,
            VideoMd5 = vdata.VideoMd5
        }
        --æ„é€ table å‚æ•°è¡¨
        luaResp = Api.Api_CallFunc(CurrentQQ, "PttCenterSvr.ShortVideoDownReq", videodata) --é€šè¿‡cmdè°ƒç”¨åŠŸèƒ½åŒ…
        luaRes =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "TextMsg",
                groupid = 0,
                content = "è§£æè§†é¢‘URL-->" .. luaResp.VideoUrl,
                atUser = 0
            }
        )
end

--ç®¡ç†å¼€å…³é€šç”¨
function adminio(CurrentQQ,data,oio)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim ~= nil) then
            msg = data.Content:gsub(oio, "")
            str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
            if (string.find(str, "å…³é—­")) then
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äººå·²è¢«å…³é—­...\nè¯·å…ˆå¼€å¯æœºå™¨äºº")
                return 1
            end
			str2 = Read("mimoio\/çŠ¶æ€æ•°æ®\/"..oio.."\/"..data.FromGroupId..".txt")
			if (string.find(str2, msg)) then
			    sedmsg(CurrentQQ,data,"âˆ´"..oio.."æœ¬å°±æ˜¯"..str2.."çŠ¶æ€")
                return 1
			end
            Wirte("mimoio\/çŠ¶æ€æ•°æ®\/"..oio.."\/"..data.FromGroupId..".txt",msg)
            sedmsg(CurrentQQ,data,"âˆ´"..oio..msg.."æˆåŠŸ")
            return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
end

--ç™¾ç§‘å¤§å…¨
function baike(CurrentQQ,data)
    keyWord = data.Content:gsub("ç™¾ç§‘", "")
        if keyWord == "" then
            return 1
        end
        response, error_message =
            http.request(
            "GET",
            "http://baike.baidu.com/api/openapi/BaikeLemmaCardApi",
            {
                query = "scope=103&format=json&appid=379020&bk_key=" .. url_encode(keyWord) .. "&bk_length=600"
            }
        )
        html = response.body
        while(string.find(html, '"errno":2')) do
            response, error_message =
            http.request(
            "GET",
            "http://baike.baidu.com/api/openapi/BaikeLemmaCardApi",
            {
                query = "scope=103&format=json&appid=379020&bk_key=" .. url_encode(keyWord) .. "&bk_length=600"
            })
			html = response.body
        end
        local j = json.decode(html)
        sedmsg(CurrentQQ,data,j.abstract.."\n"..j.url)
end

--éŸ³ä¹ç‚¹æ­Œ
function music(CurrentQQ,data)
    keyWord = data.Content:gsub("ç‚¹æ­Œ", "")
        if keyWord == "" then
            return 1
        end
        response, error_message =
            http.request(
            "GET",
            "https://c.y.qq.com/soso/fcgi-bin/client_search_cp",
            {
                query = "aggr=1&cr=1&flag_qc=0&p=1&n=6&w=" .. url_encode(keyWord)
            }
        )
        html = response.body
		str = string.sub(html,10,-2)
        j = json.decode(str)
        if (j.code == 0) then
            msg = ""
            num = j.data.song.list
            list = num[1]
            songname = list.songname
            singername = list.singer[1].name
            payplay = list.pay.payplay
			albummid = list.albummid
			songmid = list.songmid
	        sedjsonmsg(CurrentQQ,data,'{"app":"com.tencent.structmsg","desc":"éŸ³ä¹","view":"music","ver":"0.0.0.1","prompt":"[åˆ†äº«]' ..songname.. '","meta":{"music":{"sourceMsgId":"0","title":"' ..songname.. '","desc":"' ..singername.. '","preview":"y.gtimg.cn/music/photo_new/T002R150x150M000'..albummid..'.jpg","tag":"QQéŸ³ä¹","musicUrl":"https://v1.itooi.cn/tencent/url?id='..songmid..'","jumpUrl":"y.qq.com/n/yqq/song/'..songmid..'.html","appid":100497308,"app_type":1,"action":"","source_url":"url.cn/5aSZ8Gc","source_icon":"url.cn/5tLgzTm","android_pkg_name":"com.tencent.qqmusic"}},"config":{"forward":true,"type":"normal","autosize":true}}')
			return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´Error:"..j.code)
			return 1
        end
end

--è®¿é—®url
function geturl(url_class,url,caulrt)
        response, error_message =
            http.request(
            url_class,
            url,
            {
                query = caulrt
            }
        )
        html = response.body
		return html
end

--æ¶ˆæ¯å‚¨è“„
function msgsql(CurrentQQ,data)
    if (mysqlpass == "") then
	    return 1
	end
    c = mysql.new()
    -- åˆå§‹åŒ–mysqlå¯¹è±¡
    ok, err = c:connect({host = mysqlhost, port = 3306, database = mysqldb, user = mysqluser, password = mysqlpass})
    --å»ºç«‹è¿æ¥
    if ok then
        sqlstr =
            string.format(
            [[INSERT INTO msgcache (GroupID, MsgSeq, MsgRandom,MsgType,Data,MsgTime)VALUES (%d,%d,%d,'%s','%s',%d)]],
            data.FromGroupId,
            data.MsgSeq,
            data.MsgRandom,
            data.MsgType,
            data.Content,
            data.MsgTime
        )
        res, err = c:query(sqlstr) --å…¥åº“ç¼“å­˜æ¶ˆæ¯
        log.info("%s", err)
        c.close(c)
    --é‡Šæ”¾è¿æ¥
    end
    return 1
end

--æ’¤å›æ£€æµ‹
function CheHui(CurrentQQ, data, extData)
    c = mysql.new()
    -- åˆå§‹åŒ–mysqlå¯¹è±¡
	if (mysqlpass == "") then
	    return 1
	end
	
    if data.MsgType == "ON_EVENT_GROUP_REVOKE" then --ç›‘å¬ ç¾¤æ’¤å›äº‹ä»¶
        str = string.format("ç¾¤æˆ %d  æˆå‘˜ UserID %s æ’¤å›äº†æ¶ˆæ¯Seq %s \n", extData.GroupID, extData.UserID, extData.MsgSeq)
        log.info("%s", str)
        ok, err = c:connect({host = mysqlhost, port = 3306, database = mysqldb, user = mysqluser, password = mysqlpass})
        --å»ºç«‹è¿æ¥
        log.info("sql %v", err)
        if ok then
            sqlstr =
                string.format(
                "select * from msgcache where `GroupID`= %d and `MsgSeq` = %d",
                extData.GroupID,
                extData.MsgSeq
            )
            res, err = c:query(sqlstr) --è·Ÿç¾¤ç¾¤idå’Œæ¶ˆæ¯SEQæŸ¥è¯¢å‡ºæ’¤å›çš„æ¶ˆæ¯å†…å®¹
            if err == nil then
                c.close(c)
                GroupID = tonumber(res[1]["GroupID"])
                MsgType = res[1]["MsgType"]
                Data = res[1]["Data"]

                if MsgType == "TextMsg" then
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            --å‘é€æ–‡æœ¬æ¶ˆæ¯
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡æ–‡æœ¬æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                Data
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "SmallFaceMsg" then
                    --Data {"Content":"[è¡¨æƒ…101]","Hex":"FKY=","Index":101,"tips":"[å°è¡¨æƒ…]"}
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡è¡¨æƒ…æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).Content
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "PicMsg" then
                    --Data {"Content":"","FileId":2820717626,"FileMd5":"q0oEC5aloJJMFr10mplaXw==","FileSize":7026,"tips":"[ç¾¤å›¾ç‰‡]","url":"http://gchat.qpic.cn/gchatpic_new/1700487478/960839480-2534335053-AB4A040B96A5A0924C16BD749A995A5F/0?vuin=u0026term=255u0026pictype=0"}
                    jData = json.decode(Data)
					if (jData.tips == "[ç¾¤æ¶ˆæ¯-QQé—ªç…§]") then
					    
					Api.Api_SendMsg( 
                    CurrentQQ,
                    {
                        toUser = GroupID,
                        sendToType = 2,
                        sendMsgType = "ForwordMsg",
                        content = "",
                        atUser = 0,
                        groupid = 0,
                        voiceUrl = "",
                        voiceBase64Buf = "",
                        picUrl = "",
                        picBase64Buf = "",
                        forwordBuf = json.decode(Data).ForwordBuf, --æ¬²è½¬å‘çš„base64buf å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                        forwordField = json.decode(Data).ForwordField --æ¬²å†™å…¥åè®®çš„å­—æ®µID å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                    }
                )
				    return 1
					end
                    Api.Api_SendMsg( --é€šè¿‡å›¾ç‰‡md5å‘é€å›¾ç‰‡ ç§’å‘ä¸ç”¨ä¸Šä¼  ç›¸å½“äºè½¬å‘
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "PicMsg",
                            --å‘é€å›¾æ–‡æ¶ˆæ¯
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡å›¾ç‰‡æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š[PICFLAG]%s",
                                extData.UserID,
                                jData.Content
                            ),
                            --é€šè¿‡å®[PICFLAG]æ”¹å˜å›¾æ–‡é¡ºåº  æ”¹ä¸ºç°æ–‡å­—åå›¾ç‰‡
                            atUser = 0,
                            voiceUrl = "",
                            voiceBase64Buf = "",
                            picUrl = "",
                            picBase64Buf = "",
                            fileMd5 = jData.FileMd5
                        }
                    )
                end
                if MsgType == "AtMsg" then
                    --Data {"Content":"@Kar98k skjjkssjkjs","UserID":123456789,"tips":"[ATæ¶ˆæ¯]"}
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡atæ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).Content
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "VoiceMsg" then
                    --Data {"tips":"[è¯­éŸ³]","url":"http://grouptalk.c2c.qq.com/?ver=0u0026rkey=3062020101045b305902010102010102041fdef8ae042439416931554e5142586c536d78706a314c686843664959725f327a5f573064697653755902045dac2a21041f0000000866696c6574797065000000013100000005636f64656300000001310400u0026filetype=1u0026voice_codec=1"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "VoiceMsg",
                            --å‘é€ç¾¤è¯­éŸ³æ¶ˆæ¯
                            groupid = 0,
                            content = "",
                            atUser = 0,
                            voiceUrl = json.decode(Data).url,
                            --é€šè¿‡ç½‘ç»œurlè¿›è¡Œå‘é€è¯­éŸ³
                            voiceBase64Buf = "",
                            picUrl = "",
                            picBase64Buf = ""
                        }
                    )
                end

                if MsgType == "ReplayMsg" then
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡å›å¤æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).ReplayContent
                            ),
                            atUser = 0
                        }
                    )
                end
				if MsgType == "VideoMsg" then
	             Api.Api_SendMsg( 
                    CurrentQQ,
                    {
                        toUser = GroupID,
                        sendToType = 2,
                        sendMsgType = "ForwordMsg",
                        content = "",
                        atUser = 0,
                        groupid = 0,
                        voiceUrl = "",
                        voiceBase64Buf = "",
                        picUrl = "",
                        picBase64Buf = "",
                        forwordBuf = json.decode(Data).ForwordBuf, --æ¬²è½¬å‘çš„base64buf å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                        forwordField = json.decode(Data).ForwordField --æ¬²å†™å…¥åè®®çš„å­—æ®µID å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                    }
                )
				end
                if MsgType == "XmlMsg" then
				    
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "XmlMsg",
                            groupid = 0,
                            content = string.format("%s", Data),
                            atUser = 0
                        }
                    )
                end
				if MsgType == "JsonMsg" then
				    
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "JsonMsg",
                            groupid = 0,
                            content = string.format("%s", Data),
                            atUser = 0
                        }
                    )
                end
            end
        end
    end
    return 1
end
2020/09/07 12:54:36.502 [E]  mimoio.lua
2020/09/07 12:54:36.502 [E]  local log = require("log")
local Api = require("coreApi")
local json = require("json")
local http = require("http")
local mysql = require("mysql")

--ç‰ˆæœ¬å·(ä¸è¦æ”¹åŠ¨)
Vabr = "1.0.2"
--æ•°æ®åº“é…ç½®
mysqlhost = "localhost"--é»˜è®¤ä¸åŠ¨
mysqldb = "ffaxx001"--æ•°æ®åº“å
mysqluser = "ffaxx001"--æ•°æ®åº“ç”¨æˆ·å
mysqlpass = "123456"--æ•°æ®åº“å¯†ç 
--ä¸ä½¿ç”¨è¯·ä¸è¦æ”¹åŠ¨

function ReceiveFriendMsg(CurrentQQ, data)
    if (data.Content == "ä½¿ç”¨æ–¹æ³•") then
	    sendfrimsg(CurrentQQ,data,"æ·»åŠ æˆæƒè€…çš„æ–¹æ³•\nå¯¹å•ä¸ªæœºå™¨äººç§èŠå‘é€[æ·»åŠ æˆæƒè€…+æˆæƒè€…QQ]\n\næˆæƒç¾¤çš„æ–¹æ³•\nåˆ°éœ€è¦æˆæƒçš„ç¾¤é‡Œå‘é€[æˆæƒ+ä¸»äººQQ]ã€‚æ³¨æ„:æˆæƒå¿…é¡»æ˜¯æˆæƒè€…è¿›è¡Œæ“ä½œ,ç®¡ç†å‘˜æˆæƒä¸äº†")
	end
    --æ•°æ®åˆå§‹åŒ–
    if (data.Content == "åˆå§‹åŒ–") then
	    root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root ~= nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´è¯·ä¸è¦é‡å¤åˆå§‹åŒ–")
			return 1
		end
    --os.execute('mkdir mimoio/æœºå™¨æˆæƒ')
	    os.execute('mkdir mimoio')
		os.execute('mkdir mimoio/å¤è¯»æœº')
		os.execute('mkdir mimoio/å¤è¯»æœº/æ¬¡æ•°')
		os.execute('mkdir mimoio/å¤è¯»æœº/å†…å®¹')
		os.execute('mkdir mimoio/æœºå™¨æˆæƒ')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨ä¸»äºº')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨èŠå¤©')
		os.execute('mkdir mimoio/æœºå™¨è°ƒæ•™')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æŠ¢çº¢åŒ…')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æœºå™¨èŠå¤©')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æœºå™¨å¼€å…³')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æ’¤å›æ£€æµ‹')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/å›¾ç‰‡è§£æ')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/è§†é¢‘è§£æ')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/é—ªç…§æ£€æµ‹')
		Wirte("mimoio\/"..data.FromUin..".txt","999")
		sendfrimsg(CurrentQQ,data,"åˆå§‹åŒ–å®Œæ¯•ï¼\nå‘é€[ä½¿ç”¨æ–¹æ³•]äº†è§£ä½¿ç”¨å§")
	end
	--æ·»åŠ æˆæƒè€…æ“ä½œ(ç§èŠæœºå™¨äººå‘é€)
	if (string.find(data.Content, "^æ·»åŠ æˆæƒè€…")) then
	    msg = data.Content:gsub("æ·»åŠ æˆæƒè€…", "")
		--Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromUin..".txt","å…³é—­")
		root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root == nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„ç®¡ç†è€…")
			return 1
		end
		Wirte("mimoio\/æœºå™¨æˆæƒ\/"..msg..CurrentQQ..".txt","999")
		sendfrimsg(CurrentQQ,data,"âˆ´æ·»åŠ æˆæƒè€…æˆåŠŸ")
	end
	--åˆ é™¤æˆæƒè€…æ“ä½œ(ç§èŠæœºå™¨äººå‘é€)
	if (string.find(data.Content, "^åˆ é™¤æˆæƒè€…")) then
	    msg = data.Content:gsub("åˆ é™¤æˆæƒè€…", "")
		--Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromUin..".txt","å…³é—­")
		root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root == nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„ç®¡ç†è€…")
			return 1
		end
		os.remove("mimoio\/æœºå™¨æˆæƒ\/"..msg..CurrentQQ..".txt")
		sendfrimsg(CurrentQQ,data,"âˆ´åˆ é™¤æˆæƒè€…æˆåŠŸ")
	end
    return 1
end
function ReceiveGroupMsg(CurrentQQ, data)
    if (tostring(data.FromUserId) == CurrentQQ) then
	    return 1
	end
	--ç¾¤èŠæˆæƒ(åˆ°éœ€è¦æˆæƒçš„ç¾¤é‡Œæ“ä½œ)
	if (string.find(data.Content, "^æˆæƒ")) then
	    root = Read("mimoio\/æœºå™¨æˆæƒ\/"..data.FromUserId..CurrentQQ..".txt","999")
		if (root == nil) then
		    sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„æˆæƒè€…")
			return 1
		end
		msg = data.Content:gsub("æˆæƒ", "")
		os.execute('mkdir mimoio/æœºå™¨è°ƒæ•™/'..data.FromGroupId)
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨ä¸»äºº/'..data.FromGroupId)
		Wirte("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..msg..".txt","999")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt","å›å¤èŠå¤©")
		sedmsg(CurrentQQ,data,"âˆ´æˆæƒæˆåŠŸï¼\nå‘é€[å¼€å¯æœºå™¨äºº]ä½¿ç”¨å§")
	end
	--åˆ é™¤æˆæƒæ“ä½œ(åˆ°éœ€è¦åˆ é™¤æˆæƒçš„ç¾¤é‡Œæ“ä½œ)
	if (string.find(data.Content, "^åˆ é™¤æˆæƒ")) then
	    root = Read("mimoio\/æœºå™¨æˆæƒ\/"..data.FromUserId..CurrentQQ..".txt","999")
		if (root == nil) then
		    sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„æˆæƒè€…")
			return 1
		end
		msg = data.Content:gsub("åˆ é™¤æˆæƒ", "")
		os.remove("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..msg..".txt")
		os.remove("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
		sedmsg(CurrentQQ,data,"âˆ´åˆ é™¤æˆæƒæˆåŠŸï¼")
	end
	--æœºå™¨å¼€å…³æŒ‡ä»¤
	if (data.Content == "å¼€å¯æœºå™¨äºº" or data.Content == "å…³é—­æœºå™¨äºº") then
        mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim ~= nil) then
            msg = data.Content:gsub("æœºå™¨äºº", "")
            str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
			if (str == nil) then
			    Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt",msg)
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äºº"..msg.."æˆåŠŸï¼")
				log.info("Str ====> %s", str)
                return 1
			end
			
            if (string.find(str, msg)) then
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äººä¸€ç›´æ˜¯"..msg.."çš„å‘")
                return 1
            end
            Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt",msg)
            sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äºº"..msg.."æˆåŠŸï¼")
            return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
	end
    --æœºå™¨äººå¼€å¯æ£€æµ‹
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
	if (str == nil) then
	    log.info("Str ====> %s", str)
        return 1
	end
	if (string.find(str, "å…³é—­")) then
	    return 1
	end
	--atæ¶ˆæ¯å¤„ç†
	msgs = ""
	atqq = 0
	if (string.find(data.Content, "ATæ¶ˆæ¯")) then
	    msgs = json.decode(data.Content).Content
		atqq = json.decode(data.Content).UserID
	end
	--å°¾å·´è‡ªå®šä¹‰(å¾…å®Œå–„)
	tips = "â€”â€”å‡¤é£ç¿±ç¿”å…®ä¸·"
    --åŠŸèƒ½æ¨¡å—
    if (data.Content == "åŠŸèƒ½" or data.Content == "ä¸»ç•Œé¢") then
        face = faceArray()
        sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."å½±è§†æœç´¢\n"..face.."èŠå¤©å¨±ä¹\n"..face.."ä¾¿åˆ©åŠŸèƒ½\n"..face.."æœºå™¨è°ƒæ•™\n"..face.."ç®¡ç†ç³»ç»Ÿ\n"..face.."bugåé¦ˆ\n"..face.."æœ¬ç¾¤çŠ¶æ€\n"..face.."æ›´æ–°æ£€æµ‹\n\n"..tips)
    end
    --å½±è§†æœç´¢æ¨¡å—
    if (data.Content == "å½±è§†æœç´¢") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."æœç´¢+å½±è§†å\n"..face.."æˆ‘æƒ³çœ‹+å½±è§†å\n"..face.."æˆ‘è¦çœ‹+å½±è§†å\n\n"..tips)
    elseif (string.find(data.Content, "^æœç´¢")) then
	    msg = data.Content:gsub("æœç´¢", "")
		Sousuo(CurrentQQ,data,msg)
	elseif (string.find(data.Content, "^æˆ‘æƒ³çœ‹")) then
	    msg = data.Content:gsub("æˆ‘æƒ³çœ‹", "")
		Sousuo(CurrentQQ,data,msg)
    elseif (string.find(data.Content, "^æˆ‘è¦çœ‹")) then
	    msg = data.Content:gsub("æˆ‘è¦çœ‹", "")
		Sousuo(CurrentQQ,data,msg)
	end
	--èŠå¤©å¨±ä¹æ¨¡å—
	if (data.Content == "èŠå¤©å¨±ä¹") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."åˆ‡æ¢æ–‡å­—èŠå¤©\n"..face.."åˆ‡æ¢å›å¤èŠå¤©\n"..face.."åˆ‡æ¢è¯­éŸ³èŠå¤©\n\n"..tips)
    elseif (data.Content == "åˆ‡æ¢æ–‡å­—èŠå¤©") then
		liaotian(CurrentQQ,data,1)
	elseif (data.Content == "åˆ‡æ¢è¯­éŸ³èŠå¤©") then
	    liaotian(CurrentQQ,data,2)
    elseif (data.Content == "åˆ‡æ¢å›å¤èŠå¤©") then
	    liaotian(CurrentQQ,data,3)
	else
	    ownthink(CurrentQQ,data,msgs,atqq)
	end
	--ä¾¿åˆ©åŠŸèƒ½æ¨¡å—
	if (data.Content == "ä¾¿åˆ©åŠŸèƒ½") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."ç™¾ç§‘å¤§å…¨\n"..face.."éŸ³ä¹ç‚¹æ­Œ\n"..face.."é—ªä»–@xx\n"..face.."å¤©æ°”æŸ¥è¯¢\n\n"..tips)
	elseif (data.Content == "ç™¾ç§‘å¤§å…¨") then
		sedmsg(CurrentQQ,data,"å‘é€:[ç™¾ç§‘+å…³é”®è¯]\nä¾‹å¦‚:ç™¾ç§‘æ´›å¦¾èº«")
    elseif (data.Content == "éŸ³ä¹ç‚¹æ­Œ") then
		sedmsg(CurrentQQ,data,"å‘é€:[ç‚¹æ­Œ+æ­Œå]\nä¾‹å¦‚:ç‚¹æ­Œé’æŸ ")
	elseif (data.Content == "å¤©æ°”æŸ¥è¯¢") then
		sedmsg(CurrentQQ,data,"å‘é€:[å¤©æ°”+åœ°æ–¹å]\nä¾‹å¦‚:å¤©æ°”åŒ—äº¬(é™äºå›½å†…)")
    elseif (string.find(data.Content, "^å¤©æ°”")) then
        tianqi(CurrentQQ,data)
	    --msg = data.Content:gsub("æœç´¢", "")
		--Sousuo(CurrentQQ,data,msg)
	elseif (string.find(data.Content, "^ç™¾ç§‘")) then
	    baike(CurrentQQ,data)
	    --msg = data.Content:gsub("æˆ‘æƒ³çœ‹", "")
		--Sousuo(CurrentQQ,data,msg)music(CurrentQQ,data)
    elseif (string.find(data.Content, "^ç‚¹æ­Œ")) then
	    music(CurrentQQ,data)
	end
	--æœºå™¨è°ƒæ•™æ¨¡å—
	if (data.Content == "æœºå™¨è°ƒæ•™") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."æ–‡å­—è°ƒæ•™\n"..face.."è¯­éŸ³è°ƒæ•™\n"..face.."å”±æ­Œè°ƒæ•™\n"..face.."éŸ³ä¹è°ƒæ•™\n"..face.."å›¾ç‰‡è°ƒæ•™\n"..face.."åˆ é™¤è°ƒæ•™\n\n"..tips)
    elseif (data.Content == "æ–‡å­—è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#(å†…å®¹)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#ä½ å¥½å•Š")
	elseif (data.Content == "è¯­éŸ³è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#è¯­éŸ³(å†…å®¹)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#è¯­éŸ³ä½ å¥½å•Š")
	elseif (data.Content == "å›¾ç‰‡è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#å›¾ç‰‡(é“¾æ¥)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#å›¾ç‰‡http://../1.jpg")
	elseif (data.Content == "éŸ³ä¹è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#ç‚¹æ­Œ(æ­Œå)]\nä¾‹å¦‚:è°ƒæ•™å–µ#ç‚¹æ­Œå­¦çŒ«å«")
	elseif (data.Content == "å”±æ­Œè°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#å”±æ­Œ(æ­Œå)]\nä¾‹å¦‚:è°ƒæ•™å–µ#å”±æ­Œå­¦çŒ«å«")
	elseif (data.Content == "åˆ é™¤è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[åˆ é™¤è°ƒæ•™(æŒ‡ä»¤)]\nä¾‹å¦‚:åˆ é™¤è°ƒæ•™ä½ å¥½")
	elseif (string.find(data.Content, "^è°ƒæ•™")) then
        tiaojiao(CurrentQQ,data)
	elseif (string.find(data.Content, "^åˆ é™¤è°ƒæ•™")) then
        tiaojiao(CurrentQQ,data)
	end
	--ç®¡ç†ç³»ç»Ÿæ¨¡å—
	if (data.Content == "ç®¡ç†ç³»ç»Ÿ") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."å¼€å¯/å…³é—­æœºå™¨äºº\n"..face.."å¼€å¯/å…³é—­æŠ¢çº¢åŒ…\n"..face.."å¼€å¯/å…³é—­æœºå™¨èŠå¤©\n"..face.."å¼€å¯/å…³é—­é—ªç…§æ£€æµ‹\n"..face.."å¼€å¯/å…³é—­å›¾ç‰‡è§£æ\n"..face.."å¼€å¯/å…³é—­è§†é¢‘è§£æ\n"..face.."å¼€å¯/å…³é—­æ’¤å›æ£€æµ‹\n\n"..tips)
    elseif (data.Content == "å¼€å¯æœºå™¨èŠå¤©" or data.Content == "å…³é—­æœºå™¨èŠå¤©") then
        adminio(CurrentQQ,data,"æœºå™¨èŠå¤©")
    elseif (data.Content == "å¼€å¯æ’¤å›æ£€æµ‹" or data.Content == "å…³é—­æ’¤å›æ£€æµ‹") then
        adminio(CurrentQQ,data,"æ’¤å›æ£€æµ‹")
	elseif (data.Content == "å¼€å¯é—ªç…§æ£€æµ‹" or data.Content == "å…³é—­é—ªç…§æ£€æµ‹") then
        adminio(CurrentQQ,data,"é—ªç…§æ£€æµ‹")
	elseif (data.Content == "å¼€å¯æŠ¢çº¢åŒ…" or data.Content == "å…³é—­æŠ¢çº¢åŒ…") then
        adminio(CurrentQQ,data,"æŠ¢çº¢åŒ…")
	elseif (data.Content == "å¼€å¯è§†é¢‘è§£æ" or data.Content == "å…³é—­è§†é¢‘è§£æ") then
        adminio(CurrentQQ,data,"è§†é¢‘è§£æ")
	elseif (data.Content == "å¼€å¯å›¾ç‰‡è§£æ" or data.Content == "å…³é—­å›¾ç‰‡è§£æ") then
        adminio(CurrentQQ,data,"å›¾ç‰‡è§£æ")
	end
	--bugåé¦ˆæ¨¡å—
	if (data.Content == "BUGåé¦ˆ" or data.Content == "bugåé¦ˆ") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."é‚®ä»¶åé¦ˆ\n"..face.."QQåé¦ˆ\n\n"..tips)
    elseif (data.Content == "QQåé¦ˆ") then
        sedmsg(CurrentQQ,data,"???Î£(ï¾Ÿâˆ€ï¾Ÿï¾‰)ï¾‰\næ’ä»¶æœ‰é—®é¢˜å¯ä»¥åé¦ˆåˆ°:\nQQ:2353065854")
    elseif (data.Content == "é‚®ä»¶åé¦ˆ") then
        sedmsg(CurrentQQ,data,"å®è´å’‹å•¦=ÍÍŸÍŸÍ(ê’ªá—œê’ª â€§Ì£Ì¥Ì‡)\næ’ä»¶æœ‰é—®é¢˜å¯ä»¥åé¦ˆåˆ°:\né‚®ç®±ğŸ“¬:ym-o@qq.com")
	end
	--æœ¬ç¾¤çŠ¶æ€æ¨¡æ¿
	if (data.Content == "æœ¬ç¾¤çŠ¶æ€") then
        face = faceArray()
        hb = Read("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt")
        sz = Read("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt")
		tp = Read("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt")
        sp = Read("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt")
        jqr = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
        lt = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
        ch = Read("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..data.FromGroupId..".txt")
		sedmsg(CurrentQQ,data,"çŠ¶æ€æ•°æ®åˆ—è¡¨â†“â†“â†“\n"..face.."æœºå™¨äºº:"..jqr.."\n"..face.."æŠ¢çº¢åŒ…:"..hb.."\n"..face.."å›¾ç‰‡è§£æ:"..tp.."\n"..face.."æ’¤å›æ£€æµ‹:"..ch.."\n"..face.."è§†é¢‘è§£æ:"..sp.."\n"..face.."æœºå™¨èŠå¤©:"..lt.."\n"..face.."é—ªç…§æ£€æµ‹:"..sz.."\n\n"..tips)
	end
	--æ›´æ–°æ¨¡å—
	if (data.Content == "æ›´æ–°æ£€æµ‹") then
        str = geturl("GET","http://118.25.41.32/Lsb/lua/Vabr.txt","")
		log.info("Str ====> %s", str)
        if (string.find(str, Vabr)) then
            sedmsg(CurrentQQ,data,"å½“å‰ç‰ˆæœ¬ä¸ºæœ€æ–°ç‰ˆ")
        else
            sedmsg(CurrentQQ,data,"å‘ç°æ–°ç‰ˆæœ¬!\nå½“å‰ç‰ˆæœ¬:"..Vabr.."\næ–°ç‰ˆæœ¬å·:"..str.."\nèµ¶å¿«å‘é€[æ›´æ–°æ’ä»¶]å§")
        end
	elseif (data.Content == "æ›´æ–°æ’ä»¶") then
	    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim == nil) then
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
        str = geturl("GET","http://118.25.41.32/Lsb/lua/Vabr.txt","")
		log.info("Str ====> %s", str)
        if (string.find(str, Vabr)) then
            sedmsg(CurrentQQ,data,"å½“å‰ç‰ˆæœ¬ä¸ºæœ€æ–°ç‰ˆ")
        else
            str = geturl("GET","http://118.25.41.32/Lsb/lua/mimoio.txt","")
            Wirte("Plugins\/mimoio.lua",str)
            sedmsg(CurrentQQ,data,"æ›´æ–°å®Œæ¯•ï¼")
        end
	end
	--å›¾ç‰‡ç±»å‹æ¶ˆæ¯å¤„ç†
    if (data.MsgType == "PicMsg") then
	    msg = Read("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt")
		jData = json.decode(data.Content)
	    if (msg ~= nil and jData.tips ~= "[ç¾¤æ¶ˆæ¯-QQé—ªç…§]") then
            if (string.find(str, "å¼€å¯")) then
	            sedmsg(CurrentQQ,data,"å›¾ç‰‡é“¾æ¥è§£æå¦‚ä¸‹â†“â†“\n"..jData.url)
				return 1
	        end
	    end
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt")
	    if (str == nil) then
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    --é—ªç…§ã€å›¾ç‰‡å¤„ç†æ¨¡å—
		PicFlag(CurrentQQ, data)
    end
	--æŠ¢çº¢åŒ…å¤„ç†
	if (string.find(data.MsgType, "RedBagMsg") == 1) then
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt")
		if (str == nil) then
	        log.info("Str ====> %s", str)
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    RedBag(CurrentQQ, data)
	end
	--è§†é¢‘è§£æå¤„ç†
	if (string.find(data.MsgType, "VideoMsg") == 1) then
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt")
		if (str == nil) then
	        log.info("Str ====> %s", str)
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    Video(CurrentQQ, data)
	end
	--até—ªå›¾
	if (data.MsgType == "AtMsg") and (string.find(data.Content, "é—ªä»–")) then
	    shantu(CurrentQQ, data)
    end
	--è°ƒæ•™æœç´¢å¼•æ“
	mim = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..data.Content..".txt")
	if (mim == nil) then
	    --äººç±»çš„æœ¬è´¨æ˜¯å¤è¯»æœº
	    msg = Read("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt")
		if (msg ~= nil) then
		    cs = Read("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt")
			ii = tonumber(cs)
			if (string.find(msg, "^"..data.Content.."$")) then
			    if (ii > 2) then
			         math.randomseed(os.time())
                     sj = math.random(1, 5)
		             if (sj == 1 or sj == 2) then
			             sedmsg(CurrentQQ,data,msg)
					     rr = ii + 1
		                 Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
				     elseif (sj == 3) then
				         os.remove("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt")
					     os.remove("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt")
					     fdArray = {"çªç„¶æˆªæ–­å¤è¯»(ï¾ŸâŠ¿ï¾Ÿ)ï¾‚","å¤è¯»å¯è€»(â€¢Ì€ã¸ â€¢Ì â•® )","ä¸è¦å¤è¯»äº†å•¦","è¿™å°±æ˜¯æ‰€è°“çš„äººç±»çš„æœ¬è´¨","ä½ ä»¬å’‹ä¸ä¸Šå¤©å‘","åˆå¤è¯»ä¸Šç˜¾äº†å•Š"}
                         math.randomseed(os.time())
                         fdsj = math.random(1, 6)
				         sedmsg(CurrentQQ,data,fdArray[fdsj])
				     else
			             rr = ii + 1
		                 Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
		             end
			    else
			        rr = ii + 1
		            Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
			    end
			else
			    if (ii > 2) then
			        math.randomseed(os.time())
                    sj2 = math.random(1, 3)
					if (sj2 == 2) then
					    fdArray2 = {"ä¸­æ–­å¤è¯»å¯è€»","æ‰“æ–­å¤è¯»å¯è€»(â€¢Ì€ã¸ â€¢Ì â•® )","ä½ ä¸ºä»€ä¹ˆè¦æ‰“æ–­å¤è¯»å•Š","å¤è¯»ä¸é¦™å˜›","ç ´åæ°›å›´(à¸‡áµ’ÌŒçš¿áµ’ÌŒ)à¸‡â¼Â³â‚Œâ‚ƒ"}
                        math.randomseed(os.time())
                        fdsj2 = math.random(1, 5)
				        sedmsg(CurrentQQ,data,fdArray2[fdsj2])
					end
				end
				Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt","1")
			    Wirte("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt",data.Content)
			end
		else
		    Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt","1")
			Wirte("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt",data.Content)
		end
	    --å¦‚æœè°ƒæ•™æŒ‡ä»¤ä¸å­˜åœ¨ï¼Œåˆ™è¿›è¡Œå…¶ä»–æ“ä½œ
	    msgsql(CurrentQQ,data)--æ•°æ®å‚¨è“„
		--éšæœºå›å¤æ¶ˆæ¯æ¦‚ç‡0.04
	    math.randomseed(os.time())
        num = math.random(1, 40)
		if (num == 12) then
		    j = xiaosiapi(CurrentQQ,data,data.Content)
			sedmsg(CurrentQQ,data,j.data.info.text)
		end
	else
	    --è§¦å‘è°ƒæ•™æŒ‡ä»¤
		funic(CurrentQQ,data,mim)
	end
    return 1
end

function ReceiveEvents(CurrentQQ, data, extData)
  if data.MsgType == "ON_EVENT_GROUP_REVOKE" then --ç›‘å¬ ç¾¤æ’¤å›äº‹ä»¶
    --æ’¤å›äº‹ä»¶å¤„ç†
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..extData.GroupID..".txt")
    if (str == nil) then
	    log.info("Str ====> %s", str)
        return 1
	end
	if (string.find(str, "å…³é—­")) then
		return 1
	end
	CheHui(CurrentQQ, data, extData)
	--xxxxxxxxxxxxxxx
    return 1
  end
end
  --è¿›ç¾¤ç§€å›¾æ¬¢è¿


--é—ªç…§æ£€æµ‹å¤„ç†


--åŠŸèƒ½ç»„
function funic(CurrentQQ,data,msg)
    if string.find(msg, "^ç‚¹æ­Œ") then
	    data.Content = msg
        music(CurrentQQ,data,msg)
		return 1
	elseif string.find(msg, "^è¯­éŸ³") then
	    keyWord = msg:gsub("è¯­éŸ³", "")
        sedvoicemsg(CurrentQQ,data,keyWord)
		return 1
	elseif string.find(msg, "^å›¾ç‰‡") then
	    keyWord = msg:gsub("å›¾ç‰‡", "")
        sedimgmsg(CurrentQQ,data,keyWord,"")
		return 1
    elseif string.find(msg, "^å”±æ­Œ") then
        keyWord = msg:gsub("å”±æ­Œ", "")
		if (keyWord == "") then
		    sedmsg(CurrentQQ,data,"æ­Œåä¸èƒ½ç©ºç€å“¦")
		    return 1
		end
		sedmsg(CurrentQQ,data,"å¦¾èº«æ­£åœ¨åŠªåŠ›åŠ è½½Ù©(ËƒÌ¶Ì€Íˆà¯°Ë‚Ì¶ÌÍˆ)Ùˆ")
        response, error_message =
            http.request(
            "POST",
            "http://127.0.0.1:8888/SilkApi/UrlToBuf",--ä¿®æ”¹æ­¤å¤„ipåŠç«¯å£å³å¯
            {
                body = keyWord --ä¼ å…¥æ­Œæ›²å
            }
        )
        log.notice("err   %v", error_message)
        html = response.body --è¿”å›silk base64 buf
		if (string.find(html, "Î´")) then
				    sedmsg(CurrentQQ,data,"å¤©ä¾æ²¡æœ‰æ‰¾åˆ°ç›¸å…³çš„æ­Œå‘€(Ã’Ï‰Ã“×±)ï¼")
					c.close(c)
				    return 2
				end
        luaRes =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "VoiceMsg",
                groupid = 0,
                content = "",
                atUser = 0,
                voiceUrl = "",
                voiceBase64Buf = html 
            }
        )
		return 1
	end
    sedmsg(CurrentQQ,data,msg)
end

--å½±è§†æœç´¢ç”¨
function Sousuo(CurrentQQ,data,msg)
    response, error_message =
        http.request(
            "GET",
            "http://localhost/index.php/ajax/suggest",
            {
                query = "mid=1&f=admin&wd="..msg.."&limit=10&timestamp=1567914326746"
            }
        )
    html = response.body
	json = json.decode(html)
	if (json.total == 0) then
	    sedmsg(CurrentQQ,data,"å½±è§†æŸ¥è¯¢é”™è¯¯\nè¯·æ£€æŸ¥å½±è§†åæ˜¯å¦æ­£ç¡®\nâ•â•â•â•â•â•â•â•â•â•â•\næ³¨æ„âš ï¸å½±è§†åä¸è¦å¸¦æ— å…³æˆ–å¤šä½™çš„å­—ç¬¦")
	else
        sedmsg(CurrentQQ,data,"èµ„æºåœ°å€å¦‚ä¸‹â†“â†“â†“\nâ•â•â•â•â•â•â•â•â•â•\nhttp://118.25.41.32/index.php/vod/search/wd/"..escape(msg)..".html\nâ•â•â•â•â•â•â•â•â•â•â•\næ³¨æ„:å¦‚æœQQå‡ºç°åœæ­¢è®¿é—®ç°è±¡ï¼Œè¯·å¤åˆ¶é“¾æ¥ç”¨æµè§ˆå™¨æ‰“å¼€")
	end
end

--å•çº¯å‘æ¶ˆæ¯å›¾æ–‡é€šç”¨
function sedimgmsg(CurrentQQ,data,url,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "PicMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = url,
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘æ¶ˆæ¯ç”¨
function sedmsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "TextMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘ç§èŠæ¶ˆæ¯ç”¨
function sendfrimsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromUin,
        sendToType = 1,
        sendMsgType = "TextMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘jsonæ¶ˆæ¯ç”¨
function sedjsonmsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "JsonMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--èŠå¤©æ¨¡å—åˆ‡æ¢å‡½æ•°
function liaotian(CurrentQQ,data,msg)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
    if (mim == nil) then
        sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
        return 1
    end
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
	if (str == nil) then
        return 1
    end
	if (string.find(str, "å…³é—­")) then
	    sedmsg(CurrentQQ,data,"æœºå™¨èŠå¤©å¤„äºå…³é—­çŠ¶æ€\nâˆ´è¯·å…ˆå¼€å¯æœºå™¨èŠå¤©")
	    return 1
	end
	--åˆ‡æ¢å¤„ç†
	file = io.open("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt", "w")
	if (msg == 1) then
	    file:write("æ–‡å­—èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°æ–‡å­—èŠå¤©")
	elseif (msg == 2) then
	    file:write("è¯­éŸ³èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°è¯­éŸ³èŠå¤©")
	elseif (msg == 3) then
	    file:write("å›å¤èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°å›å¤èŠå¤©")
	end
	file:close()
end

--éšæœºè¡¨æƒ…å‡½æ•°
function faceArray()
    faceArray = {"[è¡¨æƒ…147]","ğŸ€","ğŸ”¥","ğŸ»","ğŸ’","[è¡¨æƒ…185]","[è¡¨æƒ…219]","[è¡¨æƒ…176]"}
    math.randomseed(os.time())
    num = math.random(1, 9)
    return faceArray[num]
end

--urlç¼–ç è½¬æ¢
function escape(w)
	pattern="[^%w%d%._%-%* ]"
	s=string.gsub(w,pattern,function(c)
		local c=string.format("%%%02X",string.byte(c))
		return c
	end)
	s=string.gsub(s," ","+")
	return s
end

--è¯»å–æ•°æ®å‡½æ•°
function Read(url)
    file = io.open(url, "r")
	if (file == nil) then
	    return nil
	else
        file:seek("set")
	    str = file:read("*a")
	    file:close()
        return str
	end
end

--å†™å…¥æ•°æ®å‡½æ•°
function Wirte(url,msg)
    file = io.open(url, "w+")
    file:write(msg)
	file:close()
    return "ok"
end

--å°æ€èŠå¤©å‡½æ•°
function xiaosiapi(CurrentQQ,data,str)
    response, error_message =
            http.request(
            "GET",
            "https://api.ownthink.com/bot",
            {
                query = "appid="..tostring(data.FromUserId).."&spoken=" .. url_encode(str),
                headers = {
                    Accept = "*/*"
                }
            }
        )
        html = response.body
		jData = json.decode(html)
		return jData
end

--æœºå™¨èŠå¤©å‡½æ•°
function ownthink(CurrentQQ,data,msgs,atqq)
    if (tostring(atqq) == CurrentQQ) then
        m = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
        if (m == nil) then
	        log.info("Str ====> %s", m)
            return 1
	    end
	    if (string.find(m, "å…³é—­")) then
	        sedmsg(CurrentQQ,data,"æœºå™¨èŠå¤©å¤„äºå…³é—­çŠ¶æ€\nâˆ´è¯·å…ˆå¼€å¯æœºå™¨èŠå¤©")
	        return 1
	    end
		res2 = string.find(msgs, " ")
		str = string.sub(msgs,res2)
		jData = xiaosiapi(CurrentQQ,data,str)
		Data = json.decode(data.Content)
		m = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
		if (m == nil) then
	        log.info("Str ====> %s", m)
            return 1
	    end
		if (string.find(m, "å›å¤èŠå¤©")) then
		    Api.Api_SendMsg(
                CurrentQQ,
                {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "ReplayMsg",
                groupid = 0,
                content = jData.data.info.text,
                atUser = 0,
				replayInfo = {
                    MsgSeq = data.MsgSeq,
                    --å›å¤æ¶ˆæ¯çš„Seq
                    MsgTime = data.MsgTime,
                    --å›å¤æ¶ˆæ¯çš„äº‹ä»¶
                    UserID = data.FromUserId,
                    --å›å¤æ¶ˆæ¯å¯¹è±¡
                    RawContent = Data.Content --å›å¤æ¶ˆæ¯çš„åŸå†…å®¹
                }
				}
            )
			return 1
		elseif (string.find(m, "æ–‡å­—èŠå¤©")) then
		    sedmsg(CurrentQQ,data,jData.data.info.text)
		else
		    sedvoicemsg(CurrentQQ,data,url_encode(jData.data.info.text))
		end
    end
end

--å‘é€è¯­éŸ³æ¶ˆæ¯
function sedvoicemsg(CurrentQQ,data,str)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "VoiceMsg",
        groupid = 0,
		voiceUrl = "https://dds.dui.ai/runtime/v1/synthesize?voiceId=qianranfa&speed=0.7&volume=100&audioType=wav&text="..str, --å‘é€è¯­éŸ³çš„ç½‘ç»œåœ°å€ æ–‡æœ¬å‹
        voiceBase64Buf = "",
        content = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å¤©æ°”æŸ¥è¯¢å‡½æ•°
--[[function tianqi(CurrentQQ,data)
    keyWord = data.Content:gsub("å¤©æ°”", "")
        if keyWord == "" then
            return 1
        end

        cookies = Api.Api_GetUserCook(CurrentQQ)

        response, error_message =
            http.request(
            "GET",
            "https://weather.mp.qq.com/cgi-bin/rich",
            {
                query = "g_tk=" .. cookies.Gtk .. "&city=" .. url_encode(keyWord),
                headers = {
                    Referer = "http://weather.mp.qq.com/ark"
                },
                cookies = {
                    uin = CurrentQQ,
                    skey = cookies.Skey
                }
            }
        )
        local html = response.body
        log.notice("From Lua html -->%s", html)

        local j = json.decode(html)
        if j.code ~= 0 then
            return 1
        end

        ApiRet =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "JsonMsg",
                groupid = 0,
                content = string.format(
                    --{"config":{"forward":1,"autosize":1},"prompt":"[åº”ç”¨]å¤©æ°”","app":"com.tencent.weather","ver":"0.0.0.1","view":"RichInfoView","meta":{"richinfo":{"adcode":"101210701","city":"æˆéƒ½","air":"58","min":"20","ts":"1500550866","wind":"1","date":"6æœˆ27æ—¥ å‘¨å››","max":"28","type":"201"}},"desc":"å¤©æ°”"}
                    --[[{"app":"com.tencent.weather","desc":"","meta":{"weather":{"ad":[{"icon":"http://imgcache.qq.com/ac/tq/xz2/tp.jpg","p":"ptype=star","t":"2","title":"æ˜Ÿåº§ | ä»Šå¤©ä¼šå› ä¸ºæ„Ÿæƒ…å’Œå®¶åº­çš„é—®é¢˜ï¼Œå½±å“å·¥ä½œï¼Œè¿˜æœ‰ï¼Œä¹Ÿè¦æ³¨æ„äºº...","url":""},{"icon":"http://imgcache.qq.com/ac/qqweather/image/2019/6/27.png","p":"ptype=lunar","t":"4","title":"é»„å† | å†œå†äº”æœˆå»¿äº”ã€‚å®œè®¢ç›Ÿ.çº³é‡‡.å‡ºè¡Œ.ç¥ˆç¦.æ–‹é†®.å®‰åºŠ.ä¼š...","url":""}],"info":{"it1":{"adcode":"101050101","city":"æ­¦æ±‰","hour":"18","max":"29","min":"17","temp":"24","type":"202","ut":"1561630401","wea":"å¤šäº‘"},"it2":{"hour":"19","temp":"22","type":"202"},"it3":{"hour":"20","temp":"21","type":"202"},"ts":"1561631244"},"url":""}},"prompt":"ã€å“ˆå°”æ»¨ã€‘å¤šäº‘ 17Â°/29Â°, 18:13æ›´æ–°~","ver":"1.0.0.106","view":"WeatherThreeView"}]]
--[[                    [[{"app":"com.tencent.weather","desc":"å¤©æ°”","view":"RichInfoView","ver":"1.0.0.217","prompt":"[åº”ç”¨]å¤©æ°”","meta":{"richinfo":{"adcode":"%s","air":"%s","city":"%s","date":"%s","max":"%s","min":"%s","ts":"1554951408","type":"%s","wind":"%s"}},"config":{"forward":1,"autosize":1,"type":"card"}}]],
--[[                    j.data.adcode,
                    j.data.air,
                    j.data.city,
                    j.data.date,
                    j.data.max,
                    j.data.min,
                    j.data.type,
                    j.data.wind
                ),
                atUser = 0
            }
        )
end
--]]
--è°ƒæ•™å¤„ç†å‡½æ•°(å¾…å¤„ç†)
function tiaojiao(CurrentQQ,data)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
	if (mim == nil) then
		sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå“‡")
		return 1
	end
	if (string.find(data.Content, "^åˆ é™¤è°ƒæ•™")) then
	    msg = data.Content:gsub("åˆ é™¤è°ƒæ•™", "")
	    if (msg == "") then
		    sedmsg(CurrentQQ,data,"è¦åˆ é™¤çš„è°ƒæ•™æŒ‡ä»¤ä¸èƒ½ä¸ºç©ºå“¦")
		    return 1
		end
		rese = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..tostring(data.FromGroupId).."\/"..msg..".txt")
	    if (rese == nil) then
			sedmsg(CurrentQQ,data,"è¿™ä¸ªæŒ‡ä»¤ä¸å­˜åœ¨äº†å“¦")
		    return 1
		end
		rm_file = os.remove("mimoio\/æœºå™¨è°ƒæ•™\/"..tostring(data.FromGroupId).."\/"..msg..".txt")
		log.info("åˆ é™¤è°ƒæ•™ ====> %s", rm_file)
		sedmsg(CurrentQQ,data,"åˆ é™¤æˆåŠŸ\nä½ ä¸å–œæ¬¢è¢«è¿™æ ·è°ƒæ•™çš„æˆ‘å—[è¡¨æƒ…9]")
		return 1
	end
    msgs = data.Content:gsub("è°ƒæ•™", "")
		res2 = string.find(msgs, "#")
		str = string.sub(msgs,res2+1)
		str2 = string.sub(msgs,1,res2-1)
		        
		        if (str == "") then
		            sedmsg(CurrentQQ,data,"è°ƒæ•™çš„å›ç­”å†…å®¹ä¸èƒ½ä¸ºç©ºå“¦")
			        return 1
		        end
				if (str2 == "") then
		            sedmsg(CurrentQQ,data,"è°ƒæ•™çš„æŒ‡ä»¤å†…å®¹ä¸èƒ½ä¸ºç©ºå“¦")
			        return 1
		        end
		        rese = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..str2..".txt")
					if (rese ~= nil) then
				        sedmsg(CurrentQQ,data,"æŒ‡ä»¤å·²ç»å­˜åœ¨äº†å“¦")
				        return 1
				    end
				Wirte("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..str2..".txt",str)
				sedmsg(CurrentQQ,data,"è°ƒæ•™æˆåŠŸ\nä½ è¿˜æƒ³å†è°ƒæ•™æˆ‘ä¸€æ¬¡å—[è¡¨æƒ…6]")
		        return 1
end

function url_encode(str)
    if (str) then
        str = string.gsub(str, "\n", "\r\n")
        str =
            string.gsub(
            str,
            "([^%w ])",
            function(c)
                return string.format("%%%02X", string.byte(c))
            end
        )
        str = string.gsub(str, " ", "+")
    end
    return str
end

--æŠ¢çº¢åŒ…å¤„ç†
function RedBag(CurrentQQ, data)
    Api.Api_OpenRedBag(CurrentQQ, data.RedBaginfo)
    if (data.RedBaginfo.RedType == 12) then
         luaRes =
                Api.Api_SendMsg(
                CurrentQQ,
                {
                    toUser = data.FromGroupId,
                    sendToType = 2,
                    sendMsgType = "TextMsg",
                    groupid = 0,
                    content = data.RedBaginfo.Tittle,
                    atUser = 0
                }
            )
        log.notice("From Lua SendMsg Ret\n%d", luaRes.Ret)
    end
end

--è§†é¢‘è§£æå¤„ç†
function Video(CurrentQQ, data)
    vdata = json.decode(data.Content)
        videodata = {
            GroupID = data.FromGroupId,
            VideoUrl = vdata.VideoUrl,
            VideoMd5 = vdata.VideoMd5
        }
        --æ„é€ table å‚æ•°è¡¨
        luaResp = Api.Api_CallFunc(CurrentQQ, "PttCenterSvr.ShortVideoDownReq", videodata) --é€šè¿‡cmdè°ƒç”¨åŠŸèƒ½åŒ…
        luaRes =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "TextMsg",
                groupid = 0,
                content = "è§£æè§†é¢‘URL-->" .. luaResp.VideoUrl,
                atUser = 0
            }
        )
end

--ç®¡ç†å¼€å…³é€šç”¨
function adminio(CurrentQQ,data,oio)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim ~= nil) then
            msg = data.Content:gsub(oio, "")
            str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
            if (string.find(str, "å…³é—­")) then
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äººå·²è¢«å…³é—­...\nè¯·å…ˆå¼€å¯æœºå™¨äºº")
                return 1
            end
			str2 = Read("mimoio\/çŠ¶æ€æ•°æ®\/"..oio.."\/"..data.FromGroupId..".txt")
			if (string.find(str2, msg)) then
			    sedmsg(CurrentQQ,data,"âˆ´"..oio.."æœ¬å°±æ˜¯"..str2.."çŠ¶æ€")
                return 1
			end
            Wirte("mimoio\/çŠ¶æ€æ•°æ®\/"..oio.."\/"..data.FromGroupId..".txt",msg)
            sedmsg(CurrentQQ,data,"âˆ´"..oio..msg.."æˆåŠŸ")
            return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
end

--ç™¾ç§‘å¤§å…¨
function baike(CurrentQQ,data)
    keyWord = data.Content:gsub("ç™¾ç§‘", "")
        if keyWord == "" then
            return 1
        end
        response, error_message =
            http.request(
            "GET",
            "http://baike.baidu.com/api/openapi/BaikeLemmaCardApi",
            {
                query = "scope=103&format=json&appid=379020&bk_key=" .. url_encode(keyWord) .. "&bk_length=600"
            }
        )
        html = response.body
        while(string.find(html, '"errno":2')) do
            response, error_message =
            http.request(
            "GET",
            "http://baike.baidu.com/api/openapi/BaikeLemmaCardApi",
            {
                query = "scope=103&format=json&appid=379020&bk_key=" .. url_encode(keyWord) .. "&bk_length=600"
            })
			html = response.body
        end
        local j = json.decode(html)
        sedmsg(CurrentQQ,data,j.abstract.."\n"..j.url)
end

--éŸ³ä¹ç‚¹æ­Œ
function music(CurrentQQ,data)
    keyWord = data.Content:gsub("ç‚¹æ­Œ", "")
        if keyWord == "" then
            return 1
        end
        response, error_message =
            http.request(
            "GET",
            "https://c.y.qq.com/soso/fcgi-bin/client_search_cp",
            {
                query = "aggr=1&cr=1&flag_qc=0&p=1&n=6&w=" .. url_encode(keyWord)
            }
        )
        html = response.body
		str = string.sub(html,10,-2)
        j = json.decode(str)
        if (j.code == 0) then
            msg = ""
            num = j.data.song.list
            list = num[1]
            songname = list.songname
            singername = list.singer[1].name
            payplay = list.pay.payplay
			albummid = list.albummid
			songmid = list.songmid
	        sedjsonmsg(CurrentQQ,data,'{"app":"com.tencent.structmsg","desc":"éŸ³ä¹","view":"music","ver":"0.0.0.1","prompt":"[åˆ†äº«]' ..songname.. '","meta":{"music":{"sourceMsgId":"0","title":"' ..songname.. '","desc":"' ..singername.. '","preview":"y.gtimg.cn/music/photo_new/T002R150x150M000'..albummid..'.jpg","tag":"QQéŸ³ä¹","musicUrl":"https://v1.itooi.cn/tencent/url?id='..songmid..'","jumpUrl":"y.qq.com/n/yqq/song/'..songmid..'.html","appid":100497308,"app_type":1,"action":"","source_url":"url.cn/5aSZ8Gc","source_icon":"url.cn/5tLgzTm","android_pkg_name":"com.tencent.qqmusic"}},"config":{"forward":true,"type":"normal","autosize":true}}')
			return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´Error:"..j.code)
			return 1
        end
end

--è®¿é—®url
function geturl(url_class,url,caulrt)
        response, error_message =
            http.request(
            url_class,
            url,
            {
                query = caulrt
            }
        )
        html = response.body
		return html
end

--æ¶ˆæ¯å‚¨è“„
function msgsql(CurrentQQ,data)
    if (mysqlpass == "") then
	    return 1
	end
    c = mysql.new()
    -- åˆå§‹åŒ–mysqlå¯¹è±¡
    ok, err = c:connect({host = mysqlhost, port = 3306, database = mysqldb, user = mysqluser, password = mysqlpass})
    --å»ºç«‹è¿æ¥
    if ok then
        sqlstr =
            string.format(
            [[INSERT INTO msgcache (GroupID, MsgSeq, MsgRandom,MsgType,Data,MsgTime)VALUES (%d,%d,%d,'%s','%s',%d)]],
            data.FromGroupId,
            data.MsgSeq,
            data.MsgRandom,
            data.MsgType,
            data.Content,
            data.MsgTime
        )
        res, err = c:query(sqlstr) --å…¥åº“ç¼“å­˜æ¶ˆæ¯
        log.info("%s", err)
        c.close(c)
    --é‡Šæ”¾è¿æ¥
    end
    return 1
end

--æ’¤å›æ£€æµ‹
function CheHui(CurrentQQ, data, extData)
    c = mysql.new()
    -- åˆå§‹åŒ–mysqlå¯¹è±¡
	if (mysqlpass == "") then
	    return 1
	end
	
    if data.MsgType == "ON_EVENT_GROUP_REVOKE" then --ç›‘å¬ ç¾¤æ’¤å›äº‹ä»¶
        str = string.format("ç¾¤æˆ %d  æˆå‘˜ UserID %s æ’¤å›äº†æ¶ˆæ¯Seq %s \n", extData.GroupID, extData.UserID, extData.MsgSeq)
        log.info("%s", str)
        ok, err = c:connect({host = mysqlhost, port = 3306, database = mysqldb, user = mysqluser, password = mysqlpass})
        --å»ºç«‹è¿æ¥
        log.info("sql %v", err)
        if ok then
            sqlstr =
                string.format(
                "select * from msgcache where `GroupID`= %d and `MsgSeq` = %d",
                extData.GroupID,
                extData.MsgSeq
            )
            res, err = c:query(sqlstr) --è·Ÿç¾¤ç¾¤idå’Œæ¶ˆæ¯SEQæŸ¥è¯¢å‡ºæ’¤å›çš„æ¶ˆæ¯å†…å®¹
            if err == nil then
                c.close(c)
                GroupID = tonumber(res[1]["GroupID"])
                MsgType = res[1]["MsgType"]
                Data = res[1]["Data"]

                if MsgType == "TextMsg" then
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            --å‘é€æ–‡æœ¬æ¶ˆæ¯
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡æ–‡æœ¬æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                Data
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "SmallFaceMsg" then
                    --Data {"Content":"[è¡¨æƒ…101]","Hex":"FKY=","Index":101,"tips":"[å°è¡¨æƒ…]"}
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡è¡¨æƒ…æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).Content
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "PicMsg" then
                    --Data {"Content":"","FileId":2820717626,"FileMd5":"q0oEC5aloJJMFr10mplaXw==","FileSize":7026,"tips":"[ç¾¤å›¾ç‰‡]","url":"http://gchat.qpic.cn/gchatpic_new/1700487478/960839480-2534335053-AB4A040B96A5A0924C16BD749A995A5F/0?vuin=u0026term=255u0026pictype=0"}
                    jData = json.decode(Data)
					if (jData.tips == "[ç¾¤æ¶ˆæ¯-QQé—ªç…§]") then
					    
					Api.Api_SendMsg( 
                    CurrentQQ,
                    {
                        toUser = GroupID,
                        sendToType = 2,
                        sendMsgType = "ForwordMsg",
                        content = "",
                        atUser = 0,
                        groupid = 0,
                        voiceUrl = "",
                        voiceBase64Buf = "",
                        picUrl = "",
                        picBase64Buf = "",
                        forwordBuf = json.decode(Data).ForwordBuf, --æ¬²è½¬å‘çš„base64buf å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                        forwordField = json.decode(Data).ForwordField --æ¬²å†™å…¥åè®®çš„å­—æ®µID å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                    }
                )
				    return 1
					end
                    Api.Api_SendMsg( --é€šè¿‡å›¾ç‰‡md5å‘é€å›¾ç‰‡ ç§’å‘ä¸ç”¨ä¸Šä¼  ç›¸å½“äºè½¬å‘
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "PicMsg",
                            --å‘é€å›¾æ–‡æ¶ˆæ¯
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡å›¾ç‰‡æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š[PICFLAG]%s",
                                extData.UserID,
                                jData.Content
                            ),
                            --é€šè¿‡å®[PICFLAG]æ”¹å˜å›¾æ–‡é¡ºåº  æ”¹ä¸ºç°æ–‡å­—åå›¾ç‰‡
                            atUser = 0,
                            voiceUrl = "",
                            voiceBase64Buf = "",
                            picUrl = "",
                            picBase64Buf = "",
                            fileMd5 = jData.FileMd5
                        }
                    )
                end
                if MsgType == "AtMsg" then
                    --Data {"Content":"@Kar98k skjjkssjkjs","UserID":123456789,"tips":"[ATæ¶ˆæ¯]"}
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡atæ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).Content
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "VoiceMsg" then
                    --Data {"tips":"[è¯­éŸ³]","url":"http://grouptalk.c2c.qq.com/?ver=0u0026rkey=3062020101045b305902010102010102041fdef8ae042439416931554e5142586c536d78706a314c686843664959725f327a5f573064697653755902045dac2a21041f0000000866696c6574797065000000013100000005636f64656300000001310400u0026filetype=1u0026voice_codec=1"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "VoiceMsg",
                            --å‘é€ç¾¤è¯­éŸ³æ¶ˆæ¯
                            groupid = 0,
                            content = "",
                            atUser = 0,
                            voiceUrl = json.decode(Data).url,
                            --é€šè¿‡ç½‘ç»œurlè¿›è¡Œå‘é€è¯­éŸ³
                            voiceBase64Buf = "",
                            picUrl = "",
                            picBase64Buf = ""
                        }
                    )
                end

                if MsgType == "ReplayMsg" then
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡å›å¤æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).ReplayContent
                            ),
                            atUser = 0
                        }
                    )
                end
				if MsgType == "VideoMsg" then
	             Api.Api_SendMsg( 
                    CurrentQQ,
                    {
                        toUser = GroupID,
                        sendToType = 2,
                        sendMsgType = "ForwordMsg",
                        content = "",
                        atUser = 0,
                        groupid = 0,
                        voiceUrl = "",
                        voiceBase64Buf = "",
                        picUrl = "",
                        picBase64Buf = "",
                        forwordBuf = json.decode(Data).ForwordBuf, --æ¬²è½¬å‘çš„base64buf å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                        forwordField = json.decode(Data).ForwordField --æ¬²å†™å…¥åè®®çš„å­—æ®µID å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                    }
                )
				end
                if MsgType == "XmlMsg" then
				    
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "XmlMsg",
                            groupid = 0,
                            content = string.format("%s", Data),
                            atUser = 0
                        }
                    )
                end
				if MsgType == "JsonMsg" then
				    
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "JsonMsg",
                            groupid = 0,
                            content = string.format("%s", Data),
                            atUser = 0
                        }
                    )
                end
            end
        end
    end
    return 1
end
2020/09/07 12:54:50.142 [E]  mimoio.lua
2020/09/07 12:54:50.143 [E]  local log = require("log")
local Api = require("coreApi")
local json = require("json")
local http = require("http")
local mysql = require("mysql")

--ç‰ˆæœ¬å·(ä¸è¦æ”¹åŠ¨)
Vabr = "1.0.2"
--æ•°æ®åº“é…ç½®
mysqlhost = "localhost"--é»˜è®¤ä¸åŠ¨
mysqldb = "ffaxx001"--æ•°æ®åº“å
mysqluser = "ffaxx001"--æ•°æ®åº“ç”¨æˆ·å
mysqlpass = "123456"--æ•°æ®åº“å¯†ç 
--ä¸ä½¿ç”¨è¯·ä¸è¦æ”¹åŠ¨

function ReceiveFriendMsg(CurrentQQ, data)
    if (data.Content == "ä½¿ç”¨æ–¹æ³•") then
	    sendfrimsg(CurrentQQ,data,"æ·»åŠ æˆæƒè€…çš„æ–¹æ³•\nå¯¹å•ä¸ªæœºå™¨äººç§èŠå‘é€[æ·»åŠ æˆæƒè€…+æˆæƒè€…QQ]\n\næˆæƒç¾¤çš„æ–¹æ³•\nåˆ°éœ€è¦æˆæƒçš„ç¾¤é‡Œå‘é€[æˆæƒ+ä¸»äººQQ]ã€‚æ³¨æ„:æˆæƒå¿…é¡»æ˜¯æˆæƒè€…è¿›è¡Œæ“ä½œ,ç®¡ç†å‘˜æˆæƒä¸äº†")
	end
    --æ•°æ®åˆå§‹åŒ–
    if (data.Content == "åˆå§‹åŒ–") then
	    root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root ~= nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´è¯·ä¸è¦é‡å¤åˆå§‹åŒ–")
			return 1
		end
    --os.execute('mkdir mimoio/æœºå™¨æˆæƒ')
	    os.execute('mkdir mimoio')
		os.execute('mkdir mimoio/å¤è¯»æœº')
		os.execute('mkdir mimoio/å¤è¯»æœº/æ¬¡æ•°')
		os.execute('mkdir mimoio/å¤è¯»æœº/å†…å®¹')
		os.execute('mkdir mimoio/æœºå™¨æˆæƒ')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨ä¸»äºº')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨èŠå¤©')
		os.execute('mkdir mimoio/æœºå™¨è°ƒæ•™')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æŠ¢çº¢åŒ…')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æœºå™¨èŠå¤©')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æœºå™¨å¼€å…³')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æ’¤å›æ£€æµ‹')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/å›¾ç‰‡è§£æ')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/è§†é¢‘è§£æ')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/é—ªç…§æ£€æµ‹')
		Wirte("mimoio\/"..data.FromUin..".txt","999")
		sendfrimsg(CurrentQQ,data,"åˆå§‹åŒ–å®Œæ¯•ï¼\nå‘é€[ä½¿ç”¨æ–¹æ³•]äº†è§£ä½¿ç”¨å§")
	end
	--æ·»åŠ æˆæƒè€…æ“ä½œ(ç§èŠæœºå™¨äººå‘é€)
	if (string.find(data.Content, "^æ·»åŠ æˆæƒè€…")) then
	    msg = data.Content:gsub("æ·»åŠ æˆæƒè€…", "")
		--Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromUin..".txt","å…³é—­")
		root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root == nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„ç®¡ç†è€…")
			return 1
		end
		Wirte("mimoio\/æœºå™¨æˆæƒ\/"..msg..CurrentQQ..".txt","999")
		sendfrimsg(CurrentQQ,data,"âˆ´æ·»åŠ æˆæƒè€…æˆåŠŸ")
	end
	--åˆ é™¤æˆæƒè€…æ“ä½œ(ç§èŠæœºå™¨äººå‘é€)
	if (string.find(data.Content, "^åˆ é™¤æˆæƒè€…")) then
	    msg = data.Content:gsub("åˆ é™¤æˆæƒè€…", "")
		--Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromUin..".txt","å…³é—­")
		root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root == nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„ç®¡ç†è€…")
			return 1
		end
		os.remove("mimoio\/æœºå™¨æˆæƒ\/"..msg..CurrentQQ..".txt")
		sendfrimsg(CurrentQQ,data,"âˆ´åˆ é™¤æˆæƒè€…æˆåŠŸ")
	end
    return 1
end
function ReceiveGroupMsg(CurrentQQ, data)
    if (tostring(data.FromUserId) == CurrentQQ) then
	    return 1
	end
	--ç¾¤èŠæˆæƒ(åˆ°éœ€è¦æˆæƒçš„ç¾¤é‡Œæ“ä½œ)
	if (string.find(data.Content, "^æˆæƒ")) then
	    root = Read("mimoio\/æœºå™¨æˆæƒ\/"..data.FromUserId..CurrentQQ..".txt","999")
		if (root == nil) then
		    sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„æˆæƒè€…")
			return 1
		end
		msg = data.Content:gsub("æˆæƒ", "")
		os.execute('mkdir mimoio/æœºå™¨è°ƒæ•™/'..data.FromGroupId)
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨ä¸»äºº/'..data.FromGroupId)
		Wirte("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..msg..".txt","999")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt","å›å¤èŠå¤©")
		sedmsg(CurrentQQ,data,"âˆ´æˆæƒæˆåŠŸï¼\nå‘é€[å¼€å¯æœºå™¨äºº]ä½¿ç”¨å§")
	end
	--åˆ é™¤æˆæƒæ“ä½œ(åˆ°éœ€è¦åˆ é™¤æˆæƒçš„ç¾¤é‡Œæ“ä½œ)
	if (string.find(data.Content, "^åˆ é™¤æˆæƒ")) then
	    root = Read("mimoio\/æœºå™¨æˆæƒ\/"..data.FromUserId..CurrentQQ..".txt","999")
		if (root == nil) then
		    sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„æˆæƒè€…")
			return 1
		end
		msg = data.Content:gsub("åˆ é™¤æˆæƒ", "")
		os.remove("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..msg..".txt")
		os.remove("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
		sedmsg(CurrentQQ,data,"âˆ´åˆ é™¤æˆæƒæˆåŠŸï¼")
	end
	--æœºå™¨å¼€å…³æŒ‡ä»¤
	if (data.Content == "å¼€å¯æœºå™¨äºº" or data.Content == "å…³é—­æœºå™¨äºº") then
        mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim ~= nil) then
            msg = data.Content:gsub("æœºå™¨äºº", "")
            str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
			if (str == nil) then
			    Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt",msg)
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äºº"..msg.."æˆåŠŸï¼")
				log.info("Str ====> %s", str)
                return 1
			end
			
            if (string.find(str, msg)) then
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äººä¸€ç›´æ˜¯"..msg.."çš„å‘")
                return 1
            end
            Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt",msg)
            sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äºº"..msg.."æˆåŠŸï¼")
            return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
	end
    --æœºå™¨äººå¼€å¯æ£€æµ‹
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
	if (str == nil) then
	    log.info("Str ====> %s", str)
        return 1
	end
	if (string.find(str, "å…³é—­")) then
	    return 1
	end
	--atæ¶ˆæ¯å¤„ç†
	msgs = ""
	atqq = 0
	if (string.find(data.Content, "ATæ¶ˆæ¯")) then
	    msgs = json.decode(data.Content).Content
		atqq = json.decode(data.Content).UserID
	end
	--å°¾å·´è‡ªå®šä¹‰(å¾…å®Œå–„)
	tips = "â€”â€”å‡¤é£ç¿±ç¿”å…®ä¸·"
    --åŠŸèƒ½æ¨¡å—
    if (data.Content == "åŠŸèƒ½" or data.Content == "ä¸»ç•Œé¢") then
        face = faceArray()
        sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."å½±è§†æœç´¢\n"..face.."èŠå¤©å¨±ä¹\n"..face.."ä¾¿åˆ©åŠŸèƒ½\n"..face.."æœºå™¨è°ƒæ•™\n"..face.."ç®¡ç†ç³»ç»Ÿ\n"..face.."bugåé¦ˆ\n"..face.."æœ¬ç¾¤çŠ¶æ€\n"..face.."æ›´æ–°æ£€æµ‹\n\n"..tips)
    end
    --å½±è§†æœç´¢æ¨¡å—
    if (data.Content == "å½±è§†æœç´¢") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."æœç´¢+å½±è§†å\n"..face.."æˆ‘æƒ³çœ‹+å½±è§†å\n"..face.."æˆ‘è¦çœ‹+å½±è§†å\n\n"..tips)
    elseif (string.find(data.Content, "^æœç´¢")) then
	    msg = data.Content:gsub("æœç´¢", "")
		Sousuo(CurrentQQ,data,msg)
	elseif (string.find(data.Content, "^æˆ‘æƒ³çœ‹")) then
	    msg = data.Content:gsub("æˆ‘æƒ³çœ‹", "")
		Sousuo(CurrentQQ,data,msg)
    elseif (string.find(data.Content, "^æˆ‘è¦çœ‹")) then
	    msg = data.Content:gsub("æˆ‘è¦çœ‹", "")
		Sousuo(CurrentQQ,data,msg)
	end
	--èŠå¤©å¨±ä¹æ¨¡å—
	if (data.Content == "èŠå¤©å¨±ä¹") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."åˆ‡æ¢æ–‡å­—èŠå¤©\n"..face.."åˆ‡æ¢å›å¤èŠå¤©\n"..face.."åˆ‡æ¢è¯­éŸ³èŠå¤©\n\n"..tips)
    elseif (data.Content == "åˆ‡æ¢æ–‡å­—èŠå¤©") then
		liaotian(CurrentQQ,data,1)
	elseif (data.Content == "åˆ‡æ¢è¯­éŸ³èŠå¤©") then
	    liaotian(CurrentQQ,data,2)
    elseif (data.Content == "åˆ‡æ¢å›å¤èŠå¤©") then
	    liaotian(CurrentQQ,data,3)
	else
	    ownthink(CurrentQQ,data,msgs,atqq)
	end
	--ä¾¿åˆ©åŠŸèƒ½æ¨¡å—
	if (data.Content == "ä¾¿åˆ©åŠŸèƒ½") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."ç™¾ç§‘å¤§å…¨\n"..face.."éŸ³ä¹ç‚¹æ­Œ\n"..face.."é—ªä»–@xx\n"..face.."å¤©æ°”æŸ¥è¯¢\n\n"..tips)
	elseif (data.Content == "ç™¾ç§‘å¤§å…¨") then
		sedmsg(CurrentQQ,data,"å‘é€:[ç™¾ç§‘+å…³é”®è¯]\nä¾‹å¦‚:ç™¾ç§‘æ´›å¦¾èº«")
    elseif (data.Content == "éŸ³ä¹ç‚¹æ­Œ") then
		sedmsg(CurrentQQ,data,"å‘é€:[ç‚¹æ­Œ+æ­Œå]\nä¾‹å¦‚:ç‚¹æ­Œé’æŸ ")
	elseif (data.Content == "å¤©æ°”æŸ¥è¯¢") then
		sedmsg(CurrentQQ,data,"å‘é€:[å¤©æ°”+åœ°æ–¹å]\nä¾‹å¦‚:å¤©æ°”åŒ—äº¬(é™äºå›½å†…)")
    elseif (string.find(data.Content, "^å¤©æ°”")) then
        tianqi(CurrentQQ,data)
	    --msg = data.Content:gsub("æœç´¢", "")
		--Sousuo(CurrentQQ,data,msg)
	elseif (string.find(data.Content, "^ç™¾ç§‘")) then
	    baike(CurrentQQ,data)
	    --msg = data.Content:gsub("æˆ‘æƒ³çœ‹", "")
		--Sousuo(CurrentQQ,data,msg)music(CurrentQQ,data)
    elseif (string.find(data.Content, "^ç‚¹æ­Œ")) then
	    music(CurrentQQ,data)
	end
	--æœºå™¨è°ƒæ•™æ¨¡å—
	if (data.Content == "æœºå™¨è°ƒæ•™") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."æ–‡å­—è°ƒæ•™\n"..face.."è¯­éŸ³è°ƒæ•™\n"..face.."å”±æ­Œè°ƒæ•™\n"..face.."éŸ³ä¹è°ƒæ•™\n"..face.."å›¾ç‰‡è°ƒæ•™\n"..face.."åˆ é™¤è°ƒæ•™\n\n"..tips)
    elseif (data.Content == "æ–‡å­—è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#(å†…å®¹)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#ä½ å¥½å•Š")
	elseif (data.Content == "è¯­éŸ³è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#è¯­éŸ³(å†…å®¹)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#è¯­éŸ³ä½ å¥½å•Š")
	elseif (data.Content == "å›¾ç‰‡è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#å›¾ç‰‡(é“¾æ¥)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#å›¾ç‰‡http://../1.jpg")
	elseif (data.Content == "éŸ³ä¹è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#ç‚¹æ­Œ(æ­Œå)]\nä¾‹å¦‚:è°ƒæ•™å–µ#ç‚¹æ­Œå­¦çŒ«å«")
	elseif (data.Content == "å”±æ­Œè°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#å”±æ­Œ(æ­Œå)]\nä¾‹å¦‚:è°ƒæ•™å–µ#å”±æ­Œå­¦çŒ«å«")
	elseif (data.Content == "åˆ é™¤è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[åˆ é™¤è°ƒæ•™(æŒ‡ä»¤)]\nä¾‹å¦‚:åˆ é™¤è°ƒæ•™ä½ å¥½")
	elseif (string.find(data.Content, "^è°ƒæ•™")) then
        tiaojiao(CurrentQQ,data)
	elseif (string.find(data.Content, "^åˆ é™¤è°ƒæ•™")) then
        tiaojiao(CurrentQQ,data)
	end
	--ç®¡ç†ç³»ç»Ÿæ¨¡å—
	if (data.Content == "ç®¡ç†ç³»ç»Ÿ") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."å¼€å¯/å…³é—­æœºå™¨äºº\n"..face.."å¼€å¯/å…³é—­æŠ¢çº¢åŒ…\n"..face.."å¼€å¯/å…³é—­æœºå™¨èŠå¤©\n"..face.."å¼€å¯/å…³é—­é—ªç…§æ£€æµ‹\n"..face.."å¼€å¯/å…³é—­å›¾ç‰‡è§£æ\n"..face.."å¼€å¯/å…³é—­è§†é¢‘è§£æ\n"..face.."å¼€å¯/å…³é—­æ’¤å›æ£€æµ‹\n\n"..tips)
    elseif (data.Content == "å¼€å¯æœºå™¨èŠå¤©" or data.Content == "å…³é—­æœºå™¨èŠå¤©") then
        adminio(CurrentQQ,data,"æœºå™¨èŠå¤©")
    elseif (data.Content == "å¼€å¯æ’¤å›æ£€æµ‹" or data.Content == "å…³é—­æ’¤å›æ£€æµ‹") then
        adminio(CurrentQQ,data,"æ’¤å›æ£€æµ‹")
	elseif (data.Content == "å¼€å¯é—ªç…§æ£€æµ‹" or data.Content == "å…³é—­é—ªç…§æ£€æµ‹") then
        adminio(CurrentQQ,data,"é—ªç…§æ£€æµ‹")
	elseif (data.Content == "å¼€å¯æŠ¢çº¢åŒ…" or data.Content == "å…³é—­æŠ¢çº¢åŒ…") then
        adminio(CurrentQQ,data,"æŠ¢çº¢åŒ…")
	elseif (data.Content == "å¼€å¯è§†é¢‘è§£æ" or data.Content == "å…³é—­è§†é¢‘è§£æ") then
        adminio(CurrentQQ,data,"è§†é¢‘è§£æ")
	elseif (data.Content == "å¼€å¯å›¾ç‰‡è§£æ" or data.Content == "å…³é—­å›¾ç‰‡è§£æ") then
        adminio(CurrentQQ,data,"å›¾ç‰‡è§£æ")
	end
	--bugåé¦ˆæ¨¡å—
	if (data.Content == "BUGåé¦ˆ" or data.Content == "bugåé¦ˆ") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."é‚®ä»¶åé¦ˆ\n"..face.."QQåé¦ˆ\n\n"..tips)
    elseif (data.Content == "QQåé¦ˆ") then
        sedmsg(CurrentQQ,data,"???Î£(ï¾Ÿâˆ€ï¾Ÿï¾‰)ï¾‰\næ’ä»¶æœ‰é—®é¢˜å¯ä»¥åé¦ˆåˆ°:\nQQ:2353065854")
    elseif (data.Content == "é‚®ä»¶åé¦ˆ") then
        sedmsg(CurrentQQ,data,"å®è´å’‹å•¦=ÍÍŸÍŸÍ(ê’ªá—œê’ª â€§Ì£Ì¥Ì‡)\næ’ä»¶æœ‰é—®é¢˜å¯ä»¥åé¦ˆåˆ°:\né‚®ç®±ğŸ“¬:ym-o@qq.com")
	end
	--æœ¬ç¾¤çŠ¶æ€æ¨¡æ¿
	if (data.Content == "æœ¬ç¾¤çŠ¶æ€") then
        face = faceArray()
        hb = Read("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt")
        sz = Read("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt")
		tp = Read("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt")
        sp = Read("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt")
        jqr = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
        lt = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
        ch = Read("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..data.FromGroupId..".txt")
		sedmsg(CurrentQQ,data,"çŠ¶æ€æ•°æ®åˆ—è¡¨â†“â†“â†“\n"..face.."æœºå™¨äºº:"..jqr.."\n"..face.."æŠ¢çº¢åŒ…:"..hb.."\n"..face.."å›¾ç‰‡è§£æ:"..tp.."\n"..face.."æ’¤å›æ£€æµ‹:"..ch.."\n"..face.."è§†é¢‘è§£æ:"..sp.."\n"..face.."æœºå™¨èŠå¤©:"..lt.."\n"..face.."é—ªç…§æ£€æµ‹:"..sz.."\n\n"..tips)
	end
	--æ›´æ–°æ¨¡å—
	if (data.Content == "æ›´æ–°æ£€æµ‹") then
        str = geturl("GET","http://118.25.41.32/Lsb/lua/Vabr.txt","")
		log.info("Str ====> %s", str)
        if (string.find(str, Vabr)) then
            sedmsg(CurrentQQ,data,"å½“å‰ç‰ˆæœ¬ä¸ºæœ€æ–°ç‰ˆ")
        else
            sedmsg(CurrentQQ,data,"å‘ç°æ–°ç‰ˆæœ¬!\nå½“å‰ç‰ˆæœ¬:"..Vabr.."\næ–°ç‰ˆæœ¬å·:"..str.."\nèµ¶å¿«å‘é€[æ›´æ–°æ’ä»¶]å§")
        end
	elseif (data.Content == "æ›´æ–°æ’ä»¶") then
	    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim == nil) then
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
        str = geturl("GET","http://118.25.41.32/Lsb/lua/Vabr.txt","")
		log.info("Str ====> %s", str)
        if (string.find(str, Vabr)) then
            sedmsg(CurrentQQ,data,"å½“å‰ç‰ˆæœ¬ä¸ºæœ€æ–°ç‰ˆ")
        else
            str = geturl("GET","http://118.25.41.32/Lsb/lua/mimoio.txt","")
            Wirte("Plugins\/mimoio.lua",str)
            sedmsg(CurrentQQ,data,"æ›´æ–°å®Œæ¯•ï¼")
        end
	end
	--å›¾ç‰‡ç±»å‹æ¶ˆæ¯å¤„ç†
    if (data.MsgType == "PicMsg") then
	    msg = Read("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt")
		jData = json.decode(data.Content)
	    if (msg ~= nil and jData.tips ~= "[ç¾¤æ¶ˆæ¯-QQé—ªç…§]") then
            if (string.find(str, "å¼€å¯")) then
	            sedmsg(CurrentQQ,data,"å›¾ç‰‡é“¾æ¥è§£æå¦‚ä¸‹â†“â†“\n"..jData.url)
				return 1
	        end
	    end
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt")
	    if (str == nil) then
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    --é—ªç…§ã€å›¾ç‰‡å¤„ç†æ¨¡å—
		PicFlag(CurrentQQ, data)
    end
	--æŠ¢çº¢åŒ…å¤„ç†
	if (string.find(data.MsgType, "RedBagMsg") == 1) then
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt")
		if (str == nil) then
	        log.info("Str ====> %s", str)
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    RedBag(CurrentQQ, data)
	end
	--è§†é¢‘è§£æå¤„ç†
	if (string.find(data.MsgType, "VideoMsg") == 1) then
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt")
		if (str == nil) then
	        log.info("Str ====> %s", str)
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    Video(CurrentQQ, data)
	end
	--até—ªå›¾
	if (data.MsgType == "AtMsg") and (string.find(data.Content, "é—ªä»–")) then
	    shantu(CurrentQQ, data)
    end
	--è°ƒæ•™æœç´¢å¼•æ“
	mim = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..data.Content..".txt")
	if (mim == nil) then
	    --äººç±»çš„æœ¬è´¨æ˜¯å¤è¯»æœº
	    msg = Read("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt")
		if (msg ~= nil) then
		    cs = Read("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt")
			ii = tonumber(cs)
			if (string.find(msg, "^"..data.Content.."$")) then
			    if (ii > 2) then
			         math.randomseed(os.time())
                     sj = math.random(1, 5)
		             if (sj == 1 or sj == 2) then
			             sedmsg(CurrentQQ,data,msg)
					     rr = ii + 1
		                 Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
				     elseif (sj == 3) then
				         os.remove("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt")
					     os.remove("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt")
					     fdArray = {"çªç„¶æˆªæ–­å¤è¯»(ï¾ŸâŠ¿ï¾Ÿ)ï¾‚","å¤è¯»å¯è€»(â€¢Ì€ã¸ â€¢Ì â•® )","ä¸è¦å¤è¯»äº†å•¦","è¿™å°±æ˜¯æ‰€è°“çš„äººç±»çš„æœ¬è´¨","ä½ ä»¬å’‹ä¸ä¸Šå¤©å‘","åˆå¤è¯»ä¸Šç˜¾äº†å•Š"}
                         math.randomseed(os.time())
                         fdsj = math.random(1, 6)
				         sedmsg(CurrentQQ,data,fdArray[fdsj])
				     else
			             rr = ii + 1
		                 Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
		             end
			    else
			        rr = ii + 1
		            Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
			    end
			else
			    if (ii > 2) then
			        math.randomseed(os.time())
                    sj2 = math.random(1, 3)
					if (sj2 == 2) then
					    fdArray2 = {"ä¸­æ–­å¤è¯»å¯è€»","æ‰“æ–­å¤è¯»å¯è€»(â€¢Ì€ã¸ â€¢Ì â•® )","ä½ ä¸ºä»€ä¹ˆè¦æ‰“æ–­å¤è¯»å•Š","å¤è¯»ä¸é¦™å˜›","ç ´åæ°›å›´(à¸‡áµ’ÌŒçš¿áµ’ÌŒ)à¸‡â¼Â³â‚Œâ‚ƒ"}
                        math.randomseed(os.time())
                        fdsj2 = math.random(1, 5)
				        sedmsg(CurrentQQ,data,fdArray2[fdsj2])
					end
				end
				Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt","1")
			    Wirte("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt",data.Content)
			end
		else
		    Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt","1")
			Wirte("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt",data.Content)
		end
	    --å¦‚æœè°ƒæ•™æŒ‡ä»¤ä¸å­˜åœ¨ï¼Œåˆ™è¿›è¡Œå…¶ä»–æ“ä½œ
	    msgsql(CurrentQQ,data)--æ•°æ®å‚¨è“„
		--éšæœºå›å¤æ¶ˆæ¯æ¦‚ç‡0.04
	    math.randomseed(os.time())
        num = math.random(1, 40)
		if (num == 12) then
		    j = xiaosiapi(CurrentQQ,data,data.Content)
			sedmsg(CurrentQQ,data,j.data.info.text)
		end
	else
	    --è§¦å‘è°ƒæ•™æŒ‡ä»¤
		funic(CurrentQQ,data,mim)
	end
    return 1
end

function ReceiveEvents(CurrentQQ, data, extData)
  if data.MsgType == "ON_EVENT_GROUP_REVOKE" then --ç›‘å¬ ç¾¤æ’¤å›äº‹ä»¶
    --æ’¤å›äº‹ä»¶å¤„ç†
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..extData.GroupID..".txt")
    if (str == nil) then
	    log.info("Str ====> %s", str)
        return 1
	end
	if (string.find(str, "å…³é—­")) then
		return 1
	end
	CheHui(CurrentQQ, data, extData)
	--xxxxxxxxxxxxxxx
    return 1
  end
end
  --è¿›ç¾¤ç§€å›¾æ¬¢è¿


--é—ªç…§æ£€æµ‹å¤„ç†


--åŠŸèƒ½ç»„
function funic(CurrentQQ,data,msg)
    if string.find(msg, "^ç‚¹æ­Œ") then
	    data.Content = msg
        music(CurrentQQ,data,msg)
		return 1
	elseif string.find(msg, "^è¯­éŸ³") then
	    keyWord = msg:gsub("è¯­éŸ³", "")
        sedvoicemsg(CurrentQQ,data,keyWord)
		return 1
	elseif string.find(msg, "^å›¾ç‰‡") then
	    keyWord = msg:gsub("å›¾ç‰‡", "")
        sedimgmsg(CurrentQQ,data,keyWord,"")
		return 1
    elseif string.find(msg, "^å”±æ­Œ") then
        keyWord = msg:gsub("å”±æ­Œ", "")
		if (keyWord == "") then
		    sedmsg(CurrentQQ,data,"æ­Œåä¸èƒ½ç©ºç€å“¦")
		    return 1
		end
		sedmsg(CurrentQQ,data,"å¦¾èº«æ­£åœ¨åŠªåŠ›åŠ è½½Ù©(ËƒÌ¶Ì€Íˆà¯°Ë‚Ì¶ÌÍˆ)Ùˆ")
        response, error_message =
            http.request(
            "POST",
            "http://127.0.0.1:8888/SilkApi/UrlToBuf",--ä¿®æ”¹æ­¤å¤„ipåŠç«¯å£å³å¯
            {
                body = keyWord --ä¼ å…¥æ­Œæ›²å
            }
        )
        log.notice("err   %v", error_message)
        html = response.body --è¿”å›silk base64 buf
		if (string.find(html, "Î´")) then
				    sedmsg(CurrentQQ,data,"å¤©ä¾æ²¡æœ‰æ‰¾åˆ°ç›¸å…³çš„æ­Œå‘€(Ã’Ï‰Ã“×±)ï¼")
					c.close(c)
				    return 2
				end
        luaRes =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "VoiceMsg",
                groupid = 0,
                content = "",
                atUser = 0,
                voiceUrl = "",
                voiceBase64Buf = html 
            }
        )
		return 1
	end
    sedmsg(CurrentQQ,data,msg)
end

--å½±è§†æœç´¢ç”¨
function Sousuo(CurrentQQ,data,msg)
    response, error_message =
        http.request(
            "GET",
            "http://localhost/index.php/ajax/suggest",
            {
                query = "mid=1&f=admin&wd="..msg.."&limit=10&timestamp=1567914326746"
            }
        )
    html = response.body
	json = json.decode(html)
	if (json.total == 0) then
	    sedmsg(CurrentQQ,data,"å½±è§†æŸ¥è¯¢é”™è¯¯\nè¯·æ£€æŸ¥å½±è§†åæ˜¯å¦æ­£ç¡®\nâ•â•â•â•â•â•â•â•â•â•â•\næ³¨æ„âš ï¸å½±è§†åä¸è¦å¸¦æ— å…³æˆ–å¤šä½™çš„å­—ç¬¦")
	else
        sedmsg(CurrentQQ,data,"èµ„æºåœ°å€å¦‚ä¸‹â†“â†“â†“\nâ•â•â•â•â•â•â•â•â•â•\nhttp://118.25.41.32/index.php/vod/search/wd/"..escape(msg)..".html\nâ•â•â•â•â•â•â•â•â•â•â•\næ³¨æ„:å¦‚æœQQå‡ºç°åœæ­¢è®¿é—®ç°è±¡ï¼Œè¯·å¤åˆ¶é“¾æ¥ç”¨æµè§ˆå™¨æ‰“å¼€")
	end
end

--å•çº¯å‘æ¶ˆæ¯å›¾æ–‡é€šç”¨
function sedimgmsg(CurrentQQ,data,url,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "PicMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = url,
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘æ¶ˆæ¯ç”¨
function sedmsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "TextMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘ç§èŠæ¶ˆæ¯ç”¨
function sendfrimsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromUin,
        sendToType = 1,
        sendMsgType = "TextMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘jsonæ¶ˆæ¯ç”¨
function sedjsonmsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "JsonMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--èŠå¤©æ¨¡å—åˆ‡æ¢å‡½æ•°
function liaotian(CurrentQQ,data,msg)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
    if (mim == nil) then
        sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
        return 1
    end
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
	if (str == nil) then
        return 1
    end
	if (string.find(str, "å…³é—­")) then
	    sedmsg(CurrentQQ,data,"æœºå™¨èŠå¤©å¤„äºå…³é—­çŠ¶æ€\nâˆ´è¯·å…ˆå¼€å¯æœºå™¨èŠå¤©")
	    return 1
	end
	--åˆ‡æ¢å¤„ç†
	file = io.open("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt", "w")
	if (msg == 1) then
	    file:write("æ–‡å­—èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°æ–‡å­—èŠå¤©")
	elseif (msg == 2) then
	    file:write("è¯­éŸ³èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°è¯­éŸ³èŠå¤©")
	elseif (msg == 3) then
	    file:write("å›å¤èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°å›å¤èŠå¤©")
	end
	file:close()
end

--éšæœºè¡¨æƒ…å‡½æ•°
function faceArray()
    faceArray = {"[è¡¨æƒ…147]","ğŸ€","ğŸ”¥","ğŸ»","ğŸ’","[è¡¨æƒ…185]","[è¡¨æƒ…219]","[è¡¨æƒ…176]"}
    math.randomseed(os.time())
    num = math.random(1, 9)
    return faceArray[num]
end

--urlç¼–ç è½¬æ¢
function escape(w)
	pattern="[^%w%d%._%-%* ]"
	s=string.gsub(w,pattern,function(c)
		local c=string.format("%%%02X",string.byte(c))
		return c
	end)
	s=string.gsub(s," ","+")
	return s
end

--è¯»å–æ•°æ®å‡½æ•°
function Read(url)
    file = io.open(url, "r")
	if (file == nil) then
	    return nil
	else
        file:seek("set")
	    str = file:read("*a")
	    file:close()
        return str
	end
end

--å†™å…¥æ•°æ®å‡½æ•°
function Wirte(url,msg)
    file = io.open(url, "w+")
    file:write(msg)
	file:close()
    return "ok"
end

--å°æ€èŠå¤©å‡½æ•°
function xiaosiapi(CurrentQQ,data,str)
    response, error_message =
            http.request(
            "GET",
            "https://api.ownthink.com/bot",
            {
                query = "appid="..tostring(data.FromUserId).."&spoken=" .. url_encode(str),
                headers = {
                    Accept = "*/*"
                }
            }
        )
        html = response.body
		jData = json.decode(html)
		return jData
end

--æœºå™¨èŠå¤©å‡½æ•°
function ownthink(CurrentQQ,data,msgs,atqq)
    if (tostring(atqq) == CurrentQQ) then
        m = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
        if (m == nil) then
	        log.info("Str ====> %s", m)
            return 1
	    end
	    if (string.find(m, "å…³é—­")) then
	        sedmsg(CurrentQQ,data,"æœºå™¨èŠå¤©å¤„äºå…³é—­çŠ¶æ€\nâˆ´è¯·å…ˆå¼€å¯æœºå™¨èŠå¤©")
	        return 1
	    end
		res2 = string.find(msgs, " ")
		str = string.sub(msgs,res2)
		jData = xiaosiapi(CurrentQQ,data,str)
		Data = json.decode(data.Content)
		m = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
		if (m == nil) then
	        log.info("Str ====> %s", m)
            return 1
	    end
		if (string.find(m, "å›å¤èŠå¤©")) then
		    Api.Api_SendMsg(
                CurrentQQ,
                {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "ReplayMsg",
                groupid = 0,
                content = jData.data.info.text,
                atUser = 0,
				replayInfo = {
                    MsgSeq = data.MsgSeq,
                    --å›å¤æ¶ˆæ¯çš„Seq
                    MsgTime = data.MsgTime,
                    --å›å¤æ¶ˆæ¯çš„äº‹ä»¶
                    UserID = data.FromUserId,
                    --å›å¤æ¶ˆæ¯å¯¹è±¡
                    RawContent = Data.Content --å›å¤æ¶ˆæ¯çš„åŸå†…å®¹
                }
				}
            )
			return 1
		elseif (string.find(m, "æ–‡å­—èŠå¤©")) then
		    sedmsg(CurrentQQ,data,jData.data.info.text)
		else
		    sedvoicemsg(CurrentQQ,data,url_encode(jData.data.info.text))
		end
    end
end

--å‘é€è¯­éŸ³æ¶ˆæ¯
function sedvoicemsg(CurrentQQ,data,str)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "VoiceMsg",
        groupid = 0,
		voiceUrl = "https://dds.dui.ai/runtime/v1/synthesize?voiceId=qianranfa&speed=0.7&volume=100&audioType=wav&text="..str, --å‘é€è¯­éŸ³çš„ç½‘ç»œåœ°å€ æ–‡æœ¬å‹
        voiceBase64Buf = "",
        content = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å¤©æ°”æŸ¥è¯¢å‡½æ•°
--[[function tianqi(CurrentQQ,data)
    keyWord = data.Content:gsub("å¤©æ°”", "")
        if keyWord == "" then
            return 1
        end

        cookies = Api.Api_GetUserCook(CurrentQQ)

        response, error_message =
            http.request(
            "GET",
            "https://weather.mp.qq.com/cgi-bin/rich",
            {
                query = "g_tk=" .. cookies.Gtk .. "&city=" .. url_encode(keyWord),
                headers = {
                    Referer = "http://weather.mp.qq.com/ark"
                },
                cookies = {
                    uin = CurrentQQ,
                    skey = cookies.Skey
                }
            }
        )
        local html = response.body
        log.notice("From Lua html -->%s", html)

        local j = json.decode(html)
        if j.code ~= 0 then
            return 1
        end

        ApiRet =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "JsonMsg",
                groupid = 0,
                content = string.format(
                    --{"config":{"forward":1,"autosize":1},"prompt":"[åº”ç”¨]å¤©æ°”","app":"com.tencent.weather","ver":"0.0.0.1","view":"RichInfoView","meta":{"richinfo":{"adcode":"101210701","city":"æˆéƒ½","air":"58","min":"20","ts":"1500550866","wind":"1","date":"6æœˆ27æ—¥ å‘¨å››","max":"28","type":"201"}},"desc":"å¤©æ°”"}
                    --[[{"app":"com.tencent.weather","desc":"","meta":{"weather":{"ad":[{"icon":"http://imgcache.qq.com/ac/tq/xz2/tp.jpg","p":"ptype=star","t":"2","title":"æ˜Ÿåº§ | ä»Šå¤©ä¼šå› ä¸ºæ„Ÿæƒ…å’Œå®¶åº­çš„é—®é¢˜ï¼Œå½±å“å·¥ä½œï¼Œè¿˜æœ‰ï¼Œä¹Ÿè¦æ³¨æ„äºº...","url":""},{"icon":"http://imgcache.qq.com/ac/qqweather/image/2019/6/27.png","p":"ptype=lunar","t":"4","title":"é»„å† | å†œå†äº”æœˆå»¿äº”ã€‚å®œè®¢ç›Ÿ.çº³é‡‡.å‡ºè¡Œ.ç¥ˆç¦.æ–‹é†®.å®‰åºŠ.ä¼š...","url":""}],"info":{"it1":{"adcode":"101050101","city":"æ­¦æ±‰","hour":"18","max":"29","min":"17","temp":"24","type":"202","ut":"1561630401","wea":"å¤šäº‘"},"it2":{"hour":"19","temp":"22","type":"202"},"it3":{"hour":"20","temp":"21","type":"202"},"ts":"1561631244"},"url":""}},"prompt":"ã€å“ˆå°”æ»¨ã€‘å¤šäº‘ 17Â°/29Â°, 18:13æ›´æ–°~","ver":"1.0.0.106","view":"WeatherThreeView"}]]
--[[                    [[{"app":"com.tencent.weather","desc":"å¤©æ°”","view":"RichInfoView","ver":"1.0.0.217","prompt":"[åº”ç”¨]å¤©æ°”","meta":{"richinfo":{"adcode":"%s","air":"%s","city":"%s","date":"%s","max":"%s","min":"%s","ts":"1554951408","type":"%s","wind":"%s"}},"config":{"forward":1,"autosize":1,"type":"card"}}]],
--[[                    j.data.adcode,
                    j.data.air,
                    j.data.city,
                    j.data.date,
                    j.data.max,
                    j.data.min,
                    j.data.type,
                    j.data.wind
                ),
                atUser = 0
            }
        )
end
--]]
--è°ƒæ•™å¤„ç†å‡½æ•°(å¾…å¤„ç†)
function tiaojiao(CurrentQQ,data)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
	if (mim == nil) then
		sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå“‡")
		return 1
	end
	if (string.find(data.Content, "^åˆ é™¤è°ƒæ•™")) then
	    msg = data.Content:gsub("åˆ é™¤è°ƒæ•™", "")
	    if (msg == "") then
		    sedmsg(CurrentQQ,data,"è¦åˆ é™¤çš„è°ƒæ•™æŒ‡ä»¤ä¸èƒ½ä¸ºç©ºå“¦")
		    return 1
		end
		rese = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..tostring(data.FromGroupId).."\/"..msg..".txt")
	    if (rese == nil) then
			sedmsg(CurrentQQ,data,"è¿™ä¸ªæŒ‡ä»¤ä¸å­˜åœ¨äº†å“¦")
		    return 1
		end
		rm_file = os.remove("mimoio\/æœºå™¨è°ƒæ•™\/"..tostring(data.FromGroupId).."\/"..msg..".txt")
		log.info("åˆ é™¤è°ƒæ•™ ====> %s", rm_file)
		sedmsg(CurrentQQ,data,"åˆ é™¤æˆåŠŸ\nä½ ä¸å–œæ¬¢è¢«è¿™æ ·è°ƒæ•™çš„æˆ‘å—[è¡¨æƒ…9]")
		return 1
	end
    msgs = data.Content:gsub("è°ƒæ•™", "")
		res2 = string.find(msgs, "#")
		str = string.sub(msgs,res2+1)
		str2 = string.sub(msgs,1,res2-1)
		        
		        if (str == "") then
		            sedmsg(CurrentQQ,data,"è°ƒæ•™çš„å›ç­”å†…å®¹ä¸èƒ½ä¸ºç©ºå“¦")
			        return 1
		        end
				if (str2 == "") then
		            sedmsg(CurrentQQ,data,"è°ƒæ•™çš„æŒ‡ä»¤å†…å®¹ä¸èƒ½ä¸ºç©ºå“¦")
			        return 1
		        end
		        rese = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..str2..".txt")
					if (rese ~= nil) then
				        sedmsg(CurrentQQ,data,"æŒ‡ä»¤å·²ç»å­˜åœ¨äº†å“¦")
				        return 1
				    end
				Wirte("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..str2..".txt",str)
				sedmsg(CurrentQQ,data,"è°ƒæ•™æˆåŠŸ\nä½ è¿˜æƒ³å†è°ƒæ•™æˆ‘ä¸€æ¬¡å—[è¡¨æƒ…6]")
		        return 1
end

function url_encode(str)
    if (str) then
        str = string.gsub(str, "\n", "\r\n")
        str =
            string.gsub(
            str,
            "([^%w ])",
            function(c)
                return string.format("%%%02X", string.byte(c))
            end
        )
        str = string.gsub(str, " ", "+")
    end
    return str
end

--æŠ¢çº¢åŒ…å¤„ç†
function RedBag(CurrentQQ, data)
    Api.Api_OpenRedBag(CurrentQQ, data.RedBaginfo)
    if (data.RedBaginfo.RedType == 12) then
         luaRes =
                Api.Api_SendMsg(
                CurrentQQ,
                {
                    toUser = data.FromGroupId,
                    sendToType = 2,
                    sendMsgType = "TextMsg",
                    groupid = 0,
                    content = data.RedBaginfo.Tittle,
                    atUser = 0
                }
            )
        log.notice("From Lua SendMsg Ret\n%d", luaRes.Ret)
    end
end

--è§†é¢‘è§£æå¤„ç†
function Video(CurrentQQ, data)
    vdata = json.decode(data.Content)
        videodata = {
            GroupID = data.FromGroupId,
            VideoUrl = vdata.VideoUrl,
            VideoMd5 = vdata.VideoMd5
        }
        --æ„é€ table å‚æ•°è¡¨
        luaResp = Api.Api_CallFunc(CurrentQQ, "PttCenterSvr.ShortVideoDownReq", videodata) --é€šè¿‡cmdè°ƒç”¨åŠŸèƒ½åŒ…
        luaRes =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "TextMsg",
                groupid = 0,
                content = "è§£æè§†é¢‘URL-->" .. luaResp.VideoUrl,
                atUser = 0
            }
        )
end

--ç®¡ç†å¼€å…³é€šç”¨
function adminio(CurrentQQ,data,oio)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim ~= nil) then
            msg = data.Content:gsub(oio, "")
            str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
            if (string.find(str, "å…³é—­")) then
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äººå·²è¢«å…³é—­...\nè¯·å…ˆå¼€å¯æœºå™¨äºº")
                return 1
            end
			str2 = Read("mimoio\/çŠ¶æ€æ•°æ®\/"..oio.."\/"..data.FromGroupId..".txt")
			if (string.find(str2, msg)) then
			    sedmsg(CurrentQQ,data,"âˆ´"..oio.."æœ¬å°±æ˜¯"..str2.."çŠ¶æ€")
                return 1
			end
            Wirte("mimoio\/çŠ¶æ€æ•°æ®\/"..oio.."\/"..data.FromGroupId..".txt",msg)
            sedmsg(CurrentQQ,data,"âˆ´"..oio..msg.."æˆåŠŸ")
            return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
end

--ç™¾ç§‘å¤§å…¨
function baike(CurrentQQ,data)
    keyWord = data.Content:gsub("ç™¾ç§‘", "")
        if keyWord == "" then
            return 1
        end
        response, error_message =
            http.request(
            "GET",
            "http://baike.baidu.com/api/openapi/BaikeLemmaCardApi",
            {
                query = "scope=103&format=json&appid=379020&bk_key=" .. url_encode(keyWord) .. "&bk_length=600"
            }
        )
        html = response.body
        while(string.find(html, '"errno":2')) do
            response, error_message =
            http.request(
            "GET",
            "http://baike.baidu.com/api/openapi/BaikeLemmaCardApi",
            {
                query = "scope=103&format=json&appid=379020&bk_key=" .. url_encode(keyWord) .. "&bk_length=600"
            })
			html = response.body
        end
        local j = json.decode(html)
        sedmsg(CurrentQQ,data,j.abstract.."\n"..j.url)
end

--éŸ³ä¹ç‚¹æ­Œ
function music(CurrentQQ,data)
    keyWord = data.Content:gsub("ç‚¹æ­Œ", "")
        if keyWord == "" then
            return 1
        end
        response, error_message =
            http.request(
            "GET",
            "https://c.y.qq.com/soso/fcgi-bin/client_search_cp",
            {
                query = "aggr=1&cr=1&flag_qc=0&p=1&n=6&w=" .. url_encode(keyWord)
            }
        )
        html = response.body
		str = string.sub(html,10,-2)
        j = json.decode(str)
        if (j.code == 0) then
            msg = ""
            num = j.data.song.list
            list = num[1]
            songname = list.songname
            singername = list.singer[1].name
            payplay = list.pay.payplay
			albummid = list.albummid
			songmid = list.songmid
	        sedjsonmsg(CurrentQQ,data,'{"app":"com.tencent.structmsg","desc":"éŸ³ä¹","view":"music","ver":"0.0.0.1","prompt":"[åˆ†äº«]' ..songname.. '","meta":{"music":{"sourceMsgId":"0","title":"' ..songname.. '","desc":"' ..singername.. '","preview":"y.gtimg.cn/music/photo_new/T002R150x150M000'..albummid..'.jpg","tag":"QQéŸ³ä¹","musicUrl":"https://v1.itooi.cn/tencent/url?id='..songmid..'","jumpUrl":"y.qq.com/n/yqq/song/'..songmid..'.html","appid":100497308,"app_type":1,"action":"","source_url":"url.cn/5aSZ8Gc","source_icon":"url.cn/5tLgzTm","android_pkg_name":"com.tencent.qqmusic"}},"config":{"forward":true,"type":"normal","autosize":true}}')
			return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´Error:"..j.code)
			return 1
        end
end

--è®¿é—®url
function geturl(url_class,url,caulrt)
        response, error_message =
            http.request(
            url_class,
            url,
            {
                query = caulrt
            }
        )
        html = response.body
		return html
end

--æ¶ˆæ¯å‚¨è“„
function msgsql(CurrentQQ,data)
    if (mysqlpass == "") then
	    return 1
	end
    c = mysql.new()
    -- åˆå§‹åŒ–mysqlå¯¹è±¡
    ok, err = c:connect({host = mysqlhost, port = 3306, database = mysqldb, user = mysqluser, password = mysqlpass})
    --å»ºç«‹è¿æ¥
    if ok then
        sqlstr =
            string.format(
            [[INSERT INTO msgcache (GroupID, MsgSeq, MsgRandom,MsgType,Data,MsgTime)VALUES (%d,%d,%d,'%s','%s',%d)]],
            data.FromGroupId,
            data.MsgSeq,
            data.MsgRandom,
            data.MsgType,
            data.Content,
            data.MsgTime
        )
        res, err = c:query(sqlstr) --å…¥åº“ç¼“å­˜æ¶ˆæ¯
        log.info("%s", err)
        c.close(c)
    --é‡Šæ”¾è¿æ¥
    end
    return 1
end

--æ’¤å›æ£€æµ‹
function CheHui(CurrentQQ, data, extData)
    c = mysql.new()
    -- åˆå§‹åŒ–mysqlå¯¹è±¡
	if (mysqlpass == "") then
	    return 1
	end
	
    if data.MsgType == "ON_EVENT_GROUP_REVOKE" then --ç›‘å¬ ç¾¤æ’¤å›äº‹ä»¶
        str = string.format("ç¾¤æˆ %d  æˆå‘˜ UserID %s æ’¤å›äº†æ¶ˆæ¯Seq %s \n", extData.GroupID, extData.UserID, extData.MsgSeq)
        log.info("%s", str)
        ok, err = c:connect({host = mysqlhost, port = 3306, database = mysqldb, user = mysqluser, password = mysqlpass})
        --å»ºç«‹è¿æ¥
        log.info("sql %v", err)
        if ok then
            sqlstr =
                string.format(
                "select * from msgcache where `GroupID`= %d and `MsgSeq` = %d",
                extData.GroupID,
                extData.MsgSeq
            )
            res, err = c:query(sqlstr) --è·Ÿç¾¤ç¾¤idå’Œæ¶ˆæ¯SEQæŸ¥è¯¢å‡ºæ’¤å›çš„æ¶ˆæ¯å†…å®¹
            if err == nil then
                c.close(c)
                GroupID = tonumber(res[1]["GroupID"])
                MsgType = res[1]["MsgType"]
                Data = res[1]["Data"]

                if MsgType == "TextMsg" then
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            --å‘é€æ–‡æœ¬æ¶ˆæ¯
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡æ–‡æœ¬æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                Data
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "SmallFaceMsg" then
                    --Data {"Content":"[è¡¨æƒ…101]","Hex":"FKY=","Index":101,"tips":"[å°è¡¨æƒ…]"}
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡è¡¨æƒ…æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).Content
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "PicMsg" then
                    --Data {"Content":"","FileId":2820717626,"FileMd5":"q0oEC5aloJJMFr10mplaXw==","FileSize":7026,"tips":"[ç¾¤å›¾ç‰‡]","url":"http://gchat.qpic.cn/gchatpic_new/1700487478/960839480-2534335053-AB4A040B96A5A0924C16BD749A995A5F/0?vuin=u0026term=255u0026pictype=0"}
                    jData = json.decode(Data)
					if (jData.tips == "[ç¾¤æ¶ˆæ¯-QQé—ªç…§]") then
					    
					Api.Api_SendMsg( 
                    CurrentQQ,
                    {
                        toUser = GroupID,
                        sendToType = 2,
                        sendMsgType = "ForwordMsg",
                        content = "",
                        atUser = 0,
                        groupid = 0,
                        voiceUrl = "",
                        voiceBase64Buf = "",
                        picUrl = "",
                        picBase64Buf = "",
                        forwordBuf = json.decode(Data).ForwordBuf, --æ¬²è½¬å‘çš„base64buf å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                        forwordField = json.decode(Data).ForwordField --æ¬²å†™å…¥åè®®çš„å­—æ®µID å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                    }
                )
				    return 1
					end
                    Api.Api_SendMsg( --é€šè¿‡å›¾ç‰‡md5å‘é€å›¾ç‰‡ ç§’å‘ä¸ç”¨ä¸Šä¼  ç›¸å½“äºè½¬å‘
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "PicMsg",
                            --å‘é€å›¾æ–‡æ¶ˆæ¯
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡å›¾ç‰‡æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š[PICFLAG]%s",
                                extData.UserID,
                                jData.Content
                            ),
                            --é€šè¿‡å®[PICFLAG]æ”¹å˜å›¾æ–‡é¡ºåº  æ”¹ä¸ºç°æ–‡å­—åå›¾ç‰‡
                            atUser = 0,
                            voiceUrl = "",
                            voiceBase64Buf = "",
                            picUrl = "",
                            picBase64Buf = "",
                            fileMd5 = jData.FileMd5
                        }
                    )
                end
                if MsgType == "AtMsg" then
                    --Data {"Content":"@Kar98k skjjkssjkjs","UserID":123456789,"tips":"[ATæ¶ˆæ¯]"}
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡atæ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).Content
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "VoiceMsg" then
                    --Data {"tips":"[è¯­éŸ³]","url":"http://grouptalk.c2c.qq.com/?ver=0u0026rkey=3062020101045b305902010102010102041fdef8ae042439416931554e5142586c536d78706a314c686843664959725f327a5f573064697653755902045dac2a21041f0000000866696c6574797065000000013100000005636f64656300000001310400u0026filetype=1u0026voice_codec=1"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "VoiceMsg",
                            --å‘é€ç¾¤è¯­éŸ³æ¶ˆæ¯
                            groupid = 0,
                            content = "",
                            atUser = 0,
                            voiceUrl = json.decode(Data).url,
                            --é€šè¿‡ç½‘ç»œurlè¿›è¡Œå‘é€è¯­éŸ³
                            voiceBase64Buf = "",
                            picUrl = "",
                            picBase64Buf = ""
                        }
                    )
                end

                if MsgType == "ReplayMsg" then
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡å›å¤æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).ReplayContent
                            ),
                            atUser = 0
                        }
                    )
                end
				if MsgType == "VideoMsg" then
	             Api.Api_SendMsg( 
                    CurrentQQ,
                    {
                        toUser = GroupID,
                        sendToType = 2,
                        sendMsgType = "ForwordMsg",
                        content = "",
                        atUser = 0,
                        groupid = 0,
                        voiceUrl = "",
                        voiceBase64Buf = "",
                        picUrl = "",
                        picBase64Buf = "",
                        forwordBuf = json.decode(Data).ForwordBuf, --æ¬²è½¬å‘çš„base64buf å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                        forwordField = json.decode(Data).ForwordField --æ¬²å†™å…¥åè®®çš„å­—æ®µID å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                    }
                )
				end
                if MsgType == "XmlMsg" then
				    
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "XmlMsg",
                            groupid = 0,
                            content = string.format("%s", Data),
                            atUser = 0
                        }
                    )
                end
				if MsgType == "JsonMsg" then
				    
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "JsonMsg",
                            groupid = 0,
                            content = string.format("%s", Data),
                            atUser = 0
                        }
                    )
                end
            end
        end
    end
    return 1
end
2020/09/07 12:54:50.164 [E]  mimoio.lua
2020/09/07 12:54:50.169 [E]  local log = require("log")
local Api = require("coreApi")
local json = require("json")
local http = require("http")
local mysql = require("mysql")

--ç‰ˆæœ¬å·(ä¸è¦æ”¹åŠ¨)
Vabr = "1.0.2"
--æ•°æ®åº“é…ç½®
mysqlhost = "localhost"--é»˜è®¤ä¸åŠ¨
mysqldb = "ffaxx001"--æ•°æ®åº“å
mysqluser = "ffaxx001"--æ•°æ®åº“ç”¨æˆ·å
mysqlpass = "123456"--æ•°æ®åº“å¯†ç 
--ä¸ä½¿ç”¨è¯·ä¸è¦æ”¹åŠ¨

function ReceiveFriendMsg(CurrentQQ, data)
    if (data.Content == "ä½¿ç”¨æ–¹æ³•") then
	    sendfrimsg(CurrentQQ,data,"æ·»åŠ æˆæƒè€…çš„æ–¹æ³•\nå¯¹å•ä¸ªæœºå™¨äººç§èŠå‘é€[æ·»åŠ æˆæƒè€…+æˆæƒè€…QQ]\n\næˆæƒç¾¤çš„æ–¹æ³•\nåˆ°éœ€è¦æˆæƒçš„ç¾¤é‡Œå‘é€[æˆæƒ+ä¸»äººQQ]ã€‚æ³¨æ„:æˆæƒå¿…é¡»æ˜¯æˆæƒè€…è¿›è¡Œæ“ä½œ,ç®¡ç†å‘˜æˆæƒä¸äº†")
	end
    --æ•°æ®åˆå§‹åŒ–
    if (data.Content == "åˆå§‹åŒ–") then
	    root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root ~= nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´è¯·ä¸è¦é‡å¤åˆå§‹åŒ–")
			return 1
		end
    --os.execute('mkdir mimoio/æœºå™¨æˆæƒ')
	    os.execute('mkdir mimoio')
		os.execute('mkdir mimoio/å¤è¯»æœº')
		os.execute('mkdir mimoio/å¤è¯»æœº/æ¬¡æ•°')
		os.execute('mkdir mimoio/å¤è¯»æœº/å†…å®¹')
		os.execute('mkdir mimoio/æœºå™¨æˆæƒ')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨ä¸»äºº')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨èŠå¤©')
		os.execute('mkdir mimoio/æœºå™¨è°ƒæ•™')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æŠ¢çº¢åŒ…')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æœºå™¨èŠå¤©')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æœºå™¨å¼€å…³')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æ’¤å›æ£€æµ‹')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/å›¾ç‰‡è§£æ')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/è§†é¢‘è§£æ')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/é—ªç…§æ£€æµ‹')
		Wirte("mimoio\/"..data.FromUin..".txt","999")
		sendfrimsg(CurrentQQ,data,"åˆå§‹åŒ–å®Œæ¯•ï¼\nå‘é€[ä½¿ç”¨æ–¹æ³•]äº†è§£ä½¿ç”¨å§")
	end
	--æ·»åŠ æˆæƒè€…æ“ä½œ(ç§èŠæœºå™¨äººå‘é€)
	if (string.find(data.Content, "^æ·»åŠ æˆæƒè€…")) then
	    msg = data.Content:gsub("æ·»åŠ æˆæƒè€…", "")
		--Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromUin..".txt","å…³é—­")
		root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root == nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„ç®¡ç†è€…")
			return 1
		end
		Wirte("mimoio\/æœºå™¨æˆæƒ\/"..msg..CurrentQQ..".txt","999")
		sendfrimsg(CurrentQQ,data,"âˆ´æ·»åŠ æˆæƒè€…æˆåŠŸ")
	end
	--åˆ é™¤æˆæƒè€…æ“ä½œ(ç§èŠæœºå™¨äººå‘é€)
	if (string.find(data.Content, "^åˆ é™¤æˆæƒè€…")) then
	    msg = data.Content:gsub("åˆ é™¤æˆæƒè€…", "")
		--Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromUin..".txt","å…³é—­")
		root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root == nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„ç®¡ç†è€…")
			return 1
		end
		os.remove("mimoio\/æœºå™¨æˆæƒ\/"..msg..CurrentQQ..".txt")
		sendfrimsg(CurrentQQ,data,"âˆ´åˆ é™¤æˆæƒè€…æˆåŠŸ")
	end
    return 1
end
function ReceiveGroupMsg(CurrentQQ, data)
    if (tostring(data.FromUserId) == CurrentQQ) then
	    return 1
	end
	--ç¾¤èŠæˆæƒ(åˆ°éœ€è¦æˆæƒçš„ç¾¤é‡Œæ“ä½œ)
	if (string.find(data.Content, "^æˆæƒ")) then
	    root = Read("mimoio\/æœºå™¨æˆæƒ\/"..data.FromUserId..CurrentQQ..".txt","999")
		if (root == nil) then
		    sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„æˆæƒè€…")
			return 1
		end
		msg = data.Content:gsub("æˆæƒ", "")
		os.execute('mkdir mimoio/æœºå™¨è°ƒæ•™/'..data.FromGroupId)
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨ä¸»äºº/'..data.FromGroupId)
		Wirte("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..msg..".txt","999")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt","å›å¤èŠå¤©")
		sedmsg(CurrentQQ,data,"âˆ´æˆæƒæˆåŠŸï¼\nå‘é€[å¼€å¯æœºå™¨äºº]ä½¿ç”¨å§")
	end
	--åˆ é™¤æˆæƒæ“ä½œ(åˆ°éœ€è¦åˆ é™¤æˆæƒçš„ç¾¤é‡Œæ“ä½œ)
	if (string.find(data.Content, "^åˆ é™¤æˆæƒ")) then
	    root = Read("mimoio\/æœºå™¨æˆæƒ\/"..data.FromUserId..CurrentQQ..".txt","999")
		if (root == nil) then
		    sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„æˆæƒè€…")
			return 1
		end
		msg = data.Content:gsub("åˆ é™¤æˆæƒ", "")
		os.remove("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..msg..".txt")
		os.remove("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
		sedmsg(CurrentQQ,data,"âˆ´åˆ é™¤æˆæƒæˆåŠŸï¼")
	end
	--æœºå™¨å¼€å…³æŒ‡ä»¤
	if (data.Content == "å¼€å¯æœºå™¨äºº" or data.Content == "å…³é—­æœºå™¨äºº") then
        mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim ~= nil) then
            msg = data.Content:gsub("æœºå™¨äºº", "")
            str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
			if (str == nil) then
			    Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt",msg)
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äºº"..msg.."æˆåŠŸï¼")
				log.info("Str ====> %s", str)
                return 1
			end
			
            if (string.find(str, msg)) then
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äººä¸€ç›´æ˜¯"..msg.."çš„å‘")
                return 1
            end
            Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt",msg)
            sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äºº"..msg.."æˆåŠŸï¼")
            return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
	end
    --æœºå™¨äººå¼€å¯æ£€æµ‹
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
	if (str == nil) then
	    log.info("Str ====> %s", str)
        return 1
	end
	if (string.find(str, "å…³é—­")) then
	    return 1
	end
	--atæ¶ˆæ¯å¤„ç†
	msgs = ""
	atqq = 0
	if (string.find(data.Content, "ATæ¶ˆæ¯")) then
	    msgs = json.decode(data.Content).Content
		atqq = json.decode(data.Content).UserID
	end
	--å°¾å·´è‡ªå®šä¹‰(å¾…å®Œå–„)
	tips = "â€”â€”å‡¤é£ç¿±ç¿”å…®ä¸·"
    --åŠŸèƒ½æ¨¡å—
    if (data.Content == "åŠŸèƒ½" or data.Content == "ä¸»ç•Œé¢") then
        face = faceArray()
        sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."å½±è§†æœç´¢\n"..face.."èŠå¤©å¨±ä¹\n"..face.."ä¾¿åˆ©åŠŸèƒ½\n"..face.."æœºå™¨è°ƒæ•™\n"..face.."ç®¡ç†ç³»ç»Ÿ\n"..face.."bugåé¦ˆ\n"..face.."æœ¬ç¾¤çŠ¶æ€\n"..face.."æ›´æ–°æ£€æµ‹\n\n"..tips)
    end
    --å½±è§†æœç´¢æ¨¡å—
    if (data.Content == "å½±è§†æœç´¢") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."æœç´¢+å½±è§†å\n"..face.."æˆ‘æƒ³çœ‹+å½±è§†å\n"..face.."æˆ‘è¦çœ‹+å½±è§†å\n\n"..tips)
    elseif (string.find(data.Content, "^æœç´¢")) then
	    msg = data.Content:gsub("æœç´¢", "")
		Sousuo(CurrentQQ,data,msg)
	elseif (string.find(data.Content, "^æˆ‘æƒ³çœ‹")) then
	    msg = data.Content:gsub("æˆ‘æƒ³çœ‹", "")
		Sousuo(CurrentQQ,data,msg)
    elseif (string.find(data.Content, "^æˆ‘è¦çœ‹")) then
	    msg = data.Content:gsub("æˆ‘è¦çœ‹", "")
		Sousuo(CurrentQQ,data,msg)
	end
	--èŠå¤©å¨±ä¹æ¨¡å—
	if (data.Content == "èŠå¤©å¨±ä¹") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."åˆ‡æ¢æ–‡å­—èŠå¤©\n"..face.."åˆ‡æ¢å›å¤èŠå¤©\n"..face.."åˆ‡æ¢è¯­éŸ³èŠå¤©\n\n"..tips)
    elseif (data.Content == "åˆ‡æ¢æ–‡å­—èŠå¤©") then
		liaotian(CurrentQQ,data,1)
	elseif (data.Content == "åˆ‡æ¢è¯­éŸ³èŠå¤©") then
	    liaotian(CurrentQQ,data,2)
    elseif (data.Content == "åˆ‡æ¢å›å¤èŠå¤©") then
	    liaotian(CurrentQQ,data,3)
	else
	    ownthink(CurrentQQ,data,msgs,atqq)
	end
	--ä¾¿åˆ©åŠŸèƒ½æ¨¡å—
	if (data.Content == "ä¾¿åˆ©åŠŸèƒ½") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."ç™¾ç§‘å¤§å…¨\n"..face.."éŸ³ä¹ç‚¹æ­Œ\n"..face.."é—ªä»–@xx\n"..face.."å¤©æ°”æŸ¥è¯¢\n\n"..tips)
	elseif (data.Content == "ç™¾ç§‘å¤§å…¨") then
		sedmsg(CurrentQQ,data,"å‘é€:[ç™¾ç§‘+å…³é”®è¯]\nä¾‹å¦‚:ç™¾ç§‘æ´›å¦¾èº«")
    elseif (data.Content == "éŸ³ä¹ç‚¹æ­Œ") then
		sedmsg(CurrentQQ,data,"å‘é€:[ç‚¹æ­Œ+æ­Œå]\nä¾‹å¦‚:ç‚¹æ­Œé’æŸ ")
	elseif (data.Content == "å¤©æ°”æŸ¥è¯¢") then
		sedmsg(CurrentQQ,data,"å‘é€:[å¤©æ°”+åœ°æ–¹å]\nä¾‹å¦‚:å¤©æ°”åŒ—äº¬(é™äºå›½å†…)")
    elseif (string.find(data.Content, "^å¤©æ°”")) then
        tianqi(CurrentQQ,data)
	    --msg = data.Content:gsub("æœç´¢", "")
		--Sousuo(CurrentQQ,data,msg)
	elseif (string.find(data.Content, "^ç™¾ç§‘")) then
	    baike(CurrentQQ,data)
	    --msg = data.Content:gsub("æˆ‘æƒ³çœ‹", "")
		--Sousuo(CurrentQQ,data,msg)music(CurrentQQ,data)
    elseif (string.find(data.Content, "^ç‚¹æ­Œ")) then
	    music(CurrentQQ,data)
	end
	--æœºå™¨è°ƒæ•™æ¨¡å—
	if (data.Content == "æœºå™¨è°ƒæ•™") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."æ–‡å­—è°ƒæ•™\n"..face.."è¯­éŸ³è°ƒæ•™\n"..face.."å”±æ­Œè°ƒæ•™\n"..face.."éŸ³ä¹è°ƒæ•™\n"..face.."å›¾ç‰‡è°ƒæ•™\n"..face.."åˆ é™¤è°ƒæ•™\n\n"..tips)
    elseif (data.Content == "æ–‡å­—è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#(å†…å®¹)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#ä½ å¥½å•Š")
	elseif (data.Content == "è¯­éŸ³è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#è¯­éŸ³(å†…å®¹)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#è¯­éŸ³ä½ å¥½å•Š")
	elseif (data.Content == "å›¾ç‰‡è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#å›¾ç‰‡(é“¾æ¥)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#å›¾ç‰‡http://../1.jpg")
	elseif (data.Content == "éŸ³ä¹è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#ç‚¹æ­Œ(æ­Œå)]\nä¾‹å¦‚:è°ƒæ•™å–µ#ç‚¹æ­Œå­¦çŒ«å«")
	elseif (data.Content == "å”±æ­Œè°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#å”±æ­Œ(æ­Œå)]\nä¾‹å¦‚:è°ƒæ•™å–µ#å”±æ­Œå­¦çŒ«å«")
	elseif (data.Content == "åˆ é™¤è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[åˆ é™¤è°ƒæ•™(æŒ‡ä»¤)]\nä¾‹å¦‚:åˆ é™¤è°ƒæ•™ä½ å¥½")
	elseif (string.find(data.Content, "^è°ƒæ•™")) then
        tiaojiao(CurrentQQ,data)
	elseif (string.find(data.Content, "^åˆ é™¤è°ƒæ•™")) then
        tiaojiao(CurrentQQ,data)
	end
	--ç®¡ç†ç³»ç»Ÿæ¨¡å—
	if (data.Content == "ç®¡ç†ç³»ç»Ÿ") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."å¼€å¯/å…³é—­æœºå™¨äºº\n"..face.."å¼€å¯/å…³é—­æŠ¢çº¢åŒ…\n"..face.."å¼€å¯/å…³é—­æœºå™¨èŠå¤©\n"..face.."å¼€å¯/å…³é—­é—ªç…§æ£€æµ‹\n"..face.."å¼€å¯/å…³é—­å›¾ç‰‡è§£æ\n"..face.."å¼€å¯/å…³é—­è§†é¢‘è§£æ\n"..face.."å¼€å¯/å…³é—­æ’¤å›æ£€æµ‹\n\n"..tips)
    elseif (data.Content == "å¼€å¯æœºå™¨èŠå¤©" or data.Content == "å…³é—­æœºå™¨èŠå¤©") then
        adminio(CurrentQQ,data,"æœºå™¨èŠå¤©")
    elseif (data.Content == "å¼€å¯æ’¤å›æ£€æµ‹" or data.Content == "å…³é—­æ’¤å›æ£€æµ‹") then
        adminio(CurrentQQ,data,"æ’¤å›æ£€æµ‹")
	elseif (data.Content == "å¼€å¯é—ªç…§æ£€æµ‹" or data.Content == "å…³é—­é—ªç…§æ£€æµ‹") then
        adminio(CurrentQQ,data,"é—ªç…§æ£€æµ‹")
	elseif (data.Content == "å¼€å¯æŠ¢çº¢åŒ…" or data.Content == "å…³é—­æŠ¢çº¢åŒ…") then
        adminio(CurrentQQ,data,"æŠ¢çº¢åŒ…")
	elseif (data.Content == "å¼€å¯è§†é¢‘è§£æ" or data.Content == "å…³é—­è§†é¢‘è§£æ") then
        adminio(CurrentQQ,data,"è§†é¢‘è§£æ")
	elseif (data.Content == "å¼€å¯å›¾ç‰‡è§£æ" or data.Content == "å…³é—­å›¾ç‰‡è§£æ") then
        adminio(CurrentQQ,data,"å›¾ç‰‡è§£æ")
	end
	--bugåé¦ˆæ¨¡å—
	if (data.Content == "BUGåé¦ˆ" or data.Content == "bugåé¦ˆ") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."é‚®ä»¶åé¦ˆ\n"..face.."QQåé¦ˆ\n\n"..tips)
    elseif (data.Content == "QQåé¦ˆ") then
        sedmsg(CurrentQQ,data,"???Î£(ï¾Ÿâˆ€ï¾Ÿï¾‰)ï¾‰\næ’ä»¶æœ‰é—®é¢˜å¯ä»¥åé¦ˆåˆ°:\nQQ:2353065854")
    elseif (data.Content == "é‚®ä»¶åé¦ˆ") then
        sedmsg(CurrentQQ,data,"å®è´å’‹å•¦=ÍÍŸÍŸÍ(ê’ªá—œê’ª â€§Ì£Ì¥Ì‡)\næ’ä»¶æœ‰é—®é¢˜å¯ä»¥åé¦ˆåˆ°:\né‚®ç®±ğŸ“¬:ym-o@qq.com")
	end
	--æœ¬ç¾¤çŠ¶æ€æ¨¡æ¿
	if (data.Content == "æœ¬ç¾¤çŠ¶æ€") then
        face = faceArray()
        hb = Read("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt")
        sz = Read("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt")
		tp = Read("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt")
        sp = Read("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt")
        jqr = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
        lt = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
        ch = Read("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..data.FromGroupId..".txt")
		sedmsg(CurrentQQ,data,"çŠ¶æ€æ•°æ®åˆ—è¡¨â†“â†“â†“\n"..face.."æœºå™¨äºº:"..jqr.."\n"..face.."æŠ¢çº¢åŒ…:"..hb.."\n"..face.."å›¾ç‰‡è§£æ:"..tp.."\n"..face.."æ’¤å›æ£€æµ‹:"..ch.."\n"..face.."è§†é¢‘è§£æ:"..sp.."\n"..face.."æœºå™¨èŠå¤©:"..lt.."\n"..face.."é—ªç…§æ£€æµ‹:"..sz.."\n\n"..tips)
	end
	--æ›´æ–°æ¨¡å—
	if (data.Content == "æ›´æ–°æ£€æµ‹") then
        str = geturl("GET","http://118.25.41.32/Lsb/lua/Vabr.txt","")
		log.info("Str ====> %s", str)
        if (string.find(str, Vabr)) then
            sedmsg(CurrentQQ,data,"å½“å‰ç‰ˆæœ¬ä¸ºæœ€æ–°ç‰ˆ")
        else
            sedmsg(CurrentQQ,data,"å‘ç°æ–°ç‰ˆæœ¬!\nå½“å‰ç‰ˆæœ¬:"..Vabr.."\næ–°ç‰ˆæœ¬å·:"..str.."\nèµ¶å¿«å‘é€[æ›´æ–°æ’ä»¶]å§")
        end
	elseif (data.Content == "æ›´æ–°æ’ä»¶") then
	    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim == nil) then
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
        str = geturl("GET","http://118.25.41.32/Lsb/lua/Vabr.txt","")
		log.info("Str ====> %s", str)
        if (string.find(str, Vabr)) then
            sedmsg(CurrentQQ,data,"å½“å‰ç‰ˆæœ¬ä¸ºæœ€æ–°ç‰ˆ")
        else
            str = geturl("GET","http://118.25.41.32/Lsb/lua/mimoio.txt","")
            Wirte("Plugins\/mimoio.lua",str)
            sedmsg(CurrentQQ,data,"æ›´æ–°å®Œæ¯•ï¼")
        end
	end
	--å›¾ç‰‡ç±»å‹æ¶ˆæ¯å¤„ç†
    if (data.MsgType == "PicMsg") then
	    msg = Read("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt")
		jData = json.decode(data.Content)
	    if (msg ~= nil and jData.tips ~= "[ç¾¤æ¶ˆæ¯-QQé—ªç…§]") then
            if (string.find(str, "å¼€å¯")) then
	            sedmsg(CurrentQQ,data,"å›¾ç‰‡é“¾æ¥è§£æå¦‚ä¸‹â†“â†“\n"..jData.url)
				return 1
	        end
	    end
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt")
	    if (str == nil) then
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    --é—ªç…§ã€å›¾ç‰‡å¤„ç†æ¨¡å—
		PicFlag(CurrentQQ, data)
    end
	--æŠ¢çº¢åŒ…å¤„ç†
	if (string.find(data.MsgType, "RedBagMsg") == 1) then
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt")
		if (str == nil) then
	        log.info("Str ====> %s", str)
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    RedBag(CurrentQQ, data)
	end
	--è§†é¢‘è§£æå¤„ç†
	if (string.find(data.MsgType, "VideoMsg") == 1) then
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt")
		if (str == nil) then
	        log.info("Str ====> %s", str)
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    Video(CurrentQQ, data)
	end
	--até—ªå›¾
	if (data.MsgType == "AtMsg") and (string.find(data.Content, "é—ªä»–")) then
	    shantu(CurrentQQ, data)
    end
	--è°ƒæ•™æœç´¢å¼•æ“
	mim = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..data.Content..".txt")
	if (mim == nil) then
	    --äººç±»çš„æœ¬è´¨æ˜¯å¤è¯»æœº
	    msg = Read("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt")
		if (msg ~= nil) then
		    cs = Read("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt")
			ii = tonumber(cs)
			if (string.find(msg, "^"..data.Content.."$")) then
			    if (ii > 2) then
			         math.randomseed(os.time())
                     sj = math.random(1, 5)
		             if (sj == 1 or sj == 2) then
			             sedmsg(CurrentQQ,data,msg)
					     rr = ii + 1
		                 Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
				     elseif (sj == 3) then
				         os.remove("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt")
					     os.remove("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt")
					     fdArray = {"çªç„¶æˆªæ–­å¤è¯»(ï¾ŸâŠ¿ï¾Ÿ)ï¾‚","å¤è¯»å¯è€»(â€¢Ì€ã¸ â€¢Ì â•® )","ä¸è¦å¤è¯»äº†å•¦","è¿™å°±æ˜¯æ‰€è°“çš„äººç±»çš„æœ¬è´¨","ä½ ä»¬å’‹ä¸ä¸Šå¤©å‘","åˆå¤è¯»ä¸Šç˜¾äº†å•Š"}
                         math.randomseed(os.time())
                         fdsj = math.random(1, 6)
				         sedmsg(CurrentQQ,data,fdArray[fdsj])
				     else
			             rr = ii + 1
		                 Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
		             end
			    else
			        rr = ii + 1
		            Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
			    end
			else
			    if (ii > 2) then
			        math.randomseed(os.time())
                    sj2 = math.random(1, 3)
					if (sj2 == 2) then
					    fdArray2 = {"ä¸­æ–­å¤è¯»å¯è€»","æ‰“æ–­å¤è¯»å¯è€»(â€¢Ì€ã¸ â€¢Ì â•® )","ä½ ä¸ºä»€ä¹ˆè¦æ‰“æ–­å¤è¯»å•Š","å¤è¯»ä¸é¦™å˜›","ç ´åæ°›å›´(à¸‡áµ’ÌŒçš¿áµ’ÌŒ)à¸‡â¼Â³â‚Œâ‚ƒ"}
                        math.randomseed(os.time())
                        fdsj2 = math.random(1, 5)
				        sedmsg(CurrentQQ,data,fdArray2[fdsj2])
					end
				end
				Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt","1")
			    Wirte("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt",data.Content)
			end
		else
		    Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt","1")
			Wirte("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt",data.Content)
		end
	    --å¦‚æœè°ƒæ•™æŒ‡ä»¤ä¸å­˜åœ¨ï¼Œåˆ™è¿›è¡Œå…¶ä»–æ“ä½œ
	    msgsql(CurrentQQ,data)--æ•°æ®å‚¨è“„
		--éšæœºå›å¤æ¶ˆæ¯æ¦‚ç‡0.04
	    math.randomseed(os.time())
        num = math.random(1, 40)
		if (num == 12) then
		    j = xiaosiapi(CurrentQQ,data,data.Content)
			sedmsg(CurrentQQ,data,j.data.info.text)
		end
	else
	    --è§¦å‘è°ƒæ•™æŒ‡ä»¤
		funic(CurrentQQ,data,mim)
	end
    return 1
end

function ReceiveEvents(CurrentQQ, data, extData)
  if data.MsgType == "ON_EVENT_GROUP_REVOKE" then --ç›‘å¬ ç¾¤æ’¤å›äº‹ä»¶
    --æ’¤å›äº‹ä»¶å¤„ç†
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..extData.GroupID..".txt")
    if (str == nil) then
	    log.info("Str ====> %s", str)
        return 1
	end
	if (string.find(str, "å…³é—­")) then
		return 1
	end
	CheHui(CurrentQQ, data, extData)
	--xxxxxxxxxxxxxxx
    return 1
  end
end
  --è¿›ç¾¤ç§€å›¾æ¬¢è¿


--é—ªç…§æ£€æµ‹å¤„ç†


--åŠŸèƒ½ç»„
function funic(CurrentQQ,data,msg)
    if string.find(msg, "^ç‚¹æ­Œ") then
	    data.Content = msg
        music(CurrentQQ,data,msg)
		return 1
	elseif string.find(msg, "^è¯­éŸ³") then
	    keyWord = msg:gsub("è¯­éŸ³", "")
        sedvoicemsg(CurrentQQ,data,keyWord)
		return 1
	elseif string.find(msg, "^å›¾ç‰‡") then
	    keyWord = msg:gsub("å›¾ç‰‡", "")
        sedimgmsg(CurrentQQ,data,keyWord,"")
		return 1
    elseif string.find(msg, "^å”±æ­Œ") then
        keyWord = msg:gsub("å”±æ­Œ", "")
		if (keyWord == "") then
		    sedmsg(CurrentQQ,data,"æ­Œåä¸èƒ½ç©ºç€å“¦")
		    return 1
		end
		sedmsg(CurrentQQ,data,"å¦¾èº«æ­£åœ¨åŠªåŠ›åŠ è½½Ù©(ËƒÌ¶Ì€Íˆà¯°Ë‚Ì¶ÌÍˆ)Ùˆ")
        response, error_message =
            http.request(
            "POST",
            "http://127.0.0.1:8888/SilkApi/UrlToBuf",--ä¿®æ”¹æ­¤å¤„ipåŠç«¯å£å³å¯
            {
                body = keyWord --ä¼ å…¥æ­Œæ›²å
            }
        )
        log.notice("err   %v", error_message)
        html = response.body --è¿”å›silk base64 buf
		if (string.find(html, "Î´")) then
				    sedmsg(CurrentQQ,data,"å¤©ä¾æ²¡æœ‰æ‰¾åˆ°ç›¸å…³çš„æ­Œå‘€(Ã’Ï‰Ã“×±)ï¼")
					c.close(c)
				    return 2
				end
        luaRes =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "VoiceMsg",
                groupid = 0,
                content = "",
                atUser = 0,
                voiceUrl = "",
                voiceBase64Buf = html 
            }
        )
		return 1
	end
    sedmsg(CurrentQQ,data,msg)
end

--å½±è§†æœç´¢ç”¨
function Sousuo(CurrentQQ,data,msg)
    response, error_message =
        http.request(
            "GET",
            "http://localhost/index.php/ajax/suggest",
            {
                query = "mid=1&f=admin&wd="..msg.."&limit=10&timestamp=1567914326746"
            }
        )
    html = response.body
	json = json.decode(html)
	if (json.total == 0) then
	    sedmsg(CurrentQQ,data,"å½±è§†æŸ¥è¯¢é”™è¯¯\nè¯·æ£€æŸ¥å½±è§†åæ˜¯å¦æ­£ç¡®\nâ•â•â•â•â•â•â•â•â•â•â•\næ³¨æ„âš ï¸å½±è§†åä¸è¦å¸¦æ— å…³æˆ–å¤šä½™çš„å­—ç¬¦")
	else
        sedmsg(CurrentQQ,data,"èµ„æºåœ°å€å¦‚ä¸‹â†“â†“â†“\nâ•â•â•â•â•â•â•â•â•â•\nhttp://118.25.41.32/index.php/vod/search/wd/"..escape(msg)..".html\nâ•â•â•â•â•â•â•â•â•â•â•\næ³¨æ„:å¦‚æœQQå‡ºç°åœæ­¢è®¿é—®ç°è±¡ï¼Œè¯·å¤åˆ¶é“¾æ¥ç”¨æµè§ˆå™¨æ‰“å¼€")
	end
end

--å•çº¯å‘æ¶ˆæ¯å›¾æ–‡é€šç”¨
function sedimgmsg(CurrentQQ,data,url,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "PicMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = url,
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘æ¶ˆæ¯ç”¨
function sedmsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "TextMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘ç§èŠæ¶ˆæ¯ç”¨
function sendfrimsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromUin,
        sendToType = 1,
        sendMsgType = "TextMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘jsonæ¶ˆæ¯ç”¨
function sedjsonmsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "JsonMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--èŠå¤©æ¨¡å—åˆ‡æ¢å‡½æ•°
function liaotian(CurrentQQ,data,msg)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
    if (mim == nil) then
        sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
        return 1
    end
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
	if (str == nil) then
        return 1
    end
	if (string.find(str, "å…³é—­")) then
	    sedmsg(CurrentQQ,data,"æœºå™¨èŠå¤©å¤„äºå…³é—­çŠ¶æ€\nâˆ´è¯·å…ˆå¼€å¯æœºå™¨èŠå¤©")
	    return 1
	end
	--åˆ‡æ¢å¤„ç†
	file = io.open("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt", "w")
	if (msg == 1) then
	    file:write("æ–‡å­—èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°æ–‡å­—èŠå¤©")
	elseif (msg == 2) then
	    file:write("è¯­éŸ³èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°è¯­éŸ³èŠå¤©")
	elseif (msg == 3) then
	    file:write("å›å¤èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°å›å¤èŠå¤©")
	end
	file:close()
end

--éšæœºè¡¨æƒ…å‡½æ•°
function faceArray()
    faceArray = {"[è¡¨æƒ…147]","ğŸ€","ğŸ”¥","ğŸ»","ğŸ’","[è¡¨æƒ…185]","[è¡¨æƒ…219]","[è¡¨æƒ…176]"}
    math.randomseed(os.time())
    num = math.random(1, 9)
    return faceArray[num]
end

--urlç¼–ç è½¬æ¢
function escape(w)
	pattern="[^%w%d%._%-%* ]"
	s=string.gsub(w,pattern,function(c)
		local c=string.format("%%%02X",string.byte(c))
		return c
	end)
	s=string.gsub(s," ","+")
	return s
end

--è¯»å–æ•°æ®å‡½æ•°
function Read(url)
    file = io.open(url, "r")
	if (file == nil) then
	    return nil
	else
        file:seek("set")
	    str = file:read("*a")
	    file:close()
        return str
	end
end

--å†™å…¥æ•°æ®å‡½æ•°
function Wirte(url,msg)
    file = io.open(url, "w+")
    file:write(msg)
	file:close()
    return "ok"
end

--å°æ€èŠå¤©å‡½æ•°
function xiaosiapi(CurrentQQ,data,str)
    response, error_message =
            http.request(
            "GET",
            "https://api.ownthink.com/bot",
            {
                query = "appid="..tostring(data.FromUserId).."&spoken=" .. url_encode(str),
                headers = {
                    Accept = "*/*"
                }
            }
        )
        html = response.body
		jData = json.decode(html)
		return jData
end

--æœºå™¨èŠå¤©å‡½æ•°
function ownthink(CurrentQQ,data,msgs,atqq)
    if (tostring(atqq) == CurrentQQ) then
        m = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
        if (m == nil) then
	        log.info("Str ====> %s", m)
            return 1
	    end
	    if (string.find(m, "å…³é—­")) then
	        sedmsg(CurrentQQ,data,"æœºå™¨èŠå¤©å¤„äºå…³é—­çŠ¶æ€\nâˆ´è¯·å…ˆå¼€å¯æœºå™¨èŠå¤©")
	        return 1
	    end
		res2 = string.find(msgs, " ")
		str = string.sub(msgs,res2)
		jData = xiaosiapi(CurrentQQ,data,str)
		Data = json.decode(data.Content)
		m = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
		if (m == nil) then
	        log.info("Str ====> %s", m)
            return 1
	    end
		if (string.find(m, "å›å¤èŠå¤©")) then
		    Api.Api_SendMsg(
                CurrentQQ,
                {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "ReplayMsg",
                groupid = 0,
                content = jData.data.info.text,
                atUser = 0,
				replayInfo = {
                    MsgSeq = data.MsgSeq,
                    --å›å¤æ¶ˆæ¯çš„Seq
                    MsgTime = data.MsgTime,
                    --å›å¤æ¶ˆæ¯çš„äº‹ä»¶
                    UserID = data.FromUserId,
                    --å›å¤æ¶ˆæ¯å¯¹è±¡
                    RawContent = Data.Content --å›å¤æ¶ˆæ¯çš„åŸå†…å®¹
                }
				}
            )
			return 1
		elseif (string.find(m, "æ–‡å­—èŠå¤©")) then
		    sedmsg(CurrentQQ,data,jData.data.info.text)
		else
		    sedvoicemsg(CurrentQQ,data,url_encode(jData.data.info.text))
		end
    end
end

--å‘é€è¯­éŸ³æ¶ˆæ¯
function sedvoicemsg(CurrentQQ,data,str)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "VoiceMsg",
        groupid = 0,
		voiceUrl = "https://dds.dui.ai/runtime/v1/synthesize?voiceId=qianranfa&speed=0.7&volume=100&audioType=wav&text="..str, --å‘é€è¯­éŸ³çš„ç½‘ç»œåœ°å€ æ–‡æœ¬å‹
        voiceBase64Buf = "",
        content = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å¤©æ°”æŸ¥è¯¢å‡½æ•°
--[[function tianqi(CurrentQQ,data)
    keyWord = data.Content:gsub("å¤©æ°”", "")
        if keyWord == "" then
            return 1
        end

        cookies = Api.Api_GetUserCook(CurrentQQ)

        response, error_message =
            http.request(
            "GET",
            "https://weather.mp.qq.com/cgi-bin/rich",
            {
                query = "g_tk=" .. cookies.Gtk .. "&city=" .. url_encode(keyWord),
                headers = {
                    Referer = "http://weather.mp.qq.com/ark"
                },
                cookies = {
                    uin = CurrentQQ,
                    skey = cookies.Skey
                }
            }
        )
        local html = response.body
        log.notice("From Lua html -->%s", html)

        local j = json.decode(html)
        if j.code ~= 0 then
            return 1
        end

        ApiRet =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "JsonMsg",
                groupid = 0,
                content = string.format(
                    --{"config":{"forward":1,"autosize":1},"prompt":"[åº”ç”¨]å¤©æ°”","app":"com.tencent.weather","ver":"0.0.0.1","view":"RichInfoView","meta":{"richinfo":{"adcode":"101210701","city":"æˆéƒ½","air":"58","min":"20","ts":"1500550866","wind":"1","date":"6æœˆ27æ—¥ å‘¨å››","max":"28","type":"201"}},"desc":"å¤©æ°”"}
                    --[[{"app":"com.tencent.weather","desc":"","meta":{"weather":{"ad":[{"icon":"http://imgcache.qq.com/ac/tq/xz2/tp.jpg","p":"ptype=star","t":"2","title":"æ˜Ÿåº§ | ä»Šå¤©ä¼šå› ä¸ºæ„Ÿæƒ…å’Œå®¶åº­çš„é—®é¢˜ï¼Œå½±å“å·¥ä½œï¼Œè¿˜æœ‰ï¼Œä¹Ÿè¦æ³¨æ„äºº...","url":""},{"icon":"http://imgcache.qq.com/ac/qqweather/image/2019/6/27.png","p":"ptype=lunar","t":"4","title":"é»„å† | å†œå†äº”æœˆå»¿äº”ã€‚å®œè®¢ç›Ÿ.çº³é‡‡.å‡ºè¡Œ.ç¥ˆç¦.æ–‹é†®.å®‰åºŠ.ä¼š...","url":""}],"info":{"it1":{"adcode":"101050101","city":"æ­¦æ±‰","hour":"18","max":"29","min":"17","temp":"24","type":"202","ut":"1561630401","wea":"å¤šäº‘"},"it2":{"hour":"19","temp":"22","type":"202"},"it3":{"hour":"20","temp":"21","type":"202"},"ts":"1561631244"},"url":""}},"prompt":"ã€å“ˆå°”æ»¨ã€‘å¤šäº‘ 17Â°/29Â°, 18:13æ›´æ–°~","ver":"1.0.0.106","view":"WeatherThreeView"}]]
--[[                    [[{"app":"com.tencent.weather","desc":"å¤©æ°”","view":"RichInfoView","ver":"1.0.0.217","prompt":"[åº”ç”¨]å¤©æ°”","meta":{"richinfo":{"adcode":"%s","air":"%s","city":"%s","date":"%s","max":"%s","min":"%s","ts":"1554951408","type":"%s","wind":"%s"}},"config":{"forward":1,"autosize":1,"type":"card"}}]],
--[[                    j.data.adcode,
                    j.data.air,
                    j.data.city,
                    j.data.date,
                    j.data.max,
                    j.data.min,
                    j.data.type,
                    j.data.wind
                ),
                atUser = 0
            }
        )
end
--]]
--è°ƒæ•™å¤„ç†å‡½æ•°(å¾…å¤„ç†)
function tiaojiao(CurrentQQ,data)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
	if (mim == nil) then
		sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå“‡")
		return 1
	end
	if (string.find(data.Content, "^åˆ é™¤è°ƒæ•™")) then
	    msg = data.Content:gsub("åˆ é™¤è°ƒæ•™", "")
	    if (msg == "") then
		    sedmsg(CurrentQQ,data,"è¦åˆ é™¤çš„è°ƒæ•™æŒ‡ä»¤ä¸èƒ½ä¸ºç©ºå“¦")
		    return 1
		end
		rese = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..tostring(data.FromGroupId).."\/"..msg..".txt")
	    if (rese == nil) then
			sedmsg(CurrentQQ,data,"è¿™ä¸ªæŒ‡ä»¤ä¸å­˜åœ¨äº†å“¦")
		    return 1
		end
		rm_file = os.remove("mimoio\/æœºå™¨è°ƒæ•™\/"..tostring(data.FromGroupId).."\/"..msg..".txt")
		log.info("åˆ é™¤è°ƒæ•™ ====> %s", rm_file)
		sedmsg(CurrentQQ,data,"åˆ é™¤æˆåŠŸ\nä½ ä¸å–œæ¬¢è¢«è¿™æ ·è°ƒæ•™çš„æˆ‘å—[è¡¨æƒ…9]")
		return 1
	end
    msgs = data.Content:gsub("è°ƒæ•™", "")
		res2 = string.find(msgs, "#")
		str = string.sub(msgs,res2+1)
		str2 = string.sub(msgs,1,res2-1)
		        
		        if (str == "") then
		            sedmsg(CurrentQQ,data,"è°ƒæ•™çš„å›ç­”å†…å®¹ä¸èƒ½ä¸ºç©ºå“¦")
			        return 1
		        end
				if (str2 == "") then
		            sedmsg(CurrentQQ,data,"è°ƒæ•™çš„æŒ‡ä»¤å†…å®¹ä¸èƒ½ä¸ºç©ºå“¦")
			        return 1
		        end
		        rese = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..str2..".txt")
					if (rese ~= nil) then
				        sedmsg(CurrentQQ,data,"æŒ‡ä»¤å·²ç»å­˜åœ¨äº†å“¦")
				        return 1
				    end
				Wirte("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..str2..".txt",str)
				sedmsg(CurrentQQ,data,"è°ƒæ•™æˆåŠŸ\nä½ è¿˜æƒ³å†è°ƒæ•™æˆ‘ä¸€æ¬¡å—[è¡¨æƒ…6]")
		        return 1
end

function url_encode(str)
    if (str) then
        str = string.gsub(str, "\n", "\r\n")
        str =
            string.gsub(
            str,
            "([^%w ])",
            function(c)
                return string.format("%%%02X", string.byte(c))
            end
        )
        str = string.gsub(str, " ", "+")
    end
    return str
end

--æŠ¢çº¢åŒ…å¤„ç†
function RedBag(CurrentQQ, data)
    Api.Api_OpenRedBag(CurrentQQ, data.RedBaginfo)
    if (data.RedBaginfo.RedType == 12) then
         luaRes =
                Api.Api_SendMsg(
                CurrentQQ,
                {
                    toUser = data.FromGroupId,
                    sendToType = 2,
                    sendMsgType = "TextMsg",
                    groupid = 0,
                    content = data.RedBaginfo.Tittle,
                    atUser = 0
                }
            )
        log.notice("From Lua SendMsg Ret\n%d", luaRes.Ret)
    end
end

--è§†é¢‘è§£æå¤„ç†
function Video(CurrentQQ, data)
    vdata = json.decode(data.Content)
        videodata = {
            GroupID = data.FromGroupId,
            VideoUrl = vdata.VideoUrl,
            VideoMd5 = vdata.VideoMd5
        }
        --æ„é€ table å‚æ•°è¡¨
        luaResp = Api.Api_CallFunc(CurrentQQ, "PttCenterSvr.ShortVideoDownReq", videodata) --é€šè¿‡cmdè°ƒç”¨åŠŸèƒ½åŒ…
        luaRes =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "TextMsg",
                groupid = 0,
                content = "è§£æè§†é¢‘URL-->" .. luaResp.VideoUrl,
                atUser = 0
            }
        )
end

--ç®¡ç†å¼€å…³é€šç”¨
function adminio(CurrentQQ,data,oio)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim ~= nil) then
            msg = data.Content:gsub(oio, "")
            str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
            if (string.find(str, "å…³é—­")) then
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äººå·²è¢«å…³é—­...\nè¯·å…ˆå¼€å¯æœºå™¨äºº")
                return 1
            end
			str2 = Read("mimoio\/çŠ¶æ€æ•°æ®\/"..oio.."\/"..data.FromGroupId..".txt")
			if (string.find(str2, msg)) then
			    sedmsg(CurrentQQ,data,"âˆ´"..oio.."æœ¬å°±æ˜¯"..str2.."çŠ¶æ€")
                return 1
			end
            Wirte("mimoio\/çŠ¶æ€æ•°æ®\/"..oio.."\/"..data.FromGroupId..".txt",msg)
            sedmsg(CurrentQQ,data,"âˆ´"..oio..msg.."æˆåŠŸ")
            return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
end

--ç™¾ç§‘å¤§å…¨
function baike(CurrentQQ,data)
    keyWord = data.Content:gsub("ç™¾ç§‘", "")
        if keyWord == "" then
            return 1
        end
        response, error_message =
            http.request(
            "GET",
            "http://baike.baidu.com/api/openapi/BaikeLemmaCardApi",
            {
                query = "scope=103&format=json&appid=379020&bk_key=" .. url_encode(keyWord) .. "&bk_length=600"
            }
        )
        html = response.body
        while(string.find(html, '"errno":2')) do
            response, error_message =
            http.request(
            "GET",
            "http://baike.baidu.com/api/openapi/BaikeLemmaCardApi",
            {
                query = "scope=103&format=json&appid=379020&bk_key=" .. url_encode(keyWord) .. "&bk_length=600"
            })
			html = response.body
        end
        local j = json.decode(html)
        sedmsg(CurrentQQ,data,j.abstract.."\n"..j.url)
end

--éŸ³ä¹ç‚¹æ­Œ
function music(CurrentQQ,data)
    keyWord = data.Content:gsub("ç‚¹æ­Œ", "")
        if keyWord == "" then
            return 1
        end
        response, error_message =
            http.request(
            "GET",
            "https://c.y.qq.com/soso/fcgi-bin/client_search_cp",
            {
                query = "aggr=1&cr=1&flag_qc=0&p=1&n=6&w=" .. url_encode(keyWord)
            }
        )
        html = response.body
		str = string.sub(html,10,-2)
        j = json.decode(str)
        if (j.code == 0) then
            msg = ""
            num = j.data.song.list
            list = num[1]
            songname = list.songname
            singername = list.singer[1].name
            payplay = list.pay.payplay
			albummid = list.albummid
			songmid = list.songmid
	        sedjsonmsg(CurrentQQ,data,'{"app":"com.tencent.structmsg","desc":"éŸ³ä¹","view":"music","ver":"0.0.0.1","prompt":"[åˆ†äº«]' ..songname.. '","meta":{"music":{"sourceMsgId":"0","title":"' ..songname.. '","desc":"' ..singername.. '","preview":"y.gtimg.cn/music/photo_new/T002R150x150M000'..albummid..'.jpg","tag":"QQéŸ³ä¹","musicUrl":"https://v1.itooi.cn/tencent/url?id='..songmid..'","jumpUrl":"y.qq.com/n/yqq/song/'..songmid..'.html","appid":100497308,"app_type":1,"action":"","source_url":"url.cn/5aSZ8Gc","source_icon":"url.cn/5tLgzTm","android_pkg_name":"com.tencent.qqmusic"}},"config":{"forward":true,"type":"normal","autosize":true}}')
			return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´Error:"..j.code)
			return 1
        end
end

--è®¿é—®url
function geturl(url_class,url,caulrt)
        response, error_message =
            http.request(
            url_class,
            url,
            {
                query = caulrt
            }
        )
        html = response.body
		return html
end

--æ¶ˆæ¯å‚¨è“„
function msgsql(CurrentQQ,data)
    if (mysqlpass == "") then
	    return 1
	end
    c = mysql.new()
    -- åˆå§‹åŒ–mysqlå¯¹è±¡
    ok, err = c:connect({host = mysqlhost, port = 3306, database = mysqldb, user = mysqluser, password = mysqlpass})
    --å»ºç«‹è¿æ¥
    if ok then
        sqlstr =
            string.format(
            [[INSERT INTO msgcache (GroupID, MsgSeq, MsgRandom,MsgType,Data,MsgTime)VALUES (%d,%d,%d,'%s','%s',%d)]],
            data.FromGroupId,
            data.MsgSeq,
            data.MsgRandom,
            data.MsgType,
            data.Content,
            data.MsgTime
        )
        res, err = c:query(sqlstr) --å…¥åº“ç¼“å­˜æ¶ˆæ¯
        log.info("%s", err)
        c.close(c)
    --é‡Šæ”¾è¿æ¥
    end
    return 1
end

--æ’¤å›æ£€æµ‹
function CheHui(CurrentQQ, data, extData)
    c = mysql.new()
    -- åˆå§‹åŒ–mysqlå¯¹è±¡
	if (mysqlpass == "") then
	    return 1
	end
	
    if data.MsgType == "ON_EVENT_GROUP_REVOKE" then --ç›‘å¬ ç¾¤æ’¤å›äº‹ä»¶
        str = string.format("ç¾¤æˆ %d  æˆå‘˜ UserID %s æ’¤å›äº†æ¶ˆæ¯Seq %s \n", extData.GroupID, extData.UserID, extData.MsgSeq)
        log.info("%s", str)
        ok, err = c:connect({host = mysqlhost, port = 3306, database = mysqldb, user = mysqluser, password = mysqlpass})
        --å»ºç«‹è¿æ¥
        log.info("sql %v", err)
        if ok then
            sqlstr =
                string.format(
                "select * from msgcache where `GroupID`= %d and `MsgSeq` = %d",
                extData.GroupID,
                extData.MsgSeq
            )
            res, err = c:query(sqlstr) --è·Ÿç¾¤ç¾¤idå’Œæ¶ˆæ¯SEQæŸ¥è¯¢å‡ºæ’¤å›çš„æ¶ˆæ¯å†…å®¹
            if err == nil then
                c.close(c)
                GroupID = tonumber(res[1]["GroupID"])
                MsgType = res[1]["MsgType"]
                Data = res[1]["Data"]

                if MsgType == "TextMsg" then
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            --å‘é€æ–‡æœ¬æ¶ˆæ¯
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡æ–‡æœ¬æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                Data
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "SmallFaceMsg" then
                    --Data {"Content":"[è¡¨æƒ…101]","Hex":"FKY=","Index":101,"tips":"[å°è¡¨æƒ…]"}
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡è¡¨æƒ…æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).Content
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "PicMsg" then
                    --Data {"Content":"","FileId":2820717626,"FileMd5":"q0oEC5aloJJMFr10mplaXw==","FileSize":7026,"tips":"[ç¾¤å›¾ç‰‡]","url":"http://gchat.qpic.cn/gchatpic_new/1700487478/960839480-2534335053-AB4A040B96A5A0924C16BD749A995A5F/0?vuin=u0026term=255u0026pictype=0"}
                    jData = json.decode(Data)
					if (jData.tips == "[ç¾¤æ¶ˆæ¯-QQé—ªç…§]") then
					    
					Api.Api_SendMsg( 
                    CurrentQQ,
                    {
                        toUser = GroupID,
                        sendToType = 2,
                        sendMsgType = "ForwordMsg",
                        content = "",
                        atUser = 0,
                        groupid = 0,
                        voiceUrl = "",
                        voiceBase64Buf = "",
                        picUrl = "",
                        picBase64Buf = "",
                        forwordBuf = json.decode(Data).ForwordBuf, --æ¬²è½¬å‘çš„base64buf å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                        forwordField = json.decode(Data).ForwordField --æ¬²å†™å…¥åè®®çš„å­—æ®µID å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                    }
                )
				    return 1
					end
                    Api.Api_SendMsg( --é€šè¿‡å›¾ç‰‡md5å‘é€å›¾ç‰‡ ç§’å‘ä¸ç”¨ä¸Šä¼  ç›¸å½“äºè½¬å‘
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "PicMsg",
                            --å‘é€å›¾æ–‡æ¶ˆæ¯
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡å›¾ç‰‡æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š[PICFLAG]%s",
                                extData.UserID,
                                jData.Content
                            ),
                            --é€šè¿‡å®[PICFLAG]æ”¹å˜å›¾æ–‡é¡ºåº  æ”¹ä¸ºç°æ–‡å­—åå›¾ç‰‡
                            atUser = 0,
                            voiceUrl = "",
                            voiceBase64Buf = "",
                            picUrl = "",
                            picBase64Buf = "",
                            fileMd5 = jData.FileMd5
                        }
                    )
                end
                if MsgType == "AtMsg" then
                    --Data {"Content":"@Kar98k skjjkssjkjs","UserID":123456789,"tips":"[ATæ¶ˆæ¯]"}
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡atæ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).Content
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "VoiceMsg" then
                    --Data {"tips":"[è¯­éŸ³]","url":"http://grouptalk.c2c.qq.com/?ver=0u0026rkey=3062020101045b305902010102010102041fdef8ae042439416931554e5142586c536d78706a314c686843664959725f327a5f573064697653755902045dac2a21041f0000000866696c6574797065000000013100000005636f64656300000001310400u0026filetype=1u0026voice_codec=1"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "VoiceMsg",
                            --å‘é€ç¾¤è¯­éŸ³æ¶ˆæ¯
                            groupid = 0,
                            content = "",
                            atUser = 0,
                            voiceUrl = json.decode(Data).url,
                            --é€šè¿‡ç½‘ç»œurlè¿›è¡Œå‘é€è¯­éŸ³
                            voiceBase64Buf = "",
                            picUrl = "",
                            picBase64Buf = ""
                        }
                    )
                end

                if MsgType == "ReplayMsg" then
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡å›å¤æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).ReplayContent
                            ),
                            atUser = 0
                        }
                    )
                end
				if MsgType == "VideoMsg" then
	             Api.Api_SendMsg( 
                    CurrentQQ,
                    {
                        toUser = GroupID,
                        sendToType = 2,
                        sendMsgType = "ForwordMsg",
                        content = "",
                        atUser = 0,
                        groupid = 0,
                        voiceUrl = "",
                        voiceBase64Buf = "",
                        picUrl = "",
                        picBase64Buf = "",
                        forwordBuf = json.decode(Data).ForwordBuf, --æ¬²è½¬å‘çš„base64buf å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                        forwordField = json.decode(Data).ForwordField --æ¬²å†™å…¥åè®®çš„å­—æ®µID å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                    }
                )
				end
                if MsgType == "XmlMsg" then
				    
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "XmlMsg",
                            groupid = 0,
                            content = string.format("%s", Data),
                            atUser = 0
                        }
                    )
                end
				if MsgType == "JsonMsg" then
				    
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "JsonMsg",
                            groupid = 0,
                            content = string.format("%s", Data),
                            atUser = 0
                        }
                    )
                end
            end
        end
    end
    return 1
end
2020/09/07 12:55:10.147 [E]  mimoio.lua
2020/09/07 12:55:10.151 [E]  local log = require("log")
local Api = require("coreApi")
local json = require("json")
local http = require("http")
local mysql = require("mysql")

--ç‰ˆæœ¬å·(ä¸è¦æ”¹åŠ¨)
Vabr = "1.0.2"
--æ•°æ®åº“é…ç½®
mysqlhost = "localhost"--é»˜è®¤ä¸åŠ¨
mysqldb = "ffaxx001"--æ•°æ®åº“å
mysqluser = "ffaxx001"--æ•°æ®åº“ç”¨æˆ·å
mysqlpass = "123456"--æ•°æ®åº“å¯†ç 
--ä¸ä½¿ç”¨è¯·ä¸è¦æ”¹åŠ¨

function ReceiveFriendMsg(CurrentQQ, data)
    if (data.Content == "ä½¿ç”¨æ–¹æ³•") then
	    sendfrimsg(CurrentQQ,data,"æ·»åŠ æˆæƒè€…çš„æ–¹æ³•\nå¯¹å•ä¸ªæœºå™¨äººç§èŠå‘é€[æ·»åŠ æˆæƒè€…+æˆæƒè€…QQ]\n\næˆæƒç¾¤çš„æ–¹æ³•\nåˆ°éœ€è¦æˆæƒçš„ç¾¤é‡Œå‘é€[æˆæƒ+ä¸»äººQQ]ã€‚æ³¨æ„:æˆæƒå¿…é¡»æ˜¯æˆæƒè€…è¿›è¡Œæ“ä½œ,ç®¡ç†å‘˜æˆæƒä¸äº†")
	end
    --æ•°æ®åˆå§‹åŒ–
    if (data.Content == "åˆå§‹åŒ–") then
	    root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root ~= nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´è¯·ä¸è¦é‡å¤åˆå§‹åŒ–")
			return 1
		end
    --os.execute('mkdir mimoio/æœºå™¨æˆæƒ')
	    os.execute('mkdir mimoio')
		os.execute('mkdir mimoio/å¤è¯»æœº')
		os.execute('mkdir mimoio/å¤è¯»æœº/æ¬¡æ•°')
		os.execute('mkdir mimoio/å¤è¯»æœº/å†…å®¹')
		os.execute('mkdir mimoio/æœºå™¨æˆæƒ')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨ä¸»äºº')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨èŠå¤©')
		os.execute('mkdir mimoio/æœºå™¨è°ƒæ•™')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æŠ¢çº¢åŒ…')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æœºå™¨èŠå¤©')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æœºå™¨å¼€å…³')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æ’¤å›æ£€æµ‹')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/å›¾ç‰‡è§£æ')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/è§†é¢‘è§£æ')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/é—ªç…§æ£€æµ‹')
		Wirte("mimoio\/"..data.FromUin..".txt","999")
		sendfrimsg(CurrentQQ,data,"åˆå§‹åŒ–å®Œæ¯•ï¼\nå‘é€[ä½¿ç”¨æ–¹æ³•]äº†è§£ä½¿ç”¨å§")
	end
	--æ·»åŠ æˆæƒè€…æ“ä½œ(ç§èŠæœºå™¨äººå‘é€)
	if (string.find(data.Content, "^æ·»åŠ æˆæƒè€…")) then
	    msg = data.Content:gsub("æ·»åŠ æˆæƒè€…", "")
		--Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromUin..".txt","å…³é—­")
		root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root == nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„ç®¡ç†è€…")
			return 1
		end
		Wirte("mimoio\/æœºå™¨æˆæƒ\/"..msg..CurrentQQ..".txt","999")
		sendfrimsg(CurrentQQ,data,"âˆ´æ·»åŠ æˆæƒè€…æˆåŠŸ")
	end
	--åˆ é™¤æˆæƒè€…æ“ä½œ(ç§èŠæœºå™¨äººå‘é€)
	if (string.find(data.Content, "^åˆ é™¤æˆæƒè€…")) then
	    msg = data.Content:gsub("åˆ é™¤æˆæƒè€…", "")
		--Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromUin..".txt","å…³é—­")
		root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root == nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„ç®¡ç†è€…")
			return 1
		end
		os.remove("mimoio\/æœºå™¨æˆæƒ\/"..msg..CurrentQQ..".txt")
		sendfrimsg(CurrentQQ,data,"âˆ´åˆ é™¤æˆæƒè€…æˆåŠŸ")
	end
    return 1
end
function ReceiveGroupMsg(CurrentQQ, data)
    if (tostring(data.FromUserId) == CurrentQQ) then
	    return 1
	end
	--ç¾¤èŠæˆæƒ(åˆ°éœ€è¦æˆæƒçš„ç¾¤é‡Œæ“ä½œ)
	if (string.find(data.Content, "^æˆæƒ")) then
	    root = Read("mimoio\/æœºå™¨æˆæƒ\/"..data.FromUserId..CurrentQQ..".txt","999")
		if (root == nil) then
		    sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„æˆæƒè€…")
			return 1
		end
		msg = data.Content:gsub("æˆæƒ", "")
		os.execute('mkdir mimoio/æœºå™¨è°ƒæ•™/'..data.FromGroupId)
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨ä¸»äºº/'..data.FromGroupId)
		Wirte("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..msg..".txt","999")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt","å›å¤èŠå¤©")
		sedmsg(CurrentQQ,data,"âˆ´æˆæƒæˆåŠŸï¼\nå‘é€[å¼€å¯æœºå™¨äºº]ä½¿ç”¨å§")
	end
	--åˆ é™¤æˆæƒæ“ä½œ(åˆ°éœ€è¦åˆ é™¤æˆæƒçš„ç¾¤é‡Œæ“ä½œ)
	if (string.find(data.Content, "^åˆ é™¤æˆæƒ")) then
	    root = Read("mimoio\/æœºå™¨æˆæƒ\/"..data.FromUserId..CurrentQQ..".txt","999")
		if (root == nil) then
		    sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„æˆæƒè€…")
			return 1
		end
		msg = data.Content:gsub("åˆ é™¤æˆæƒ", "")
		os.remove("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..msg..".txt")
		os.remove("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
		sedmsg(CurrentQQ,data,"âˆ´åˆ é™¤æˆæƒæˆåŠŸï¼")
	end
	--æœºå™¨å¼€å…³æŒ‡ä»¤
	if (data.Content == "å¼€å¯æœºå™¨äºº" or data.Content == "å…³é—­æœºå™¨äºº") then
        mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim ~= nil) then
            msg = data.Content:gsub("æœºå™¨äºº", "")
            str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
			if (str == nil) then
			    Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt",msg)
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äºº"..msg.."æˆåŠŸï¼")
				log.info("Str ====> %s", str)
                return 1
			end
			
            if (string.find(str, msg)) then
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äººä¸€ç›´æ˜¯"..msg.."çš„å‘")
                return 1
            end
            Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt",msg)
            sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äºº"..msg.."æˆåŠŸï¼")
            return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
	end
    --æœºå™¨äººå¼€å¯æ£€æµ‹
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
	if (str == nil) then
	    log.info("Str ====> %s", str)
        return 1
	end
	if (string.find(str, "å…³é—­")) then
	    return 1
	end
	--atæ¶ˆæ¯å¤„ç†
	msgs = ""
	atqq = 0
	if (string.find(data.Content, "ATæ¶ˆæ¯")) then
	    msgs = json.decode(data.Content).Content
		atqq = json.decode(data.Content).UserID
	end
	--å°¾å·´è‡ªå®šä¹‰(å¾…å®Œå–„)
	tips = "â€”â€”å‡¤é£ç¿±ç¿”å…®ä¸·"
    --åŠŸèƒ½æ¨¡å—
    if (data.Content == "åŠŸèƒ½" or data.Content == "ä¸»ç•Œé¢") then
        face = faceArray()
        sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."å½±è§†æœç´¢\n"..face.."èŠå¤©å¨±ä¹\n"..face.."ä¾¿åˆ©åŠŸèƒ½\n"..face.."æœºå™¨è°ƒæ•™\n"..face.."ç®¡ç†ç³»ç»Ÿ\n"..face.."bugåé¦ˆ\n"..face.."æœ¬ç¾¤çŠ¶æ€\n"..face.."æ›´æ–°æ£€æµ‹\n\n"..tips)
    end
    --å½±è§†æœç´¢æ¨¡å—
    if (data.Content == "å½±è§†æœç´¢") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."æœç´¢+å½±è§†å\n"..face.."æˆ‘æƒ³çœ‹+å½±è§†å\n"..face.."æˆ‘è¦çœ‹+å½±è§†å\n\n"..tips)
    elseif (string.find(data.Content, "^æœç´¢")) then
	    msg = data.Content:gsub("æœç´¢", "")
		Sousuo(CurrentQQ,data,msg)
	elseif (string.find(data.Content, "^æˆ‘æƒ³çœ‹")) then
	    msg = data.Content:gsub("æˆ‘æƒ³çœ‹", "")
		Sousuo(CurrentQQ,data,msg)
    elseif (string.find(data.Content, "^æˆ‘è¦çœ‹")) then
	    msg = data.Content:gsub("æˆ‘è¦çœ‹", "")
		Sousuo(CurrentQQ,data,msg)
	end
	--èŠå¤©å¨±ä¹æ¨¡å—
	if (data.Content == "èŠå¤©å¨±ä¹") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."åˆ‡æ¢æ–‡å­—èŠå¤©\n"..face.."åˆ‡æ¢å›å¤èŠå¤©\n"..face.."åˆ‡æ¢è¯­éŸ³èŠå¤©\n\n"..tips)
    elseif (data.Content == "åˆ‡æ¢æ–‡å­—èŠå¤©") then
		liaotian(CurrentQQ,data,1)
	elseif (data.Content == "åˆ‡æ¢è¯­éŸ³èŠå¤©") then
	    liaotian(CurrentQQ,data,2)
    elseif (data.Content == "åˆ‡æ¢å›å¤èŠå¤©") then
	    liaotian(CurrentQQ,data,3)
	else
	    ownthink(CurrentQQ,data,msgs,atqq)
	end
	--ä¾¿åˆ©åŠŸèƒ½æ¨¡å—
	if (data.Content == "ä¾¿åˆ©åŠŸèƒ½") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."ç™¾ç§‘å¤§å…¨\n"..face.."éŸ³ä¹ç‚¹æ­Œ\n"..face.."é—ªä»–@xx\n"..face.."å¤©æ°”æŸ¥è¯¢\n\n"..tips)
	elseif (data.Content == "ç™¾ç§‘å¤§å…¨") then
		sedmsg(CurrentQQ,data,"å‘é€:[ç™¾ç§‘+å…³é”®è¯]\nä¾‹å¦‚:ç™¾ç§‘æ´›å¦¾èº«")
    elseif (data.Content == "éŸ³ä¹ç‚¹æ­Œ") then
		sedmsg(CurrentQQ,data,"å‘é€:[ç‚¹æ­Œ+æ­Œå]\nä¾‹å¦‚:ç‚¹æ­Œé’æŸ ")
	elseif (data.Content == "å¤©æ°”æŸ¥è¯¢") then
		sedmsg(CurrentQQ,data,"å‘é€:[å¤©æ°”+åœ°æ–¹å]\nä¾‹å¦‚:å¤©æ°”åŒ—äº¬(é™äºå›½å†…)")
    elseif (string.find(data.Content, "^å¤©æ°”")) then
        tianqi(CurrentQQ,data)
	    --msg = data.Content:gsub("æœç´¢", "")
		--Sousuo(CurrentQQ,data,msg)
	elseif (string.find(data.Content, "^ç™¾ç§‘")) then
	    baike(CurrentQQ,data)
	    --msg = data.Content:gsub("æˆ‘æƒ³çœ‹", "")
		--Sousuo(CurrentQQ,data,msg)music(CurrentQQ,data)
    elseif (string.find(data.Content, "^ç‚¹æ­Œ")) then
	    music(CurrentQQ,data)
	end
	--æœºå™¨è°ƒæ•™æ¨¡å—
	if (data.Content == "æœºå™¨è°ƒæ•™") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."æ–‡å­—è°ƒæ•™\n"..face.."è¯­éŸ³è°ƒæ•™\n"..face.."å”±æ­Œè°ƒæ•™\n"..face.."éŸ³ä¹è°ƒæ•™\n"..face.."å›¾ç‰‡è°ƒæ•™\n"..face.."åˆ é™¤è°ƒæ•™\n\n"..tips)
    elseif (data.Content == "æ–‡å­—è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#(å†…å®¹)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#ä½ å¥½å•Š")
	elseif (data.Content == "è¯­éŸ³è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#è¯­éŸ³(å†…å®¹)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#è¯­éŸ³ä½ å¥½å•Š")
	elseif (data.Content == "å›¾ç‰‡è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#å›¾ç‰‡(é“¾æ¥)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#å›¾ç‰‡http://../1.jpg")
	elseif (data.Content == "éŸ³ä¹è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#ç‚¹æ­Œ(æ­Œå)]\nä¾‹å¦‚:è°ƒæ•™å–µ#ç‚¹æ­Œå­¦çŒ«å«")
	elseif (data.Content == "å”±æ­Œè°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#å”±æ­Œ(æ­Œå)]\nä¾‹å¦‚:è°ƒæ•™å–µ#å”±æ­Œå­¦çŒ«å«")
	elseif (data.Content == "åˆ é™¤è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[åˆ é™¤è°ƒæ•™(æŒ‡ä»¤)]\nä¾‹å¦‚:åˆ é™¤è°ƒæ•™ä½ å¥½")
	elseif (string.find(data.Content, "^è°ƒæ•™")) then
        tiaojiao(CurrentQQ,data)
	elseif (string.find(data.Content, "^åˆ é™¤è°ƒæ•™")) then
        tiaojiao(CurrentQQ,data)
	end
	--ç®¡ç†ç³»ç»Ÿæ¨¡å—
	if (data.Content == "ç®¡ç†ç³»ç»Ÿ") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."å¼€å¯/å…³é—­æœºå™¨äºº\n"..face.."å¼€å¯/å…³é—­æŠ¢çº¢åŒ…\n"..face.."å¼€å¯/å…³é—­æœºå™¨èŠå¤©\n"..face.."å¼€å¯/å…³é—­é—ªç…§æ£€æµ‹\n"..face.."å¼€å¯/å…³é—­å›¾ç‰‡è§£æ\n"..face.."å¼€å¯/å…³é—­è§†é¢‘è§£æ\n"..face.."å¼€å¯/å…³é—­æ’¤å›æ£€æµ‹\n\n"..tips)
    elseif (data.Content == "å¼€å¯æœºå™¨èŠå¤©" or data.Content == "å…³é—­æœºå™¨èŠå¤©") then
        adminio(CurrentQQ,data,"æœºå™¨èŠå¤©")
    elseif (data.Content == "å¼€å¯æ’¤å›æ£€æµ‹" or data.Content == "å…³é—­æ’¤å›æ£€æµ‹") then
        adminio(CurrentQQ,data,"æ’¤å›æ£€æµ‹")
	elseif (data.Content == "å¼€å¯é—ªç…§æ£€æµ‹" or data.Content == "å…³é—­é—ªç…§æ£€æµ‹") then
        adminio(CurrentQQ,data,"é—ªç…§æ£€æµ‹")
	elseif (data.Content == "å¼€å¯æŠ¢çº¢åŒ…" or data.Content == "å…³é—­æŠ¢çº¢åŒ…") then
        adminio(CurrentQQ,data,"æŠ¢çº¢åŒ…")
	elseif (data.Content == "å¼€å¯è§†é¢‘è§£æ" or data.Content == "å…³é—­è§†é¢‘è§£æ") then
        adminio(CurrentQQ,data,"è§†é¢‘è§£æ")
	elseif (data.Content == "å¼€å¯å›¾ç‰‡è§£æ" or data.Content == "å…³é—­å›¾ç‰‡è§£æ") then
        adminio(CurrentQQ,data,"å›¾ç‰‡è§£æ")
	end
	--bugåé¦ˆæ¨¡å—
	if (data.Content == "BUGåé¦ˆ" or data.Content == "bugåé¦ˆ") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."é‚®ä»¶åé¦ˆ\n"..face.."QQåé¦ˆ\n\n"..tips)
    elseif (data.Content == "QQåé¦ˆ") then
        sedmsg(CurrentQQ,data,"???Î£(ï¾Ÿâˆ€ï¾Ÿï¾‰)ï¾‰\næ’ä»¶æœ‰é—®é¢˜å¯ä»¥åé¦ˆåˆ°:\nQQ:2353065854")
    elseif (data.Content == "é‚®ä»¶åé¦ˆ") then
        sedmsg(CurrentQQ,data,"å®è´å’‹å•¦=ÍÍŸÍŸÍ(ê’ªá—œê’ª â€§Ì£Ì¥Ì‡)\næ’ä»¶æœ‰é—®é¢˜å¯ä»¥åé¦ˆåˆ°:\né‚®ç®±ğŸ“¬:ym-o@qq.com")
	end
	--æœ¬ç¾¤çŠ¶æ€æ¨¡æ¿
	if (data.Content == "æœ¬ç¾¤çŠ¶æ€") then
        face = faceArray()
        hb = Read("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt")
        sz = Read("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt")
		tp = Read("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt")
        sp = Read("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt")
        jqr = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
        lt = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
        ch = Read("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..data.FromGroupId..".txt")
		sedmsg(CurrentQQ,data,"çŠ¶æ€æ•°æ®åˆ—è¡¨â†“â†“â†“\n"..face.."æœºå™¨äºº:"..jqr.."\n"..face.."æŠ¢çº¢åŒ…:"..hb.."\n"..face.."å›¾ç‰‡è§£æ:"..tp.."\n"..face.."æ’¤å›æ£€æµ‹:"..ch.."\n"..face.."è§†é¢‘è§£æ:"..sp.."\n"..face.."æœºå™¨èŠå¤©:"..lt.."\n"..face.."é—ªç…§æ£€æµ‹:"..sz.."\n\n"..tips)
	end
	--æ›´æ–°æ¨¡å—
	if (data.Content == "æ›´æ–°æ£€æµ‹") then
        str = geturl("GET","http://118.25.41.32/Lsb/lua/Vabr.txt","")
		log.info("Str ====> %s", str)
        if (string.find(str, Vabr)) then
            sedmsg(CurrentQQ,data,"å½“å‰ç‰ˆæœ¬ä¸ºæœ€æ–°ç‰ˆ")
        else
            sedmsg(CurrentQQ,data,"å‘ç°æ–°ç‰ˆæœ¬!\nå½“å‰ç‰ˆæœ¬:"..Vabr.."\næ–°ç‰ˆæœ¬å·:"..str.."\nèµ¶å¿«å‘é€[æ›´æ–°æ’ä»¶]å§")
        end
	elseif (data.Content == "æ›´æ–°æ’ä»¶") then
	    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim == nil) then
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
        str = geturl("GET","http://118.25.41.32/Lsb/lua/Vabr.txt","")
		log.info("Str ====> %s", str)
        if (string.find(str, Vabr)) then
            sedmsg(CurrentQQ,data,"å½“å‰ç‰ˆæœ¬ä¸ºæœ€æ–°ç‰ˆ")
        else
            str = geturl("GET","http://118.25.41.32/Lsb/lua/mimoio.txt","")
            Wirte("Plugins\/mimoio.lua",str)
            sedmsg(CurrentQQ,data,"æ›´æ–°å®Œæ¯•ï¼")
        end
	end
	--å›¾ç‰‡ç±»å‹æ¶ˆæ¯å¤„ç†
    if (data.MsgType == "PicMsg") then
	    msg = Read("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt")
		jData = json.decode(data.Content)
	    if (msg ~= nil and jData.tips ~= "[ç¾¤æ¶ˆæ¯-QQé—ªç…§]") then
            if (string.find(str, "å¼€å¯")) then
	            sedmsg(CurrentQQ,data,"å›¾ç‰‡é“¾æ¥è§£æå¦‚ä¸‹â†“â†“\n"..jData.url)
				return 1
	        end
	    end
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt")
	    if (str == nil) then
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    --é—ªç…§ã€å›¾ç‰‡å¤„ç†æ¨¡å—
		PicFlag(CurrentQQ, data)
    end
	--æŠ¢çº¢åŒ…å¤„ç†
	if (string.find(data.MsgType, "RedBagMsg") == 1) then
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt")
		if (str == nil) then
	        log.info("Str ====> %s", str)
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    RedBag(CurrentQQ, data)
	end
	--è§†é¢‘è§£æå¤„ç†
	if (string.find(data.MsgType, "VideoMsg") == 1) then
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt")
		if (str == nil) then
	        log.info("Str ====> %s", str)
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    Video(CurrentQQ, data)
	end
	--até—ªå›¾
	if (data.MsgType == "AtMsg") and (string.find(data.Content, "é—ªä»–")) then
	    shantu(CurrentQQ, data)
    end
	--è°ƒæ•™æœç´¢å¼•æ“
	mim = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..data.Content..".txt")
	if (mim == nil) then
	    --äººç±»çš„æœ¬è´¨æ˜¯å¤è¯»æœº
	    msg = Read("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt")
		if (msg ~= nil) then
		    cs = Read("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt")
			ii = tonumber(cs)
			if (string.find(msg, "^"..data.Content.."$")) then
			    if (ii > 2) then
			         math.randomseed(os.time())
                     sj = math.random(1, 5)
		             if (sj == 1 or sj == 2) then
			             sedmsg(CurrentQQ,data,msg)
					     rr = ii + 1
		                 Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
				     elseif (sj == 3) then
				         os.remove("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt")
					     os.remove("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt")
					     fdArray = {"çªç„¶æˆªæ–­å¤è¯»(ï¾ŸâŠ¿ï¾Ÿ)ï¾‚","å¤è¯»å¯è€»(â€¢Ì€ã¸ â€¢Ì â•® )","ä¸è¦å¤è¯»äº†å•¦","è¿™å°±æ˜¯æ‰€è°“çš„äººç±»çš„æœ¬è´¨","ä½ ä»¬å’‹ä¸ä¸Šå¤©å‘","åˆå¤è¯»ä¸Šç˜¾äº†å•Š"}
                         math.randomseed(os.time())
                         fdsj = math.random(1, 6)
				         sedmsg(CurrentQQ,data,fdArray[fdsj])
				     else
			             rr = ii + 1
		                 Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
		             end
			    else
			        rr = ii + 1
		            Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
			    end
			else
			    if (ii > 2) then
			        math.randomseed(os.time())
                    sj2 = math.random(1, 3)
					if (sj2 == 2) then
					    fdArray2 = {"ä¸­æ–­å¤è¯»å¯è€»","æ‰“æ–­å¤è¯»å¯è€»(â€¢Ì€ã¸ â€¢Ì â•® )","ä½ ä¸ºä»€ä¹ˆè¦æ‰“æ–­å¤è¯»å•Š","å¤è¯»ä¸é¦™å˜›","ç ´åæ°›å›´(à¸‡áµ’ÌŒçš¿áµ’ÌŒ)à¸‡â¼Â³â‚Œâ‚ƒ"}
                        math.randomseed(os.time())
                        fdsj2 = math.random(1, 5)
				        sedmsg(CurrentQQ,data,fdArray2[fdsj2])
					end
				end
				Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt","1")
			    Wirte("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt",data.Content)
			end
		else
		    Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt","1")
			Wirte("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt",data.Content)
		end
	    --å¦‚æœè°ƒæ•™æŒ‡ä»¤ä¸å­˜åœ¨ï¼Œåˆ™è¿›è¡Œå…¶ä»–æ“ä½œ
	    msgsql(CurrentQQ,data)--æ•°æ®å‚¨è“„
		--éšæœºå›å¤æ¶ˆæ¯æ¦‚ç‡0.04
	    math.randomseed(os.time())
        num = math.random(1, 40)
		if (num == 12) then
		    j = xiaosiapi(CurrentQQ,data,data.Content)
			sedmsg(CurrentQQ,data,j.data.info.text)
		end
	else
	    --è§¦å‘è°ƒæ•™æŒ‡ä»¤
		funic(CurrentQQ,data,mim)
	end
    return 1
end

function ReceiveEvents(CurrentQQ, data, extData)
  if data.MsgType == "ON_EVENT_GROUP_REVOKE" then --ç›‘å¬ ç¾¤æ’¤å›äº‹ä»¶
    --æ’¤å›äº‹ä»¶å¤„ç†
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..extData.GroupID..".txt")
    if (str == nil) then
	    log.info("Str ====> %s", str)
        return 1
	end
	if (string.find(str, "å…³é—­")) then
		return 1
	end
	CheHui(CurrentQQ, data, extData)
	--xxxxxxxxxxxxxxx
    return 1
  end
end
  --è¿›ç¾¤ç§€å›¾æ¬¢è¿


--é—ªç…§æ£€æµ‹å¤„ç†


--åŠŸèƒ½ç»„
function funic(CurrentQQ,data,msg)
    if string.find(msg, "^ç‚¹æ­Œ") then
	    data.Content = msg
        music(CurrentQQ,data,msg)
		return 1
	elseif string.find(msg, "^è¯­éŸ³") then
	    keyWord = msg:gsub("è¯­éŸ³", "")
        sedvoicemsg(CurrentQQ,data,keyWord)
		return 1
	elseif string.find(msg, "^å›¾ç‰‡") then
	    keyWord = msg:gsub("å›¾ç‰‡", "")
        sedimgmsg(CurrentQQ,data,keyWord,"")
		return 1
    elseif string.find(msg, "^å”±æ­Œ") then
        keyWord = msg:gsub("å”±æ­Œ", "")
		if (keyWord == "") then
		    sedmsg(CurrentQQ,data,"æ­Œåä¸èƒ½ç©ºç€å“¦")
		    return 1
		end
		sedmsg(CurrentQQ,data,"å¦¾èº«æ­£åœ¨åŠªåŠ›åŠ è½½Ù©(ËƒÌ¶Ì€Íˆà¯°Ë‚Ì¶ÌÍˆ)Ùˆ")
        response, error_message =
            http.request(
            "POST",
            "http://127.0.0.1:8888/SilkApi/UrlToBuf",--ä¿®æ”¹æ­¤å¤„ipåŠç«¯å£å³å¯
            {
                body = keyWord --ä¼ å…¥æ­Œæ›²å
            }
        )
        log.notice("err   %v", error_message)
        html = response.body --è¿”å›silk base64 buf
		if (string.find(html, "Î´")) then
				    sedmsg(CurrentQQ,data,"å¤©ä¾æ²¡æœ‰æ‰¾åˆ°ç›¸å…³çš„æ­Œå‘€(Ã’Ï‰Ã“×±)ï¼")
					c.close(c)
				    return 2
				end
        luaRes =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "VoiceMsg",
                groupid = 0,
                content = "",
                atUser = 0,
                voiceUrl = "",
                voiceBase64Buf = html 
            }
        )
		return 1
	end
    sedmsg(CurrentQQ,data,msg)
end

--å½±è§†æœç´¢ç”¨
function Sousuo(CurrentQQ,data,msg)
    response, error_message =
        http.request(
            "GET",
            "http://localhost/index.php/ajax/suggest",
            {
                query = "mid=1&f=admin&wd="..msg.."&limit=10&timestamp=1567914326746"
            }
        )
    html = response.body
	json = json.decode(html)
	if (json.total == 0) then
	    sedmsg(CurrentQQ,data,"å½±è§†æŸ¥è¯¢é”™è¯¯\nè¯·æ£€æŸ¥å½±è§†åæ˜¯å¦æ­£ç¡®\nâ•â•â•â•â•â•â•â•â•â•â•\næ³¨æ„âš ï¸å½±è§†åä¸è¦å¸¦æ— å…³æˆ–å¤šä½™çš„å­—ç¬¦")
	else
        sedmsg(CurrentQQ,data,"èµ„æºåœ°å€å¦‚ä¸‹â†“â†“â†“\nâ•â•â•â•â•â•â•â•â•â•\nhttp://118.25.41.32/index.php/vod/search/wd/"..escape(msg)..".html\nâ•â•â•â•â•â•â•â•â•â•â•\næ³¨æ„:å¦‚æœQQå‡ºç°åœæ­¢è®¿é—®ç°è±¡ï¼Œè¯·å¤åˆ¶é“¾æ¥ç”¨æµè§ˆå™¨æ‰“å¼€")
	end
end

--å•çº¯å‘æ¶ˆæ¯å›¾æ–‡é€šç”¨
function sedimgmsg(CurrentQQ,data,url,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "PicMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = url,
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘æ¶ˆæ¯ç”¨
function sedmsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "TextMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘ç§èŠæ¶ˆæ¯ç”¨
function sendfrimsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromUin,
        sendToType = 1,
        sendMsgType = "TextMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘jsonæ¶ˆæ¯ç”¨
function sedjsonmsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "JsonMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--èŠå¤©æ¨¡å—åˆ‡æ¢å‡½æ•°
function liaotian(CurrentQQ,data,msg)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
    if (mim == nil) then
        sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
        return 1
    end
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
	if (str == nil) then
        return 1
    end
	if (string.find(str, "å…³é—­")) then
	    sedmsg(CurrentQQ,data,"æœºå™¨èŠå¤©å¤„äºå…³é—­çŠ¶æ€\nâˆ´è¯·å…ˆå¼€å¯æœºå™¨èŠå¤©")
	    return 1
	end
	--åˆ‡æ¢å¤„ç†
	file = io.open("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt", "w")
	if (msg == 1) then
	    file:write("æ–‡å­—èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°æ–‡å­—èŠå¤©")
	elseif (msg == 2) then
	    file:write("è¯­éŸ³èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°è¯­éŸ³èŠå¤©")
	elseif (msg == 3) then
	    file:write("å›å¤èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°å›å¤èŠå¤©")
	end
	file:close()
end

--éšæœºè¡¨æƒ…å‡½æ•°
function faceArray()
    faceArray = {"[è¡¨æƒ…147]","ğŸ€","ğŸ”¥","ğŸ»","ğŸ’","[è¡¨æƒ…185]","[è¡¨æƒ…219]","[è¡¨æƒ…176]"}
    math.randomseed(os.time())
    num = math.random(1, 9)
    return faceArray[num]
end

--urlç¼–ç è½¬æ¢
function escape(w)
	pattern="[^%w%d%._%-%* ]"
	s=string.gsub(w,pattern,function(c)
		local c=string.format("%%%02X",string.byte(c))
		return c
	end)
	s=string.gsub(s," ","+")
	return s
end

--è¯»å–æ•°æ®å‡½æ•°
function Read(url)
    file = io.open(url, "r")
	if (file == nil) then
	    return nil
	else
        file:seek("set")
	    str = file:read("*a")
	    file:close()
        return str
	end
end

--å†™å…¥æ•°æ®å‡½æ•°
function Wirte(url,msg)
    file = io.open(url, "w+")
    file:write(msg)
	file:close()
    return "ok"
end

--å°æ€èŠå¤©å‡½æ•°
function xiaosiapi(CurrentQQ,data,str)
    response, error_message =
            http.request(
            "GET",
            "https://api.ownthink.com/bot",
            {
                query = "appid="..tostring(data.FromUserId).."&spoken=" .. url_encode(str),
                headers = {
                    Accept = "*/*"
                }
            }
        )
        html = response.body
		jData = json.decode(html)
		return jData
end

--æœºå™¨èŠå¤©å‡½æ•°
function ownthink(CurrentQQ,data,msgs,atqq)
    if (tostring(atqq) == CurrentQQ) then
        m = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
        if (m == nil) then
	        log.info("Str ====> %s", m)
            return 1
	    end
	    if (string.find(m, "å…³é—­")) then
	        sedmsg(CurrentQQ,data,"æœºå™¨èŠå¤©å¤„äºå…³é—­çŠ¶æ€\nâˆ´è¯·å…ˆå¼€å¯æœºå™¨èŠå¤©")
	        return 1
	    end
		res2 = string.find(msgs, " ")
		str = string.sub(msgs,res2)
		jData = xiaosiapi(CurrentQQ,data,str)
		Data = json.decode(data.Content)
		m = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
		if (m == nil) then
	        log.info("Str ====> %s", m)
            return 1
	    end
		if (string.find(m, "å›å¤èŠå¤©")) then
		    Api.Api_SendMsg(
                CurrentQQ,
                {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "ReplayMsg",
                groupid = 0,
                content = jData.data.info.text,
                atUser = 0,
				replayInfo = {
                    MsgSeq = data.MsgSeq,
                    --å›å¤æ¶ˆæ¯çš„Seq
                    MsgTime = data.MsgTime,
                    --å›å¤æ¶ˆæ¯çš„äº‹ä»¶
                    UserID = data.FromUserId,
                    --å›å¤æ¶ˆæ¯å¯¹è±¡
                    RawContent = Data.Content --å›å¤æ¶ˆæ¯çš„åŸå†…å®¹
                }
				}
            )
			return 1
		elseif (string.find(m, "æ–‡å­—èŠå¤©")) then
		    sedmsg(CurrentQQ,data,jData.data.info.text)
		else
		    sedvoicemsg(CurrentQQ,data,url_encode(jData.data.info.text))
		end
    end
end

--å‘é€è¯­éŸ³æ¶ˆæ¯
function sedvoicemsg(CurrentQQ,data,str)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "VoiceMsg",
        groupid = 0,
		voiceUrl = "https://dds.dui.ai/runtime/v1/synthesize?voiceId=qianranfa&speed=0.7&volume=100&audioType=wav&text="..str, --å‘é€è¯­éŸ³çš„ç½‘ç»œåœ°å€ æ–‡æœ¬å‹
        voiceBase64Buf = "",
        content = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å¤©æ°”æŸ¥è¯¢å‡½æ•°
--[[function tianqi(CurrentQQ,data)
    keyWord = data.Content:gsub("å¤©æ°”", "")
        if keyWord == "" then
            return 1
        end

        cookies = Api.Api_GetUserCook(CurrentQQ)

        response, error_message =
            http.request(
            "GET",
            "https://weather.mp.qq.com/cgi-bin/rich",
            {
                query = "g_tk=" .. cookies.Gtk .. "&city=" .. url_encode(keyWord),
                headers = {
                    Referer = "http://weather.mp.qq.com/ark"
                },
                cookies = {
                    uin = CurrentQQ,
                    skey = cookies.Skey
                }
            }
        )
        local html = response.body
        log.notice("From Lua html -->%s", html)

        local j = json.decode(html)
        if j.code ~= 0 then
            return 1
        end

        ApiRet =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "JsonMsg",
                groupid = 0,
                content = string.format(
                    --{"config":{"forward":1,"autosize":1},"prompt":"[åº”ç”¨]å¤©æ°”","app":"com.tencent.weather","ver":"0.0.0.1","view":"RichInfoView","meta":{"richinfo":{"adcode":"101210701","city":"æˆéƒ½","air":"58","min":"20","ts":"1500550866","wind":"1","date":"6æœˆ27æ—¥ å‘¨å››","max":"28","type":"201"}},"desc":"å¤©æ°”"}
                    --[[{"app":"com.tencent.weather","desc":"","meta":{"weather":{"ad":[{"icon":"http://imgcache.qq.com/ac/tq/xz2/tp.jpg","p":"ptype=star","t":"2","title":"æ˜Ÿåº§ | ä»Šå¤©ä¼šå› ä¸ºæ„Ÿæƒ…å’Œå®¶åº­çš„é—®é¢˜ï¼Œå½±å“å·¥ä½œï¼Œè¿˜æœ‰ï¼Œä¹Ÿè¦æ³¨æ„äºº...","url":""},{"icon":"http://imgcache.qq.com/ac/qqweather/image/2019/6/27.png","p":"ptype=lunar","t":"4","title":"é»„å† | å†œå†äº”æœˆå»¿äº”ã€‚å®œè®¢ç›Ÿ.çº³é‡‡.å‡ºè¡Œ.ç¥ˆç¦.æ–‹é†®.å®‰åºŠ.ä¼š...","url":""}],"info":{"it1":{"adcode":"101050101","city":"æ­¦æ±‰","hour":"18","max":"29","min":"17","temp":"24","type":"202","ut":"1561630401","wea":"å¤šäº‘"},"it2":{"hour":"19","temp":"22","type":"202"},"it3":{"hour":"20","temp":"21","type":"202"},"ts":"1561631244"},"url":""}},"prompt":"ã€å“ˆå°”æ»¨ã€‘å¤šäº‘ 17Â°/29Â°, 18:13æ›´æ–°~","ver":"1.0.0.106","view":"WeatherThreeView"}]]
--[[                    [[{"app":"com.tencent.weather","desc":"å¤©æ°”","view":"RichInfoView","ver":"1.0.0.217","prompt":"[åº”ç”¨]å¤©æ°”","meta":{"richinfo":{"adcode":"%s","air":"%s","city":"%s","date":"%s","max":"%s","min":"%s","ts":"1554951408","type":"%s","wind":"%s"}},"config":{"forward":1,"autosize":1,"type":"card"}}]],
--[[                    j.data.adcode,
                    j.data.air,
                    j.data.city,
                    j.data.date,
                    j.data.max,
                    j.data.min,
                    j.data.type,
                    j.data.wind
                ),
                atUser = 0
            }
        )
end
--]]
--è°ƒæ•™å¤„ç†å‡½æ•°(å¾…å¤„ç†)
function tiaojiao(CurrentQQ,data)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
	if (mim == nil) then
		sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå“‡")
		return 1
	end
	if (string.find(data.Content, "^åˆ é™¤è°ƒæ•™")) then
	    msg = data.Content:gsub("åˆ é™¤è°ƒæ•™", "")
	    if (msg == "") then
		    sedmsg(CurrentQQ,data,"è¦åˆ é™¤çš„è°ƒæ•™æŒ‡ä»¤ä¸èƒ½ä¸ºç©ºå“¦")
		    return 1
		end
		rese = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..tostring(data.FromGroupId).."\/"..msg..".txt")
	    if (rese == nil) then
			sedmsg(CurrentQQ,data,"è¿™ä¸ªæŒ‡ä»¤ä¸å­˜åœ¨äº†å“¦")
		    return 1
		end
		rm_file = os.remove("mimoio\/æœºå™¨è°ƒæ•™\/"..tostring(data.FromGroupId).."\/"..msg..".txt")
		log.info("åˆ é™¤è°ƒæ•™ ====> %s", rm_file)
		sedmsg(CurrentQQ,data,"åˆ é™¤æˆåŠŸ\nä½ ä¸å–œæ¬¢è¢«è¿™æ ·è°ƒæ•™çš„æˆ‘å—[è¡¨æƒ…9]")
		return 1
	end
    msgs = data.Content:gsub("è°ƒæ•™", "")
		res2 = string.find(msgs, "#")
		str = string.sub(msgs,res2+1)
		str2 = string.sub(msgs,1,res2-1)
		        
		        if (str == "") then
		            sedmsg(CurrentQQ,data,"è°ƒæ•™çš„å›ç­”å†…å®¹ä¸èƒ½ä¸ºç©ºå“¦")
			        return 1
		        end
				if (str2 == "") then
		            sedmsg(CurrentQQ,data,"è°ƒæ•™çš„æŒ‡ä»¤å†…å®¹ä¸èƒ½ä¸ºç©ºå“¦")
			        return 1
		        end
		        rese = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..str2..".txt")
					if (rese ~= nil) then
				        sedmsg(CurrentQQ,data,"æŒ‡ä»¤å·²ç»å­˜åœ¨äº†å“¦")
				        return 1
				    end
				Wirte("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..str2..".txt",str)
				sedmsg(CurrentQQ,data,"è°ƒæ•™æˆåŠŸ\nä½ è¿˜æƒ³å†è°ƒæ•™æˆ‘ä¸€æ¬¡å—[è¡¨æƒ…6]")
		        return 1
end

function url_encode(str)
    if (str) then
        str = string.gsub(str, "\n", "\r\n")
        str =
            string.gsub(
            str,
            "([^%w ])",
            function(c)
                return string.format("%%%02X", string.byte(c))
            end
        )
        str = string.gsub(str, " ", "+")
    end
    return str
end

--æŠ¢çº¢åŒ…å¤„ç†
function RedBag(CurrentQQ, data)
    Api.Api_OpenRedBag(CurrentQQ, data.RedBaginfo)
    if (data.RedBaginfo.RedType == 12) then
         luaRes =
                Api.Api_SendMsg(
                CurrentQQ,
                {
                    toUser = data.FromGroupId,
                    sendToType = 2,
                    sendMsgType = "TextMsg",
                    groupid = 0,
                    content = data.RedBaginfo.Tittle,
                    atUser = 0
                }
            )
        log.notice("From Lua SendMsg Ret\n%d", luaRes.Ret)
    end
end

--è§†é¢‘è§£æå¤„ç†
function Video(CurrentQQ, data)
    vdata = json.decode(data.Content)
        videodata = {
            GroupID = data.FromGroupId,
            VideoUrl = vdata.VideoUrl,
            VideoMd5 = vdata.VideoMd5
        }
        --æ„é€ table å‚æ•°è¡¨
        luaResp = Api.Api_CallFunc(CurrentQQ, "PttCenterSvr.ShortVideoDownReq", videodata) --é€šè¿‡cmdè°ƒç”¨åŠŸèƒ½åŒ…
        luaRes =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "TextMsg",
                groupid = 0,
                content = "è§£æè§†é¢‘URL-->" .. luaResp.VideoUrl,
                atUser = 0
            }
        )
end

--ç®¡ç†å¼€å…³é€šç”¨
function adminio(CurrentQQ,data,oio)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim ~= nil) then
            msg = data.Content:gsub(oio, "")
            str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
            if (string.find(str, "å…³é—­")) then
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äººå·²è¢«å…³é—­...\nè¯·å…ˆå¼€å¯æœºå™¨äºº")
                return 1
            end
			str2 = Read("mimoio\/çŠ¶æ€æ•°æ®\/"..oio.."\/"..data.FromGroupId..".txt")
			if (string.find(str2, msg)) then
			    sedmsg(CurrentQQ,data,"âˆ´"..oio.."æœ¬å°±æ˜¯"..str2.."çŠ¶æ€")
                return 1
			end
            Wirte("mimoio\/çŠ¶æ€æ•°æ®\/"..oio.."\/"..data.FromGroupId..".txt",msg)
            sedmsg(CurrentQQ,data,"âˆ´"..oio..msg.."æˆåŠŸ")
            return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
end

--ç™¾ç§‘å¤§å…¨
function baike(CurrentQQ,data)
    keyWord = data.Content:gsub("ç™¾ç§‘", "")
        if keyWord == "" then
            return 1
        end
        response, error_message =
            http.request(
            "GET",
            "http://baike.baidu.com/api/openapi/BaikeLemmaCardApi",
            {
                query = "scope=103&format=json&appid=379020&bk_key=" .. url_encode(keyWord) .. "&bk_length=600"
            }
        )
        html = response.body
        while(string.find(html, '"errno":2')) do
            response, error_message =
            http.request(
            "GET",
            "http://baike.baidu.com/api/openapi/BaikeLemmaCardApi",
            {
                query = "scope=103&format=json&appid=379020&bk_key=" .. url_encode(keyWord) .. "&bk_length=600"
            })
			html = response.body
        end
        local j = json.decode(html)
        sedmsg(CurrentQQ,data,j.abstract.."\n"..j.url)
end

--éŸ³ä¹ç‚¹æ­Œ
function music(CurrentQQ,data)
    keyWord = data.Content:gsub("ç‚¹æ­Œ", "")
        if keyWord == "" then
            return 1
        end
        response, error_message =
            http.request(
            "GET",
            "https://c.y.qq.com/soso/fcgi-bin/client_search_cp",
            {
                query = "aggr=1&cr=1&flag_qc=0&p=1&n=6&w=" .. url_encode(keyWord)
            }
        )
        html = response.body
		str = string.sub(html,10,-2)
        j = json.decode(str)
        if (j.code == 0) then
            msg = ""
            num = j.data.song.list
            list = num[1]
            songname = list.songname
            singername = list.singer[1].name
            payplay = list.pay.payplay
			albummid = list.albummid
			songmid = list.songmid
	        sedjsonmsg(CurrentQQ,data,'{"app":"com.tencent.structmsg","desc":"éŸ³ä¹","view":"music","ver":"0.0.0.1","prompt":"[åˆ†äº«]' ..songname.. '","meta":{"music":{"sourceMsgId":"0","title":"' ..songname.. '","desc":"' ..singername.. '","preview":"y.gtimg.cn/music/photo_new/T002R150x150M000'..albummid..'.jpg","tag":"QQéŸ³ä¹","musicUrl":"https://v1.itooi.cn/tencent/url?id='..songmid..'","jumpUrl":"y.qq.com/n/yqq/song/'..songmid..'.html","appid":100497308,"app_type":1,"action":"","source_url":"url.cn/5aSZ8Gc","source_icon":"url.cn/5tLgzTm","android_pkg_name":"com.tencent.qqmusic"}},"config":{"forward":true,"type":"normal","autosize":true}}')
			return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´Error:"..j.code)
			return 1
        end
end

--è®¿é—®url
function geturl(url_class,url,caulrt)
        response, error_message =
            http.request(
            url_class,
            url,
            {
                query = caulrt
            }
        )
        html = response.body
		return html
end

--æ¶ˆæ¯å‚¨è“„
function msgsql(CurrentQQ,data)
    if (mysqlpass == "") then
	    return 1
	end
    c = mysql.new()
    -- åˆå§‹åŒ–mysqlå¯¹è±¡
    ok, err = c:connect({host = mysqlhost, port = 3306, database = mysqldb, user = mysqluser, password = mysqlpass})
    --å»ºç«‹è¿æ¥
    if ok then
        sqlstr =
            string.format(
            [[INSERT INTO msgcache (GroupID, MsgSeq, MsgRandom,MsgType,Data,MsgTime)VALUES (%d,%d,%d,'%s','%s',%d)]],
            data.FromGroupId,
            data.MsgSeq,
            data.MsgRandom,
            data.MsgType,
            data.Content,
            data.MsgTime
        )
        res, err = c:query(sqlstr) --å…¥åº“ç¼“å­˜æ¶ˆæ¯
        log.info("%s", err)
        c.close(c)
    --é‡Šæ”¾è¿æ¥
    end
    return 1
end

--æ’¤å›æ£€æµ‹
function CheHui(CurrentQQ, data, extData)
    c = mysql.new()
    -- åˆå§‹åŒ–mysqlå¯¹è±¡
	if (mysqlpass == "") then
	    return 1
	end
	
    if data.MsgType == "ON_EVENT_GROUP_REVOKE" then --ç›‘å¬ ç¾¤æ’¤å›äº‹ä»¶
        str = string.format("ç¾¤æˆ %d  æˆå‘˜ UserID %s æ’¤å›äº†æ¶ˆæ¯Seq %s \n", extData.GroupID, extData.UserID, extData.MsgSeq)
        log.info("%s", str)
        ok, err = c:connect({host = mysqlhost, port = 3306, database = mysqldb, user = mysqluser, password = mysqlpass})
        --å»ºç«‹è¿æ¥
        log.info("sql %v", err)
        if ok then
            sqlstr =
                string.format(
                "select * from msgcache where `GroupID`= %d and `MsgSeq` = %d",
                extData.GroupID,
                extData.MsgSeq
            )
            res, err = c:query(sqlstr) --è·Ÿç¾¤ç¾¤idå’Œæ¶ˆæ¯SEQæŸ¥è¯¢å‡ºæ’¤å›çš„æ¶ˆæ¯å†…å®¹
            if err == nil then
                c.close(c)
                GroupID = tonumber(res[1]["GroupID"])
                MsgType = res[1]["MsgType"]
                Data = res[1]["Data"]

                if MsgType == "TextMsg" then
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            --å‘é€æ–‡æœ¬æ¶ˆæ¯
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡æ–‡æœ¬æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                Data
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "SmallFaceMsg" then
                    --Data {"Content":"[è¡¨æƒ…101]","Hex":"FKY=","Index":101,"tips":"[å°è¡¨æƒ…]"}
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡è¡¨æƒ…æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).Content
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "PicMsg" then
                    --Data {"Content":"","FileId":2820717626,"FileMd5":"q0oEC5aloJJMFr10mplaXw==","FileSize":7026,"tips":"[ç¾¤å›¾ç‰‡]","url":"http://gchat.qpic.cn/gchatpic_new/1700487478/960839480-2534335053-AB4A040B96A5A0924C16BD749A995A5F/0?vuin=u0026term=255u0026pictype=0"}
                    jData = json.decode(Data)
					if (jData.tips == "[ç¾¤æ¶ˆæ¯-QQé—ªç…§]") then
					    
					Api.Api_SendMsg( 
                    CurrentQQ,
                    {
                        toUser = GroupID,
                        sendToType = 2,
                        sendMsgType = "ForwordMsg",
                        content = "",
                        atUser = 0,
                        groupid = 0,
                        voiceUrl = "",
                        voiceBase64Buf = "",
                        picUrl = "",
                        picBase64Buf = "",
                        forwordBuf = json.decode(Data).ForwordBuf, --æ¬²è½¬å‘çš„base64buf å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                        forwordField = json.decode(Data).ForwordField --æ¬²å†™å…¥åè®®çš„å­—æ®µID å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                    }
                )
				    return 1
					end
                    Api.Api_SendMsg( --é€šè¿‡å›¾ç‰‡md5å‘é€å›¾ç‰‡ ç§’å‘ä¸ç”¨ä¸Šä¼  ç›¸å½“äºè½¬å‘
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "PicMsg",
                            --å‘é€å›¾æ–‡æ¶ˆæ¯
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡å›¾ç‰‡æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š[PICFLAG]%s",
                                extData.UserID,
                                jData.Content
                            ),
                            --é€šè¿‡å®[PICFLAG]æ”¹å˜å›¾æ–‡é¡ºåº  æ”¹ä¸ºç°æ–‡å­—åå›¾ç‰‡
                            atUser = 0,
                            voiceUrl = "",
                            voiceBase64Buf = "",
                            picUrl = "",
                            picBase64Buf = "",
                            fileMd5 = jData.FileMd5
                        }
                    )
                end
                if MsgType == "AtMsg" then
                    --Data {"Content":"@Kar98k skjjkssjkjs","UserID":123456789,"tips":"[ATæ¶ˆæ¯]"}
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡atæ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).Content
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "VoiceMsg" then
                    --Data {"tips":"[è¯­éŸ³]","url":"http://grouptalk.c2c.qq.com/?ver=0u0026rkey=3062020101045b305902010102010102041fdef8ae042439416931554e5142586c536d78706a314c686843664959725f327a5f573064697653755902045dac2a21041f0000000866696c6574797065000000013100000005636f64656300000001310400u0026filetype=1u0026voice_codec=1"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "VoiceMsg",
                            --å‘é€ç¾¤è¯­éŸ³æ¶ˆæ¯
                            groupid = 0,
                            content = "",
                            atUser = 0,
                            voiceUrl = json.decode(Data).url,
                            --é€šè¿‡ç½‘ç»œurlè¿›è¡Œå‘é€è¯­éŸ³
                            voiceBase64Buf = "",
                            picUrl = "",
                            picBase64Buf = ""
                        }
                    )
                end

                if MsgType == "ReplayMsg" then
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡å›å¤æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).ReplayContent
                            ),
                            atUser = 0
                        }
                    )
                end
				if MsgType == "VideoMsg" then
	             Api.Api_SendMsg( 
                    CurrentQQ,
                    {
                        toUser = GroupID,
                        sendToType = 2,
                        sendMsgType = "ForwordMsg",
                        content = "",
                        atUser = 0,
                        groupid = 0,
                        voiceUrl = "",
                        voiceBase64Buf = "",
                        picUrl = "",
                        picBase64Buf = "",
                        forwordBuf = json.decode(Data).ForwordBuf, --æ¬²è½¬å‘çš„base64buf å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                        forwordField = json.decode(Data).ForwordField --æ¬²å†™å…¥åè®®çš„å­—æ®µID å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                    }
                )
				end
                if MsgType == "XmlMsg" then
				    
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "XmlMsg",
                            groupid = 0,
                            content = string.format("%s", Data),
                            atUser = 0
                        }
                    )
                end
				if MsgType == "JsonMsg" then
				    
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "JsonMsg",
                            groupid = 0,
                            content = string.format("%s", Data),
                            atUser = 0
                        }
                    )
                end
            end
        end
    end
    return 1
end
2020/09/07 12:55:10.413 [E]  mimoio.lua
2020/09/07 12:55:10.413 [E]  local log = require("log")
local Api = require("coreApi")
local json = require("json")
local http = require("http")
local mysql = require("mysql")

--ç‰ˆæœ¬å·(ä¸è¦æ”¹åŠ¨)
Vabr = "1.0.2"
--æ•°æ®åº“é…ç½®
mysqlhost = "localhost"--é»˜è®¤ä¸åŠ¨
mysqldb = "ffaxx001"--æ•°æ®åº“å
mysqluser = "ffaxx001"--æ•°æ®åº“ç”¨æˆ·å
mysqlpass = "123456"--æ•°æ®åº“å¯†ç 
--ä¸ä½¿ç”¨è¯·ä¸è¦æ”¹åŠ¨

function ReceiveFriendMsg(CurrentQQ, data)
    if (data.Content == "ä½¿ç”¨æ–¹æ³•") then
	    sendfrimsg(CurrentQQ,data,"æ·»åŠ æˆæƒè€…çš„æ–¹æ³•\nå¯¹å•ä¸ªæœºå™¨äººç§èŠå‘é€[æ·»åŠ æˆæƒè€…+æˆæƒè€…QQ]\n\næˆæƒç¾¤çš„æ–¹æ³•\nåˆ°éœ€è¦æˆæƒçš„ç¾¤é‡Œå‘é€[æˆæƒ+ä¸»äººQQ]ã€‚æ³¨æ„:æˆæƒå¿…é¡»æ˜¯æˆæƒè€…è¿›è¡Œæ“ä½œ,ç®¡ç†å‘˜æˆæƒä¸äº†")
	end
    --æ•°æ®åˆå§‹åŒ–
    if (data.Content == "åˆå§‹åŒ–") then
	    root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root ~= nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´è¯·ä¸è¦é‡å¤åˆå§‹åŒ–")
			return 1
		end
    --os.execute('mkdir mimoio/æœºå™¨æˆæƒ')
	    os.execute('mkdir mimoio')
		os.execute('mkdir mimoio/å¤è¯»æœº')
		os.execute('mkdir mimoio/å¤è¯»æœº/æ¬¡æ•°')
		os.execute('mkdir mimoio/å¤è¯»æœº/å†…å®¹')
		os.execute('mkdir mimoio/æœºå™¨æˆæƒ')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨ä¸»äºº')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨èŠå¤©')
		os.execute('mkdir mimoio/æœºå™¨è°ƒæ•™')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æŠ¢çº¢åŒ…')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æœºå™¨èŠå¤©')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æœºå™¨å¼€å…³')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æ’¤å›æ£€æµ‹')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/å›¾ç‰‡è§£æ')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/è§†é¢‘è§£æ')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/é—ªç…§æ£€æµ‹')
		Wirte("mimoio\/"..data.FromUin..".txt","999")
		sendfrimsg(CurrentQQ,data,"åˆå§‹åŒ–å®Œæ¯•ï¼\nå‘é€[ä½¿ç”¨æ–¹æ³•]äº†è§£ä½¿ç”¨å§")
	end
	--æ·»åŠ æˆæƒè€…æ“ä½œ(ç§èŠæœºå™¨äººå‘é€)
	if (string.find(data.Content, "^æ·»åŠ æˆæƒè€…")) then
	    msg = data.Content:gsub("æ·»åŠ æˆæƒè€…", "")
		--Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromUin..".txt","å…³é—­")
		root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root == nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„ç®¡ç†è€…")
			return 1
		end
		Wirte("mimoio\/æœºå™¨æˆæƒ\/"..msg..CurrentQQ..".txt","999")
		sendfrimsg(CurrentQQ,data,"âˆ´æ·»åŠ æˆæƒè€…æˆåŠŸ")
	end
	--åˆ é™¤æˆæƒè€…æ“ä½œ(ç§èŠæœºå™¨äººå‘é€)
	if (string.find(data.Content, "^åˆ é™¤æˆæƒè€…")) then
	    msg = data.Content:gsub("åˆ é™¤æˆæƒè€…", "")
		--Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromUin..".txt","å…³é—­")
		root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root == nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„ç®¡ç†è€…")
			return 1
		end
		os.remove("mimoio\/æœºå™¨æˆæƒ\/"..msg..CurrentQQ..".txt")
		sendfrimsg(CurrentQQ,data,"âˆ´åˆ é™¤æˆæƒè€…æˆåŠŸ")
	end
    return 1
end
function ReceiveGroupMsg(CurrentQQ, data)
    if (tostring(data.FromUserId) == CurrentQQ) then
	    return 1
	end
	--ç¾¤èŠæˆæƒ(åˆ°éœ€è¦æˆæƒçš„ç¾¤é‡Œæ“ä½œ)
	if (string.find(data.Content, "^æˆæƒ")) then
	    root = Read("mimoio\/æœºå™¨æˆæƒ\/"..data.FromUserId..CurrentQQ..".txt","999")
		if (root == nil) then
		    sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„æˆæƒè€…")
			return 1
		end
		msg = data.Content:gsub("æˆæƒ", "")
		os.execute('mkdir mimoio/æœºå™¨è°ƒæ•™/'..data.FromGroupId)
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨ä¸»äºº/'..data.FromGroupId)
		Wirte("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..msg..".txt","999")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt","å›å¤èŠå¤©")
		sedmsg(CurrentQQ,data,"âˆ´æˆæƒæˆåŠŸï¼\nå‘é€[å¼€å¯æœºå™¨äºº]ä½¿ç”¨å§")
	end
	--åˆ é™¤æˆæƒæ“ä½œ(åˆ°éœ€è¦åˆ é™¤æˆæƒçš„ç¾¤é‡Œæ“ä½œ)
	if (string.find(data.Content, "^åˆ é™¤æˆæƒ")) then
	    root = Read("mimoio\/æœºå™¨æˆæƒ\/"..data.FromUserId..CurrentQQ..".txt","999")
		if (root == nil) then
		    sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„æˆæƒè€…")
			return 1
		end
		msg = data.Content:gsub("åˆ é™¤æˆæƒ", "")
		os.remove("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..msg..".txt")
		os.remove("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
		sedmsg(CurrentQQ,data,"âˆ´åˆ é™¤æˆæƒæˆåŠŸï¼")
	end
	--æœºå™¨å¼€å…³æŒ‡ä»¤
	if (data.Content == "å¼€å¯æœºå™¨äºº" or data.Content == "å…³é—­æœºå™¨äºº") then
        mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim ~= nil) then
            msg = data.Content:gsub("æœºå™¨äºº", "")
            str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
			if (str == nil) then
			    Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt",msg)
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äºº"..msg.."æˆåŠŸï¼")
				log.info("Str ====> %s", str)
                return 1
			end
			
            if (string.find(str, msg)) then
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äººä¸€ç›´æ˜¯"..msg.."çš„å‘")
                return 1
            end
            Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt",msg)
            sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äºº"..msg.."æˆåŠŸï¼")
            return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
	end
    --æœºå™¨äººå¼€å¯æ£€æµ‹
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
	if (str == nil) then
	    log.info("Str ====> %s", str)
        return 1
	end
	if (string.find(str, "å…³é—­")) then
	    return 1
	end
	--atæ¶ˆæ¯å¤„ç†
	msgs = ""
	atqq = 0
	if (string.find(data.Content, "ATæ¶ˆæ¯")) then
	    msgs = json.decode(data.Content).Content
		atqq = json.decode(data.Content).UserID
	end
	--å°¾å·´è‡ªå®šä¹‰(å¾…å®Œå–„)
	tips = "â€”â€”å‡¤é£ç¿±ç¿”å…®ä¸·"
    --åŠŸèƒ½æ¨¡å—
    if (data.Content == "åŠŸèƒ½" or data.Content == "ä¸»ç•Œé¢") then
        face = faceArray()
        sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."å½±è§†æœç´¢\n"..face.."èŠå¤©å¨±ä¹\n"..face.."ä¾¿åˆ©åŠŸèƒ½\n"..face.."æœºå™¨è°ƒæ•™\n"..face.."ç®¡ç†ç³»ç»Ÿ\n"..face.."bugåé¦ˆ\n"..face.."æœ¬ç¾¤çŠ¶æ€\n"..face.."æ›´æ–°æ£€æµ‹\n\n"..tips)
    end
    --å½±è§†æœç´¢æ¨¡å—
    if (data.Content == "å½±è§†æœç´¢") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."æœç´¢+å½±è§†å\n"..face.."æˆ‘æƒ³çœ‹+å½±è§†å\n"..face.."æˆ‘è¦çœ‹+å½±è§†å\n\n"..tips)
    elseif (string.find(data.Content, "^æœç´¢")) then
	    msg = data.Content:gsub("æœç´¢", "")
		Sousuo(CurrentQQ,data,msg)
	elseif (string.find(data.Content, "^æˆ‘æƒ³çœ‹")) then
	    msg = data.Content:gsub("æˆ‘æƒ³çœ‹", "")
		Sousuo(CurrentQQ,data,msg)
    elseif (string.find(data.Content, "^æˆ‘è¦çœ‹")) then
	    msg = data.Content:gsub("æˆ‘è¦çœ‹", "")
		Sousuo(CurrentQQ,data,msg)
	end
	--èŠå¤©å¨±ä¹æ¨¡å—
	if (data.Content == "èŠå¤©å¨±ä¹") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."åˆ‡æ¢æ–‡å­—èŠå¤©\n"..face.."åˆ‡æ¢å›å¤èŠå¤©\n"..face.."åˆ‡æ¢è¯­éŸ³èŠå¤©\n\n"..tips)
    elseif (data.Content == "åˆ‡æ¢æ–‡å­—èŠå¤©") then
		liaotian(CurrentQQ,data,1)
	elseif (data.Content == "åˆ‡æ¢è¯­éŸ³èŠå¤©") then
	    liaotian(CurrentQQ,data,2)
    elseif (data.Content == "åˆ‡æ¢å›å¤èŠå¤©") then
	    liaotian(CurrentQQ,data,3)
	else
	    ownthink(CurrentQQ,data,msgs,atqq)
	end
	--ä¾¿åˆ©åŠŸèƒ½æ¨¡å—
	if (data.Content == "ä¾¿åˆ©åŠŸèƒ½") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."ç™¾ç§‘å¤§å…¨\n"..face.."éŸ³ä¹ç‚¹æ­Œ\n"..face.."é—ªä»–@xx\n"..face.."å¤©æ°”æŸ¥è¯¢\n\n"..tips)
	elseif (data.Content == "ç™¾ç§‘å¤§å…¨") then
		sedmsg(CurrentQQ,data,"å‘é€:[ç™¾ç§‘+å…³é”®è¯]\nä¾‹å¦‚:ç™¾ç§‘æ´›å¦¾èº«")
    elseif (data.Content == "éŸ³ä¹ç‚¹æ­Œ") then
		sedmsg(CurrentQQ,data,"å‘é€:[ç‚¹æ­Œ+æ­Œå]\nä¾‹å¦‚:ç‚¹æ­Œé’æŸ ")
	elseif (data.Content == "å¤©æ°”æŸ¥è¯¢") then
		sedmsg(CurrentQQ,data,"å‘é€:[å¤©æ°”+åœ°æ–¹å]\nä¾‹å¦‚:å¤©æ°”åŒ—äº¬(é™äºå›½å†…)")
    elseif (string.find(data.Content, "^å¤©æ°”")) then
        tianqi(CurrentQQ,data)
	    --msg = data.Content:gsub("æœç´¢", "")
		--Sousuo(CurrentQQ,data,msg)
	elseif (string.find(data.Content, "^ç™¾ç§‘")) then
	    baike(CurrentQQ,data)
	    --msg = data.Content:gsub("æˆ‘æƒ³çœ‹", "")
		--Sousuo(CurrentQQ,data,msg)music(CurrentQQ,data)
    elseif (string.find(data.Content, "^ç‚¹æ­Œ")) then
	    music(CurrentQQ,data)
	end
	--æœºå™¨è°ƒæ•™æ¨¡å—
	if (data.Content == "æœºå™¨è°ƒæ•™") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."æ–‡å­—è°ƒæ•™\n"..face.."è¯­éŸ³è°ƒæ•™\n"..face.."å”±æ­Œè°ƒæ•™\n"..face.."éŸ³ä¹è°ƒæ•™\n"..face.."å›¾ç‰‡è°ƒæ•™\n"..face.."åˆ é™¤è°ƒæ•™\n\n"..tips)
    elseif (data.Content == "æ–‡å­—è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#(å†…å®¹)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#ä½ å¥½å•Š")
	elseif (data.Content == "è¯­éŸ³è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#è¯­éŸ³(å†…å®¹)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#è¯­éŸ³ä½ å¥½å•Š")
	elseif (data.Content == "å›¾ç‰‡è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#å›¾ç‰‡(é“¾æ¥)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#å›¾ç‰‡http://../1.jpg")
	elseif (data.Content == "éŸ³ä¹è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#ç‚¹æ­Œ(æ­Œå)]\nä¾‹å¦‚:è°ƒæ•™å–µ#ç‚¹æ­Œå­¦çŒ«å«")
	elseif (data.Content == "å”±æ­Œè°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#å”±æ­Œ(æ­Œå)]\nä¾‹å¦‚:è°ƒæ•™å–µ#å”±æ­Œå­¦çŒ«å«")
	elseif (data.Content == "åˆ é™¤è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[åˆ é™¤è°ƒæ•™(æŒ‡ä»¤)]\nä¾‹å¦‚:åˆ é™¤è°ƒæ•™ä½ å¥½")
	elseif (string.find(data.Content, "^è°ƒæ•™")) then
        tiaojiao(CurrentQQ,data)
	elseif (string.find(data.Content, "^åˆ é™¤è°ƒæ•™")) then
        tiaojiao(CurrentQQ,data)
	end
	--ç®¡ç†ç³»ç»Ÿæ¨¡å—
	if (data.Content == "ç®¡ç†ç³»ç»Ÿ") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."å¼€å¯/å…³é—­æœºå™¨äºº\n"..face.."å¼€å¯/å…³é—­æŠ¢çº¢åŒ…\n"..face.."å¼€å¯/å…³é—­æœºå™¨èŠå¤©\n"..face.."å¼€å¯/å…³é—­é—ªç…§æ£€æµ‹\n"..face.."å¼€å¯/å…³é—­å›¾ç‰‡è§£æ\n"..face.."å¼€å¯/å…³é—­è§†é¢‘è§£æ\n"..face.."å¼€å¯/å…³é—­æ’¤å›æ£€æµ‹\n\n"..tips)
    elseif (data.Content == "å¼€å¯æœºå™¨èŠå¤©" or data.Content == "å…³é—­æœºå™¨èŠå¤©") then
        adminio(CurrentQQ,data,"æœºå™¨èŠå¤©")
    elseif (data.Content == "å¼€å¯æ’¤å›æ£€æµ‹" or data.Content == "å…³é—­æ’¤å›æ£€æµ‹") then
        adminio(CurrentQQ,data,"æ’¤å›æ£€æµ‹")
	elseif (data.Content == "å¼€å¯é—ªç…§æ£€æµ‹" or data.Content == "å…³é—­é—ªç…§æ£€æµ‹") then
        adminio(CurrentQQ,data,"é—ªç…§æ£€æµ‹")
	elseif (data.Content == "å¼€å¯æŠ¢çº¢åŒ…" or data.Content == "å…³é—­æŠ¢çº¢åŒ…") then
        adminio(CurrentQQ,data,"æŠ¢çº¢åŒ…")
	elseif (data.Content == "å¼€å¯è§†é¢‘è§£æ" or data.Content == "å…³é—­è§†é¢‘è§£æ") then
        adminio(CurrentQQ,data,"è§†é¢‘è§£æ")
	elseif (data.Content == "å¼€å¯å›¾ç‰‡è§£æ" or data.Content == "å…³é—­å›¾ç‰‡è§£æ") then
        adminio(CurrentQQ,data,"å›¾ç‰‡è§£æ")
	end
	--bugåé¦ˆæ¨¡å—
	if (data.Content == "BUGåé¦ˆ" or data.Content == "bugåé¦ˆ") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."é‚®ä»¶åé¦ˆ\n"..face.."QQåé¦ˆ\n\n"..tips)
    elseif (data.Content == "QQåé¦ˆ") then
        sedmsg(CurrentQQ,data,"???Î£(ï¾Ÿâˆ€ï¾Ÿï¾‰)ï¾‰\næ’ä»¶æœ‰é—®é¢˜å¯ä»¥åé¦ˆåˆ°:\nQQ:2353065854")
    elseif (data.Content == "é‚®ä»¶åé¦ˆ") then
        sedmsg(CurrentQQ,data,"å®è´å’‹å•¦=ÍÍŸÍŸÍ(ê’ªá—œê’ª â€§Ì£Ì¥Ì‡)\næ’ä»¶æœ‰é—®é¢˜å¯ä»¥åé¦ˆåˆ°:\né‚®ç®±ğŸ“¬:ym-o@qq.com")
	end
	--æœ¬ç¾¤çŠ¶æ€æ¨¡æ¿
	if (data.Content == "æœ¬ç¾¤çŠ¶æ€") then
        face = faceArray()
        hb = Read("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt")
        sz = Read("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt")
		tp = Read("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt")
        sp = Read("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt")
        jqr = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
        lt = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
        ch = Read("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..data.FromGroupId..".txt")
		sedmsg(CurrentQQ,data,"çŠ¶æ€æ•°æ®åˆ—è¡¨â†“â†“â†“\n"..face.."æœºå™¨äºº:"..jqr.."\n"..face.."æŠ¢çº¢åŒ…:"..hb.."\n"..face.."å›¾ç‰‡è§£æ:"..tp.."\n"..face.."æ’¤å›æ£€æµ‹:"..ch.."\n"..face.."è§†é¢‘è§£æ:"..sp.."\n"..face.."æœºå™¨èŠå¤©:"..lt.."\n"..face.."é—ªç…§æ£€æµ‹:"..sz.."\n\n"..tips)
	end
	--æ›´æ–°æ¨¡å—
	if (data.Content == "æ›´æ–°æ£€æµ‹") then
        str = geturl("GET","http://118.25.41.32/Lsb/lua/Vabr.txt","")
		log.info("Str ====> %s", str)
        if (string.find(str, Vabr)) then
            sedmsg(CurrentQQ,data,"å½“å‰ç‰ˆæœ¬ä¸ºæœ€æ–°ç‰ˆ")
        else
            sedmsg(CurrentQQ,data,"å‘ç°æ–°ç‰ˆæœ¬!\nå½“å‰ç‰ˆæœ¬:"..Vabr.."\næ–°ç‰ˆæœ¬å·:"..str.."\nèµ¶å¿«å‘é€[æ›´æ–°æ’ä»¶]å§")
        end
	elseif (data.Content == "æ›´æ–°æ’ä»¶") then
	    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim == nil) then
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
        str = geturl("GET","http://118.25.41.32/Lsb/lua/Vabr.txt","")
		log.info("Str ====> %s", str)
        if (string.find(str, Vabr)) then
            sedmsg(CurrentQQ,data,"å½“å‰ç‰ˆæœ¬ä¸ºæœ€æ–°ç‰ˆ")
        else
            str = geturl("GET","http://118.25.41.32/Lsb/lua/mimoio.txt","")
            Wirte("Plugins\/mimoio.lua",str)
            sedmsg(CurrentQQ,data,"æ›´æ–°å®Œæ¯•ï¼")
        end
	end
	--å›¾ç‰‡ç±»å‹æ¶ˆæ¯å¤„ç†
    if (data.MsgType == "PicMsg") then
	    msg = Read("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt")
		jData = json.decode(data.Content)
	    if (msg ~= nil and jData.tips ~= "[ç¾¤æ¶ˆæ¯-QQé—ªç…§]") then
            if (string.find(str, "å¼€å¯")) then
	            sedmsg(CurrentQQ,data,"å›¾ç‰‡é“¾æ¥è§£æå¦‚ä¸‹â†“â†“\n"..jData.url)
				return 1
	        end
	    end
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt")
	    if (str == nil) then
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    --é—ªç…§ã€å›¾ç‰‡å¤„ç†æ¨¡å—
		PicFlag(CurrentQQ, data)
    end
	--æŠ¢çº¢åŒ…å¤„ç†
	if (string.find(data.MsgType, "RedBagMsg") == 1) then
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt")
		if (str == nil) then
	        log.info("Str ====> %s", str)
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    RedBag(CurrentQQ, data)
	end
	--è§†é¢‘è§£æå¤„ç†
	if (string.find(data.MsgType, "VideoMsg") == 1) then
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt")
		if (str == nil) then
	        log.info("Str ====> %s", str)
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    Video(CurrentQQ, data)
	end
	--até—ªå›¾
	if (data.MsgType == "AtMsg") and (string.find(data.Content, "é—ªä»–")) then
	    shantu(CurrentQQ, data)
    end
	--è°ƒæ•™æœç´¢å¼•æ“
	mim = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..data.Content..".txt")
	if (mim == nil) then
	    --äººç±»çš„æœ¬è´¨æ˜¯å¤è¯»æœº
	    msg = Read("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt")
		if (msg ~= nil) then
		    cs = Read("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt")
			ii = tonumber(cs)
			if (string.find(msg, "^"..data.Content.."$")) then
			    if (ii > 2) then
			         math.randomseed(os.time())
                     sj = math.random(1, 5)
		             if (sj == 1 or sj == 2) then
			             sedmsg(CurrentQQ,data,msg)
					     rr = ii + 1
		                 Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
				     elseif (sj == 3) then
				         os.remove("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt")
					     os.remove("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt")
					     fdArray = {"çªç„¶æˆªæ–­å¤è¯»(ï¾ŸâŠ¿ï¾Ÿ)ï¾‚","å¤è¯»å¯è€»(â€¢Ì€ã¸ â€¢Ì â•® )","ä¸è¦å¤è¯»äº†å•¦","è¿™å°±æ˜¯æ‰€è°“çš„äººç±»çš„æœ¬è´¨","ä½ ä»¬å’‹ä¸ä¸Šå¤©å‘","åˆå¤è¯»ä¸Šç˜¾äº†å•Š"}
                         math.randomseed(os.time())
                         fdsj = math.random(1, 6)
				         sedmsg(CurrentQQ,data,fdArray[fdsj])
				     else
			             rr = ii + 1
		                 Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
		             end
			    else
			        rr = ii + 1
		            Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
			    end
			else
			    if (ii > 2) then
			        math.randomseed(os.time())
                    sj2 = math.random(1, 3)
					if (sj2 == 2) then
					    fdArray2 = {"ä¸­æ–­å¤è¯»å¯è€»","æ‰“æ–­å¤è¯»å¯è€»(â€¢Ì€ã¸ â€¢Ì â•® )","ä½ ä¸ºä»€ä¹ˆè¦æ‰“æ–­å¤è¯»å•Š","å¤è¯»ä¸é¦™å˜›","ç ´åæ°›å›´(à¸‡áµ’ÌŒçš¿áµ’ÌŒ)à¸‡â¼Â³â‚Œâ‚ƒ"}
                        math.randomseed(os.time())
                        fdsj2 = math.random(1, 5)
				        sedmsg(CurrentQQ,data,fdArray2[fdsj2])
					end
				end
				Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt","1")
			    Wirte("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt",data.Content)
			end
		else
		    Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt","1")
			Wirte("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt",data.Content)
		end
	    --å¦‚æœè°ƒæ•™æŒ‡ä»¤ä¸å­˜åœ¨ï¼Œåˆ™è¿›è¡Œå…¶ä»–æ“ä½œ
	    msgsql(CurrentQQ,data)--æ•°æ®å‚¨è“„
		--éšæœºå›å¤æ¶ˆæ¯æ¦‚ç‡0.04
	    math.randomseed(os.time())
        num = math.random(1, 40)
		if (num == 12) then
		    j = xiaosiapi(CurrentQQ,data,data.Content)
			sedmsg(CurrentQQ,data,j.data.info.text)
		end
	else
	    --è§¦å‘è°ƒæ•™æŒ‡ä»¤
		funic(CurrentQQ,data,mim)
	end
    return 1
end

function ReceiveEvents(CurrentQQ, data, extData)
  if data.MsgType == "ON_EVENT_GROUP_REVOKE" then --ç›‘å¬ ç¾¤æ’¤å›äº‹ä»¶
    --æ’¤å›äº‹ä»¶å¤„ç†
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..extData.GroupID..".txt")
    if (str == nil) then
	    log.info("Str ====> %s", str)
        return 1
	end
	if (string.find(str, "å…³é—­")) then
		return 1
	end
	CheHui(CurrentQQ, data, extData)
	--xxxxxxxxxxxxxxx
    return 1
  end
end
  --è¿›ç¾¤ç§€å›¾æ¬¢è¿


--é—ªç…§æ£€æµ‹å¤„ç†


--åŠŸèƒ½ç»„
function funic(CurrentQQ,data,msg)
    if string.find(msg, "^ç‚¹æ­Œ") then
	    data.Content = msg
        music(CurrentQQ,data,msg)
		return 1
	elseif string.find(msg, "^è¯­éŸ³") then
	    keyWord = msg:gsub("è¯­éŸ³", "")
        sedvoicemsg(CurrentQQ,data,keyWord)
		return 1
	elseif string.find(msg, "^å›¾ç‰‡") then
	    keyWord = msg:gsub("å›¾ç‰‡", "")
        sedimgmsg(CurrentQQ,data,keyWord,"")
		return 1
    elseif string.find(msg, "^å”±æ­Œ") then
        keyWord = msg:gsub("å”±æ­Œ", "")
		if (keyWord == "") then
		    sedmsg(CurrentQQ,data,"æ­Œåä¸èƒ½ç©ºç€å“¦")
		    return 1
		end
		sedmsg(CurrentQQ,data,"å¦¾èº«æ­£åœ¨åŠªåŠ›åŠ è½½Ù©(ËƒÌ¶Ì€Íˆà¯°Ë‚Ì¶ÌÍˆ)Ùˆ")
        response, error_message =
            http.request(
            "POST",
            "http://127.0.0.1:8888/SilkApi/UrlToBuf",--ä¿®æ”¹æ­¤å¤„ipåŠç«¯å£å³å¯
            {
                body = keyWord --ä¼ å…¥æ­Œæ›²å
            }
        )
        log.notice("err   %v", error_message)
        html = response.body --è¿”å›silk base64 buf
		if (string.find(html, "Î´")) then
				    sedmsg(CurrentQQ,data,"å¤©ä¾æ²¡æœ‰æ‰¾åˆ°ç›¸å…³çš„æ­Œå‘€(Ã’Ï‰Ã“×±)ï¼")
					c.close(c)
				    return 2
				end
        luaRes =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "VoiceMsg",
                groupid = 0,
                content = "",
                atUser = 0,
                voiceUrl = "",
                voiceBase64Buf = html 
            }
        )
		return 1
	end
    sedmsg(CurrentQQ,data,msg)
end

--å½±è§†æœç´¢ç”¨
function Sousuo(CurrentQQ,data,msg)
    response, error_message =
        http.request(
            "GET",
            "http://localhost/index.php/ajax/suggest",
            {
                query = "mid=1&f=admin&wd="..msg.."&limit=10&timestamp=1567914326746"
            }
        )
    html = response.body
	json = json.decode(html)
	if (json.total == 0) then
	    sedmsg(CurrentQQ,data,"å½±è§†æŸ¥è¯¢é”™è¯¯\nè¯·æ£€æŸ¥å½±è§†åæ˜¯å¦æ­£ç¡®\nâ•â•â•â•â•â•â•â•â•â•â•\næ³¨æ„âš ï¸å½±è§†åä¸è¦å¸¦æ— å…³æˆ–å¤šä½™çš„å­—ç¬¦")
	else
        sedmsg(CurrentQQ,data,"èµ„æºåœ°å€å¦‚ä¸‹â†“â†“â†“\nâ•â•â•â•â•â•â•â•â•â•\nhttp://118.25.41.32/index.php/vod/search/wd/"..escape(msg)..".html\nâ•â•â•â•â•â•â•â•â•â•â•\næ³¨æ„:å¦‚æœQQå‡ºç°åœæ­¢è®¿é—®ç°è±¡ï¼Œè¯·å¤åˆ¶é“¾æ¥ç”¨æµè§ˆå™¨æ‰“å¼€")
	end
end

--å•çº¯å‘æ¶ˆæ¯å›¾æ–‡é€šç”¨
function sedimgmsg(CurrentQQ,data,url,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "PicMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = url,
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘æ¶ˆæ¯ç”¨
function sedmsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "TextMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘ç§èŠæ¶ˆæ¯ç”¨
function sendfrimsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromUin,
        sendToType = 1,
        sendMsgType = "TextMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘jsonæ¶ˆæ¯ç”¨
function sedjsonmsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "JsonMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--èŠå¤©æ¨¡å—åˆ‡æ¢å‡½æ•°
function liaotian(CurrentQQ,data,msg)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
    if (mim == nil) then
        sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
        return 1
    end
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
	if (str == nil) then
        return 1
    end
	if (string.find(str, "å…³é—­")) then
	    sedmsg(CurrentQQ,data,"æœºå™¨èŠå¤©å¤„äºå…³é—­çŠ¶æ€\nâˆ´è¯·å…ˆå¼€å¯æœºå™¨èŠå¤©")
	    return 1
	end
	--åˆ‡æ¢å¤„ç†
	file = io.open("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt", "w")
	if (msg == 1) then
	    file:write("æ–‡å­—èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°æ–‡å­—èŠå¤©")
	elseif (msg == 2) then
	    file:write("è¯­éŸ³èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°è¯­éŸ³èŠå¤©")
	elseif (msg == 3) then
	    file:write("å›å¤èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°å›å¤èŠå¤©")
	end
	file:close()
end

--éšæœºè¡¨æƒ…å‡½æ•°
function faceArray()
    faceArray = {"[è¡¨æƒ…147]","ğŸ€","ğŸ”¥","ğŸ»","ğŸ’","[è¡¨æƒ…185]","[è¡¨æƒ…219]","[è¡¨æƒ…176]"}
    math.randomseed(os.time())
    num = math.random(1, 9)
    return faceArray[num]
end

--urlç¼–ç è½¬æ¢
function escape(w)
	pattern="[^%w%d%._%-%* ]"
	s=string.gsub(w,pattern,function(c)
		local c=string.format("%%%02X",string.byte(c))
		return c
	end)
	s=string.gsub(s," ","+")
	return s
end

--è¯»å–æ•°æ®å‡½æ•°
function Read(url)
    file = io.open(url, "r")
	if (file == nil) then
	    return nil
	else
        file:seek("set")
	    str = file:read("*a")
	    file:close()
        return str
	end
end

--å†™å…¥æ•°æ®å‡½æ•°
function Wirte(url,msg)
    file = io.open(url, "w+")
    file:write(msg)
	file:close()
    return "ok"
end

--å°æ€èŠå¤©å‡½æ•°
function xiaosiapi(CurrentQQ,data,str)
    response, error_message =
            http.request(
            "GET",
            "https://api.ownthink.com/bot",
            {
                query = "appid="..tostring(data.FromUserId).."&spoken=" .. url_encode(str),
                headers = {
                    Accept = "*/*"
                }
            }
        )
        html = response.body
		jData = json.decode(html)
		return jData
end

--æœºå™¨èŠå¤©å‡½æ•°
function ownthink(CurrentQQ,data,msgs,atqq)
    if (tostring(atqq) == CurrentQQ) then
        m = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
        if (m == nil) then
	        log.info("Str ====> %s", m)
            return 1
	    end
	    if (string.find(m, "å…³é—­")) then
	        sedmsg(CurrentQQ,data,"æœºå™¨èŠå¤©å¤„äºå…³é—­çŠ¶æ€\nâˆ´è¯·å…ˆå¼€å¯æœºå™¨èŠå¤©")
	        return 1
	    end
		res2 = string.find(msgs, " ")
		str = string.sub(msgs,res2)
		jData = xiaosiapi(CurrentQQ,data,str)
		Data = json.decode(data.Content)
		m = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
		if (m == nil) then
	        log.info("Str ====> %s", m)
            return 1
	    end
		if (string.find(m, "å›å¤èŠå¤©")) then
		    Api.Api_SendMsg(
                CurrentQQ,
                {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "ReplayMsg",
                groupid = 0,
                content = jData.data.info.text,
                atUser = 0,
				replayInfo = {
                    MsgSeq = data.MsgSeq,
                    --å›å¤æ¶ˆæ¯çš„Seq
                    MsgTime = data.MsgTime,
                    --å›å¤æ¶ˆæ¯çš„äº‹ä»¶
                    UserID = data.FromUserId,
                    --å›å¤æ¶ˆæ¯å¯¹è±¡
                    RawContent = Data.Content --å›å¤æ¶ˆæ¯çš„åŸå†…å®¹
                }
				}
            )
			return 1
		elseif (string.find(m, "æ–‡å­—èŠå¤©")) then
		    sedmsg(CurrentQQ,data,jData.data.info.text)
		else
		    sedvoicemsg(CurrentQQ,data,url_encode(jData.data.info.text))
		end
    end
end

--å‘é€è¯­éŸ³æ¶ˆæ¯
function sedvoicemsg(CurrentQQ,data,str)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "VoiceMsg",
        groupid = 0,
		voiceUrl = "https://dds.dui.ai/runtime/v1/synthesize?voiceId=qianranfa&speed=0.7&volume=100&audioType=wav&text="..str, --å‘é€è¯­éŸ³çš„ç½‘ç»œåœ°å€ æ–‡æœ¬å‹
        voiceBase64Buf = "",
        content = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å¤©æ°”æŸ¥è¯¢å‡½æ•°
--[[function tianqi(CurrentQQ,data)
    keyWord = data.Content:gsub("å¤©æ°”", "")
        if keyWord == "" then
            return 1
        end

        cookies = Api.Api_GetUserCook(CurrentQQ)

        response, error_message =
            http.request(
            "GET",
            "https://weather.mp.qq.com/cgi-bin/rich",
            {
                query = "g_tk=" .. cookies.Gtk .. "&city=" .. url_encode(keyWord),
                headers = {
                    Referer = "http://weather.mp.qq.com/ark"
                },
                cookies = {
                    uin = CurrentQQ,
                    skey = cookies.Skey
                }
            }
        )
        local html = response.body
        log.notice("From Lua html -->%s", html)

        local j = json.decode(html)
        if j.code ~= 0 then
            return 1
        end

        ApiRet =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "JsonMsg",
                groupid = 0,
                content = string.format(
                    --{"config":{"forward":1,"autosize":1},"prompt":"[åº”ç”¨]å¤©æ°”","app":"com.tencent.weather","ver":"0.0.0.1","view":"RichInfoView","meta":{"richinfo":{"adcode":"101210701","city":"æˆéƒ½","air":"58","min":"20","ts":"1500550866","wind":"1","date":"6æœˆ27æ—¥ å‘¨å››","max":"28","type":"201"}},"desc":"å¤©æ°”"}
                    --[[{"app":"com.tencent.weather","desc":"","meta":{"weather":{"ad":[{"icon":"http://imgcache.qq.com/ac/tq/xz2/tp.jpg","p":"ptype=star","t":"2","title":"æ˜Ÿåº§ | ä»Šå¤©ä¼šå› ä¸ºæ„Ÿæƒ…å’Œå®¶åº­çš„é—®é¢˜ï¼Œå½±å“å·¥ä½œï¼Œè¿˜æœ‰ï¼Œä¹Ÿè¦æ³¨æ„äºº...","url":""},{"icon":"http://imgcache.qq.com/ac/qqweather/image/2019/6/27.png","p":"ptype=lunar","t":"4","title":"é»„å† | å†œå†äº”æœˆå»¿äº”ã€‚å®œè®¢ç›Ÿ.çº³é‡‡.å‡ºè¡Œ.ç¥ˆç¦.æ–‹é†®.å®‰åºŠ.ä¼š...","url":""}],"info":{"it1":{"adcode":"101050101","city":"æ­¦æ±‰","hour":"18","max":"29","min":"17","temp":"24","type":"202","ut":"1561630401","wea":"å¤šäº‘"},"it2":{"hour":"19","temp":"22","type":"202"},"it3":{"hour":"20","temp":"21","type":"202"},"ts":"1561631244"},"url":""}},"prompt":"ã€å“ˆå°”æ»¨ã€‘å¤šäº‘ 17Â°/29Â°, 18:13æ›´æ–°~","ver":"1.0.0.106","view":"WeatherThreeView"}]]
--[[                    [[{"app":"com.tencent.weather","desc":"å¤©æ°”","view":"RichInfoView","ver":"1.0.0.217","prompt":"[åº”ç”¨]å¤©æ°”","meta":{"richinfo":{"adcode":"%s","air":"%s","city":"%s","date":"%s","max":"%s","min":"%s","ts":"1554951408","type":"%s","wind":"%s"}},"config":{"forward":1,"autosize":1,"type":"card"}}]],
--[[                    j.data.adcode,
                    j.data.air,
                    j.data.city,
                    j.data.date,
                    j.data.max,
                    j.data.min,
                    j.data.type,
                    j.data.wind
                ),
                atUser = 0
            }
        )
end
--]]
--è°ƒæ•™å¤„ç†å‡½æ•°(å¾…å¤„ç†)
function tiaojiao(CurrentQQ,data)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
	if (mim == nil) then
		sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå“‡")
		return 1
	end
	if (string.find(data.Content, "^åˆ é™¤è°ƒæ•™")) then
	    msg = data.Content:gsub("åˆ é™¤è°ƒæ•™", "")
	    if (msg == "") then
		    sedmsg(CurrentQQ,data,"è¦åˆ é™¤çš„è°ƒæ•™æŒ‡ä»¤ä¸èƒ½ä¸ºç©ºå“¦")
		    return 1
		end
		rese = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..tostring(data.FromGroupId).."\/"..msg..".txt")
	    if (rese == nil) then
			sedmsg(CurrentQQ,data,"è¿™ä¸ªæŒ‡ä»¤ä¸å­˜åœ¨äº†å“¦")
		    return 1
		end
		rm_file = os.remove("mimoio\/æœºå™¨è°ƒæ•™\/"..tostring(data.FromGroupId).."\/"..msg..".txt")
		log.info("åˆ é™¤è°ƒæ•™ ====> %s", rm_file)
		sedmsg(CurrentQQ,data,"åˆ é™¤æˆåŠŸ\nä½ ä¸å–œæ¬¢è¢«è¿™æ ·è°ƒæ•™çš„æˆ‘å—[è¡¨æƒ…9]")
		return 1
	end
    msgs = data.Content:gsub("è°ƒæ•™", "")
		res2 = string.find(msgs, "#")
		str = string.sub(msgs,res2+1)
		str2 = string.sub(msgs,1,res2-1)
		        
		        if (str == "") then
		            sedmsg(CurrentQQ,data,"è°ƒæ•™çš„å›ç­”å†…å®¹ä¸èƒ½ä¸ºç©ºå“¦")
			        return 1
		        end
				if (str2 == "") then
		            sedmsg(CurrentQQ,data,"è°ƒæ•™çš„æŒ‡ä»¤å†…å®¹ä¸èƒ½ä¸ºç©ºå“¦")
			        return 1
		        end
		        rese = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..str2..".txt")
					if (rese ~= nil) then
				        sedmsg(CurrentQQ,data,"æŒ‡ä»¤å·²ç»å­˜åœ¨äº†å“¦")
				        return 1
				    end
				Wirte("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..str2..".txt",str)
				sedmsg(CurrentQQ,data,"è°ƒæ•™æˆåŠŸ\nä½ è¿˜æƒ³å†è°ƒæ•™æˆ‘ä¸€æ¬¡å—[è¡¨æƒ…6]")
		        return 1
end

function url_encode(str)
    if (str) then
        str = string.gsub(str, "\n", "\r\n")
        str =
            string.gsub(
            str,
            "([^%w ])",
            function(c)
                return string.format("%%%02X", string.byte(c))
            end
        )
        str = string.gsub(str, " ", "+")
    end
    return str
end

--æŠ¢çº¢åŒ…å¤„ç†
function RedBag(CurrentQQ, data)
    Api.Api_OpenRedBag(CurrentQQ, data.RedBaginfo)
    if (data.RedBaginfo.RedType == 12) then
         luaRes =
                Api.Api_SendMsg(
                CurrentQQ,
                {
                    toUser = data.FromGroupId,
                    sendToType = 2,
                    sendMsgType = "TextMsg",
                    groupid = 0,
                    content = data.RedBaginfo.Tittle,
                    atUser = 0
                }
            )
        log.notice("From Lua SendMsg Ret\n%d", luaRes.Ret)
    end
end

--è§†é¢‘è§£æå¤„ç†
function Video(CurrentQQ, data)
    vdata = json.decode(data.Content)
        videodata = {
            GroupID = data.FromGroupId,
            VideoUrl = vdata.VideoUrl,
            VideoMd5 = vdata.VideoMd5
        }
        --æ„é€ table å‚æ•°è¡¨
        luaResp = Api.Api_CallFunc(CurrentQQ, "PttCenterSvr.ShortVideoDownReq", videodata) --é€šè¿‡cmdè°ƒç”¨åŠŸèƒ½åŒ…
        luaRes =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "TextMsg",
                groupid = 0,
                content = "è§£æè§†é¢‘URL-->" .. luaResp.VideoUrl,
                atUser = 0
            }
        )
end

--ç®¡ç†å¼€å…³é€šç”¨
function adminio(CurrentQQ,data,oio)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim ~= nil) then
            msg = data.Content:gsub(oio, "")
            str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
            if (string.find(str, "å…³é—­")) then
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äººå·²è¢«å…³é—­...\nè¯·å…ˆå¼€å¯æœºå™¨äºº")
                return 1
            end
			str2 = Read("mimoio\/çŠ¶æ€æ•°æ®\/"..oio.."\/"..data.FromGroupId..".txt")
			if (string.find(str2, msg)) then
			    sedmsg(CurrentQQ,data,"âˆ´"..oio.."æœ¬å°±æ˜¯"..str2.."çŠ¶æ€")
                return 1
			end
            Wirte("mimoio\/çŠ¶æ€æ•°æ®\/"..oio.."\/"..data.FromGroupId..".txt",msg)
            sedmsg(CurrentQQ,data,"âˆ´"..oio..msg.."æˆåŠŸ")
            return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
end

--ç™¾ç§‘å¤§å…¨
function baike(CurrentQQ,data)
    keyWord = data.Content:gsub("ç™¾ç§‘", "")
        if keyWord == "" then
            return 1
        end
        response, error_message =
            http.request(
            "GET",
            "http://baike.baidu.com/api/openapi/BaikeLemmaCardApi",
            {
                query = "scope=103&format=json&appid=379020&bk_key=" .. url_encode(keyWord) .. "&bk_length=600"
            }
        )
        html = response.body
        while(string.find(html, '"errno":2')) do
            response, error_message =
            http.request(
            "GET",
            "http://baike.baidu.com/api/openapi/BaikeLemmaCardApi",
            {
                query = "scope=103&format=json&appid=379020&bk_key=" .. url_encode(keyWord) .. "&bk_length=600"
            })
			html = response.body
        end
        local j = json.decode(html)
        sedmsg(CurrentQQ,data,j.abstract.."\n"..j.url)
end

--éŸ³ä¹ç‚¹æ­Œ
function music(CurrentQQ,data)
    keyWord = data.Content:gsub("ç‚¹æ­Œ", "")
        if keyWord == "" then
            return 1
        end
        response, error_message =
            http.request(
            "GET",
            "https://c.y.qq.com/soso/fcgi-bin/client_search_cp",
            {
                query = "aggr=1&cr=1&flag_qc=0&p=1&n=6&w=" .. url_encode(keyWord)
            }
        )
        html = response.body
		str = string.sub(html,10,-2)
        j = json.decode(str)
        if (j.code == 0) then
            msg = ""
            num = j.data.song.list
            list = num[1]
            songname = list.songname
            singername = list.singer[1].name
            payplay = list.pay.payplay
			albummid = list.albummid
			songmid = list.songmid
	        sedjsonmsg(CurrentQQ,data,'{"app":"com.tencent.structmsg","desc":"éŸ³ä¹","view":"music","ver":"0.0.0.1","prompt":"[åˆ†äº«]' ..songname.. '","meta":{"music":{"sourceMsgId":"0","title":"' ..songname.. '","desc":"' ..singername.. '","preview":"y.gtimg.cn/music/photo_new/T002R150x150M000'..albummid..'.jpg","tag":"QQéŸ³ä¹","musicUrl":"https://v1.itooi.cn/tencent/url?id='..songmid..'","jumpUrl":"y.qq.com/n/yqq/song/'..songmid..'.html","appid":100497308,"app_type":1,"action":"","source_url":"url.cn/5aSZ8Gc","source_icon":"url.cn/5tLgzTm","android_pkg_name":"com.tencent.qqmusic"}},"config":{"forward":true,"type":"normal","autosize":true}}')
			return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´Error:"..j.code)
			return 1
        end
end

--è®¿é—®url
function geturl(url_class,url,caulrt)
        response, error_message =
            http.request(
            url_class,
            url,
            {
                query = caulrt
            }
        )
        html = response.body
		return html
end

--æ¶ˆæ¯å‚¨è“„
function msgsql(CurrentQQ,data)
    if (mysqlpass == "") then
	    return 1
	end
    c = mysql.new()
    -- åˆå§‹åŒ–mysqlå¯¹è±¡
    ok, err = c:connect({host = mysqlhost, port = 3306, database = mysqldb, user = mysqluser, password = mysqlpass})
    --å»ºç«‹è¿æ¥
    if ok then
        sqlstr =
            string.format(
            [[INSERT INTO msgcache (GroupID, MsgSeq, MsgRandom,MsgType,Data,MsgTime)VALUES (%d,%d,%d,'%s','%s',%d)]],
            data.FromGroupId,
            data.MsgSeq,
            data.MsgRandom,
            data.MsgType,
            data.Content,
            data.MsgTime
        )
        res, err = c:query(sqlstr) --å…¥åº“ç¼“å­˜æ¶ˆæ¯
        log.info("%s", err)
        c.close(c)
    --é‡Šæ”¾è¿æ¥
    end
    return 1
end

--æ’¤å›æ£€æµ‹
function CheHui(CurrentQQ, data, extData)
    c = mysql.new()
    -- åˆå§‹åŒ–mysqlå¯¹è±¡
	if (mysqlpass == "") then
	    return 1
	end
	
    if data.MsgType == "ON_EVENT_GROUP_REVOKE" then --ç›‘å¬ ç¾¤æ’¤å›äº‹ä»¶
        str = string.format("ç¾¤æˆ %d  æˆå‘˜ UserID %s æ’¤å›äº†æ¶ˆæ¯Seq %s \n", extData.GroupID, extData.UserID, extData.MsgSeq)
        log.info("%s", str)
        ok, err = c:connect({host = mysqlhost, port = 3306, database = mysqldb, user = mysqluser, password = mysqlpass})
        --å»ºç«‹è¿æ¥
        log.info("sql %v", err)
        if ok then
            sqlstr =
                string.format(
                "select * from msgcache where `GroupID`= %d and `MsgSeq` = %d",
                extData.GroupID,
                extData.MsgSeq
            )
            res, err = c:query(sqlstr) --è·Ÿç¾¤ç¾¤idå’Œæ¶ˆæ¯SEQæŸ¥è¯¢å‡ºæ’¤å›çš„æ¶ˆæ¯å†…å®¹
            if err == nil then
                c.close(c)
                GroupID = tonumber(res[1]["GroupID"])
                MsgType = res[1]["MsgType"]
                Data = res[1]["Data"]

                if MsgType == "TextMsg" then
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            --å‘é€æ–‡æœ¬æ¶ˆæ¯
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡æ–‡æœ¬æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                Data
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "SmallFaceMsg" then
                    --Data {"Content":"[è¡¨æƒ…101]","Hex":"FKY=","Index":101,"tips":"[å°è¡¨æƒ…]"}
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡è¡¨æƒ…æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).Content
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "PicMsg" then
                    --Data {"Content":"","FileId":2820717626,"FileMd5":"q0oEC5aloJJMFr10mplaXw==","FileSize":7026,"tips":"[ç¾¤å›¾ç‰‡]","url":"http://gchat.qpic.cn/gchatpic_new/1700487478/960839480-2534335053-AB4A040B96A5A0924C16BD749A995A5F/0?vuin=u0026term=255u0026pictype=0"}
                    jData = json.decode(Data)
					if (jData.tips == "[ç¾¤æ¶ˆæ¯-QQé—ªç…§]") then
					    
					Api.Api_SendMsg( 
                    CurrentQQ,
                    {
                        toUser = GroupID,
                        sendToType = 2,
                        sendMsgType = "ForwordMsg",
                        content = "",
                        atUser = 0,
                        groupid = 0,
                        voiceUrl = "",
                        voiceBase64Buf = "",
                        picUrl = "",
                        picBase64Buf = "",
                        forwordBuf = json.decode(Data).ForwordBuf, --æ¬²è½¬å‘çš„base64buf å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                        forwordField = json.decode(Data).ForwordField --æ¬²å†™å…¥åè®®çš„å­—æ®µID å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                    }
                )
				    return 1
					end
                    Api.Api_SendMsg( --é€šè¿‡å›¾ç‰‡md5å‘é€å›¾ç‰‡ ç§’å‘ä¸ç”¨ä¸Šä¼  ç›¸å½“äºè½¬å‘
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "PicMsg",
                            --å‘é€å›¾æ–‡æ¶ˆæ¯
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡å›¾ç‰‡æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š[PICFLAG]%s",
                                extData.UserID,
                                jData.Content
                            ),
                            --é€šè¿‡å®[PICFLAG]æ”¹å˜å›¾æ–‡é¡ºåº  æ”¹ä¸ºç°æ–‡å­—åå›¾ç‰‡
                            atUser = 0,
                            voiceUrl = "",
                            voiceBase64Buf = "",
                            picUrl = "",
                            picBase64Buf = "",
                            fileMd5 = jData.FileMd5
                        }
                    )
                end
                if MsgType == "AtMsg" then
                    --Data {"Content":"@Kar98k skjjkssjkjs","UserID":123456789,"tips":"[ATæ¶ˆæ¯]"}
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡atæ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).Content
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "VoiceMsg" then
                    --Data {"tips":"[è¯­éŸ³]","url":"http://grouptalk.c2c.qq.com/?ver=0u0026rkey=3062020101045b305902010102010102041fdef8ae042439416931554e5142586c536d78706a314c686843664959725f327a5f573064697653755902045dac2a21041f0000000866696c6574797065000000013100000005636f64656300000001310400u0026filetype=1u0026voice_codec=1"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "VoiceMsg",
                            --å‘é€ç¾¤è¯­éŸ³æ¶ˆæ¯
                            groupid = 0,
                            content = "",
                            atUser = 0,
                            voiceUrl = json.decode(Data).url,
                            --é€šè¿‡ç½‘ç»œurlè¿›è¡Œå‘é€è¯­éŸ³
                            voiceBase64Buf = "",
                            picUrl = "",
                            picBase64Buf = ""
                        }
                    )
                end

                if MsgType == "ReplayMsg" then
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡å›å¤æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).ReplayContent
                            ),
                            atUser = 0
                        }
                    )
                end
				if MsgType == "VideoMsg" then
	             Api.Api_SendMsg( 
                    CurrentQQ,
                    {
                        toUser = GroupID,
                        sendToType = 2,
                        sendMsgType = "ForwordMsg",
                        content = "",
                        atUser = 0,
                        groupid = 0,
                        voiceUrl = "",
                        voiceBase64Buf = "",
                        picUrl = "",
                        picBase64Buf = "",
                        forwordBuf = json.decode(Data).ForwordBuf, --æ¬²è½¬å‘çš„base64buf å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                        forwordField = json.decode(Data).ForwordField --æ¬²å†™å…¥åè®®çš„å­—æ®µID å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                    }
                )
				end
                if MsgType == "XmlMsg" then
				    
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "XmlMsg",
                            groupid = 0,
                            content = string.format("%s", Data),
                            atUser = 0
                        }
                    )
                end
				if MsgType == "JsonMsg" then
				    
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "JsonMsg",
                            groupid = 0,
                            content = string.format("%s", Data),
                            atUser = 0
                        }
                    )
                end
            end
        end
    end
    return 1
end
2020/09/07 12:55:20.887 [E]  mimoio.lua
2020/09/07 12:55:20.888 [E]  local log = require("log")
local Api = require("coreApi")
local json = require("json")
local http = require("http")
local mysql = require("mysql")

--ç‰ˆæœ¬å·(ä¸è¦æ”¹åŠ¨)
Vabr = "1.0.2"
--æ•°æ®åº“é…ç½®
mysqlhost = "localhost"--é»˜è®¤ä¸åŠ¨
mysqldb = "ffaxx001"--æ•°æ®åº“å
mysqluser = "ffaxx001"--æ•°æ®åº“ç”¨æˆ·å
mysqlpass = "123456"--æ•°æ®åº“å¯†ç 
--ä¸ä½¿ç”¨è¯·ä¸è¦æ”¹åŠ¨

function ReceiveFriendMsg(CurrentQQ, data)
    if (data.Content == "ä½¿ç”¨æ–¹æ³•") then
	    sendfrimsg(CurrentQQ,data,"æ·»åŠ æˆæƒè€…çš„æ–¹æ³•\nå¯¹å•ä¸ªæœºå™¨äººç§èŠå‘é€[æ·»åŠ æˆæƒè€…+æˆæƒè€…QQ]\n\næˆæƒç¾¤çš„æ–¹æ³•\nåˆ°éœ€è¦æˆæƒçš„ç¾¤é‡Œå‘é€[æˆæƒ+ä¸»äººQQ]ã€‚æ³¨æ„:æˆæƒå¿…é¡»æ˜¯æˆæƒè€…è¿›è¡Œæ“ä½œ,ç®¡ç†å‘˜æˆæƒä¸äº†")
	end
    --æ•°æ®åˆå§‹åŒ–
    if (data.Content == "åˆå§‹åŒ–") then
	    root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root ~= nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´è¯·ä¸è¦é‡å¤åˆå§‹åŒ–")
			return 1
		end
    --os.execute('mkdir mimoio/æœºå™¨æˆæƒ')
	    os.execute('mkdir mimoio')
		os.execute('mkdir mimoio/å¤è¯»æœº')
		os.execute('mkdir mimoio/å¤è¯»æœº/æ¬¡æ•°')
		os.execute('mkdir mimoio/å¤è¯»æœº/å†…å®¹')
		os.execute('mkdir mimoio/æœºå™¨æˆæƒ')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨ä¸»äºº')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨èŠå¤©')
		os.execute('mkdir mimoio/æœºå™¨è°ƒæ•™')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æŠ¢çº¢åŒ…')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æœºå™¨èŠå¤©')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æœºå™¨å¼€å…³')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æ’¤å›æ£€æµ‹')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/å›¾ç‰‡è§£æ')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/è§†é¢‘è§£æ')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/é—ªç…§æ£€æµ‹')
		Wirte("mimoio\/"..data.FromUin..".txt","999")
		sendfrimsg(CurrentQQ,data,"åˆå§‹åŒ–å®Œæ¯•ï¼\nå‘é€[ä½¿ç”¨æ–¹æ³•]äº†è§£ä½¿ç”¨å§")
	end
	--æ·»åŠ æˆæƒè€…æ“ä½œ(ç§èŠæœºå™¨äººå‘é€)
	if (string.find(data.Content, "^æ·»åŠ æˆæƒè€…")) then
	    msg = data.Content:gsub("æ·»åŠ æˆæƒè€…", "")
		--Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromUin..".txt","å…³é—­")
		root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root == nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„ç®¡ç†è€…")
			return 1
		end
		Wirte("mimoio\/æœºå™¨æˆæƒ\/"..msg..CurrentQQ..".txt","999")
		sendfrimsg(CurrentQQ,data,"âˆ´æ·»åŠ æˆæƒè€…æˆåŠŸ")
	end
	--åˆ é™¤æˆæƒè€…æ“ä½œ(ç§èŠæœºå™¨äººå‘é€)
	if (string.find(data.Content, "^åˆ é™¤æˆæƒè€…")) then
	    msg = data.Content:gsub("åˆ é™¤æˆæƒè€…", "")
		--Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromUin..".txt","å…³é—­")
		root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root == nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„ç®¡ç†è€…")
			return 1
		end
		os.remove("mimoio\/æœºå™¨æˆæƒ\/"..msg..CurrentQQ..".txt")
		sendfrimsg(CurrentQQ,data,"âˆ´åˆ é™¤æˆæƒè€…æˆåŠŸ")
	end
    return 1
end
function ReceiveGroupMsg(CurrentQQ, data)
    if (tostring(data.FromUserId) == CurrentQQ) then
	    return 1
	end
	--ç¾¤èŠæˆæƒ(åˆ°éœ€è¦æˆæƒçš„ç¾¤é‡Œæ“ä½œ)
	if (string.find(data.Content, "^æˆæƒ")) then
	    root = Read("mimoio\/æœºå™¨æˆæƒ\/"..data.FromUserId..CurrentQQ..".txt","999")
		if (root == nil) then
		    sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„æˆæƒè€…")
			return 1
		end
		msg = data.Content:gsub("æˆæƒ", "")
		os.execute('mkdir mimoio/æœºå™¨è°ƒæ•™/'..data.FromGroupId)
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨ä¸»äºº/'..data.FromGroupId)
		Wirte("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..msg..".txt","999")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt","å›å¤èŠå¤©")
		sedmsg(CurrentQQ,data,"âˆ´æˆæƒæˆåŠŸï¼\nå‘é€[å¼€å¯æœºå™¨äºº]ä½¿ç”¨å§")
	end
	--åˆ é™¤æˆæƒæ“ä½œ(åˆ°éœ€è¦åˆ é™¤æˆæƒçš„ç¾¤é‡Œæ“ä½œ)
	if (string.find(data.Content, "^åˆ é™¤æˆæƒ")) then
	    root = Read("mimoio\/æœºå™¨æˆæƒ\/"..data.FromUserId..CurrentQQ..".txt","999")
		if (root == nil) then
		    sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„æˆæƒè€…")
			return 1
		end
		msg = data.Content:gsub("åˆ é™¤æˆæƒ", "")
		os.remove("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..msg..".txt")
		os.remove("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
		sedmsg(CurrentQQ,data,"âˆ´åˆ é™¤æˆæƒæˆåŠŸï¼")
	end
	--æœºå™¨å¼€å…³æŒ‡ä»¤
	if (data.Content == "å¼€å¯æœºå™¨äºº" or data.Content == "å…³é—­æœºå™¨äºº") then
        mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim ~= nil) then
            msg = data.Content:gsub("æœºå™¨äºº", "")
            str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
			if (str == nil) then
			    Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt",msg)
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äºº"..msg.."æˆåŠŸï¼")
				log.info("Str ====> %s", str)
                return 1
			end
			
            if (string.find(str, msg)) then
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äººä¸€ç›´æ˜¯"..msg.."çš„å‘")
                return 1
            end
            Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt",msg)
            sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äºº"..msg.."æˆåŠŸï¼")
            return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
	end
    --æœºå™¨äººå¼€å¯æ£€æµ‹
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
	if (str == nil) then
	    log.info("Str ====> %s", str)
        return 1
	end
	if (string.find(str, "å…³é—­")) then
	    return 1
	end
	--atæ¶ˆæ¯å¤„ç†
	msgs = ""
	atqq = 0
	if (string.find(data.Content, "ATæ¶ˆæ¯")) then
	    msgs = json.decode(data.Content).Content
		atqq = json.decode(data.Content).UserID
	end
	--å°¾å·´è‡ªå®šä¹‰(å¾…å®Œå–„)
	tips = "â€”â€”å‡¤é£ç¿±ç¿”å…®ä¸·"
    --åŠŸèƒ½æ¨¡å—
    if (data.Content == "åŠŸèƒ½" or data.Content == "ä¸»ç•Œé¢") then
        face = faceArray()
        sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."å½±è§†æœç´¢\n"..face.."èŠå¤©å¨±ä¹\n"..face.."ä¾¿åˆ©åŠŸèƒ½\n"..face.."æœºå™¨è°ƒæ•™\n"..face.."ç®¡ç†ç³»ç»Ÿ\n"..face.."bugåé¦ˆ\n"..face.."æœ¬ç¾¤çŠ¶æ€\n"..face.."æ›´æ–°æ£€æµ‹\n\n"..tips)
    end
    --å½±è§†æœç´¢æ¨¡å—
    if (data.Content == "å½±è§†æœç´¢") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."æœç´¢+å½±è§†å\n"..face.."æˆ‘æƒ³çœ‹+å½±è§†å\n"..face.."æˆ‘è¦çœ‹+å½±è§†å\n\n"..tips)
    elseif (string.find(data.Content, "^æœç´¢")) then
	    msg = data.Content:gsub("æœç´¢", "")
		Sousuo(CurrentQQ,data,msg)
	elseif (string.find(data.Content, "^æˆ‘æƒ³çœ‹")) then
	    msg = data.Content:gsub("æˆ‘æƒ³çœ‹", "")
		Sousuo(CurrentQQ,data,msg)
    elseif (string.find(data.Content, "^æˆ‘è¦çœ‹")) then
	    msg = data.Content:gsub("æˆ‘è¦çœ‹", "")
		Sousuo(CurrentQQ,data,msg)
	end
	--èŠå¤©å¨±ä¹æ¨¡å—
	if (data.Content == "èŠå¤©å¨±ä¹") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."åˆ‡æ¢æ–‡å­—èŠå¤©\n"..face.."åˆ‡æ¢å›å¤èŠå¤©\n"..face.."åˆ‡æ¢è¯­éŸ³èŠå¤©\n\n"..tips)
    elseif (data.Content == "åˆ‡æ¢æ–‡å­—èŠå¤©") then
		liaotian(CurrentQQ,data,1)
	elseif (data.Content == "åˆ‡æ¢è¯­éŸ³èŠå¤©") then
	    liaotian(CurrentQQ,data,2)
    elseif (data.Content == "åˆ‡æ¢å›å¤èŠå¤©") then
	    liaotian(CurrentQQ,data,3)
	else
	    ownthink(CurrentQQ,data,msgs,atqq)
	end
	--ä¾¿åˆ©åŠŸèƒ½æ¨¡å—
	if (data.Content == "ä¾¿åˆ©åŠŸèƒ½") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."ç™¾ç§‘å¤§å…¨\n"..face.."éŸ³ä¹ç‚¹æ­Œ\n"..face.."é—ªä»–@xx\n"..face.."å¤©æ°”æŸ¥è¯¢\n\n"..tips)
	elseif (data.Content == "ç™¾ç§‘å¤§å…¨") then
		sedmsg(CurrentQQ,data,"å‘é€:[ç™¾ç§‘+å…³é”®è¯]\nä¾‹å¦‚:ç™¾ç§‘æ´›å¦¾èº«")
    elseif (data.Content == "éŸ³ä¹ç‚¹æ­Œ") then
		sedmsg(CurrentQQ,data,"å‘é€:[ç‚¹æ­Œ+æ­Œå]\nä¾‹å¦‚:ç‚¹æ­Œé’æŸ ")
	elseif (data.Content == "å¤©æ°”æŸ¥è¯¢") then
		sedmsg(CurrentQQ,data,"å‘é€:[å¤©æ°”+åœ°æ–¹å]\nä¾‹å¦‚:å¤©æ°”åŒ—äº¬(é™äºå›½å†…)")
    elseif (string.find(data.Content, "^å¤©æ°”")) then
        tianqi(CurrentQQ,data)
	    --msg = data.Content:gsub("æœç´¢", "")
		--Sousuo(CurrentQQ,data,msg)
	elseif (string.find(data.Content, "^ç™¾ç§‘")) then
	    baike(CurrentQQ,data)
	    --msg = data.Content:gsub("æˆ‘æƒ³çœ‹", "")
		--Sousuo(CurrentQQ,data,msg)music(CurrentQQ,data)
    elseif (string.find(data.Content, "^ç‚¹æ­Œ")) then
	    music(CurrentQQ,data)
	end
	--æœºå™¨è°ƒæ•™æ¨¡å—
	if (data.Content == "æœºå™¨è°ƒæ•™") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."æ–‡å­—è°ƒæ•™\n"..face.."è¯­éŸ³è°ƒæ•™\n"..face.."å”±æ­Œè°ƒæ•™\n"..face.."éŸ³ä¹è°ƒæ•™\n"..face.."å›¾ç‰‡è°ƒæ•™\n"..face.."åˆ é™¤è°ƒæ•™\n\n"..tips)
    elseif (data.Content == "æ–‡å­—è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#(å†…å®¹)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#ä½ å¥½å•Š")
	elseif (data.Content == "è¯­éŸ³è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#è¯­éŸ³(å†…å®¹)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#è¯­éŸ³ä½ å¥½å•Š")
	elseif (data.Content == "å›¾ç‰‡è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#å›¾ç‰‡(é“¾æ¥)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#å›¾ç‰‡http://../1.jpg")
	elseif (data.Content == "éŸ³ä¹è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#ç‚¹æ­Œ(æ­Œå)]\nä¾‹å¦‚:è°ƒæ•™å–µ#ç‚¹æ­Œå­¦çŒ«å«")
	elseif (data.Content == "å”±æ­Œè°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#å”±æ­Œ(æ­Œå)]\nä¾‹å¦‚:è°ƒæ•™å–µ#å”±æ­Œå­¦çŒ«å«")
	elseif (data.Content == "åˆ é™¤è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[åˆ é™¤è°ƒæ•™(æŒ‡ä»¤)]\nä¾‹å¦‚:åˆ é™¤è°ƒæ•™ä½ å¥½")
	elseif (string.find(data.Content, "^è°ƒæ•™")) then
        tiaojiao(CurrentQQ,data)
	elseif (string.find(data.Content, "^åˆ é™¤è°ƒæ•™")) then
        tiaojiao(CurrentQQ,data)
	end
	--ç®¡ç†ç³»ç»Ÿæ¨¡å—
	if (data.Content == "ç®¡ç†ç³»ç»Ÿ") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."å¼€å¯/å…³é—­æœºå™¨äºº\n"..face.."å¼€å¯/å…³é—­æŠ¢çº¢åŒ…\n"..face.."å¼€å¯/å…³é—­æœºå™¨èŠå¤©\n"..face.."å¼€å¯/å…³é—­é—ªç…§æ£€æµ‹\n"..face.."å¼€å¯/å…³é—­å›¾ç‰‡è§£æ\n"..face.."å¼€å¯/å…³é—­è§†é¢‘è§£æ\n"..face.."å¼€å¯/å…³é—­æ’¤å›æ£€æµ‹\n\n"..tips)
    elseif (data.Content == "å¼€å¯æœºå™¨èŠå¤©" or data.Content == "å…³é—­æœºå™¨èŠå¤©") then
        adminio(CurrentQQ,data,"æœºå™¨èŠå¤©")
    elseif (data.Content == "å¼€å¯æ’¤å›æ£€æµ‹" or data.Content == "å…³é—­æ’¤å›æ£€æµ‹") then
        adminio(CurrentQQ,data,"æ’¤å›æ£€æµ‹")
	elseif (data.Content == "å¼€å¯é—ªç…§æ£€æµ‹" or data.Content == "å…³é—­é—ªç…§æ£€æµ‹") then
        adminio(CurrentQQ,data,"é—ªç…§æ£€æµ‹")
	elseif (data.Content == "å¼€å¯æŠ¢çº¢åŒ…" or data.Content == "å…³é—­æŠ¢çº¢åŒ…") then
        adminio(CurrentQQ,data,"æŠ¢çº¢åŒ…")
	elseif (data.Content == "å¼€å¯è§†é¢‘è§£æ" or data.Content == "å…³é—­è§†é¢‘è§£æ") then
        adminio(CurrentQQ,data,"è§†é¢‘è§£æ")
	elseif (data.Content == "å¼€å¯å›¾ç‰‡è§£æ" or data.Content == "å…³é—­å›¾ç‰‡è§£æ") then
        adminio(CurrentQQ,data,"å›¾ç‰‡è§£æ")
	end
	--bugåé¦ˆæ¨¡å—
	if (data.Content == "BUGåé¦ˆ" or data.Content == "bugåé¦ˆ") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."é‚®ä»¶åé¦ˆ\n"..face.."QQåé¦ˆ\n\n"..tips)
    elseif (data.Content == "QQåé¦ˆ") then
        sedmsg(CurrentQQ,data,"???Î£(ï¾Ÿâˆ€ï¾Ÿï¾‰)ï¾‰\næ’ä»¶æœ‰é—®é¢˜å¯ä»¥åé¦ˆåˆ°:\nQQ:2353065854")
    elseif (data.Content == "é‚®ä»¶åé¦ˆ") then
        sedmsg(CurrentQQ,data,"å®è´å’‹å•¦=ÍÍŸÍŸÍ(ê’ªá—œê’ª â€§Ì£Ì¥Ì‡)\næ’ä»¶æœ‰é—®é¢˜å¯ä»¥åé¦ˆåˆ°:\né‚®ç®±ğŸ“¬:ym-o@qq.com")
	end
	--æœ¬ç¾¤çŠ¶æ€æ¨¡æ¿
	if (data.Content == "æœ¬ç¾¤çŠ¶æ€") then
        face = faceArray()
        hb = Read("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt")
        sz = Read("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt")
		tp = Read("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt")
        sp = Read("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt")
        jqr = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
        lt = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
        ch = Read("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..data.FromGroupId..".txt")
		sedmsg(CurrentQQ,data,"çŠ¶æ€æ•°æ®åˆ—è¡¨â†“â†“â†“\n"..face.."æœºå™¨äºº:"..jqr.."\n"..face.."æŠ¢çº¢åŒ…:"..hb.."\n"..face.."å›¾ç‰‡è§£æ:"..tp.."\n"..face.."æ’¤å›æ£€æµ‹:"..ch.."\n"..face.."è§†é¢‘è§£æ:"..sp.."\n"..face.."æœºå™¨èŠå¤©:"..lt.."\n"..face.."é—ªç…§æ£€æµ‹:"..sz.."\n\n"..tips)
	end
	--æ›´æ–°æ¨¡å—
	if (data.Content == "æ›´æ–°æ£€æµ‹") then
        str = geturl("GET","http://118.25.41.32/Lsb/lua/Vabr.txt","")
		log.info("Str ====> %s", str)
        if (string.find(str, Vabr)) then
            sedmsg(CurrentQQ,data,"å½“å‰ç‰ˆæœ¬ä¸ºæœ€æ–°ç‰ˆ")
        else
            sedmsg(CurrentQQ,data,"å‘ç°æ–°ç‰ˆæœ¬!\nå½“å‰ç‰ˆæœ¬:"..Vabr.."\næ–°ç‰ˆæœ¬å·:"..str.."\nèµ¶å¿«å‘é€[æ›´æ–°æ’ä»¶]å§")
        end
	elseif (data.Content == "æ›´æ–°æ’ä»¶") then
	    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim == nil) then
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
        str = geturl("GET","http://118.25.41.32/Lsb/lua/Vabr.txt","")
		log.info("Str ====> %s", str)
        if (string.find(str, Vabr)) then
            sedmsg(CurrentQQ,data,"å½“å‰ç‰ˆæœ¬ä¸ºæœ€æ–°ç‰ˆ")
        else
            str = geturl("GET","http://118.25.41.32/Lsb/lua/mimoio.txt","")
            Wirte("Plugins\/mimoio.lua",str)
            sedmsg(CurrentQQ,data,"æ›´æ–°å®Œæ¯•ï¼")
        end
	end
	--å›¾ç‰‡ç±»å‹æ¶ˆæ¯å¤„ç†
    if (data.MsgType == "PicMsg") then
	    msg = Read("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt")
		jData = json.decode(data.Content)
	    if (msg ~= nil and jData.tips ~= "[ç¾¤æ¶ˆæ¯-QQé—ªç…§]") then
            if (string.find(str, "å¼€å¯")) then
	            sedmsg(CurrentQQ,data,"å›¾ç‰‡é“¾æ¥è§£æå¦‚ä¸‹â†“â†“\n"..jData.url)
				return 1
	        end
	    end
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt")
	    if (str == nil) then
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    --é—ªç…§ã€å›¾ç‰‡å¤„ç†æ¨¡å—
		PicFlag(CurrentQQ, data)
    end
	--æŠ¢çº¢åŒ…å¤„ç†
	if (string.find(data.MsgType, "RedBagMsg") == 1) then
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt")
		if (str == nil) then
	        log.info("Str ====> %s", str)
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    RedBag(CurrentQQ, data)
	end
	--è§†é¢‘è§£æå¤„ç†
	if (string.find(data.MsgType, "VideoMsg") == 1) then
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt")
		if (str == nil) then
	        log.info("Str ====> %s", str)
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    Video(CurrentQQ, data)
	end
	--até—ªå›¾
	if (data.MsgType == "AtMsg") and (string.find(data.Content, "é—ªä»–")) then
	    shantu(CurrentQQ, data)
    end
	--è°ƒæ•™æœç´¢å¼•æ“
	mim = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..data.Content..".txt")
	if (mim == nil) then
	    --äººç±»çš„æœ¬è´¨æ˜¯å¤è¯»æœº
	    msg = Read("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt")
		if (msg ~= nil) then
		    cs = Read("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt")
			ii = tonumber(cs)
			if (string.find(msg, "^"..data.Content.."$")) then
			    if (ii > 2) then
			         math.randomseed(os.time())
                     sj = math.random(1, 5)
		             if (sj == 1 or sj == 2) then
			             sedmsg(CurrentQQ,data,msg)
					     rr = ii + 1
		                 Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
				     elseif (sj == 3) then
				         os.remove("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt")
					     os.remove("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt")
					     fdArray = {"çªç„¶æˆªæ–­å¤è¯»(ï¾ŸâŠ¿ï¾Ÿ)ï¾‚","å¤è¯»å¯è€»(â€¢Ì€ã¸ â€¢Ì â•® )","ä¸è¦å¤è¯»äº†å•¦","è¿™å°±æ˜¯æ‰€è°“çš„äººç±»çš„æœ¬è´¨","ä½ ä»¬å’‹ä¸ä¸Šå¤©å‘","åˆå¤è¯»ä¸Šç˜¾äº†å•Š"}
                         math.randomseed(os.time())
                         fdsj = math.random(1, 6)
				         sedmsg(CurrentQQ,data,fdArray[fdsj])
				     else
			             rr = ii + 1
		                 Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
		             end
			    else
			        rr = ii + 1
		            Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
			    end
			else
			    if (ii > 2) then
			        math.randomseed(os.time())
                    sj2 = math.random(1, 3)
					if (sj2 == 2) then
					    fdArray2 = {"ä¸­æ–­å¤è¯»å¯è€»","æ‰“æ–­å¤è¯»å¯è€»(â€¢Ì€ã¸ â€¢Ì â•® )","ä½ ä¸ºä»€ä¹ˆè¦æ‰“æ–­å¤è¯»å•Š","å¤è¯»ä¸é¦™å˜›","ç ´åæ°›å›´(à¸‡áµ’ÌŒçš¿áµ’ÌŒ)à¸‡â¼Â³â‚Œâ‚ƒ"}
                        math.randomseed(os.time())
                        fdsj2 = math.random(1, 5)
				        sedmsg(CurrentQQ,data,fdArray2[fdsj2])
					end
				end
				Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt","1")
			    Wirte("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt",data.Content)
			end
		else
		    Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt","1")
			Wirte("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt",data.Content)
		end
	    --å¦‚æœè°ƒæ•™æŒ‡ä»¤ä¸å­˜åœ¨ï¼Œåˆ™è¿›è¡Œå…¶ä»–æ“ä½œ
	    msgsql(CurrentQQ,data)--æ•°æ®å‚¨è“„
		--éšæœºå›å¤æ¶ˆæ¯æ¦‚ç‡0.04
	    math.randomseed(os.time())
        num = math.random(1, 40)
		if (num == 12) then
		    j = xiaosiapi(CurrentQQ,data,data.Content)
			sedmsg(CurrentQQ,data,j.data.info.text)
		end
	else
	    --è§¦å‘è°ƒæ•™æŒ‡ä»¤
		funic(CurrentQQ,data,mim)
	end
    return 1
end

function ReceiveEvents(CurrentQQ, data, extData)
  if data.MsgType == "ON_EVENT_GROUP_REVOKE" then --ç›‘å¬ ç¾¤æ’¤å›äº‹ä»¶
    --æ’¤å›äº‹ä»¶å¤„ç†
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..extData.GroupID..".txt")
    if (str == nil) then
	    log.info("Str ====> %s", str)
        return 1
	end
	if (string.find(str, "å…³é—­")) then
		return 1
	end
	CheHui(CurrentQQ, data, extData)
	--xxxxxxxxxxxxxxx
    return 1
  end
end
  --è¿›ç¾¤ç§€å›¾æ¬¢è¿


--é—ªç…§æ£€æµ‹å¤„ç†


--åŠŸèƒ½ç»„
function funic(CurrentQQ,data,msg)
    if string.find(msg, "^ç‚¹æ­Œ") then
	    data.Content = msg
        music(CurrentQQ,data,msg)
		return 1
	elseif string.find(msg, "^è¯­éŸ³") then
	    keyWord = msg:gsub("è¯­éŸ³", "")
        sedvoicemsg(CurrentQQ,data,keyWord)
		return 1
	elseif string.find(msg, "^å›¾ç‰‡") then
	    keyWord = msg:gsub("å›¾ç‰‡", "")
        sedimgmsg(CurrentQQ,data,keyWord,"")
		return 1
    elseif string.find(msg, "^å”±æ­Œ") then
        keyWord = msg:gsub("å”±æ­Œ", "")
		if (keyWord == "") then
		    sedmsg(CurrentQQ,data,"æ­Œåä¸èƒ½ç©ºç€å“¦")
		    return 1
		end
		sedmsg(CurrentQQ,data,"å¦¾èº«æ­£åœ¨åŠªåŠ›åŠ è½½Ù©(ËƒÌ¶Ì€Íˆà¯°Ë‚Ì¶ÌÍˆ)Ùˆ")
        response, error_message =
            http.request(
            "POST",
            "http://127.0.0.1:8888/SilkApi/UrlToBuf",--ä¿®æ”¹æ­¤å¤„ipåŠç«¯å£å³å¯
            {
                body = keyWord --ä¼ å…¥æ­Œæ›²å
            }
        )
        log.notice("err   %v", error_message)
        html = response.body --è¿”å›silk base64 buf
		if (string.find(html, "Î´")) then
				    sedmsg(CurrentQQ,data,"å¤©ä¾æ²¡æœ‰æ‰¾åˆ°ç›¸å…³çš„æ­Œå‘€(Ã’Ï‰Ã“×±)ï¼")
					c.close(c)
				    return 2
				end
        luaRes =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "VoiceMsg",
                groupid = 0,
                content = "",
                atUser = 0,
                voiceUrl = "",
                voiceBase64Buf = html 
            }
        )
		return 1
	end
    sedmsg(CurrentQQ,data,msg)
end

--å½±è§†æœç´¢ç”¨
function Sousuo(CurrentQQ,data,msg)
    response, error_message =
        http.request(
            "GET",
            "http://localhost/index.php/ajax/suggest",
            {
                query = "mid=1&f=admin&wd="..msg.."&limit=10&timestamp=1567914326746"
            }
        )
    html = response.body
	json = json.decode(html)
	if (json.total == 0) then
	    sedmsg(CurrentQQ,data,"å½±è§†æŸ¥è¯¢é”™è¯¯\nè¯·æ£€æŸ¥å½±è§†åæ˜¯å¦æ­£ç¡®\nâ•â•â•â•â•â•â•â•â•â•â•\næ³¨æ„âš ï¸å½±è§†åä¸è¦å¸¦æ— å…³æˆ–å¤šä½™çš„å­—ç¬¦")
	else
        sedmsg(CurrentQQ,data,"èµ„æºåœ°å€å¦‚ä¸‹â†“â†“â†“\nâ•â•â•â•â•â•â•â•â•â•\nhttp://118.25.41.32/index.php/vod/search/wd/"..escape(msg)..".html\nâ•â•â•â•â•â•â•â•â•â•â•\næ³¨æ„:å¦‚æœQQå‡ºç°åœæ­¢è®¿é—®ç°è±¡ï¼Œè¯·å¤åˆ¶é“¾æ¥ç”¨æµè§ˆå™¨æ‰“å¼€")
	end
end

--å•çº¯å‘æ¶ˆæ¯å›¾æ–‡é€šç”¨
function sedimgmsg(CurrentQQ,data,url,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "PicMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = url,
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘æ¶ˆæ¯ç”¨
function sedmsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "TextMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘ç§èŠæ¶ˆæ¯ç”¨
function sendfrimsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromUin,
        sendToType = 1,
        sendMsgType = "TextMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘jsonæ¶ˆæ¯ç”¨
function sedjsonmsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "JsonMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--èŠå¤©æ¨¡å—åˆ‡æ¢å‡½æ•°
function liaotian(CurrentQQ,data,msg)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
    if (mim == nil) then
        sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
        return 1
    end
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
	if (str == nil) then
        return 1
    end
	if (string.find(str, "å…³é—­")) then
	    sedmsg(CurrentQQ,data,"æœºå™¨èŠå¤©å¤„äºå…³é—­çŠ¶æ€\nâˆ´è¯·å…ˆå¼€å¯æœºå™¨èŠå¤©")
	    return 1
	end
	--åˆ‡æ¢å¤„ç†
	file = io.open("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt", "w")
	if (msg == 1) then
	    file:write("æ–‡å­—èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°æ–‡å­—èŠå¤©")
	elseif (msg == 2) then
	    file:write("è¯­éŸ³èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°è¯­éŸ³èŠå¤©")
	elseif (msg == 3) then
	    file:write("å›å¤èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°å›å¤èŠå¤©")
	end
	file:close()
end

--éšæœºè¡¨æƒ…å‡½æ•°
function faceArray()
    faceArray = {"[è¡¨æƒ…147]","ğŸ€","ğŸ”¥","ğŸ»","ğŸ’","[è¡¨æƒ…185]","[è¡¨æƒ…219]","[è¡¨æƒ…176]"}
    math.randomseed(os.time())
    num = math.random(1, 9)
    return faceArray[num]
end

--urlç¼–ç è½¬æ¢
function escape(w)
	pattern="[^%w%d%._%-%* ]"
	s=string.gsub(w,pattern,function(c)
		local c=string.format("%%%02X",string.byte(c))
		return c
	end)
	s=string.gsub(s," ","+")
	return s
end

--è¯»å–æ•°æ®å‡½æ•°
function Read(url)
    file = io.open(url, "r")
	if (file == nil) then
	    return nil
	else
        file:seek("set")
	    str = file:read("*a")
	    file:close()
        return str
	end
end

--å†™å…¥æ•°æ®å‡½æ•°
function Wirte(url,msg)
    file = io.open(url, "w+")
    file:write(msg)
	file:close()
    return "ok"
end

--å°æ€èŠå¤©å‡½æ•°
function xiaosiapi(CurrentQQ,data,str)
    response, error_message =
            http.request(
            "GET",
            "https://api.ownthink.com/bot",
            {
                query = "appid="..tostring(data.FromUserId).."&spoken=" .. url_encode(str),
                headers = {
                    Accept = "*/*"
                }
            }
        )
        html = response.body
		jData = json.decode(html)
		return jData
end

--æœºå™¨èŠå¤©å‡½æ•°
function ownthink(CurrentQQ,data,msgs,atqq)
    if (tostring(atqq) == CurrentQQ) then
        m = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
        if (m == nil) then
	        log.info("Str ====> %s", m)
            return 1
	    end
	    if (string.find(m, "å…³é—­")) then
	        sedmsg(CurrentQQ,data,"æœºå™¨èŠå¤©å¤„äºå…³é—­çŠ¶æ€\nâˆ´è¯·å…ˆå¼€å¯æœºå™¨èŠå¤©")
	        return 1
	    end
		res2 = string.find(msgs, " ")
		str = string.sub(msgs,res2)
		jData = xiaosiapi(CurrentQQ,data,str)
		Data = json.decode(data.Content)
		m = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
		if (m == nil) then
	        log.info("Str ====> %s", m)
            return 1
	    end
		if (string.find(m, "å›å¤èŠå¤©")) then
		    Api.Api_SendMsg(
                CurrentQQ,
                {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "ReplayMsg",
                groupid = 0,
                content = jData.data.info.text,
                atUser = 0,
				replayInfo = {
                    MsgSeq = data.MsgSeq,
                    --å›å¤æ¶ˆæ¯çš„Seq
                    MsgTime = data.MsgTime,
                    --å›å¤æ¶ˆæ¯çš„äº‹ä»¶
                    UserID = data.FromUserId,
                    --å›å¤æ¶ˆæ¯å¯¹è±¡
                    RawContent = Data.Content --å›å¤æ¶ˆæ¯çš„åŸå†…å®¹
                }
				}
            )
			return 1
		elseif (string.find(m, "æ–‡å­—èŠå¤©")) then
		    sedmsg(CurrentQQ,data,jData.data.info.text)
		else
		    sedvoicemsg(CurrentQQ,data,url_encode(jData.data.info.text))
		end
    end
end

--å‘é€è¯­éŸ³æ¶ˆæ¯
function sedvoicemsg(CurrentQQ,data,str)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "VoiceMsg",
        groupid = 0,
		voiceUrl = "https://dds.dui.ai/runtime/v1/synthesize?voiceId=qianranfa&speed=0.7&volume=100&audioType=wav&text="..str, --å‘é€è¯­éŸ³çš„ç½‘ç»œåœ°å€ æ–‡æœ¬å‹
        voiceBase64Buf = "",
        content = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å¤©æ°”æŸ¥è¯¢å‡½æ•°
--[[function tianqi(CurrentQQ,data)
    keyWord = data.Content:gsub("å¤©æ°”", "")
        if keyWord == "" then
            return 1
        end

        cookies = Api.Api_GetUserCook(CurrentQQ)

        response, error_message =
            http.request(
            "GET",
            "https://weather.mp.qq.com/cgi-bin/rich",
            {
                query = "g_tk=" .. cookies.Gtk .. "&city=" .. url_encode(keyWord),
                headers = {
                    Referer = "http://weather.mp.qq.com/ark"
                },
                cookies = {
                    uin = CurrentQQ,
                    skey = cookies.Skey
                }
            }
        )
        local html = response.body
        log.notice("From Lua html -->%s", html)

        local j = json.decode(html)
        if j.code ~= 0 then
            return 1
        end

        ApiRet =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "JsonMsg",
                groupid = 0,
                content = string.format(
                    --{"config":{"forward":1,"autosize":1},"prompt":"[åº”ç”¨]å¤©æ°”","app":"com.tencent.weather","ver":"0.0.0.1","view":"RichInfoView","meta":{"richinfo":{"adcode":"101210701","city":"æˆéƒ½","air":"58","min":"20","ts":"1500550866","wind":"1","date":"6æœˆ27æ—¥ å‘¨å››","max":"28","type":"201"}},"desc":"å¤©æ°”"}
                    --[[{"app":"com.tencent.weather","desc":"","meta":{"weather":{"ad":[{"icon":"http://imgcache.qq.com/ac/tq/xz2/tp.jpg","p":"ptype=star","t":"2","title":"æ˜Ÿåº§ | ä»Šå¤©ä¼šå› ä¸ºæ„Ÿæƒ…å’Œå®¶åº­çš„é—®é¢˜ï¼Œå½±å“å·¥ä½œï¼Œè¿˜æœ‰ï¼Œä¹Ÿè¦æ³¨æ„äºº...","url":""},{"icon":"http://imgcache.qq.com/ac/qqweather/image/2019/6/27.png","p":"ptype=lunar","t":"4","title":"é»„å† | å†œå†äº”æœˆå»¿äº”ã€‚å®œè®¢ç›Ÿ.çº³é‡‡.å‡ºè¡Œ.ç¥ˆç¦.æ–‹é†®.å®‰åºŠ.ä¼š...","url":""}],"info":{"it1":{"adcode":"101050101","city":"æ­¦æ±‰","hour":"18","max":"29","min":"17","temp":"24","type":"202","ut":"1561630401","wea":"å¤šäº‘"},"it2":{"hour":"19","temp":"22","type":"202"},"it3":{"hour":"20","temp":"21","type":"202"},"ts":"1561631244"},"url":""}},"prompt":"ã€å“ˆå°”æ»¨ã€‘å¤šäº‘ 17Â°/29Â°, 18:13æ›´æ–°~","ver":"1.0.0.106","view":"WeatherThreeView"}]]
--[[                    [[{"app":"com.tencent.weather","desc":"å¤©æ°”","view":"RichInfoView","ver":"1.0.0.217","prompt":"[åº”ç”¨]å¤©æ°”","meta":{"richinfo":{"adcode":"%s","air":"%s","city":"%s","date":"%s","max":"%s","min":"%s","ts":"1554951408","type":"%s","wind":"%s"}},"config":{"forward":1,"autosize":1,"type":"card"}}]],
--[[                    j.data.adcode,
                    j.data.air,
                    j.data.city,
                    j.data.date,
                    j.data.max,
                    j.data.min,
                    j.data.type,
                    j.data.wind
                ),
                atUser = 0
            }
        )
end
--]]
--è°ƒæ•™å¤„ç†å‡½æ•°(å¾…å¤„ç†)
function tiaojiao(CurrentQQ,data)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
	if (mim == nil) then
		sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå“‡")
		return 1
	end
	if (string.find(data.Content, "^åˆ é™¤è°ƒæ•™")) then
	    msg = data.Content:gsub("åˆ é™¤è°ƒæ•™", "")
	    if (msg == "") then
		    sedmsg(CurrentQQ,data,"è¦åˆ é™¤çš„è°ƒæ•™æŒ‡ä»¤ä¸èƒ½ä¸ºç©ºå“¦")
		    return 1
		end
		rese = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..tostring(data.FromGroupId).."\/"..msg..".txt")
	    if (rese == nil) then
			sedmsg(CurrentQQ,data,"è¿™ä¸ªæŒ‡ä»¤ä¸å­˜åœ¨äº†å“¦")
		    return 1
		end
		rm_file = os.remove("mimoio\/æœºå™¨è°ƒæ•™\/"..tostring(data.FromGroupId).."\/"..msg..".txt")
		log.info("åˆ é™¤è°ƒæ•™ ====> %s", rm_file)
		sedmsg(CurrentQQ,data,"åˆ é™¤æˆåŠŸ\nä½ ä¸å–œæ¬¢è¢«è¿™æ ·è°ƒæ•™çš„æˆ‘å—[è¡¨æƒ…9]")
		return 1
	end
    msgs = data.Content:gsub("è°ƒæ•™", "")
		res2 = string.find(msgs, "#")
		str = string.sub(msgs,res2+1)
		str2 = string.sub(msgs,1,res2-1)
		        
		        if (str == "") then
		            sedmsg(CurrentQQ,data,"è°ƒæ•™çš„å›ç­”å†…å®¹ä¸èƒ½ä¸ºç©ºå“¦")
			        return 1
		        end
				if (str2 == "") then
		            sedmsg(CurrentQQ,data,"è°ƒæ•™çš„æŒ‡ä»¤å†…å®¹ä¸èƒ½ä¸ºç©ºå“¦")
			        return 1
		        end
		        rese = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..str2..".txt")
					if (rese ~= nil) then
				        sedmsg(CurrentQQ,data,"æŒ‡ä»¤å·²ç»å­˜åœ¨äº†å“¦")
				        return 1
				    end
				Wirte("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..str2..".txt",str)
				sedmsg(CurrentQQ,data,"è°ƒæ•™æˆåŠŸ\nä½ è¿˜æƒ³å†è°ƒæ•™æˆ‘ä¸€æ¬¡å—[è¡¨æƒ…6]")
		        return 1
end

function url_encode(str)
    if (str) then
        str = string.gsub(str, "\n", "\r\n")
        str =
            string.gsub(
            str,
            "([^%w ])",
            function(c)
                return string.format("%%%02X", string.byte(c))
            end
        )
        str = string.gsub(str, " ", "+")
    end
    return str
end

--æŠ¢çº¢åŒ…å¤„ç†
function RedBag(CurrentQQ, data)
    Api.Api_OpenRedBag(CurrentQQ, data.RedBaginfo)
    if (data.RedBaginfo.RedType == 12) then
         luaRes =
                Api.Api_SendMsg(
                CurrentQQ,
                {
                    toUser = data.FromGroupId,
                    sendToType = 2,
                    sendMsgType = "TextMsg",
                    groupid = 0,
                    content = data.RedBaginfo.Tittle,
                    atUser = 0
                }
            )
        log.notice("From Lua SendMsg Ret\n%d", luaRes.Ret)
    end
end

--è§†é¢‘è§£æå¤„ç†
function Video(CurrentQQ, data)
    vdata = json.decode(data.Content)
        videodata = {
            GroupID = data.FromGroupId,
            VideoUrl = vdata.VideoUrl,
            VideoMd5 = vdata.VideoMd5
        }
        --æ„é€ table å‚æ•°è¡¨
        luaResp = Api.Api_CallFunc(CurrentQQ, "PttCenterSvr.ShortVideoDownReq", videodata) --é€šè¿‡cmdè°ƒç”¨åŠŸèƒ½åŒ…
        luaRes =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "TextMsg",
                groupid = 0,
                content = "è§£æè§†é¢‘URL-->" .. luaResp.VideoUrl,
                atUser = 0
            }
        )
end

--ç®¡ç†å¼€å…³é€šç”¨
function adminio(CurrentQQ,data,oio)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim ~= nil) then
            msg = data.Content:gsub(oio, "")
            str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
            if (string.find(str, "å…³é—­")) then
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äººå·²è¢«å…³é—­...\nè¯·å…ˆå¼€å¯æœºå™¨äºº")
                return 1
            end
			str2 = Read("mimoio\/çŠ¶æ€æ•°æ®\/"..oio.."\/"..data.FromGroupId..".txt")
			if (string.find(str2, msg)) then
			    sedmsg(CurrentQQ,data,"âˆ´"..oio.."æœ¬å°±æ˜¯"..str2.."çŠ¶æ€")
                return 1
			end
            Wirte("mimoio\/çŠ¶æ€æ•°æ®\/"..oio.."\/"..data.FromGroupId..".txt",msg)
            sedmsg(CurrentQQ,data,"âˆ´"..oio..msg.."æˆåŠŸ")
            return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
end

--ç™¾ç§‘å¤§å…¨
function baike(CurrentQQ,data)
    keyWord = data.Content:gsub("ç™¾ç§‘", "")
        if keyWord == "" then
            return 1
        end
        response, error_message =
            http.request(
            "GET",
            "http://baike.baidu.com/api/openapi/BaikeLemmaCardApi",
            {
                query = "scope=103&format=json&appid=379020&bk_key=" .. url_encode(keyWord) .. "&bk_length=600"
            }
        )
        html = response.body
        while(string.find(html, '"errno":2')) do
            response, error_message =
            http.request(
            "GET",
            "http://baike.baidu.com/api/openapi/BaikeLemmaCardApi",
            {
                query = "scope=103&format=json&appid=379020&bk_key=" .. url_encode(keyWord) .. "&bk_length=600"
            })
			html = response.body
        end
        local j = json.decode(html)
        sedmsg(CurrentQQ,data,j.abstract.."\n"..j.url)
end

--éŸ³ä¹ç‚¹æ­Œ
function music(CurrentQQ,data)
    keyWord = data.Content:gsub("ç‚¹æ­Œ", "")
        if keyWord == "" then
            return 1
        end
        response, error_message =
            http.request(
            "GET",
            "https://c.y.qq.com/soso/fcgi-bin/client_search_cp",
            {
                query = "aggr=1&cr=1&flag_qc=0&p=1&n=6&w=" .. url_encode(keyWord)
            }
        )
        html = response.body
		str = string.sub(html,10,-2)
        j = json.decode(str)
        if (j.code == 0) then
            msg = ""
            num = j.data.song.list
            list = num[1]
            songname = list.songname
            singername = list.singer[1].name
            payplay = list.pay.payplay
			albummid = list.albummid
			songmid = list.songmid
	        sedjsonmsg(CurrentQQ,data,'{"app":"com.tencent.structmsg","desc":"éŸ³ä¹","view":"music","ver":"0.0.0.1","prompt":"[åˆ†äº«]' ..songname.. '","meta":{"music":{"sourceMsgId":"0","title":"' ..songname.. '","desc":"' ..singername.. '","preview":"y.gtimg.cn/music/photo_new/T002R150x150M000'..albummid..'.jpg","tag":"QQéŸ³ä¹","musicUrl":"https://v1.itooi.cn/tencent/url?id='..songmid..'","jumpUrl":"y.qq.com/n/yqq/song/'..songmid..'.html","appid":100497308,"app_type":1,"action":"","source_url":"url.cn/5aSZ8Gc","source_icon":"url.cn/5tLgzTm","android_pkg_name":"com.tencent.qqmusic"}},"config":{"forward":true,"type":"normal","autosize":true}}')
			return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´Error:"..j.code)
			return 1
        end
end

--è®¿é—®url
function geturl(url_class,url,caulrt)
        response, error_message =
            http.request(
            url_class,
            url,
            {
                query = caulrt
            }
        )
        html = response.body
		return html
end

--æ¶ˆæ¯å‚¨è“„
function msgsql(CurrentQQ,data)
    if (mysqlpass == "") then
	    return 1
	end
    c = mysql.new()
    -- åˆå§‹åŒ–mysqlå¯¹è±¡
    ok, err = c:connect({host = mysqlhost, port = 3306, database = mysqldb, user = mysqluser, password = mysqlpass})
    --å»ºç«‹è¿æ¥
    if ok then
        sqlstr =
            string.format(
            [[INSERT INTO msgcache (GroupID, MsgSeq, MsgRandom,MsgType,Data,MsgTime)VALUES (%d,%d,%d,'%s','%s',%d)]],
            data.FromGroupId,
            data.MsgSeq,
            data.MsgRandom,
            data.MsgType,
            data.Content,
            data.MsgTime
        )
        res, err = c:query(sqlstr) --å…¥åº“ç¼“å­˜æ¶ˆæ¯
        log.info("%s", err)
        c.close(c)
    --é‡Šæ”¾è¿æ¥
    end
    return 1
end

--æ’¤å›æ£€æµ‹
function CheHui(CurrentQQ, data, extData)
    c = mysql.new()
    -- åˆå§‹åŒ–mysqlå¯¹è±¡
	if (mysqlpass == "") then
	    return 1
	end
	
    if data.MsgType == "ON_EVENT_GROUP_REVOKE" then --ç›‘å¬ ç¾¤æ’¤å›äº‹ä»¶
        str = string.format("ç¾¤æˆ %d  æˆå‘˜ UserID %s æ’¤å›äº†æ¶ˆæ¯Seq %s \n", extData.GroupID, extData.UserID, extData.MsgSeq)
        log.info("%s", str)
        ok, err = c:connect({host = mysqlhost, port = 3306, database = mysqldb, user = mysqluser, password = mysqlpass})
        --å»ºç«‹è¿æ¥
        log.info("sql %v", err)
        if ok then
            sqlstr =
                string.format(
                "select * from msgcache where `GroupID`= %d and `MsgSeq` = %d",
                extData.GroupID,
                extData.MsgSeq
            )
            res, err = c:query(sqlstr) --è·Ÿç¾¤ç¾¤idå’Œæ¶ˆæ¯SEQæŸ¥è¯¢å‡ºæ’¤å›çš„æ¶ˆæ¯å†…å®¹
            if err == nil then
                c.close(c)
                GroupID = tonumber(res[1]["GroupID"])
                MsgType = res[1]["MsgType"]
                Data = res[1]["Data"]

                if MsgType == "TextMsg" then
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            --å‘é€æ–‡æœ¬æ¶ˆæ¯
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡æ–‡æœ¬æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                Data
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "SmallFaceMsg" then
                    --Data {"Content":"[è¡¨æƒ…101]","Hex":"FKY=","Index":101,"tips":"[å°è¡¨æƒ…]"}
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡è¡¨æƒ…æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).Content
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "PicMsg" then
                    --Data {"Content":"","FileId":2820717626,"FileMd5":"q0oEC5aloJJMFr10mplaXw==","FileSize":7026,"tips":"[ç¾¤å›¾ç‰‡]","url":"http://gchat.qpic.cn/gchatpic_new/1700487478/960839480-2534335053-AB4A040B96A5A0924C16BD749A995A5F/0?vuin=u0026term=255u0026pictype=0"}
                    jData = json.decode(Data)
					if (jData.tips == "[ç¾¤æ¶ˆæ¯-QQé—ªç…§]") then
					    
					Api.Api_SendMsg( 
                    CurrentQQ,
                    {
                        toUser = GroupID,
                        sendToType = 2,
                        sendMsgType = "ForwordMsg",
                        content = "",
                        atUser = 0,
                        groupid = 0,
                        voiceUrl = "",
                        voiceBase64Buf = "",
                        picUrl = "",
                        picBase64Buf = "",
                        forwordBuf = json.decode(Data).ForwordBuf, --æ¬²è½¬å‘çš„base64buf å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                        forwordField = json.decode(Data).ForwordField --æ¬²å†™å…¥åè®®çš„å­—æ®µID å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                    }
                )
				    return 1
					end
                    Api.Api_SendMsg( --é€šè¿‡å›¾ç‰‡md5å‘é€å›¾ç‰‡ ç§’å‘ä¸ç”¨ä¸Šä¼  ç›¸å½“äºè½¬å‘
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "PicMsg",
                            --å‘é€å›¾æ–‡æ¶ˆæ¯
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡å›¾ç‰‡æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š[PICFLAG]%s",
                                extData.UserID,
                                jData.Content
                            ),
                            --é€šè¿‡å®[PICFLAG]æ”¹å˜å›¾æ–‡é¡ºåº  æ”¹ä¸ºç°æ–‡å­—åå›¾ç‰‡
                            atUser = 0,
                            voiceUrl = "",
                            voiceBase64Buf = "",
                            picUrl = "",
                            picBase64Buf = "",
                            fileMd5 = jData.FileMd5
                        }
                    )
                end
                if MsgType == "AtMsg" then
                    --Data {"Content":"@Kar98k skjjkssjkjs","UserID":123456789,"tips":"[ATæ¶ˆæ¯]"}
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡atæ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).Content
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "VoiceMsg" then
                    --Data {"tips":"[è¯­éŸ³]","url":"http://grouptalk.c2c.qq.com/?ver=0u0026rkey=3062020101045b305902010102010102041fdef8ae042439416931554e5142586c536d78706a314c686843664959725f327a5f573064697653755902045dac2a21041f0000000866696c6574797065000000013100000005636f64656300000001310400u0026filetype=1u0026voice_codec=1"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "VoiceMsg",
                            --å‘é€ç¾¤è¯­éŸ³æ¶ˆæ¯
                            groupid = 0,
                            content = "",
                            atUser = 0,
                            voiceUrl = json.decode(Data).url,
                            --é€šè¿‡ç½‘ç»œurlè¿›è¡Œå‘é€è¯­éŸ³
                            voiceBase64Buf = "",
                            picUrl = "",
                            picBase64Buf = ""
                        }
                    )
                end

                if MsgType == "ReplayMsg" then
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡å›å¤æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).ReplayContent
                            ),
                            atUser = 0
                        }
                    )
                end
				if MsgType == "VideoMsg" then
	             Api.Api_SendMsg( 
                    CurrentQQ,
                    {
                        toUser = GroupID,
                        sendToType = 2,
                        sendMsgType = "ForwordMsg",
                        content = "",
                        atUser = 0,
                        groupid = 0,
                        voiceUrl = "",
                        voiceBase64Buf = "",
                        picUrl = "",
                        picBase64Buf = "",
                        forwordBuf = json.decode(Data).ForwordBuf, --æ¬²è½¬å‘çš„base64buf å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                        forwordField = json.decode(Data).ForwordField --æ¬²å†™å…¥åè®®çš„å­—æ®µID å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                    }
                )
				end
                if MsgType == "XmlMsg" then
				    
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "XmlMsg",
                            groupid = 0,
                            content = string.format("%s", Data),
                            atUser = 0
                        }
                    )
                end
				if MsgType == "JsonMsg" then
				    
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "JsonMsg",
                            groupid = 0,
                            content = string.format("%s", Data),
                            atUser = 0
                        }
                    )
                end
            end
        end
    end
    return 1
end
2020/09/07 12:55:26.549 [E]  mimoio.lua
2020/09/07 12:55:26.549 [E]  local log = require("log")
local Api = require("coreApi")
local json = require("json")
local http = require("http")
local mysql = require("mysql")

--ç‰ˆæœ¬å·(ä¸è¦æ”¹åŠ¨)
Vabr = "1.0.2"
--æ•°æ®åº“é…ç½®
mysqlhost = "localhost"--é»˜è®¤ä¸åŠ¨
mysqldb = "ffaxx001"--æ•°æ®åº“å
mysqluser = "ffaxx001"--æ•°æ®åº“ç”¨æˆ·å
mysqlpass = "123456"--æ•°æ®åº“å¯†ç 
--ä¸ä½¿ç”¨è¯·ä¸è¦æ”¹åŠ¨

function ReceiveFriendMsg(CurrentQQ, data)
    if (data.Content == "ä½¿ç”¨æ–¹æ³•") then
	    sendfrimsg(CurrentQQ,data,"æ·»åŠ æˆæƒè€…çš„æ–¹æ³•\nå¯¹å•ä¸ªæœºå™¨äººç§èŠå‘é€[æ·»åŠ æˆæƒè€…+æˆæƒè€…QQ]\n\næˆæƒç¾¤çš„æ–¹æ³•\nåˆ°éœ€è¦æˆæƒçš„ç¾¤é‡Œå‘é€[æˆæƒ+ä¸»äººQQ]ã€‚æ³¨æ„:æˆæƒå¿…é¡»æ˜¯æˆæƒè€…è¿›è¡Œæ“ä½œ,ç®¡ç†å‘˜æˆæƒä¸äº†")
	end
    --æ•°æ®åˆå§‹åŒ–
    if (data.Content == "åˆå§‹åŒ–") then
	    root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root ~= nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´è¯·ä¸è¦é‡å¤åˆå§‹åŒ–")
			return 1
		end
    --os.execute('mkdir mimoio/æœºå™¨æˆæƒ')
	    os.execute('mkdir mimoio')
		os.execute('mkdir mimoio/å¤è¯»æœº')
		os.execute('mkdir mimoio/å¤è¯»æœº/æ¬¡æ•°')
		os.execute('mkdir mimoio/å¤è¯»æœº/å†…å®¹')
		os.execute('mkdir mimoio/æœºå™¨æˆæƒ')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨ä¸»äºº')
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨èŠå¤©')
		os.execute('mkdir mimoio/æœºå™¨è°ƒæ•™')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æŠ¢çº¢åŒ…')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æœºå™¨èŠå¤©')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æœºå™¨å¼€å…³')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/æ’¤å›æ£€æµ‹')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/å›¾ç‰‡è§£æ')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/è§†é¢‘è§£æ')
		os.execute('mkdir mimoio/çŠ¶æ€æ•°æ®/é—ªç…§æ£€æµ‹')
		Wirte("mimoio\/"..data.FromUin..".txt","999")
		sendfrimsg(CurrentQQ,data,"åˆå§‹åŒ–å®Œæ¯•ï¼\nå‘é€[ä½¿ç”¨æ–¹æ³•]äº†è§£ä½¿ç”¨å§")
	end
	--æ·»åŠ æˆæƒè€…æ“ä½œ(ç§èŠæœºå™¨äººå‘é€)
	if (string.find(data.Content, "^æ·»åŠ æˆæƒè€…")) then
	    msg = data.Content:gsub("æ·»åŠ æˆæƒè€…", "")
		--Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromUin..".txt","å…³é—­")
		root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root == nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„ç®¡ç†è€…")
			return 1
		end
		Wirte("mimoio\/æœºå™¨æˆæƒ\/"..msg..CurrentQQ..".txt","999")
		sendfrimsg(CurrentQQ,data,"âˆ´æ·»åŠ æˆæƒè€…æˆåŠŸ")
	end
	--åˆ é™¤æˆæƒè€…æ“ä½œ(ç§èŠæœºå™¨äººå‘é€)
	if (string.find(data.Content, "^åˆ é™¤æˆæƒè€…")) then
	    msg = data.Content:gsub("åˆ é™¤æˆæƒè€…", "")
		--Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromUin..".txt","å…³é—­")
		root = Read("mimoio\/"..data.FromUin..".txt")
	    if (root == nil) then
		    sendfrimsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„ç®¡ç†è€…")
			return 1
		end
		os.remove("mimoio\/æœºå™¨æˆæƒ\/"..msg..CurrentQQ..".txt")
		sendfrimsg(CurrentQQ,data,"âˆ´åˆ é™¤æˆæƒè€…æˆåŠŸ")
	end
    return 1
end
function ReceiveGroupMsg(CurrentQQ, data)
    if (tostring(data.FromUserId) == CurrentQQ) then
	    return 1
	end
	--ç¾¤èŠæˆæƒ(åˆ°éœ€è¦æˆæƒçš„ç¾¤é‡Œæ“ä½œ)
	if (string.find(data.Content, "^æˆæƒ")) then
	    root = Read("mimoio\/æœºå™¨æˆæƒ\/"..data.FromUserId..CurrentQQ..".txt","999")
		if (root == nil) then
		    sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„æˆæƒè€…")
			return 1
		end
		msg = data.Content:gsub("æˆæƒ", "")
		os.execute('mkdir mimoio/æœºå™¨è°ƒæ•™/'..data.FromGroupId)
		os.execute('mkdir mimoio/æœºå™¨é…ç½®/æœºå™¨ä¸»äºº/'..data.FromGroupId)
		Wirte("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..msg..".txt","999")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt","å…³é—­")
		Wirte("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt","å›å¤èŠå¤©")
		sedmsg(CurrentQQ,data,"âˆ´æˆæƒæˆåŠŸï¼\nå‘é€[å¼€å¯æœºå™¨äºº]ä½¿ç”¨å§")
	end
	--åˆ é™¤æˆæƒæ“ä½œ(åˆ°éœ€è¦åˆ é™¤æˆæƒçš„ç¾¤é‡Œæ“ä½œ)
	if (string.find(data.Content, "^åˆ é™¤æˆæƒ")) then
	    root = Read("mimoio\/æœºå™¨æˆæƒ\/"..data.FromUserId..CurrentQQ..".txt","999")
		if (root == nil) then
		    sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘çš„æˆæƒè€…")
			return 1
		end
		msg = data.Content:gsub("åˆ é™¤æˆæƒ", "")
		os.remove("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..msg..".txt")
		os.remove("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
		sedmsg(CurrentQQ,data,"âˆ´åˆ é™¤æˆæƒæˆåŠŸï¼")
	end
	--æœºå™¨å¼€å…³æŒ‡ä»¤
	if (data.Content == "å¼€å¯æœºå™¨äºº" or data.Content == "å…³é—­æœºå™¨äºº") then
        mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim ~= nil) then
            msg = data.Content:gsub("æœºå™¨äºº", "")
            str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
			if (str == nil) then
			    Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt",msg)
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äºº"..msg.."æˆåŠŸï¼")
				log.info("Str ====> %s", str)
                return 1
			end
			
            if (string.find(str, msg)) then
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äººä¸€ç›´æ˜¯"..msg.."çš„å‘")
                return 1
            end
            Wirte("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt",msg)
            sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äºº"..msg.."æˆåŠŸï¼")
            return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
	end
    --æœºå™¨äººå¼€å¯æ£€æµ‹
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
	if (str == nil) then
	    log.info("Str ====> %s", str)
        return 1
	end
	if (string.find(str, "å…³é—­")) then
	    return 1
	end
	--atæ¶ˆæ¯å¤„ç†
	msgs = ""
	atqq = 0
	if (string.find(data.Content, "ATæ¶ˆæ¯")) then
	    msgs = json.decode(data.Content).Content
		atqq = json.decode(data.Content).UserID
	end
	--å°¾å·´è‡ªå®šä¹‰(å¾…å®Œå–„)
	tips = "â€”â€”å‡¤é£ç¿±ç¿”å…®ä¸·"
    --åŠŸèƒ½æ¨¡å—
    if (data.Content == "åŠŸèƒ½" or data.Content == "ä¸»ç•Œé¢") then
        face = faceArray()
        sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."å½±è§†æœç´¢\n"..face.."èŠå¤©å¨±ä¹\n"..face.."ä¾¿åˆ©åŠŸèƒ½\n"..face.."æœºå™¨è°ƒæ•™\n"..face.."ç®¡ç†ç³»ç»Ÿ\n"..face.."bugåé¦ˆ\n"..face.."æœ¬ç¾¤çŠ¶æ€\n"..face.."æ›´æ–°æ£€æµ‹\n\n"..tips)
    end
    --å½±è§†æœç´¢æ¨¡å—
    if (data.Content == "å½±è§†æœç´¢") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."æœç´¢+å½±è§†å\n"..face.."æˆ‘æƒ³çœ‹+å½±è§†å\n"..face.."æˆ‘è¦çœ‹+å½±è§†å\n\n"..tips)
    elseif (string.find(data.Content, "^æœç´¢")) then
	    msg = data.Content:gsub("æœç´¢", "")
		Sousuo(CurrentQQ,data,msg)
	elseif (string.find(data.Content, "^æˆ‘æƒ³çœ‹")) then
	    msg = data.Content:gsub("æˆ‘æƒ³çœ‹", "")
		Sousuo(CurrentQQ,data,msg)
    elseif (string.find(data.Content, "^æˆ‘è¦çœ‹")) then
	    msg = data.Content:gsub("æˆ‘è¦çœ‹", "")
		Sousuo(CurrentQQ,data,msg)
	end
	--èŠå¤©å¨±ä¹æ¨¡å—
	if (data.Content == "èŠå¤©å¨±ä¹") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."åˆ‡æ¢æ–‡å­—èŠå¤©\n"..face.."åˆ‡æ¢å›å¤èŠå¤©\n"..face.."åˆ‡æ¢è¯­éŸ³èŠå¤©\n\n"..tips)
    elseif (data.Content == "åˆ‡æ¢æ–‡å­—èŠå¤©") then
		liaotian(CurrentQQ,data,1)
	elseif (data.Content == "åˆ‡æ¢è¯­éŸ³èŠå¤©") then
	    liaotian(CurrentQQ,data,2)
    elseif (data.Content == "åˆ‡æ¢å›å¤èŠå¤©") then
	    liaotian(CurrentQQ,data,3)
	else
	    ownthink(CurrentQQ,data,msgs,atqq)
	end
	--ä¾¿åˆ©åŠŸèƒ½æ¨¡å—
	if (data.Content == "ä¾¿åˆ©åŠŸèƒ½") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."ç™¾ç§‘å¤§å…¨\n"..face.."éŸ³ä¹ç‚¹æ­Œ\n"..face.."é—ªä»–@xx\n"..face.."å¤©æ°”æŸ¥è¯¢\n\n"..tips)
	elseif (data.Content == "ç™¾ç§‘å¤§å…¨") then
		sedmsg(CurrentQQ,data,"å‘é€:[ç™¾ç§‘+å…³é”®è¯]\nä¾‹å¦‚:ç™¾ç§‘æ´›å¦¾èº«")
    elseif (data.Content == "éŸ³ä¹ç‚¹æ­Œ") then
		sedmsg(CurrentQQ,data,"å‘é€:[ç‚¹æ­Œ+æ­Œå]\nä¾‹å¦‚:ç‚¹æ­Œé’æŸ ")
	elseif (data.Content == "å¤©æ°”æŸ¥è¯¢") then
		sedmsg(CurrentQQ,data,"å‘é€:[å¤©æ°”+åœ°æ–¹å]\nä¾‹å¦‚:å¤©æ°”åŒ—äº¬(é™äºå›½å†…)")
    elseif (string.find(data.Content, "^å¤©æ°”")) then
        tianqi(CurrentQQ,data)
	    --msg = data.Content:gsub("æœç´¢", "")
		--Sousuo(CurrentQQ,data,msg)
	elseif (string.find(data.Content, "^ç™¾ç§‘")) then
	    baike(CurrentQQ,data)
	    --msg = data.Content:gsub("æˆ‘æƒ³çœ‹", "")
		--Sousuo(CurrentQQ,data,msg)music(CurrentQQ,data)
    elseif (string.find(data.Content, "^ç‚¹æ­Œ")) then
	    music(CurrentQQ,data)
	end
	--æœºå™¨è°ƒæ•™æ¨¡å—
	if (data.Content == "æœºå™¨è°ƒæ•™") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."æ–‡å­—è°ƒæ•™\n"..face.."è¯­éŸ³è°ƒæ•™\n"..face.."å”±æ­Œè°ƒæ•™\n"..face.."éŸ³ä¹è°ƒæ•™\n"..face.."å›¾ç‰‡è°ƒæ•™\n"..face.."åˆ é™¤è°ƒæ•™\n\n"..tips)
    elseif (data.Content == "æ–‡å­—è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#(å†…å®¹)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#ä½ å¥½å•Š")
	elseif (data.Content == "è¯­éŸ³è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#è¯­éŸ³(å†…å®¹)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#è¯­éŸ³ä½ å¥½å•Š")
	elseif (data.Content == "å›¾ç‰‡è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#å›¾ç‰‡(é“¾æ¥)]\nä¾‹å¦‚:è°ƒæ•™ä½ å¥½#å›¾ç‰‡http://../1.jpg")
	elseif (data.Content == "éŸ³ä¹è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#ç‚¹æ­Œ(æ­Œå)]\nä¾‹å¦‚:è°ƒæ•™å–µ#ç‚¹æ­Œå­¦çŒ«å«")
	elseif (data.Content == "å”±æ­Œè°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[è°ƒæ•™(æŒ‡ä»¤)#å”±æ­Œ(æ­Œå)]\nä¾‹å¦‚:è°ƒæ•™å–µ#å”±æ­Œå­¦çŒ«å«")
	elseif (data.Content == "åˆ é™¤è°ƒæ•™") then
		sedmsg(CurrentQQ,data,"å‘é€[åˆ é™¤è°ƒæ•™(æŒ‡ä»¤)]\nä¾‹å¦‚:åˆ é™¤è°ƒæ•™ä½ å¥½")
	elseif (string.find(data.Content, "^è°ƒæ•™")) then
        tiaojiao(CurrentQQ,data)
	elseif (string.find(data.Content, "^åˆ é™¤è°ƒæ•™")) then
        tiaojiao(CurrentQQ,data)
	end
	--ç®¡ç†ç³»ç»Ÿæ¨¡å—
	if (data.Content == "ç®¡ç†ç³»ç»Ÿ") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."å¼€å¯/å…³é—­æœºå™¨äºº\n"..face.."å¼€å¯/å…³é—­æŠ¢çº¢åŒ…\n"..face.."å¼€å¯/å…³é—­æœºå™¨èŠå¤©\n"..face.."å¼€å¯/å…³é—­é—ªç…§æ£€æµ‹\n"..face.."å¼€å¯/å…³é—­å›¾ç‰‡è§£æ\n"..face.."å¼€å¯/å…³é—­è§†é¢‘è§£æ\n"..face.."å¼€å¯/å…³é—­æ’¤å›æ£€æµ‹\n\n"..tips)
    elseif (data.Content == "å¼€å¯æœºå™¨èŠå¤©" or data.Content == "å…³é—­æœºå™¨èŠå¤©") then
        adminio(CurrentQQ,data,"æœºå™¨èŠå¤©")
    elseif (data.Content == "å¼€å¯æ’¤å›æ£€æµ‹" or data.Content == "å…³é—­æ’¤å›æ£€æµ‹") then
        adminio(CurrentQQ,data,"æ’¤å›æ£€æµ‹")
	elseif (data.Content == "å¼€å¯é—ªç…§æ£€æµ‹" or data.Content == "å…³é—­é—ªç…§æ£€æµ‹") then
        adminio(CurrentQQ,data,"é—ªç…§æ£€æµ‹")
	elseif (data.Content == "å¼€å¯æŠ¢çº¢åŒ…" or data.Content == "å…³é—­æŠ¢çº¢åŒ…") then
        adminio(CurrentQQ,data,"æŠ¢çº¢åŒ…")
	elseif (data.Content == "å¼€å¯è§†é¢‘è§£æ" or data.Content == "å…³é—­è§†é¢‘è§£æ") then
        adminio(CurrentQQ,data,"è§†é¢‘è§£æ")
	elseif (data.Content == "å¼€å¯å›¾ç‰‡è§£æ" or data.Content == "å…³é—­å›¾ç‰‡è§£æ") then
        adminio(CurrentQQ,data,"å›¾ç‰‡è§£æ")
	end
	--bugåé¦ˆæ¨¡å—
	if (data.Content == "BUGåé¦ˆ" or data.Content == "bugåé¦ˆ") then
        face = faceArray()
		sedimgmsg(CurrentQQ,data,"http://q1.qlogo.cn/g?b=qq&nk="..data.FromUserId.."&s=640",face.."é‚®ä»¶åé¦ˆ\n"..face.."QQåé¦ˆ\n\n"..tips)
    elseif (data.Content == "QQåé¦ˆ") then
        sedmsg(CurrentQQ,data,"???Î£(ï¾Ÿâˆ€ï¾Ÿï¾‰)ï¾‰\næ’ä»¶æœ‰é—®é¢˜å¯ä»¥åé¦ˆåˆ°:\nQQ:2353065854")
    elseif (data.Content == "é‚®ä»¶åé¦ˆ") then
        sedmsg(CurrentQQ,data,"å®è´å’‹å•¦=ÍÍŸÍŸÍ(ê’ªá—œê’ª â€§Ì£Ì¥Ì‡)\næ’ä»¶æœ‰é—®é¢˜å¯ä»¥åé¦ˆåˆ°:\né‚®ç®±ğŸ“¬:ym-o@qq.com")
	end
	--æœ¬ç¾¤çŠ¶æ€æ¨¡æ¿
	if (data.Content == "æœ¬ç¾¤çŠ¶æ€") then
        face = faceArray()
        hb = Read("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt")
        sz = Read("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt")
		tp = Read("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt")
        sp = Read("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt")
        jqr = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
        lt = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
        ch = Read("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..data.FromGroupId..".txt")
		sedmsg(CurrentQQ,data,"çŠ¶æ€æ•°æ®åˆ—è¡¨â†“â†“â†“\n"..face.."æœºå™¨äºº:"..jqr.."\n"..face.."æŠ¢çº¢åŒ…:"..hb.."\n"..face.."å›¾ç‰‡è§£æ:"..tp.."\n"..face.."æ’¤å›æ£€æµ‹:"..ch.."\n"..face.."è§†é¢‘è§£æ:"..sp.."\n"..face.."æœºå™¨èŠå¤©:"..lt.."\n"..face.."é—ªç…§æ£€æµ‹:"..sz.."\n\n"..tips)
	end
	--æ›´æ–°æ¨¡å—
	if (data.Content == "æ›´æ–°æ£€æµ‹") then
        str = geturl("GET","http://118.25.41.32/Lsb/lua/Vabr.txt","")
		log.info("Str ====> %s", str)
        if (string.find(str, Vabr)) then
            sedmsg(CurrentQQ,data,"å½“å‰ç‰ˆæœ¬ä¸ºæœ€æ–°ç‰ˆ")
        else
            sedmsg(CurrentQQ,data,"å‘ç°æ–°ç‰ˆæœ¬!\nå½“å‰ç‰ˆæœ¬:"..Vabr.."\næ–°ç‰ˆæœ¬å·:"..str.."\nèµ¶å¿«å‘é€[æ›´æ–°æ’ä»¶]å§")
        end
	elseif (data.Content == "æ›´æ–°æ’ä»¶") then
	    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim == nil) then
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
        str = geturl("GET","http://118.25.41.32/Lsb/lua/Vabr.txt","")
		log.info("Str ====> %s", str)
        if (string.find(str, Vabr)) then
            sedmsg(CurrentQQ,data,"å½“å‰ç‰ˆæœ¬ä¸ºæœ€æ–°ç‰ˆ")
        else
            str = geturl("GET","http://118.25.41.32/Lsb/lua/mimoio.txt","")
            Wirte("Plugins\/mimoio.lua",str)
            sedmsg(CurrentQQ,data,"æ›´æ–°å®Œæ¯•ï¼")
        end
	end
	--å›¾ç‰‡ç±»å‹æ¶ˆæ¯å¤„ç†
    if (data.MsgType == "PicMsg") then
	    msg = Read("mimoio\/çŠ¶æ€æ•°æ®\/å›¾ç‰‡è§£æ\/"..data.FromGroupId..".txt")
		jData = json.decode(data.Content)
	    if (msg ~= nil and jData.tips ~= "[ç¾¤æ¶ˆæ¯-QQé—ªç…§]") then
            if (string.find(str, "å¼€å¯")) then
	            sedmsg(CurrentQQ,data,"å›¾ç‰‡é“¾æ¥è§£æå¦‚ä¸‹â†“â†“\n"..jData.url)
				return 1
	        end
	    end
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/é—ªç…§æ£€æµ‹\/"..data.FromGroupId..".txt")
	    if (str == nil) then
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    --é—ªç…§ã€å›¾ç‰‡å¤„ç†æ¨¡å—
		PicFlag(CurrentQQ, data)
    end
	--æŠ¢çº¢åŒ…å¤„ç†
	if (string.find(data.MsgType, "RedBagMsg") == 1) then
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æŠ¢çº¢åŒ…\/"..data.FromGroupId..".txt")
		if (str == nil) then
	        log.info("Str ====> %s", str)
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    RedBag(CurrentQQ, data)
	end
	--è§†é¢‘è§£æå¤„ç†
	if (string.find(data.MsgType, "VideoMsg") == 1) then
	    --å¼€å…³åˆ¤æ–­æ¨¡å—
	    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/è§†é¢‘è§£æ\/"..data.FromGroupId..".txt")
		if (str == nil) then
	        log.info("Str ====> %s", str)
            return 1
	    end
	    if (string.find(str, "å…³é—­")) then
	        return 1
	    end
	    Video(CurrentQQ, data)
	end
	--até—ªå›¾
	if (data.MsgType == "AtMsg") and (string.find(data.Content, "é—ªä»–")) then
	    shantu(CurrentQQ, data)
    end
	--è°ƒæ•™æœç´¢å¼•æ“
	mim = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..data.Content..".txt")
	if (mim == nil) then
	    --äººç±»çš„æœ¬è´¨æ˜¯å¤è¯»æœº
	    msg = Read("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt")
		if (msg ~= nil) then
		    cs = Read("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt")
			ii = tonumber(cs)
			if (string.find(msg, "^"..data.Content.."$")) then
			    if (ii > 2) then
			         math.randomseed(os.time())
                     sj = math.random(1, 5)
		             if (sj == 1 or sj == 2) then
			             sedmsg(CurrentQQ,data,msg)
					     rr = ii + 1
		                 Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
				     elseif (sj == 3) then
				         os.remove("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt")
					     os.remove("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt")
					     fdArray = {"çªç„¶æˆªæ–­å¤è¯»(ï¾ŸâŠ¿ï¾Ÿ)ï¾‚","å¤è¯»å¯è€»(â€¢Ì€ã¸ â€¢Ì â•® )","ä¸è¦å¤è¯»äº†å•¦","è¿™å°±æ˜¯æ‰€è°“çš„äººç±»çš„æœ¬è´¨","ä½ ä»¬å’‹ä¸ä¸Šå¤©å‘","åˆå¤è¯»ä¸Šç˜¾äº†å•Š"}
                         math.randomseed(os.time())
                         fdsj = math.random(1, 6)
				         sedmsg(CurrentQQ,data,fdArray[fdsj])
				     else
			             rr = ii + 1
		                 Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
		             end
			    else
			        rr = ii + 1
		            Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt",tostring(rr))
			    end
			else
			    if (ii > 2) then
			        math.randomseed(os.time())
                    sj2 = math.random(1, 3)
					if (sj2 == 2) then
					    fdArray2 = {"ä¸­æ–­å¤è¯»å¯è€»","æ‰“æ–­å¤è¯»å¯è€»(â€¢Ì€ã¸ â€¢Ì â•® )","ä½ ä¸ºä»€ä¹ˆè¦æ‰“æ–­å¤è¯»å•Š","å¤è¯»ä¸é¦™å˜›","ç ´åæ°›å›´(à¸‡áµ’ÌŒçš¿áµ’ÌŒ)à¸‡â¼Â³â‚Œâ‚ƒ"}
                        math.randomseed(os.time())
                        fdsj2 = math.random(1, 5)
				        sedmsg(CurrentQQ,data,fdArray2[fdsj2])
					end
				end
				Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt","1")
			    Wirte("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt",data.Content)
			end
		else
		    Wirte("mimoio\/å¤è¯»æœº\/æ¬¡æ•°\/"..data.FromGroupId..".txt","1")
			Wirte("mimoio\/å¤è¯»æœº\/å†…å®¹\/"..data.FromGroupId..".txt",data.Content)
		end
	    --å¦‚æœè°ƒæ•™æŒ‡ä»¤ä¸å­˜åœ¨ï¼Œåˆ™è¿›è¡Œå…¶ä»–æ“ä½œ
	    msgsql(CurrentQQ,data)--æ•°æ®å‚¨è“„
		--éšæœºå›å¤æ¶ˆæ¯æ¦‚ç‡0.04
	    math.randomseed(os.time())
        num = math.random(1, 40)
		if (num == 12) then
		    j = xiaosiapi(CurrentQQ,data,data.Content)
			sedmsg(CurrentQQ,data,j.data.info.text)
		end
	else
	    --è§¦å‘è°ƒæ•™æŒ‡ä»¤
		funic(CurrentQQ,data,mim)
	end
    return 1
end

function ReceiveEvents(CurrentQQ, data, extData)
  if data.MsgType == "ON_EVENT_GROUP_REVOKE" then --ç›‘å¬ ç¾¤æ’¤å›äº‹ä»¶
    --æ’¤å›äº‹ä»¶å¤„ç†
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æ’¤å›æ£€æµ‹\/"..extData.GroupID..".txt")
    if (str == nil) then
	    log.info("Str ====> %s", str)
        return 1
	end
	if (string.find(str, "å…³é—­")) then
		return 1
	end
	CheHui(CurrentQQ, data, extData)
	--xxxxxxxxxxxxxxx
    return 1
  end
end
  --è¿›ç¾¤ç§€å›¾æ¬¢è¿


--é—ªç…§æ£€æµ‹å¤„ç†


--åŠŸèƒ½ç»„
function funic(CurrentQQ,data,msg)
    if string.find(msg, "^ç‚¹æ­Œ") then
	    data.Content = msg
        music(CurrentQQ,data,msg)
		return 1
	elseif string.find(msg, "^è¯­éŸ³") then
	    keyWord = msg:gsub("è¯­éŸ³", "")
        sedvoicemsg(CurrentQQ,data,keyWord)
		return 1
	elseif string.find(msg, "^å›¾ç‰‡") then
	    keyWord = msg:gsub("å›¾ç‰‡", "")
        sedimgmsg(CurrentQQ,data,keyWord,"")
		return 1
    elseif string.find(msg, "^å”±æ­Œ") then
        keyWord = msg:gsub("å”±æ­Œ", "")
		if (keyWord == "") then
		    sedmsg(CurrentQQ,data,"æ­Œåä¸èƒ½ç©ºç€å“¦")
		    return 1
		end
		sedmsg(CurrentQQ,data,"å¦¾èº«æ­£åœ¨åŠªåŠ›åŠ è½½Ù©(ËƒÌ¶Ì€Íˆà¯°Ë‚Ì¶ÌÍˆ)Ùˆ")
        response, error_message =
            http.request(
            "POST",
            "http://127.0.0.1:8888/SilkApi/UrlToBuf",--ä¿®æ”¹æ­¤å¤„ipåŠç«¯å£å³å¯
            {
                body = keyWord --ä¼ å…¥æ­Œæ›²å
            }
        )
        log.notice("err   %v", error_message)
        html = response.body --è¿”å›silk base64 buf
		if (string.find(html, "Î´")) then
				    sedmsg(CurrentQQ,data,"å¤©ä¾æ²¡æœ‰æ‰¾åˆ°ç›¸å…³çš„æ­Œå‘€(Ã’Ï‰Ã“×±)ï¼")
					c.close(c)
				    return 2
				end
        luaRes =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "VoiceMsg",
                groupid = 0,
                content = "",
                atUser = 0,
                voiceUrl = "",
                voiceBase64Buf = html 
            }
        )
		return 1
	end
    sedmsg(CurrentQQ,data,msg)
end

--å½±è§†æœç´¢ç”¨
function Sousuo(CurrentQQ,data,msg)
    response, error_message =
        http.request(
            "GET",
            "http://localhost/index.php/ajax/suggest",
            {
                query = "mid=1&f=admin&wd="..msg.."&limit=10&timestamp=1567914326746"
            }
        )
    html = response.body
	json = json.decode(html)
	if (json.total == 0) then
	    sedmsg(CurrentQQ,data,"å½±è§†æŸ¥è¯¢é”™è¯¯\nè¯·æ£€æŸ¥å½±è§†åæ˜¯å¦æ­£ç¡®\nâ•â•â•â•â•â•â•â•â•â•â•\næ³¨æ„âš ï¸å½±è§†åä¸è¦å¸¦æ— å…³æˆ–å¤šä½™çš„å­—ç¬¦")
	else
        sedmsg(CurrentQQ,data,"èµ„æºåœ°å€å¦‚ä¸‹â†“â†“â†“\nâ•â•â•â•â•â•â•â•â•â•\nhttp://118.25.41.32/index.php/vod/search/wd/"..escape(msg)..".html\nâ•â•â•â•â•â•â•â•â•â•â•\næ³¨æ„:å¦‚æœQQå‡ºç°åœæ­¢è®¿é—®ç°è±¡ï¼Œè¯·å¤åˆ¶é“¾æ¥ç”¨æµè§ˆå™¨æ‰“å¼€")
	end
end

--å•çº¯å‘æ¶ˆæ¯å›¾æ–‡é€šç”¨
function sedimgmsg(CurrentQQ,data,url,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "PicMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = url,
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘æ¶ˆæ¯ç”¨
function sedmsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "TextMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘ç§èŠæ¶ˆæ¯ç”¨
function sendfrimsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromUin,
        sendToType = 1,
        sendMsgType = "TextMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å•çº¯å‘jsonæ¶ˆæ¯ç”¨
function sedjsonmsg(CurrentQQ,data,msg)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "JsonMsg",
        groupid = 0,
        content = msg,
        picBase64Buf = "",
        --å‘æœ¬åœ°é€å›¾ç‰‡çš„buf è½¬ bas64 ç¼–ç  æ–‡æœ¬å‹
        fileMd5 = "",
		picUrl = "",
        atUser = 0
        }
    )
	return ApiRet
end

--èŠå¤©æ¨¡å—åˆ‡æ¢å‡½æ•°
function liaotian(CurrentQQ,data,msg)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
    if (mim == nil) then
        sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
        return 1
    end
    str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
	if (str == nil) then
        return 1
    end
	if (string.find(str, "å…³é—­")) then
	    sedmsg(CurrentQQ,data,"æœºå™¨èŠå¤©å¤„äºå…³é—­çŠ¶æ€\nâˆ´è¯·å…ˆå¼€å¯æœºå™¨èŠå¤©")
	    return 1
	end
	--åˆ‡æ¢å¤„ç†
	file = io.open("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt", "w")
	if (msg == 1) then
	    file:write("æ–‡å­—èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°æ–‡å­—èŠå¤©")
	elseif (msg == 2) then
	    file:write("è¯­éŸ³èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°è¯­éŸ³èŠå¤©")
	elseif (msg == 3) then
	    file:write("å›å¤èŠå¤©")
	    sedmsg(CurrentQQ,data,"âˆ´æˆåŠŸåˆ‡æ¢åˆ°å›å¤èŠå¤©")
	end
	file:close()
end

--éšæœºè¡¨æƒ…å‡½æ•°
function faceArray()
    faceArray = {"[è¡¨æƒ…147]","ğŸ€","ğŸ”¥","ğŸ»","ğŸ’","[è¡¨æƒ…185]","[è¡¨æƒ…219]","[è¡¨æƒ…176]"}
    math.randomseed(os.time())
    num = math.random(1, 9)
    return faceArray[num]
end

--urlç¼–ç è½¬æ¢
function escape(w)
	pattern="[^%w%d%._%-%* ]"
	s=string.gsub(w,pattern,function(c)
		local c=string.format("%%%02X",string.byte(c))
		return c
	end)
	s=string.gsub(s," ","+")
	return s
end

--è¯»å–æ•°æ®å‡½æ•°
function Read(url)
    file = io.open(url, "r")
	if (file == nil) then
	    return nil
	else
        file:seek("set")
	    str = file:read("*a")
	    file:close()
        return str
	end
end

--å†™å…¥æ•°æ®å‡½æ•°
function Wirte(url,msg)
    file = io.open(url, "w+")
    file:write(msg)
	file:close()
    return "ok"
end

--å°æ€èŠå¤©å‡½æ•°
function xiaosiapi(CurrentQQ,data,str)
    response, error_message =
            http.request(
            "GET",
            "https://api.ownthink.com/bot",
            {
                query = "appid="..tostring(data.FromUserId).."&spoken=" .. url_encode(str),
                headers = {
                    Accept = "*/*"
                }
            }
        )
        html = response.body
		jData = json.decode(html)
		return jData
end

--æœºå™¨èŠå¤©å‡½æ•°
function ownthink(CurrentQQ,data,msgs,atqq)
    if (tostring(atqq) == CurrentQQ) then
        m = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
        if (m == nil) then
	        log.info("Str ====> %s", m)
            return 1
	    end
	    if (string.find(m, "å…³é—­")) then
	        sedmsg(CurrentQQ,data,"æœºå™¨èŠå¤©å¤„äºå…³é—­çŠ¶æ€\nâˆ´è¯·å…ˆå¼€å¯æœºå™¨èŠå¤©")
	        return 1
	    end
		res2 = string.find(msgs, " ")
		str = string.sub(msgs,res2)
		jData = xiaosiapi(CurrentQQ,data,str)
		Data = json.decode(data.Content)
		m = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨èŠå¤©\/"..data.FromGroupId..".txt")
		if (m == nil) then
	        log.info("Str ====> %s", m)
            return 1
	    end
		if (string.find(m, "å›å¤èŠå¤©")) then
		    Api.Api_SendMsg(
                CurrentQQ,
                {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "ReplayMsg",
                groupid = 0,
                content = jData.data.info.text,
                atUser = 0,
				replayInfo = {
                    MsgSeq = data.MsgSeq,
                    --å›å¤æ¶ˆæ¯çš„Seq
                    MsgTime = data.MsgTime,
                    --å›å¤æ¶ˆæ¯çš„äº‹ä»¶
                    UserID = data.FromUserId,
                    --å›å¤æ¶ˆæ¯å¯¹è±¡
                    RawContent = Data.Content --å›å¤æ¶ˆæ¯çš„åŸå†…å®¹
                }
				}
            )
			return 1
		elseif (string.find(m, "æ–‡å­—èŠå¤©")) then
		    sedmsg(CurrentQQ,data,jData.data.info.text)
		else
		    sedvoicemsg(CurrentQQ,data,url_encode(jData.data.info.text))
		end
    end
end

--å‘é€è¯­éŸ³æ¶ˆæ¯
function sedvoicemsg(CurrentQQ,data,str)
    ApiRet = Api.Api_SendMsg(
        CurrentQQ,
        {
        toUser = data.FromGroupId,
        sendToType = 2,
        sendMsgType = "VoiceMsg",
        groupid = 0,
		voiceUrl = "https://dds.dui.ai/runtime/v1/synthesize?voiceId=qianranfa&speed=0.7&volume=100&audioType=wav&text="..str, --å‘é€è¯­éŸ³çš„ç½‘ç»œåœ°å€ æ–‡æœ¬å‹
        voiceBase64Buf = "",
        content = "",
        atUser = 0
        }
    )
	return ApiRet
end

--å¤©æ°”æŸ¥è¯¢å‡½æ•°
--[[function tianqi(CurrentQQ,data)
    keyWord = data.Content:gsub("å¤©æ°”", "")
        if keyWord == "" then
            return 1
        end

        cookies = Api.Api_GetUserCook(CurrentQQ)

        response, error_message =
            http.request(
            "GET",
            "https://weather.mp.qq.com/cgi-bin/rich",
            {
                query = "g_tk=" .. cookies.Gtk .. "&city=" .. url_encode(keyWord),
                headers = {
                    Referer = "http://weather.mp.qq.com/ark"
                },
                cookies = {
                    uin = CurrentQQ,
                    skey = cookies.Skey
                }
            }
        )
        local html = response.body
        log.notice("From Lua html -->%s", html)

        local j = json.decode(html)
        if j.code ~= 0 then
            return 1
        end

        ApiRet =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "JsonMsg",
                groupid = 0,
                content = string.format(
                    --{"config":{"forward":1,"autosize":1},"prompt":"[åº”ç”¨]å¤©æ°”","app":"com.tencent.weather","ver":"0.0.0.1","view":"RichInfoView","meta":{"richinfo":{"adcode":"101210701","city":"æˆéƒ½","air":"58","min":"20","ts":"1500550866","wind":"1","date":"6æœˆ27æ—¥ å‘¨å››","max":"28","type":"201"}},"desc":"å¤©æ°”"}
                    --[[{"app":"com.tencent.weather","desc":"","meta":{"weather":{"ad":[{"icon":"http://imgcache.qq.com/ac/tq/xz2/tp.jpg","p":"ptype=star","t":"2","title":"æ˜Ÿåº§ | ä»Šå¤©ä¼šå› ä¸ºæ„Ÿæƒ…å’Œå®¶åº­çš„é—®é¢˜ï¼Œå½±å“å·¥ä½œï¼Œè¿˜æœ‰ï¼Œä¹Ÿè¦æ³¨æ„äºº...","url":""},{"icon":"http://imgcache.qq.com/ac/qqweather/image/2019/6/27.png","p":"ptype=lunar","t":"4","title":"é»„å† | å†œå†äº”æœˆå»¿äº”ã€‚å®œè®¢ç›Ÿ.çº³é‡‡.å‡ºè¡Œ.ç¥ˆç¦.æ–‹é†®.å®‰åºŠ.ä¼š...","url":""}],"info":{"it1":{"adcode":"101050101","city":"æ­¦æ±‰","hour":"18","max":"29","min":"17","temp":"24","type":"202","ut":"1561630401","wea":"å¤šäº‘"},"it2":{"hour":"19","temp":"22","type":"202"},"it3":{"hour":"20","temp":"21","type":"202"},"ts":"1561631244"},"url":""}},"prompt":"ã€å“ˆå°”æ»¨ã€‘å¤šäº‘ 17Â°/29Â°, 18:13æ›´æ–°~","ver":"1.0.0.106","view":"WeatherThreeView"}]]
--[[                    [[{"app":"com.tencent.weather","desc":"å¤©æ°”","view":"RichInfoView","ver":"1.0.0.217","prompt":"[åº”ç”¨]å¤©æ°”","meta":{"richinfo":{"adcode":"%s","air":"%s","city":"%s","date":"%s","max":"%s","min":"%s","ts":"1554951408","type":"%s","wind":"%s"}},"config":{"forward":1,"autosize":1,"type":"card"}}]],
--[[                    j.data.adcode,
                    j.data.air,
                    j.data.city,
                    j.data.date,
                    j.data.max,
                    j.data.min,
                    j.data.type,
                    j.data.wind
                ),
                atUser = 0
            }
        )
end
--]]
--è°ƒæ•™å¤„ç†å‡½æ•°(å¾…å¤„ç†)
function tiaojiao(CurrentQQ,data)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
	if (mim == nil) then
		sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå“‡")
		return 1
	end
	if (string.find(data.Content, "^åˆ é™¤è°ƒæ•™")) then
	    msg = data.Content:gsub("åˆ é™¤è°ƒæ•™", "")
	    if (msg == "") then
		    sedmsg(CurrentQQ,data,"è¦åˆ é™¤çš„è°ƒæ•™æŒ‡ä»¤ä¸èƒ½ä¸ºç©ºå“¦")
		    return 1
		end
		rese = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..tostring(data.FromGroupId).."\/"..msg..".txt")
	    if (rese == nil) then
			sedmsg(CurrentQQ,data,"è¿™ä¸ªæŒ‡ä»¤ä¸å­˜åœ¨äº†å“¦")
		    return 1
		end
		rm_file = os.remove("mimoio\/æœºå™¨è°ƒæ•™\/"..tostring(data.FromGroupId).."\/"..msg..".txt")
		log.info("åˆ é™¤è°ƒæ•™ ====> %s", rm_file)
		sedmsg(CurrentQQ,data,"åˆ é™¤æˆåŠŸ\nä½ ä¸å–œæ¬¢è¢«è¿™æ ·è°ƒæ•™çš„æˆ‘å—[è¡¨æƒ…9]")
		return 1
	end
    msgs = data.Content:gsub("è°ƒæ•™", "")
		res2 = string.find(msgs, "#")
		str = string.sub(msgs,res2+1)
		str2 = string.sub(msgs,1,res2-1)
		        
		        if (str == "") then
		            sedmsg(CurrentQQ,data,"è°ƒæ•™çš„å›ç­”å†…å®¹ä¸èƒ½ä¸ºç©ºå“¦")
			        return 1
		        end
				if (str2 == "") then
		            sedmsg(CurrentQQ,data,"è°ƒæ•™çš„æŒ‡ä»¤å†…å®¹ä¸èƒ½ä¸ºç©ºå“¦")
			        return 1
		        end
		        rese = Read("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..str2..".txt")
					if (rese ~= nil) then
				        sedmsg(CurrentQQ,data,"æŒ‡ä»¤å·²ç»å­˜åœ¨äº†å“¦")
				        return 1
				    end
				Wirte("mimoio\/æœºå™¨è°ƒæ•™\/"..data.FromGroupId.."\/"..str2..".txt",str)
				sedmsg(CurrentQQ,data,"è°ƒæ•™æˆåŠŸ\nä½ è¿˜æƒ³å†è°ƒæ•™æˆ‘ä¸€æ¬¡å—[è¡¨æƒ…6]")
		        return 1
end

function url_encode(str)
    if (str) then
        str = string.gsub(str, "\n", "\r\n")
        str =
            string.gsub(
            str,
            "([^%w ])",
            function(c)
                return string.format("%%%02X", string.byte(c))
            end
        )
        str = string.gsub(str, " ", "+")
    end
    return str
end

--æŠ¢çº¢åŒ…å¤„ç†
function RedBag(CurrentQQ, data)
    Api.Api_OpenRedBag(CurrentQQ, data.RedBaginfo)
    if (data.RedBaginfo.RedType == 12) then
         luaRes =
                Api.Api_SendMsg(
                CurrentQQ,
                {
                    toUser = data.FromGroupId,
                    sendToType = 2,
                    sendMsgType = "TextMsg",
                    groupid = 0,
                    content = data.RedBaginfo.Tittle,
                    atUser = 0
                }
            )
        log.notice("From Lua SendMsg Ret\n%d", luaRes.Ret)
    end
end

--è§†é¢‘è§£æå¤„ç†
function Video(CurrentQQ, data)
    vdata = json.decode(data.Content)
        videodata = {
            GroupID = data.FromGroupId,
            VideoUrl = vdata.VideoUrl,
            VideoMd5 = vdata.VideoMd5
        }
        --æ„é€ table å‚æ•°è¡¨
        luaResp = Api.Api_CallFunc(CurrentQQ, "PttCenterSvr.ShortVideoDownReq", videodata) --é€šè¿‡cmdè°ƒç”¨åŠŸèƒ½åŒ…
        luaRes =
            Api.Api_SendMsg(
            CurrentQQ,
            {
                toUser = data.FromGroupId,
                sendToType = 2,
                sendMsgType = "TextMsg",
                groupid = 0,
                content = "è§£æè§†é¢‘URL-->" .. luaResp.VideoUrl,
                atUser = 0
            }
        )
end

--ç®¡ç†å¼€å…³é€šç”¨
function adminio(CurrentQQ,data,oio)
    mim = Read("mimoio\/æœºå™¨é…ç½®\/æœºå™¨ä¸»äºº\/"..data.FromGroupId.."\/"..data.FromUserId..".txt")
        if (mim ~= nil) then
            msg = data.Content:gsub(oio, "")
            str = Read("mimoio\/çŠ¶æ€æ•°æ®\/æœºå™¨å¼€å…³\/"..data.FromGroupId..CurrentQQ..".txt")
            if (string.find(str, "å…³é—­")) then
                sedmsg(CurrentQQ,data,"âˆ´æœºå™¨äººå·²è¢«å…³é—­...\nè¯·å…ˆå¼€å¯æœºå™¨äºº")
                return 1
            end
			str2 = Read("mimoio\/çŠ¶æ€æ•°æ®\/"..oio.."\/"..data.FromGroupId..".txt")
			if (string.find(str2, msg)) then
			    sedmsg(CurrentQQ,data,"âˆ´"..oio.."æœ¬å°±æ˜¯"..str2.."çŠ¶æ€")
                return 1
			end
            Wirte("mimoio\/çŠ¶æ€æ•°æ®\/"..oio.."\/"..data.FromGroupId..".txt",msg)
            sedmsg(CurrentQQ,data,"âˆ´"..oio..msg.."æˆåŠŸ")
            return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´ä½ ä¸æ˜¯æˆ‘ä¸»äººå‘")
            return 1
        end
end

--ç™¾ç§‘å¤§å…¨
function baike(CurrentQQ,data)
    keyWord = data.Content:gsub("ç™¾ç§‘", "")
        if keyWord == "" then
            return 1
        end
        response, error_message =
            http.request(
            "GET",
            "http://baike.baidu.com/api/openapi/BaikeLemmaCardApi",
            {
                query = "scope=103&format=json&appid=379020&bk_key=" .. url_encode(keyWord) .. "&bk_length=600"
            }
        )
        html = response.body
        while(string.find(html, '"errno":2')) do
            response, error_message =
            http.request(
            "GET",
            "http://baike.baidu.com/api/openapi/BaikeLemmaCardApi",
            {
                query = "scope=103&format=json&appid=379020&bk_key=" .. url_encode(keyWord) .. "&bk_length=600"
            })
			html = response.body
        end
        local j = json.decode(html)
        sedmsg(CurrentQQ,data,j.abstract.."\n"..j.url)
end

--éŸ³ä¹ç‚¹æ­Œ
function music(CurrentQQ,data)
    keyWord = data.Content:gsub("ç‚¹æ­Œ", "")
        if keyWord == "" then
            return 1
        end
        response, error_message =
            http.request(
            "GET",
            "https://c.y.qq.com/soso/fcgi-bin/client_search_cp",
            {
                query = "aggr=1&cr=1&flag_qc=0&p=1&n=6&w=" .. url_encode(keyWord)
            }
        )
        html = response.body
		str = string.sub(html,10,-2)
        j = json.decode(str)
        if (j.code == 0) then
            msg = ""
            num = j.data.song.list
            list = num[1]
            songname = list.songname
            singername = list.singer[1].name
            payplay = list.pay.payplay
			albummid = list.albummid
			songmid = list.songmid
	        sedjsonmsg(CurrentQQ,data,'{"app":"com.tencent.structmsg","desc":"éŸ³ä¹","view":"music","ver":"0.0.0.1","prompt":"[åˆ†äº«]' ..songname.. '","meta":{"music":{"sourceMsgId":"0","title":"' ..songname.. '","desc":"' ..singername.. '","preview":"y.gtimg.cn/music/photo_new/T002R150x150M000'..albummid..'.jpg","tag":"QQéŸ³ä¹","musicUrl":"https://v1.itooi.cn/tencent/url?id='..songmid..'","jumpUrl":"y.qq.com/n/yqq/song/'..songmid..'.html","appid":100497308,"app_type":1,"action":"","source_url":"url.cn/5aSZ8Gc","source_icon":"url.cn/5tLgzTm","android_pkg_name":"com.tencent.qqmusic"}},"config":{"forward":true,"type":"normal","autosize":true}}')
			return 1
        else
            sedmsg(CurrentQQ,data,"âˆ´Error:"..j.code)
			return 1
        end
end

--è®¿é—®url
function geturl(url_class,url,caulrt)
        response, error_message =
            http.request(
            url_class,
            url,
            {
                query = caulrt
            }
        )
        html = response.body
		return html
end

--æ¶ˆæ¯å‚¨è“„
function msgsql(CurrentQQ,data)
    if (mysqlpass == "") then
	    return 1
	end
    c = mysql.new()
    -- åˆå§‹åŒ–mysqlå¯¹è±¡
    ok, err = c:connect({host = mysqlhost, port = 3306, database = mysqldb, user = mysqluser, password = mysqlpass})
    --å»ºç«‹è¿æ¥
    if ok then
        sqlstr =
            string.format(
            [[INSERT INTO msgcache (GroupID, MsgSeq, MsgRandom,MsgType,Data,MsgTime)VALUES (%d,%d,%d,'%s','%s',%d)]],
            data.FromGroupId,
            data.MsgSeq,
            data.MsgRandom,
            data.MsgType,
            data.Content,
            data.MsgTime
        )
        res, err = c:query(sqlstr) --å…¥åº“ç¼“å­˜æ¶ˆæ¯
        log.info("%s", err)
        c.close(c)
    --é‡Šæ”¾è¿æ¥
    end
    return 1
end

--æ’¤å›æ£€æµ‹
function CheHui(CurrentQQ, data, extData)
    c = mysql.new()
    -- åˆå§‹åŒ–mysqlå¯¹è±¡
	if (mysqlpass == "") then
	    return 1
	end
	
    if data.MsgType == "ON_EVENT_GROUP_REVOKE" then --ç›‘å¬ ç¾¤æ’¤å›äº‹ä»¶
        str = string.format("ç¾¤æˆ %d  æˆå‘˜ UserID %s æ’¤å›äº†æ¶ˆæ¯Seq %s \n", extData.GroupID, extData.UserID, extData.MsgSeq)
        log.info("%s", str)
        ok, err = c:connect({host = mysqlhost, port = 3306, database = mysqldb, user = mysqluser, password = mysqlpass})
        --å»ºç«‹è¿æ¥
        log.info("sql %v", err)
        if ok then
            sqlstr =
                string.format(
                "select * from msgcache where `GroupID`= %d and `MsgSeq` = %d",
                extData.GroupID,
                extData.MsgSeq
            )
            res, err = c:query(sqlstr) --è·Ÿç¾¤ç¾¤idå’Œæ¶ˆæ¯SEQæŸ¥è¯¢å‡ºæ’¤å›çš„æ¶ˆæ¯å†…å®¹
            if err == nil then
                c.close(c)
                GroupID = tonumber(res[1]["GroupID"])
                MsgType = res[1]["MsgType"]
                Data = res[1]["Data"]

                if MsgType == "TextMsg" then
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            --å‘é€æ–‡æœ¬æ¶ˆæ¯
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡æ–‡æœ¬æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                Data
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "SmallFaceMsg" then
                    --Data {"Content":"[è¡¨æƒ…101]","Hex":"FKY=","Index":101,"tips":"[å°è¡¨æƒ…]"}
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡è¡¨æƒ…æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).Content
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "PicMsg" then
                    --Data {"Content":"","FileId":2820717626,"FileMd5":"q0oEC5aloJJMFr10mplaXw==","FileSize":7026,"tips":"[ç¾¤å›¾ç‰‡]","url":"http://gchat.qpic.cn/gchatpic_new/1700487478/960839480-2534335053-AB4A040B96A5A0924C16BD749A995A5F/0?vuin=u0026term=255u0026pictype=0"}
                    jData = json.decode(Data)
					if (jData.tips == "[ç¾¤æ¶ˆæ¯-QQé—ªç…§]") then
					    
					Api.Api_SendMsg( 
                    CurrentQQ,
                    {
                        toUser = GroupID,
                        sendToType = 2,
                        sendMsgType = "ForwordMsg",
                        content = "",
                        atUser = 0,
                        groupid = 0,
                        voiceUrl = "",
                        voiceBase64Buf = "",
                        picUrl = "",
                        picBase64Buf = "",
                        forwordBuf = json.decode(Data).ForwordBuf, --æ¬²è½¬å‘çš„base64buf å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                        forwordField = json.decode(Data).ForwordField --æ¬²å†™å…¥åè®®çš„å­—æ®µID å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                    }
                )
				    return 1
					end
                    Api.Api_SendMsg( --é€šè¿‡å›¾ç‰‡md5å‘é€å›¾ç‰‡ ç§’å‘ä¸ç”¨ä¸Šä¼  ç›¸å½“äºè½¬å‘
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "PicMsg",
                            --å‘é€å›¾æ–‡æ¶ˆæ¯
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡å›¾ç‰‡æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š[PICFLAG]%s",
                                extData.UserID,
                                jData.Content
                            ),
                            --é€šè¿‡å®[PICFLAG]æ”¹å˜å›¾æ–‡é¡ºåº  æ”¹ä¸ºç°æ–‡å­—åå›¾ç‰‡
                            atUser = 0,
                            voiceUrl = "",
                            voiceBase64Buf = "",
                            picUrl = "",
                            picBase64Buf = "",
                            fileMd5 = jData.FileMd5
                        }
                    )
                end
                if MsgType == "AtMsg" then
                    --Data {"Content":"@Kar98k skjjkssjkjs","UserID":123456789,"tips":"[ATæ¶ˆæ¯]"}
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡atæ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).Content
                            ),
                            atUser = 0
                        }
                    )
                end
                if MsgType == "VoiceMsg" then
                    --Data {"tips":"[è¯­éŸ³]","url":"http://grouptalk.c2c.qq.com/?ver=0u0026rkey=3062020101045b305902010102010102041fdef8ae042439416931554e5142586c536d78706a314c686843664959725f327a5f573064697653755902045dac2a21041f0000000866696c6574797065000000013100000005636f64656300000001310400u0026filetype=1u0026voice_codec=1"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "VoiceMsg",
                            --å‘é€ç¾¤è¯­éŸ³æ¶ˆæ¯
                            groupid = 0,
                            content = "",
                            atUser = 0,
                            voiceUrl = json.decode(Data).url,
                            --é€šè¿‡ç½‘ç»œurlè¿›è¡Œå‘é€è¯­éŸ³
                            voiceBase64Buf = "",
                            picUrl = "",
                            picBase64Buf = ""
                        }
                    )
                end

                if MsgType == "ReplayMsg" then
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "TextMsg",
                            groupid = 0,
                            content = string.format(
                                "æ•è·åˆ°æˆå‘˜ %d\nâ•â•â•â•â•â•â•â•â•â•â•\næ’¤å›äº†ä¸€æ¡å›å¤æ¶ˆæ¯\næ¶ˆæ¯å†…å®¹ä¸ºï¼š\n%s",
                                extData.UserID,
                                json.decode(Data).ReplayContent
                            ),
                            atUser = 0
                        }
                    )
                end
				if MsgType == "VideoMsg" then
	             Api.Api_SendMsg( 
                    CurrentQQ,
                    {
                        toUser = GroupID,
                        sendToType = 2,
                        sendMsgType = "ForwordMsg",
                        content = "",
                        atUser = 0,
                        groupid = 0,
                        voiceUrl = "",
                        voiceBase64Buf = "",
                        picUrl = "",
                        picBase64Buf = "",
                        forwordBuf = json.decode(Data).ForwordBuf, --æ¬²è½¬å‘çš„base64buf å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                        forwordField = json.decode(Data).ForwordField --æ¬²å†™å…¥åè®®çš„å­—æ®µID å›¾ç‰‡æ¶ˆæ¯ è§†é¢‘æ¶ˆæ¯ ä¼šç»™å‡ºæ­¤å‚æ•°
                    }
                )
				end
                if MsgType == "XmlMsg" then
				    
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "XmlMsg",
                            groupid = 0,
                            content = string.format("%s", Data),
                            atUser = 0
                        }
                    )
                end
				if MsgType == "JsonMsg" then
				    
                    --Data {"MsgSeq":3536,"ReplayContent":"11 @Mac","SrcContent":"...","UserID":123123,"tips":"[å›å¤]"}
                    --log.info("sql %s", json.decode(Data).url)
                    Api.Api_SendMsg(
                        CurrentQQ,
                        {
                            toUser = GroupID,
                            sendToType = 2,
                            sendMsgType = "JsonMsg",
                            groupid = 0,
                            content = string.format("%s", Data),
                            atUser = 0
                        }
                    )
                end
            end
        end
    end
    return 1
end
2020/09/07 13:05:06.642 [E]  QQLuaVmRun CallGlobal err <string>:24: attempt to call a non-function object
stack traceback:
	<string>:24: in function 'baike'
	<string>:9: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{959562190 æµ‹è¯•ç¾¤ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘é©¬äº‘ TextMsg 1599455106 6576 967694092 <nil>} 
2020/09/07 13:05:14.670 [E]  QQLuaVmRun CallGlobal err <string>:24: attempt to call a non-function object
stack traceback:
	<string>:24: in function 'baike'
	<string>:9: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{959562190 æµ‹è¯•ç¾¤ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘é©¬äº‘ TextMsg 1599455114 6577 1763976928 <nil>} 
2020/09/07 13:05:47.174 [E]  QQLuaVmRun CallGlobal err <string>:39: attempt to call a non-function object
stack traceback:
	<string>:39: in function 'baike'
	<string>:9: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{959562190 æµ‹è¯•ç¾¤ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘é©¬äº‘ TextMsg 1599455146 6578 1151384374 <nil>} 
2020/09/07 13:07:37.608 [E]  QQLuaVmRun CallGlobal err <string>:24: attempt to call a non-function object
stack traceback:
	<string>:24: in function 'baike'
	<string>:9: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{959562190 æµ‹è¯•ç¾¤ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘é©¬äº‘ TextMsg 1599455257 6579 2191121448 <nil>} 
2020/09/07 13:11:04.131 [E]  QQLuaVmRun CallGlobal err <string>:896: cannot perform concat operation between string and nil
stack traceback:
	<string>:896: in function 'baike'
	<string>:200: in main chunk
	[G]: ? detail File mimoio.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{959562190 æµ‹è¯•ç¾¤ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘è¥¿ç§‘å¤§ TextMsg 1599455463 6583 1250796296 <nil>} 
2020/09/07 13:11:10.130 [E]  QQLuaVmRun CallGlobal err <string>:896: cannot perform concat operation between string and nil
stack traceback:
	<string>:896: in function 'baike'
	<string>:200: in main chunk
	[G]: ? detail File mimoio.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{959562190 æµ‹è¯•ç¾¤ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘è¥¿ç§‘å¤§ TextMsg 1599455469 6584 3501607097 <nil>} 
2020/09/07 13:12:36.922 [E]  QQLuaVmRun CallGlobal err <string>:200: attempt to call a non-function object
stack traceback:
	<string>:200: in main chunk
	[G]: ? detail File mimoio.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{959562190 æµ‹è¯•ç¾¤ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘åŒ—äº¬å¤§å­¦ TextMsg 1599455556 6588 1717220511 <nil>} 
2020/09/07 13:12:43.436 [E]  QQLuaVmRun CallGlobal err <string>:200: attempt to call a non-function object
stack traceback:
	<string>:200: in main chunk
	[G]: ? detail File mimoio.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{959562190 æµ‹è¯•ç¾¤ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘æ¸…åå¤§å­¦ TextMsg 1599455563 6589 307177739 <nil>} 
2020/09/07 13:13:29.280 [E]  QQLuaVmRun CallGlobal err <string>:24: attempt to call a non-function object
stack traceback:
	<string>:24: in function 'baike'
	<string>:9: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{959562190 æµ‹è¯•ç¾¤ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘é©¬äº‘ TextMsg 1599455609 6593 3766695520 <nil>} 
2020/09/07 13:13:32.816 [E]  QQLuaVmRun CallGlobal err <string>:24: attempt to call a non-function object
stack traceback:
	<string>:24: in function 'baike'
	<string>:9: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{959562190 æµ‹è¯•ç¾¤ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘é©¬äº‘ TextMsg 1599455612 6594 2138883429 <nil>} 
2020/09/07 13:14:11.182 [E]  QQLuaVmRun CallGlobal err <string>:39: cannot perform concat operation between string and nil
stack traceback:
	<string>:39: in function 'baike'
	<string>:9: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{959562190 æµ‹è¯•ç¾¤ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘è¥¿å—ç§‘å¤§ TextMsg 1599455650 6601 1222736623 <nil>} 
2020/09/07 13:14:31.153 [E]  QQLuaVmRun CallGlobal err <string>:39: cannot perform concat operation between string and nil
stack traceback:
	<string>:39: in function 'baike'
	<string>:9: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{959562190 æµ‹è¯•ç¾¤ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘è¥¿å—ç§‘å¤§ TextMsg 1599455670 6602 2611864290 <nil>} 
2020/09/07 13:14:35.389 [E]  QQLuaVmRun CallGlobal err <string>:24: attempt to call a non-function object
stack traceback:
	<string>:24: in function 'baike'
	<string>:9: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{959562190 æµ‹è¯•ç¾¤ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘é©¬äº‘ TextMsg 1599455675 6603 4065242277 <nil>} 
2020/09/07 13:14:50.306 [E]  QQLuaVmRun CallGlobal err <string>:24: attempt to call a non-function object
stack traceback:
	<string>:24: in function 'baike'
	<string>:9: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{959562190 æµ‹è¯•ç¾¤ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘é©¬äº‘ TextMsg 1599455690 6604 1788347384 <nil>} 
2020/09/07 13:15:22.032 [E]  QQLuaVmRun CallGlobal err <string>:24: attempt to call a non-function object
stack traceback:
	<string>:24: in function 'baike'
	<string>:9: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{959562190 æµ‹è¯•ç¾¤ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘ä¸­å›½ TextMsg 1599455721 6605 411630194 <nil>} 
2020/09/07 13:15:39.577 [E]  QQLuaVmRun CallGlobal err <string>:24: attempt to call a non-function object
stack traceback:
	<string>:24: in function 'baike'
	<string>:9: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{959562190 æµ‹è¯•ç¾¤ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘é©¬äº‘ TextMsg 1599455739 6608 1391617637 <nil>} 
2020/09/07 13:15:48.860 [E]  QQLuaVmRun CallGlobal err <string>:24: attempt to call a non-function object
stack traceback:
	<string>:24: in function 'baike'
	<string>:9: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{959562190 æµ‹è¯•ç¾¤ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘é©¬äº‘ TextMsg 1599455748 6611 2951346331 <nil>} 
2020/09/07 13:16:06.818 [E]  QQLuaVmRun CallGlobal err <string>:999: attempt to index a non-table object(nil) with key 'GroupID'
stack traceback:
	<string>:999: in function 'CheHui'
	<string>:417: in main chunk
	[G]: ? detail File mimoio.lua when  call ReceiveEvents params [0] 1689236904  [1] &{383770908 0 ON_EVENT_GROUP_REVOKE 136589 ç¾¤æˆå‘˜æ’¤å›æ¶ˆæ¯äº‹ä»¶ <nil>}  [2] map[AdminUserID:1689236904 GroupID:383770908 MsgRandom:2930674504 MsgSeq:136589 UserID:1689236904]
2020/09/07 13:16:17.321 [E]  QQLuaVmRun CallGlobal err <string>:999: attempt to index a non-table object(nil) with key 'GroupID'
stack traceback:
	<string>:999: in function 'CheHui'
	<string>:417: in main chunk
	[G]: ? detail File mimoio.lua when  call ReceiveEvents params [0] 1689236904  [1] &{383770908 0 ON_EVENT_GROUP_REVOKE 136591 ç¾¤æˆå‘˜æ’¤å›æ¶ˆæ¯äº‹ä»¶ <nil>}  [2] map[AdminUserID:1689236904 GroupID:383770908 MsgRandom:2785284695 MsgSeq:136591 UserID:1689236904]
2020/09/07 13:16:23.213 [E]  QQLuaVmRun CallGlobal err <string>:999: attempt to index a non-table object(nil) with key 'GroupID'
stack traceback:
	<string>:999: in function 'CheHui'
	<string>:417: in main chunk
	[G]: ? detail File mimoio.lua when  call ReceiveEvents params [0] 1689236904  [1] &{383770908 0 ON_EVENT_GROUP_REVOKE 136594 ç¾¤æˆå‘˜æ’¤å›æ¶ˆæ¯äº‹ä»¶ <nil>}  [2] map[AdminUserID:1689236904 GroupID:383770908 MsgRandom:4197848432 MsgSeq:136594 UserID:1689236904]
2020/09/07 13:16:29.851 [E]  QQLuaVmRun CallGlobal err <string>:999: attempt to index a non-table object(nil) with key 'GroupID'
stack traceback:
	<string>:999: in function 'CheHui'
	<string>:417: in main chunk
	[G]: ? detail File mimoio.lua when  call ReceiveEvents params [0] 1689236904  [1] &{383770908 0 ON_EVENT_GROUP_REVOKE 136598 ç¾¤æˆå‘˜æ’¤å›æ¶ˆæ¯äº‹ä»¶ <nil>}  [2] map[AdminUserID:1689236904 GroupID:383770908 MsgRandom:2083299823 MsgSeq:136598 UserID:1689236904]
2020/09/07 13:16:41.934 [E]  QQLuaVmRun CallGlobal err <string>:24: attempt to call a non-function object
stack traceback:
	<string>:24: in function 'baike'
	<string>:9: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{959562190 æµ‹è¯•ç¾¤ 1689236904 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘é©¬äº‘ TextMsg 1599455801 6635 1599455801 <nil>} 
2020/09/07 13:16:50.897 [E]  QQLuaVmRun CallGlobal err <string>:24: attempt to call a non-function object
stack traceback:
	<string>:24: in function 'baike'
	<string>:9: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{959562190 æµ‹è¯•ç¾¤ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘é©¬äº‘ TextMsg 1599455810 6639 3469441579 <nil>} 
2020/09/07 13:17:19.962 [E]  QQLuaVmRun CallGlobal err <string>:24: attempt to call a non-function object
stack traceback:
	<string>:24: in function 'baike'
	<string>:9: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{959562190 æµ‹è¯•ç¾¤ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘èµµé‘« TextMsg 1599455839 6642 3728601891 <nil>} 
2020/09/07 13:17:24.725 [E]  QQLuaVmRun CallGlobal err <string>:24: attempt to call a non-function object
stack traceback:
	<string>:24: in function 'baike'
	<string>:9: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{959562190 æµ‹è¯•ç¾¤ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘èµµé‘« TextMsg 1599455844 6645 3626034274 <nil>} 
2020/09/07 13:17:26.703 [E]  QQLuaVmRun CallGlobal err <string>:24: attempt to call a non-function object
stack traceback:
	<string>:24: in function 'baike'
	<string>:9: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{959562190 æµ‹è¯•ç¾¤ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘èµµé‘« TextMsg 1599455846 6646 3131813445 <nil>} 
2020/09/07 13:17:30.602 [E]  QQLuaVmRun CallGlobal err <string>:24: attempt to call a non-function object
stack traceback:
	<string>:24: in function 'baike'
	<string>:9: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{959562190 æµ‹è¯•ç¾¤ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘èµµé‘« TextMsg 1599455850 6652 425135538 <nil>} 
2020/09/07 13:17:31.340 [E]  QQLuaVmRun CallGlobal err <string>:24: attempt to call a non-function object
stack traceback:
	<string>:24: in function 'baike'
	<string>:9: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{959562190 æµ‹è¯•ç¾¤ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘èµµé‘« TextMsg 1599455851 6655 2585216489 <nil>} 
2020/09/07 13:17:31.718 [E]  QQLuaVmRun CallGlobal err <string>:24: attempt to call a non-function object
stack traceback:
	<string>:24: in function 'baike'
	<string>:9: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{959562190 æµ‹è¯•ç¾¤ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘èµµé‘« TextMsg 1599455851 6656 1312282259 <nil>} 
2020/09/07 13:17:55.678 [E]  QQLuaVmRun CallGlobal err <string>:24: attempt to call a non-function object
stack traceback:
	<string>:24: in function 'baike'
	<string>:9: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{959562190 æµ‹è¯•ç¾¤ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘èµµé‘« TextMsg 1599455875 6675 1410695034 <nil>} 
2020/09/07 13:19:16.626 [E]  QQLuaVmRun CallGlobal err <string>:24: attempt to call a non-function object
stack traceback:
	<string>:24: in function 'baike'
	<string>:9: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{959562190 æµ‹è¯•ç¾¤ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘é©¬äº‘ TextMsg 1599455956 6676 3692464981 <nil>} 
2020/09/07 13:19:19.114 [E]  QQLuaVmRun CallGlobal err <string>:24: attempt to call a non-function object
stack traceback:
	<string>:24: in function 'baike'
	<string>:9: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{959562190 æµ‹è¯•ç¾¤ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘é©¬äº‘ TextMsg 1599455959 6677 530922015 <nil>} 
2020/09/07 13:19:29.645 [E]  QQLuaVmRun CallGlobal err <string>:24: attempt to call a non-function object
stack traceback:
	<string>:24: in function 'baike'
	<string>:9: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{959562190 æµ‹è¯•ç¾¤ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘é©¬äº‘ TextMsg 1599455969 6683 3126910557 <nil>} 
2020/09/07 13:21:48.006 [E]  QQLuaVmRun CallGlobal err <string>:27: attempt to call a non-function object
stack traceback:
	<string>:27: in function 'baike'
	<string>:12: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{959562190 æµ‹è¯•ç¾¤ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘é©¬äº‘ TextMsg 1599456107 6689 3406078373 <nil>} 
2020/09/07 13:23:03.151 [E]  QQLuaVmRun CallGlobal err <string>:42: cannot perform concat operation between string and nil
stack traceback:
	<string>:42: in function 'baike'
	<string>:12: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{383770908 å¸è±ªé«˜ç´šå¨›æ¨‚æœƒæ‰€ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘è‹æ¾³ TextMsg 1599456182 136608 1997596652 <nil>} 
2020/09/07 13:23:08.165 [E]  QQLuaVmRun CallGlobal err <string>:27: attempt to call a non-function object
stack traceback:
	<string>:27: in function 'baike'
	<string>:12: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{383770908 å¸è±ªé«˜ç´šå¨›æ¨‚æœƒæ‰€ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘è‹æ¾³ TextMsg 1599456188 136609 3344661157 <nil>} 
2020/09/07 13:23:12.102 [E]  QQLuaVmRun CallGlobal err <string>:42: cannot perform concat operation between string and nil
stack traceback:
	<string>:42: in function 'baike'
	<string>:12: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{383770908 å¸è±ªé«˜ç´šå¨›æ¨‚æœƒæ‰€ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘è‹æ¾³ TextMsg 1599456191 136610 3134893592 <nil>} 
2020/09/07 13:23:14.259 [E]  QQLuaVmRun CallGlobal err <string>:42: cannot perform concat operation between string and nil
stack traceback:
	<string>:42: in function 'baike'
	<string>:12: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{383770908 å¸è±ªé«˜ç´šå¨›æ¨‚æœƒæ‰€ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘è‹æ¾³ TextMsg 1599456194 136611 1260006660 <nil>} 
2020/09/07 13:23:17.106 [E]  QQLuaVmRun CallGlobal err <string>:42: cannot perform concat operation between string and nil
stack traceback:
	<string>:42: in function 'baike'
	<string>:12: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{383770908 å¸è±ªé«˜ç´šå¨›æ¨‚æœƒæ‰€ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘è‹æ¾³ TextMsg 1599456196 136612 3586197276 <nil>} 
2020/09/07 13:23:23.724 [E]  QQLuaVmRun CallGlobal err <string>:27: attempt to call a non-function object
stack traceback:
	<string>:27: in function 'baike'
	<string>:12: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{383770908 å¸è±ªé«˜ç´šå¨›æ¨‚æœƒæ‰€ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘è‹æ¾³ TextMsg 1599456203 136613 2578265940 <nil>} 
2020/09/07 13:23:26.391 [E]  QQLuaVmRun CallGlobal err <string>:42: cannot perform concat operation between string and nil
stack traceback:
	<string>:42: in function 'baike'
	<string>:12: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{383770908 å¸è±ªé«˜ç´šå¨›æ¨‚æœƒæ‰€ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘è‹æ¾³ TextMsg 1599456206 136614 2568755392 <nil>} 
2020/09/07 13:23:29.929 [E]  QQLuaVmRun CallGlobal err <string>:27: attempt to call a non-function object
stack traceback:
	<string>:27: in function 'baike'
	<string>:12: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{383770908 å¸è±ªé«˜ç´šå¨›æ¨‚æœƒæ‰€ 1689236904 è½ä¼æœºå™¨äºº ç™¾ç§‘è‹æ¾³ TextMsg 1599456209 136616 1599456209 <nil>} 
2020/09/07 13:23:30.103 [E]  QQLuaVmRun CallGlobal err <string>:42: cannot perform concat operation between string and nil
stack traceback:
	<string>:42: in function 'baike'
	<string>:12: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{383770908 å¸è±ªé«˜ç´šå¨›æ¨‚æœƒæ‰€ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘è‹æ¾³ TextMsg 1599456209 136615 1504137667 <nil>} 
2020/09/07 13:23:33.144 [E]  QQLuaVmRun CallGlobal err <string>:42: cannot perform concat operation between string and nil
stack traceback:
	<string>:42: in function 'baike'
	<string>:12: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{383770908 å¸è±ªé«˜ç´šå¨›æ¨‚æœƒæ‰€ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘è‹æ¾³ TextMsg 1599456212 136617 2022594292 <nil>} 
2020/09/07 13:23:35.482 [E]  QQLuaVmRun CallGlobal err <string>:27: attempt to call a non-function object
stack traceback:
	<string>:27: in function 'baike'
	<string>:12: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{383770908 å¸è±ªé«˜ç´šå¨›æ¨‚æœƒæ‰€ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘è‹æ¾³ TextMsg 1599456215 136618 98225408 <nil>} 
2020/09/07 13:24:03.630 [E]  QQLuaVmRun CallGlobal err <string>:27: attempt to call a non-function object
stack traceback:
	<string>:27: in function 'baike'
	<string>:12: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{383770908 å¸è±ªé«˜ç´šå¨›æ¨‚æœƒæ‰€ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘è‹æ¾³ TextMsg 1599456243 136622 2045150915 <nil>} 
2020/09/07 13:24:10.104 [E]  QQLuaVmRun CallGlobal err <string>:42: cannot perform concat operation between string and nil
stack traceback:
	<string>:42: in function 'baike'
	<string>:12: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{383770908 å¸è±ªé«˜ç´šå¨›æ¨‚æœƒæ‰€ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘æ•¬å¯æ´² TextMsg 1599456249 136623 2021102017 <nil>} 
2020/09/07 13:24:53.148 [E]  QQLuaVmRun CallGlobal err <string>:42: cannot perform concat operation between string and nil
stack traceback:
	<string>:42: in function 'baike'
	<string>:12: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{383770908 å¸è±ªé«˜ç´šå¨›æ¨‚æœƒæ‰€ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘è‹æ¾³ TextMsg 1599456292 136627 16851662 <nil>} 
2020/09/07 13:25:48.126 [E]  QQLuaVmRun CallGlobal err <string>:42: cannot perform concat operation between string and nil
stack traceback:
	<string>:42: in function 'baike'
	<string>:12: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{383770908 å¸è±ªé«˜ç´šå¨›æ¨‚æœƒæ‰€ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘æ•¬å¯æ´² TextMsg 1599456347 136628 5887041 <nil>} 
2020/09/07 13:26:37.719 [E]  QQLuaVmRun CallGlobal err <string>:999: attempt to index a non-table object(nil) with key 'GroupID'
stack traceback:
	<string>:999: in function 'CheHui'
	<string>:417: in main chunk
	[G]: ? detail File mimoio.lua when  call ReceiveEvents params [0] 1689236904  [1] &{383770908 0 ON_EVENT_GROUP_REVOKE 136630 ç¾¤æˆå‘˜æ’¤å›æ¶ˆæ¯äº‹ä»¶ <nil>}  [2] map[AdminUserID:1689236904 GroupID:383770908 MsgRandom:2227035871 MsgSeq:136630 UserID:1689236904]
2020/09/07 13:28:48.776 [E]  QQLuaVmRun CallGlobal err <string>:999: attempt to index a non-table object(nil) with key 'GroupID'
stack traceback:
	<string>:999: in function 'CheHui'
	<string>:417: in main chunk
	[G]: ? detail File mimoio.lua when  call ReceiveEvents params [0] 1689236904  [1] &{383770908 0 ON_EVENT_GROUP_REVOKE 136632 ç¾¤æˆå‘˜æ’¤å›æ¶ˆæ¯äº‹ä»¶ <nil>}  [2] map[AdminUserID:1689236904 GroupID:383770908 MsgRandom:119382191 MsgSeq:136632 UserID:1689236904]
2020/09/07 13:35:05.632 [E]  QQLuaVmRun CallGlobal err <string>:27: attempt to call a non-function object
stack traceback:
	<string>:27: in function 'baike'
	<string>:12: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{383770908 å¸è±ªé«˜ç´šå¨›æ¨‚æœƒæ‰€ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘æ¶©å›¾ TextMsg 1599456905 136639 3859441354 <nil>} 
2020/09/07 13:35:22.097 [E]  QQLuaVmRun CallGlobal err <string>:42: cannot perform concat operation between string and nil
stack traceback:
	<string>:42: in function 'baike'
	<string>:12: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{383770908 å¸è±ªé«˜ç´šå¨›æ¨‚æœƒæ‰€ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘æ–°å¹´è¥¿å—ç§‘æŠ€å¤§å­¦ TextMsg 1599456921 136640 355628252 <nil>} 
2020/09/07 13:50:26.511 [E]  QQLuaVmRun CallGlobal err <string>:27: attempt to call a non-function object
stack traceback:
	<string>:27: in function 'baike'
	<string>:12: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{383770908 å¸è±ªé«˜ç´šå¨›æ¨‚æœƒæ‰€ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘è¥¿å—ç§‘æŠ€å¤§å­¦ TextMsg 1599457826 136641 4048191387 <nil>} 
2020/09/07 14:22:58.666 [E]  QQLuaVmRun CallGlobal err <string>:33: cannot perform concat operation between string and nil
stack traceback:
	<string>:33: in function 'baike'
	<string>:12: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{959562190 æµ‹è¯•ç¾¤ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘é©¬äº‘ TextMsg 1599459778 6690 4020322464 <nil>} 
2020/09/07 14:23:05.360 [E]  QQLuaVmRun CallGlobal err <string>:33: cannot perform concat operation between string and nil
stack traceback:
	<string>:33: in function 'baike'
	<string>:12: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{959562190 æµ‹è¯•ç¾¤ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘é©¬äº‘ TextMsg 1599459785 6691 1393549028 <nil>} 
2020/09/07 14:23:25.572 [E]  QQLuaVmRun CallGlobal err <string>:27: attempt to call a non-function object
stack traceback:
	<string>:27: in function 'baike'
	<string>:12: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{959562190 æµ‹è¯•ç¾¤ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘æ·˜å® TextMsg 1599459805 6692 1438733807 <nil>} 
2020/09/07 14:23:28.777 [E]  QQLuaVmRun CallGlobal err <string>:33: cannot perform concat operation between string and nil
stack traceback:
	<string>:33: in function 'baike'
	<string>:12: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{959562190 æµ‹è¯•ç¾¤ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘é©¬äº‘ TextMsg 1599459808 6693 1094743045 <nil>} 
2020/09/07 14:23:43.995 [E]  QQLuaVmRun CallGlobal err <string>:27: attempt to call a non-function object
stack traceback:
	<string>:27: in function 'baike'
	<string>:12: in main chunk
	[G]: ? detail File baike2.lua when  call ReceiveGroupMsg params [0] 1689236904  [1] &{959562190 æµ‹è¯•ç¾¤ 2450459910 å‡¤é£ç¿±ç¿”å…®ä¸· ç™¾ç§‘é©¬äº‘ TextMsg 1599459823 6694 4154281280 <nil>} 
2020/09/07 15:22:45.005 [E]  QQLuaVmRun CallGlobal err Unknow Lua Function:ReceiveEvents detail File weatherfy4a.lua when  call ReceiveEvents params [0] 1689236904  [1] &{928308961 0 ON_EVENT_GROUP_REVOKE 529808 ç¾¤æˆå‘˜æ’¤å›æ¶ˆæ¯äº‹ä»¶ <nil>}  [2] map[AdminUserID:1689236904 GroupID:928308961 MsgRandom:1988743755 MsgSeq:529808 UserID:1689236904]
2020/09/07 16:31:03.549 [E]  QQLuaVmRun CallGlobal err <string>:999: attempt to index a non-table object(nil) with key 'GroupID'
stack traceback:
	<string>:999: in function 'CheHui'
	<string>:417: in main chunk
	[G]: ? detail File mimoio.lua when  call ReceiveEvents params [0] 1689236904  [1] &{383770908 0 ON_EVENT_GROUP_REVOKE 136654 ç¾¤æˆå‘˜æ’¤å›æ¶ˆæ¯äº‹ä»¶ <nil>}  [2] map[AdminUserID:1689236904 GroupID:383770908 MsgRandom:99838422 MsgSeq:136654 UserID:1689236904]
2020/09/07 16:31:09.936 [E]  QQLuaVmRun CallGlobal err <string>:999: attempt to index a non-table object(nil) with key 'GroupID'
stack traceback:
	<string>:999: in function 'CheHui'
	<string>:417: in main chunk
	[G]: ? detail File mimoio.lua when  call ReceiveEvents params [0] 1689236904  [1] &{383770908 0 ON_EVENT_GROUP_REVOKE 136656 ç¾¤æˆå‘˜æ’¤å›æ¶ˆæ¯äº‹ä»¶ <nil>}  [2] map[AdminUserID:1689236904 GroupID:383770908 MsgRandom:721728631 MsgSeq:136656 UserID:1689236904]
2020/09/07 16:31:23.461 [E]  QQLuaVmRun CallGlobal err <string>:999: attempt to index a non-table object(nil) with key 'GroupID'
stack traceback:
	<string>:999: in function 'CheHui'
	<string>:417: in main chunk
	[G]: ? detail File mimoio.lua when  call ReceiveEvents params [0] 1689236904  [1] &{383770908 0 ON_EVENT_GROUP_REVOKE 136659 ç¾¤æˆå‘˜æ’¤å›æ¶ˆæ¯äº‹ä»¶ <nil>}  [2] map[AdminUserID:1689236904 GroupID:383770908 MsgRandom:1584082702 MsgSeq:136659 UserID:1689236904]
2020/09/07 16:31:28.609 [E]  QQLuaVmRun CallGlobal err <string>:999: attempt to index a non-table object(nil) with key 'GroupID'
stack traceback:
	<string>:999: in function 'CheHui'
	<string>:417: in main chunk
	[G]: ? detail File mimoio.lua when  call ReceiveEvents params [0] 1689236904  [1] &{383770908 0 ON_EVENT_GROUP_REVOKE 136661 ç¾¤æˆå‘˜æ’¤å›æ¶ˆæ¯äº‹ä»¶ <nil>}  [2] map[AdminUserID:1689236904 GroupID:383770908 MsgRandom:3195877935 MsgSeq:136661 UserID:1689236904]
2020/09/07 16:31:40.162 [E]  QQLuaVmRun CallGlobal err <string>:999: attempt to index a non-table object(nil) with key 'GroupID'
stack traceback:
	<string>:999: in function 'CheHui'
	<string>:417: in main chunk
	[G]: ? detail File mimoio.lua when  call ReceiveEvents params [0] 1689236904  [1] &{383770908 0 ON_EVENT_GROUP_REVOKE 136663 ç¾¤æˆå‘˜æ’¤å›æ¶ˆæ¯äº‹ä»¶ <nil>}  [2] map[AdminUserID:1689236904 GroupID:383770908 MsgRandom:3324557076 MsgSeq:136663 UserID:1689236904]
2020/09/07 16:31:45.940 [E]  QQLuaVmRun CallGlobal err <string>:999: attempt to index a non-table object(nil) with key 'GroupID'
stack traceback:
	<string>:999: in function 'CheHui'
	<string>:417: in main chunk
	[G]: ? detail File mimoio.lua when  call ReceiveEvents params [0] 1689236904  [1] &{383770908 0 ON_EVENT_GROUP_REVOKE 136665 ç¾¤æˆå‘˜æ’¤å›æ¶ˆæ¯äº‹ä»¶ <nil>}  [2] map[AdminUserID:1689236904 GroupID:383770908 MsgRandom:1067038125 MsgSeq:136665 UserID:1689236904]
2020/09/07 16:31:46.651 [E]  QQLuaVmRun CallGlobal err <string>:999: attempt to index a non-table object(nil) with key 'GroupID'
stack traceback:
	<string>:999: in function 'CheHui'
	<string>:417: in main chunk
	[G]: ? detail File mimoio.lua when  call ReceiveEvents params [0] 1689236904  [1] &{383770908 0 ON_EVENT_GROUP_REVOKE 136667 ç¾¤æˆå‘˜æ’¤å›æ¶ˆæ¯äº‹ä»¶ <nil>}  [2] map[AdminUserID:1689236904 GroupID:383770908 MsgRandom:3950981770 MsgSeq:136667 UserID:1689236904]
2020/09/07 16:31:54.932 [E]  QQLuaVmRun CallGlobal err <string>:999: attempt to index a non-table object(nil) with key 'GroupID'
stack traceback:
	<string>:999: in function 'CheHui'
	<string>:417: in main chunk
	[G]: ? detail File mimoio.lua when  call ReceiveEvents params [0] 1689236904  [1] &{383770908 0 ON_EVENT_GROUP_REVOKE 136669 ç¾¤æˆå‘˜æ’¤å›æ¶ˆæ¯äº‹ä»¶ <nil>}  [2] map[AdminUserID:1689236904 GroupID:383770908 MsgRandom:1734097886 MsgSeq:136669 UserID:1689236904]
2020/09/07 17:23:33.143 [E]  QQLuaVmRun CallGlobal err <string>:999: attempt to index a non-table object(nil) with key 'GroupID'
stack traceback:
	<string>:999: in function 'CheHui'
	<string>:417: in main chunk
	[G]: ? detail File mimoio.lua when  call ReceiveEvents params [0] 1689236904  [1] &{383770908 0 ON_EVENT_GROUP_REVOKE 136671 ç¾¤æˆå‘˜æ’¤å›æ¶ˆæ¯äº‹ä»¶ <nil>}  [2] map[AdminUserID:1689236904 GroupID:383770908 MsgRandom:1524734990 MsgSeq:136671 UserID:1689236904]
2020/09/07 17:24:29.436 [E]  QQLuaVmRun CallGlobal err <string>:999: attempt to index a non-table object(nil) with key 'GroupID'
stack traceback:
	<string>:999: in function 'CheHui'
	<string>:417: in main chunk
	[G]: ? detail File mimoio.lua when  call ReceiveEvents params [0] 1689236904  [1] &{383770908 0 ON_EVENT_GROUP_REVOKE 136673 ç¾¤æˆå‘˜æ’¤å›æ¶ˆæ¯äº‹ä»¶ <nil>}  [2] map[AdminUserID:1689236904 GroupID:383770908 MsgRandom:3185927130 MsgSeq:136673 UserID:1689236904]
2020/09/07 17:24:49.633 [E]  QQLuaVmRun CallGlobal err <string>:999: attempt to index a non-table object(nil) with key 'GroupID'
stack traceback:
	<string>:999: in function 'CheHui'
	<string>:417: in main chunk
	[G]: ? detail File mimoio.lua when  call ReceiveEvents params [0] 1689236904  [1] &{383770908 0 ON_EVENT_GROUP_REVOKE 136676 ç¾¤æˆå‘˜æ’¤å›æ¶ˆæ¯äº‹ä»¶ <nil>}  [2] map[AdminUserID:1689236904 GroupID:383770908 MsgRandom:1796749261 MsgSeq:136676 UserID:1689236904]
2020/09/07 17:25:13.859 [E]  QQLuaVmRun CallGlobal err <string>:999: attempt to index a non-table object(nil) with key 'GroupID'
stack traceback:
	<string>:999: in function 'CheHui'
	<string>:417: in main chunk
	[G]: ? detail File mimoio.lua when  call ReceiveEvents params [0] 1689236904  [1] &{383770908 0 ON_EVENT_GROUP_REVOKE 136678 ç¾¤æˆå‘˜æ’¤å›æ¶ˆæ¯äº‹ä»¶ <nil>}  [2] map[AdminUserID:1689236904 GroupID:383770908 MsgRandom:3254537161 MsgSeq:136678 UserID:1689236904]
2020/09/07 18:16:17.099 [E]  QQLuaVmRun CallGlobal err Unknow Lua Function:ReceiveEvents detail File weatherfy4a.lua when  call ReceiveEvents params [0] 1689236904  [1] &{581168848 1689236904 ON_EVENT_GROUP_EXIT 0 ç¾¤æˆå‘˜é€€å‡ºç¾¤èŠäº‹ä»¶ <nil>}  [2] map[UserID:2654568218]
2020/09/07 20:00:32.560 [E]  QQLuaVmRun CallGlobal err <string>:999: attempt to index a non-table object(nil) with key 'GroupID'
stack traceback:
	<string>:999: in function 'CheHui'
	<string>:417: in main chunk
	[G]: ? detail File mimoio.lua when  call ReceiveEvents params [0] 1689236904  [1] &{383770908 0 ON_EVENT_GROUP_REVOKE 136751 ç¾¤æˆå‘˜æ’¤å›æ¶ˆæ¯äº‹ä»¶ <nil>}  [2] map[AdminUserID:751329708 GroupID:383770908 MsgRandom:1599479157 MsgSeq:136751 UserID:1689236904]
2020/09/07 23:46:39.810 [E]  QQLuaVmRun CallGlobal err <string>:999: attempt to index a non-table object(nil) with key 'GroupID'
stack traceback:
	<string>:999: in function 'CheHui'
	<string>:417: in main chunk
	[G]: ? detail File mimoio.lua when  call ReceiveEvents params [0] 1689236904  [1] &{383770908 0 ON_EVENT_GROUP_REVOKE 136778 ç¾¤æˆå‘˜æ’¤å›æ¶ˆæ¯äº‹ä»¶ <nil>}  [2] map[AdminUserID:1689236904 GroupID:383770908 MsgRandom:3338444353 MsgSeq:136778 UserID:1689236904]
2020/09/07 23:46:41.858 [E]  QQLuaVmRun CallGlobal err <string>:999: attempt to index a non-table object(nil) with key 'GroupID'
stack traceback:
	<string>:999: in function 'CheHui'
	<string>:417: in main chunk
	[G]: ? detail File mimoio.lua when  call ReceiveEvents params [0] 1689236904  [1] &{383770908 0 ON_EVENT_GROUP_REVOKE 136780 ç¾¤æˆå‘˜æ’¤å›æ¶ˆæ¯äº‹ä»¶ <nil>}  [2] map[AdminUserID:1689236904 GroupID:383770908 MsgRandom:1080568956 MsgSeq:136780 UserID:1689236904]
2020/09/07 23:46:51.885 [E]  QQLuaVmRun CallGlobal err <string>:999: attempt to index a non-table object(nil) with key 'GroupID'
stack traceback:
	<string>:999: in function 'CheHui'
	<string>:417: in main chunk
	[G]: ? detail File mimoio.lua when  call ReceiveEvents params [0] 1689236904  [1] &{383770908 0 ON_EVENT_GROUP_REVOKE 136782 ç¾¤æˆå‘˜æ’¤å›æ¶ˆæ¯äº‹ä»¶ <nil>}  [2] map[AdminUserID:1689236904 GroupID:383770908 MsgRandom:1052616707 MsgSeq:136782 UserID:1689236904]
2020/09/07 23:46:59.547 [E]  QQLuaVmRun CallGlobal err <string>:999: attempt to index a non-table object(nil) with key 'GroupID'
stack traceback:
	<string>:999: in function 'CheHui'
	<string>:417: in main chunk
	[G]: ? detail File mimoio.lua when  call ReceiveEvents params [0] 1689236904  [1] &{383770908 0 ON_EVENT_GROUP_REVOKE 136784 ç¾¤æˆå‘˜æ’¤å›æ¶ˆæ¯äº‹ä»¶ <nil>}  [2] map[AdminUserID:1689236904 GroupID:383770908 MsgRandom:2348033017 MsgSeq:136784 UserID:1689236904]
2020/09/07 23:47:05.677 [E]  QQLuaVmRun CallGlobal err <string>:999: attempt to index a non-table object(nil) with key 'GroupID'
stack traceback:
	<string>:999: in function 'CheHui'
	<string>:417: in main chunk
	[G]: ? detail File mimoio.lua when  call ReceiveEvents params [0] 1689236904  [1] &{383770908 0 ON_EVENT_GROUP_REVOKE 136786 ç¾¤æˆå‘˜æ’¤å›æ¶ˆæ¯äº‹ä»¶ <nil>}  [2] map[AdminUserID:1689236904 GroupID:383770908 MsgRandom:1234940024 MsgSeq:136786 UserID:1689236904]
2020/09/07 23:47:13.498 [E]  QQLuaVmRun CallGlobal err <string>:999: attempt to index a non-table object(nil) with key 'GroupID'
stack traceback:
	<string>:999: in function 'CheHui'
	<string>:417: in main chunk
	[G]: ? detail File mimoio.lua when  call ReceiveEvents params [0] 1689236904  [1] &{383770908 0 ON_EVENT_GROUP_REVOKE 136788 ç¾¤æˆå‘˜æ’¤å›æ¶ˆæ¯äº‹ä»¶ <nil>}  [2] map[AdminUserID:1689236904 GroupID:383770908 MsgRandom:2218260812 MsgSeq:136788 UserID:1689236904]
2020/09/07 23:47:20.679 [E]  QQLuaVmRun CallGlobal err <string>:999: attempt to index a non-table object(nil) with key 'GroupID'
stack traceback:
	<string>:999: in function 'CheHui'
	<string>:417: in main chunk
	[G]: ? detail File mimoio.lua when  call ReceiveEvents params [0] 1689236904  [1] &{383770908 0 ON_EVENT_GROUP_REVOKE 136790 ç¾¤æˆå‘˜æ’¤å›æ¶ˆæ¯äº‹ä»¶ <nil>}  [2] map[AdminUserID:1689236904 GroupID:383770908 MsgRandom:2345497921 MsgSeq:136790 UserID:1689236904]
2020/09/07 23:47:35.170 [E]  QQLuaVmRun CallGlobal err <string>:999: attempt to index a non-table object(nil) with key 'GroupID'
stack traceback:
	<string>:999: in function 'CheHui'
	<string>:417: in main chunk
	[G]: ? detail File mimoio.lua when  call ReceiveEvents params [0] 1689236904  [1] &{383770908 0 ON_EVENT_GROUP_REVOKE 136792 ç¾¤æˆå‘˜æ’¤å›æ¶ˆæ¯äº‹ä»¶ <nil>}  [2] map[AdminUserID:1689236904 GroupID:383770908 MsgRandom:1806400822 MsgSeq:136792 UserID:1689236904]
